exports.id=15,exports.ids=[15],exports.modules={1191:(e,t,a)=>{"use strict";a.d(t,{N6:()=>n,UX:()=>s,XU:()=>r});let r={Ward6:"Ward 6",Ward7:"Ward 7",Ward8:"Ward 8",Ward9:"Ward 9",WardGI:"Ward GI",Ward10B:"Ward 10B",Ward11:"Ward 11",Ward12:"Ward 12",ICU:"ICU",CCU:"CCU",LR:"LR",NSY:"NSY"},s=["Ward6","Ward7","Ward8","Ward9","WardGI","Ward10B","Ward11","Ward12","ICU","CCU","LR","NSY"],n={numberOfPatients:"0",nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",overallData:"0",availableBeds:"0",plannedDischarge:"0",unavailable:"0",comment:""}},39946:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(60687),s=a(43210),n=a(16189),l=a(84623),i=a(16509),o=a(36006),d=a(70069);function c({children:e,title:t,requiredRole:a="user",infoBox:c}){let{user:u,loading:m,isAuthenticated:f}=(0,l.A)(),x=(0,n.useRouter)(),[h,b]=(0,s.useState)(!1);return m?(0,r.jsx)(o.A,{}):f?h?(0,r.jsx)(i.A,{requiredRole:a,children:(0,r.jsxs)("div",{className:"min-h-screen pb-16 relative",children:[(0,r.jsxs)("main",{className:"container mx-auto px-4 pt-20",children:[t&&(0,r.jsx)("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:t}),c&&(0,r.jsx)("div",{className:"mb-6",children:c}),e]}),(0,r.jsx)("div",{className:"fixed bottom-4 right-4 text-sm text-gray-500",children:d.h})]})}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"max-w-md w-full p-6 bg-white rounded-lg shadow-lg",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("svg",{className:"mx-auto h-16 w-16 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsx)("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"ไม่มีสิทธิ์เข้าถึง"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"คุณไม่มีสิทธิ์เพียงพอในการเข้าถึงหน้านี้ กรุณาติดต่อผู้ดูแลระบบหากคุณเชื่อว่านี่เป็นข้อผิดพลาด"}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)("button",{type:"button",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:()=>x.push("/"),children:"กลับไปยังหน้าหลัก"})})]})})}):null}a(84788)},59863:()=>{},70069:(e,t,a)=>{"use strict";a.d(t,{h:()=>r});let r="v.2.3.3.2025"},77820:(e,t,a)=>{"use strict";a.d(t,{A:()=>w});var r=a(60687),s=a(43210),n=a(9141),l=a(75535);a(59863);var i=a(1191),o=a(1923),d=a(84788),c=a(84623);let u=({wardId:e,date:t,status:a="pending"})=>{let[i,u]=(0,s.useState)(!1),{user:m}=(0,c.A)(),f=m?.role==="supervisor"||m?.role==="admin";if(!f&&"pending"===a)return(0,r.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"รออนุมัติ"]});let x=async()=>{try{u(!0);let a=await o.YU.fire({title:"ลงชื่อผู้อนุมัติ",html:`
          <div class="text-left">
            <p class="mb-2 font-medium">กรุณากรอกชื่อผู้อนุมัติ</p>
            <div class="mb-3">
              <label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">ชื่อ</label>
              <input type="text" id="firstName" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="ชื่อ" value="${m?.firstName||""}">
            </div>
            <div>
              <label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">นามสกุล</label>
              <input type="text" id="lastName" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="นามสกุล" value="${m?.lastName||""}">
            </div>
          </div>
        `,icon:"info",showCancelButton:!0,confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33",preConfirm:()=>{let e=document.getElementById("firstName").value,t=document.getElementById("lastName").value;return e.trim()?t.trim()?{firstName:e,lastName:t}:(o.YU.showValidationMessage("กรุณากรอกนามสกุล"),!1):(o.YU.showValidationMessage("กรุณากรอกชื่อ"),!1)}});if(!a.isConfirmed){u(!1);return}let{firstName:r,lastName:s}=a.value;if(!(await o.YU.fire({title:"อนุมัติข้อมูล Ward",html:`
          <div class="text-left">
            <p class="mb-2 font-medium">คุณต้องการอนุมัติข้อมูลของ ${e} ใช่หรือไม่?</p>
            <p class="text-sm text-gray-600">วันที่: ${t}</p>
            <p class="text-sm text-gray-600">ผู้อนุมัติ: ${r} ${s}</p>
          </div>
        `,icon:"question",showCancelButton:!0,confirmButtonText:"อนุมัติ",cancelButtonText:"ยกเลิก",confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33"})).isConfirmed){u(!1);return}let i=(0,l.H9)(n.db,"wardDailyRecords",`${t}_${e}`);await (0,l.mZ)(i,{approvalStatus:"approved",approvedAt:new Date().toISOString(),approvedBy:{uid:m?.uid||"",firstName:r,lastName:s,displayName:`${r} ${s}`,email:m?.email||""}});try{let a=(0,l.H9)(n.db,"approvalQueue",`${t}_${e}`);await (0,l.kd)(a),console.log("Removed from approvalQueue:",`${t}_${e}`)}catch(e){console.error("Error removing from approvalQueue:",e)}(0,d.$s)("approval_success",{wardId:e,date:t,action:"Approve ข้อมูลสำเร็จ",approvedBy:`${r} ${s}`,approvedById:m?.uid,timestamp:new Date().toISOString()}),await o.YU.fire({title:"อนุมัติสำเร็จ",text:`ข้อมูลของ ${e} ได้รับการอนุมัติแล้ว`,icon:"success",confirmButtonColor:"#0ab4ab"}),window.location.reload()}catch(e){console.error("Error approving ward data:",e),await o.YU.fire({title:"เกิดข้อผิดพลาด",text:"ไม่สามารถอนุมัติข้อมูลได้ กรุณาลองอีกครั้ง",icon:"error",confirmButtonColor:"#0ab4ab"})}finally{u(!1)}},h=async()=>{try{u(!0);let a=await o.YU.fire({title:"ลงชื่อผู้ปฏิเสธ",html:`
          <div class="text-left">
            <p class="mb-2 font-medium">กรุณากรอกชื่อผู้ปฏิเสธ</p>
            <div class="mb-3">
              <label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">ชื่อ</label>
              <input type="text" id="firstName" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="ชื่อ" value="${m?.firstName||""}">
            </div>
            <div class="mb-3">
              <label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">นามสกุล</label>
              <input type="text" id="lastName" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="นามสกุล" value="${m?.lastName||""}">
            </div>
          </div>
        `,icon:"info",showCancelButton:!0,confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33",preConfirm:()=>{let e=document.getElementById("firstName").value,t=document.getElementById("lastName").value;return e.trim()?t.trim()?{firstName:e,lastName:t}:(o.YU.showValidationMessage("กรุณากรอกนามสกุล"),!1):(o.YU.showValidationMessage("กรุณากรอกชื่อ"),!1)}});if(!a.isConfirmed){u(!1);return}let{firstName:r,lastName:s}=a.value,i=await o.YU.fire({title:"ปฏิเสธข้อมูล Ward",html:`
          <div class="text-left">
            <p class="mb-2 font-medium">กรุณาระบุเหตุผลในการปฏิเสธ:</p>
            <textarea id="rejection-reason" class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="3"></textarea>
            <p class="text-sm text-gray-600 mt-2">ผู้ปฏิเสธ: ${r} ${s}</p>
          </div>
        `,icon:"warning",showCancelButton:!0,confirmButtonText:"ปฏิเสธ",cancelButtonText:"ยกเลิก",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",preConfirm:()=>{let e=document.getElementById("rejection-reason").value;return e.trim()||o.YU.showValidationMessage("กรุณาระบุเหตุผลในการปฏิเสธ"),e}});if(!i.isConfirmed){u(!1);return}let c=i.value,f=(0,l.H9)(n.db,"wardDailyRecords",`${t}_${e}`);await (0,l.mZ)(f,{approvalStatus:"rejected",rejectedAt:new Date().toISOString(),rejectionReason:c,rejectedBy:{uid:m?.uid||"",firstName:r,lastName:s,displayName:`${r} ${s}`,email:m?.email||""}});try{let a=(0,l.H9)(n.db,"approvalQueue",`${t}_${e}`);await (0,l.kd)(a),console.log("Removed from approvalQueue:",`${t}_${e}`)}catch(e){console.error("Error removing from approvalQueue:",e)}(0,d.$s)("rejection_success",{wardId:e,date:t,action:"ปฏิเสธข้อมูล",rejectedBy:`${r} ${s}`,rejectedById:m?.uid,reason:c,timestamp:new Date().toISOString()}),await o.YU.fire({title:"ปฏิเสธข้อมูลสำเร็จ",text:`ข้อมูลของ ${e} ถูกปฏิเสธแล้ว`,icon:"success",confirmButtonColor:"#0ab4ab"}),window.location.reload()}catch(e){console.error("Error rejecting ward data:",e),await o.YU.fire({title:"เกิดข้อผิดพลาด",text:"ไม่สามารถปฏิเสธข้อมูลได้ กรุณาลองอีกครั้ง",icon:"error",confirmButtonColor:"#0ab4ab"})}finally{u(!1)}};return"approved"===a?(0,r.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"อนุมัติแล้ว"]}):"rejected"===a?(0,r.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),"ปฏิเสธแล้ว"]}):f&&"pending"===a?(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:x,disabled:i,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",children:i?"กำลังดำเนินการ...":"อนุมัติ"}),(0,r.jsx)("button",{onClick:h,disabled:i,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:i?"กำลังดำเนินการ...":"ปฏิเสธ"})]}):(0,r.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"รออนุมัติ"]})},m=({WARD_ORDER:e,formData:t,handleInputChange:a,displayValue:s,approvalStatuses:n={},selectedDate:l,readOnly:o=!1})=>{let d=(e,t,r)=>{"function"==typeof a&&a(e,t,r.replace(/[^0-9]/g,""))},c=(e,a)=>t&&t[e]?t[e][a]:"",m=Array.isArray(e)?e:[];return(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("div",{className:"inline-flex gap-1 min-w-max p-1",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h3",{className:"text-xs font-bold text-gray-700 font-THSarabun",children:"Wards"})}),m.map(e=>(0,r.jsx)("div",{className:"h-8 flex items-center",children:(0,r.jsx)("span",{className:"text-xs font-semibold text-[#0ab4ab] font-THSarabun whitespace-nowrap",children:i.XU[e]||e})},e)),(0,r.jsx)("div",{className:"h-8 flex items-center",children:(0,r.jsx)("span",{className:"text-xs font-semibold text-purple-600 font-THSarabun",children:"Total"})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Patient Census"})}),m.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-[#0ab4ab]/20 to-[#0ab4ab]/10 rounded-md p-1 text-[#0ab4ab] shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s(c(e,"numberOfPatients")),className:"w-16 text-center text-sm font-bold bg-gray-100 border-b border-[#0ab4ab] focus:outline-none text-[#0ab4ab] placeholder-[#0ab4ab]/50 font-THSarabun cursor-not-allowed",placeholder:"0",readOnly:!0,disabled:!0})})},e)),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s(t?.totals?.numberOfPatients||"0"),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Overall Data"})}),m.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-400/20 to-blue-500/10 rounded-md p-1 text-blue-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s(c(e,"overallData")),className:"w-16 text-center text-sm font-bold bg-gray-100 border-b border-blue-500 focus:outline-none text-blue-600 placeholder-blue-300 font-THSarabun cursor-not-allowed",placeholder:"0",readOnly:!0,disabled:!0})})},e)),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s(t?.totals?.overallData||"0"),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]}),Object.entries({"Nurse Manager":"nurseManager",RN:"RN",PN:"PN",WC:"WC",NA:"nurseAid"}).map(([e,a])=>(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:e})}),m.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-400/20 to-green-500/10 rounded-md p-1 text-green-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s(c(e,a)),onChange:t=>d(a,e,t.target.value),className:`w-16 text-center text-sm font-bold ${o?"bg-gray-100 cursor-not-allowed":"bg-white"} border-b border-green-500 focus:outline-none focus:border-green-500 text-black placeholder-green-300 font-THSarabun`,placeholder:"0",min:"0",readOnly:o,disabled:o})})},e)),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s(t?.totals?.[a]||"0"),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},a)),Object.entries({"New Admit":"newAdmit","Transfer In":"transferIn","Refer In":"referIn","Transfer Out":"transferOut","Refer Out":"referOut",Discharge:"discharge",Dead:"dead"}).map(([e,a])=>(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:e})}),m.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-yellow-400/20 to-yellow-500/10 rounded-md p-1 text-yellow-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s(c(e,a)),onChange:t=>d(a,e,t.target.value),className:`w-16 text-center text-sm font-bold ${o?"bg-gray-100 cursor-not-allowed":"bg-white"} border-b border-yellow-500 focus:outline-none focus:border-yellow-500 text-black placeholder-yellow-300 font-THSarabun`,placeholder:"0",min:"0",readOnly:o,disabled:o})})},e)),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s(t?.totals?.[a]||"0"),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},a)),Object.entries({Available:"availableBeds",Unavailable:"unavailable","Planned Discharge":"plannedDischarge"}).map(([e,a])=>(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:e})}),m.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-pink-400/20 to-pink-500/10 rounded-md p-1 text-pink-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s(c(e,a)),onChange:t=>d(a,e,t.target.value),className:`w-16 text-center text-sm font-bold ${o?"bg-gray-100 cursor-not-allowed":"bg-white"} border-b border-pink-500 focus:outline-none focus:border-pink-500 text-black placeholder-pink-300 font-THSarabun`,placeholder:"0",min:"0",readOnly:o,disabled:o})})},e)),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s(t?.totals?.[a]||"0"),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},a)),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Comment"})}),m.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-gray-100 to-gray-200 rounded-md p-1 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",value:t?.[e]?.comment||"",onChange:t=>d("comment",e,t.target.value),className:`w-24 text-center text-xs ${o?"bg-gray-100 cursor-not-allowed":"bg-white"} border-b border-gray-400 focus:outline-none focus:border-gray-600 text-black placeholder-gray-300 font-THSarabun`,placeholder:"Add comment...",readOnly:o,disabled:o})})},e)),(0,r.jsx)("div",{className:"h-8"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Approval Status"})}),m.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-100 to-blue-200 rounded-md p-1 shadow h-8",children:(0,r.jsx)("div",{className:"text-center flex justify-center items-center",children:n[e]?(0,r.jsx)(u,{wardId:e,date:l,status:n[e]}):(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"No data"})})},e)),(0,r.jsx)("div",{className:"h-8"})]})]})})},f=({label:e,oldValue:t,newValue:a})=>(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 py-1",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600",children:e}),(0,r.jsx)("div",{className:"text-sm text-purple-600",children:t||"-"}),(0,r.jsx)("div",{className:"text-sm text-pink-600",children:a||"-"})]}),x=({showDataComparison:e,existingData:t,formData:a,summaryData:s,setShowDataComparison:n,saveData:l,WARD_ORDER:i})=>e&&t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-xl font-medium mb-4",children:"Data Comparison"}),(0,r.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-lg mb-2",children:e}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-2",children:[(0,r.jsx)("div",{className:"font-medium",children:"Field"}),(0,r.jsx)("div",{className:"font-medium",children:"Current"}),(0,r.jsx)("div",{className:"font-medium",children:"New"})]}),(0,r.jsx)("div",{className:"space-y-1",children:(0,r.jsx)(f,{label:"Patient Census",oldValue:t?.wards?.[e]?.numberOfPatients,newValue:a?.wards?.[e]?.numberOfPatients})})]},e))}),(0,r.jsxs)("div",{className:"mt-6 flex justify-end gap-4",children:[(0,r.jsx)("button",{onClick:()=>n(!1),className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"}),(0,r.jsx)("button",{onClick:l,className:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600",children:"Save Changes"})]})]})}):null;var h=a(39245);let b=({summaryData:e,setSummaryData:t})=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6",children:(0,r.jsx)("div",{className:"grid grid-cols-1 gap-8",children:(0,r.jsxs)("div",{className:"bg-green-50/80 rounded-xl p-5 shadow-sm",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-green-800 mb-4 bg-white/50 py-2 px-4 rounded-lg text-center shadow-sm",children:"Supervisor Signature"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-green-700",children:"First Name"}),(0,r.jsx)("input",{type:"text",value:e.supervisorFirstName,onChange:e=>t(t=>({...t,supervisorFirstName:e.target.value})),className:"w-full text-black px-3 py-2 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-300 focus:border-green-300 bg-white/70",placeholder:"ชื่อ"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-green-700",children:"Last Name"}),(0,r.jsx)("input",{type:"text",value:e.supervisorLastName,onChange:e=>t(t=>({...t,supervisorLastName:e.target.value})),className:"w-full text-black px-3 py-2 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-300 focus:border-green-300 bg-white/70",placeholder:"นามสกุล"})]})]})]})})}),p=({summaryData:e,setSummaryData:t})=>(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-center mb-6 text-indigo-800 bg-white/50 py-2 rounded-lg shadow-sm",children:"ข้อมูลสรุป 24 ชั่วโมง"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"bg-pink-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-pink-700 mb-2",children:"OPD 24hr"}),(0,r.jsx)("input",{type:"number",value:e.opdTotal24hr,onChange:e=>t(t=>({...t,opdTotal24hr:e.target.value})),className:"w-full text-black px-3 py-2 border border-pink-200 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-pink-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-purple-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"Old Patient"}),(0,r.jsx)("input",{type:"number",value:e.existingPatients,onChange:e=>t(t=>({...t,existingPatients:e.target.value})),className:"w-full text-black px-3 py-2 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"New Patient"}),(0,r.jsx)("input",{type:"number",value:e.newPatients,onChange:e=>t(t=>({...t,newPatients:e.target.value})),className:"w-full text-black px-3 py-2 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-300 focus:border-blue-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-teal-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-teal-700 mb-2",children:"Admit 24hr"}),(0,r.jsx)("input",{type:"number",value:e.admissions24hr,onChange:e=>t(t=>({...t,admissions24hr:e.target.value})),className:"w-full text-black px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-300 focus:border-teal-300 bg-white/70",placeholder:"0"})]})]})]});var g=a(14188),v=a(16189);let w=({isApprovalMode:e=!1})=>{let t=(0,v.useRouter)(),{user:a}=(0,c.A)(),[d,u]=(0,s.useState)(0),[f,w]=(0,s.useState)(!0),[N,y]=(0,s.useState)(!1),[j,C]=(0,s.useState)(!1),[D,B]=(0,s.useState)(new Date),[S,O]=(0,s.useState)([]),[$,k]=(0,s.useState)(""),[I,P]=(0,s.useState)(!1),[T,M]=(0,s.useState)({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:""}),[W,R]=(0,s.useState)({date:"",shift:"",wards:{Ward6:{...i.N6},Ward7:{...i.N6},Ward8:{...i.N6},Ward9:{...i.N6},WardGI:{...i.N6},Ward10B:{...i.N6},Ward11:{...i.N6},Ward12:{...i.N6},ICU:{...i.N6},CCU:{...i.N6},LR:{...i.N6},NSY:{...i.N6}},totals:{...i.N6}}),[U,A]=(0,s.useState)(!1),[E,L]=(0,s.useState)(null),[Y,H]=(0,s.useState)({initialLoading:!0,savingData:!1,checkingDuplicates:!1,fetchingDates:!1}),[_,G]=(0,s.useState)(""),[F,z]=(0,s.useState)(!1),[V,X]=(0,s.useState)(!1),[J,Q]=(0,s.useState)({});(0,s.useEffect)(()=>{let e=()=>window.innerWidth<768,t=()=>{X(e())};return X(e()),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),(0,s.useEffect)(()=>{setTimeout(()=>{w(!1)},1e3)},[]);let K=async e=>{try{if(!e)return;let t=(0,h.Ol)(new Date(e)),a=(0,l.rJ)(n.db,"wardDailyRecords"),r={};for(let e of i.UX){let s=(0,l.P)(a,(0,l._M)("date","==",t),(0,l._M)("wardId","==",e)),n=await (0,l.GG)(s);if(n.empty)r[e]=null;else{let t=n.docs[0].data();r[e]=t.approvalStatus||"pending"}}Q(r),console.log("Fetched approval statuses:",r)}catch(e){console.error("Error fetching approval statuses:",e)}};(0,s.useEffect)(()=>{console.log(`ShiftForm running in ${e?"approval":"normal"} mode`),e&&P(!0)},[e]);let[q,Z]=(0,s.useState)(!1),[ee,et]=(0,s.useState)(!1),ea=async e=>{try{let t=(0,l.rJ)(n.db,"staffRecords"),a=(0,l.P)(t,(0,l._M)("date","==",e),(0,l._M)("shift","==","07:00-19:00")),r=!(await (0,l.GG)(a)).empty;return Z(r),r}catch(e){return console.error("Error checking morning shift data:",e),Z(!1),!1}},er=async e=>{try{let t=(0,l.rJ)(n.db,"staffRecords"),a=(0,l.P)(t,(0,l._M)("date","==",e)),r=await (0,l.GG)(a),s=new Set(r.docs.map(e=>e.data().shift));return{hasMorningShift:s.has("07:00-19:00"),hasNightShift:s.has("19:00-07:00")}}catch(e){return console.error("Error checking date shifts:",e),{hasMorningShift:!1,hasNightShift:!1}}},es=(0,s.useMemo)(()=>Object.values(W.wards).reduce((e,t)=>({numberOfPatients:e.numberOfPatients+(Number(t.numberOfPatients)||0),nurseManager:e.nurseManager+(Number(t.nurseManager)||0),RN:e.RN+(Number(t.RN)||0),PN:e.PN+(Number(t.PN)||0),WC:e.WC+(Number(t.WC)||0),newAdmit:e.newAdmit+(Number(t.newAdmit)||0),transferIn:e.transferIn+(Number(t.transferIn)||0),referIn:e.referIn+(Number(t.referIn)||0),transferOut:e.transferOut+(Number(t.transferOut)||0),referOut:e.referOut+(Number(t.referOut)||0),discharge:e.discharge+(Number(t.discharge)||0),dead:e.dead+(Number(t.dead)||0),overallData:e.overallData+(Number(t.overallData)||0),availableBeds:e.availableBeds+(Number(t.availableBeds)||0),unavailable:e.unavailable+(Number(t.unavailable)||0),plannedDischarge:e.plannedDischarge+(Number(t.plannedDischarge)||0)}),{numberOfPatients:0,nurseManager:0,RN:0,PN:0,WC:0,newAdmit:0,transferIn:0,referIn:0,transferOut:0,referOut:0,discharge:0,dead:0,overallData:0,availableBeds:0,unavailable:0,plannedDischarge:0}),[W.wards]);(0,s.useEffect)(()=>{R(e=>({...e,totals:es}))},[es]);let en=(0,s.useCallback)(()=>{if(!a||a.role?.toLowerCase()==="admin"||a.role?.toLowerCase()==="approver")return i.UX;let e=a.department;return e&&i.UX.includes(e)?[e]:i.UX},[a]),el=(0,s.useMemo)(()=>en(),[en]),ei=(0,s.useCallback)((e,t,r)=>{if(a?.role?.toLowerCase()==="user"||I){console.log("View only mode: Changes are disabled");return}if(!t||!e){console.error("Missing ward or field type in handleInputChange");return}R(a=>{let s={...a};if(s.wards[t]||(s.wards[t]={}),s.wards[t][e]=r,["newAdmit","transferIn","referIn","transferOut","referOut","discharge","dead"].includes(e)){let e=s.wards[t],a=Number(e.newAdmit||0),r=Number(e.transferIn||0),n=Number(e.referIn||0),l=Number(e.transferOut||0),i=Number(e.referOut||0),o=a+r+n-l-i-Number(e.discharge||0)-Number(e.dead||0);s.wards[t].numberOfPatients=String(o>=0?o:0),s.wards[t].overallData=String(o>=0?o:0)}return s})},[a,I,R]),eo=async e=>{if(e.preventDefault(),I){o.YU.fire({title:"โหมดดูข้อมูลเท่านั้น",text:"ข้อมูลอยู่ในโหมดดูอย่างเดียว ไม่สามารถบันทึกได้",icon:"info",confirmButtonColor:"#0ab4ab"});return}if(a?.role?.toLowerCase()==="user"){o.YU.fire({title:"โหมดดูข้อมูลเท่านั้น",text:"คุณไม่มีสิทธิ์บันทึกข้อมูล กรุณาติดต่อผู้ดูแลระบบ",icon:"info",confirmButtonColor:"#0ab4ab"});return}};(0,s.useCallback)(()=>{let e=new Date,t=new Date(D);return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},[D]);let ed=()=>{if(!W.date)return!1;let e=new Date(W.date),t=new Date;return t.setDate(t.getDate()+1),e.setHours(0,0,0,0),t.setHours(0,0,0,0),e>t};(0,s.useCallback)(()=>Object.values(W.wards).some(e=>Object.entries(e).some(([e,t])=>"comment"!==e&&""!==t&&"0"!==t)),[W.wards]);let ec=(0,s.useCallback)(()=>{let e={staff:!1,movement:!1,additional:!1};return Object.values(W.wards).forEach(t=>{("0"!==t.nurseManager||"0"!==t.RN||"0"!==t.PN||"0"!==t.WC)&&(e.staff=!0),("0"!==t.newAdmit||"0"!==t.transferIn||"0"!==t.referIn||"0"!==t.transferOut||"0"!==t.referOut||"0"!==t.discharge||"0"!==t.dead)&&(e.movement=!0),("0"!==t.availableBeds||"0"!==t.unavailable||"0"!==t.plannedDischarge||""!==t.comment.trim())&&(e.additional=!0)}),e},[W.wards]),eu=(0,s.useCallback)(()=>{let e=ec(W);return e.staff||e.movement||e.additional},[W,ec]);(0,s.useEffect)(()=>{z(eu())},[W,T,eu]),(0,s.useEffect)(()=>{let e=e=>{F&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[F]),(0,s.useEffect)(()=>{let e=async()=>{if(eu()&&!(await o.YU.fire({title:"แจ้งเตือนการออกจากหน้าบันทึกข้อมูล",html:`
                        <div class="text-left">
                            <p class="font-semibold">ท่านกำลังดำเนินการบันทึกข้อมูลอยู่</p>
                            <div class="mt-4 space-y-2">
                                <p class="text-gray-600">การออกจากหน้านี้จะส่งผลให้:</p>
                                <ul class="list-disc pl-5 text-sm text-gray-600">
                                    <li>ข้อมูลที่กำลังบันทึกจะถูกรีเซ็ตทั้งหมด</li>
                                    <li>ท่านจะต้องเริ่มกรอกข้อมูลใหม่เมื่อกลับมาที่หน้านี้</li>
                                </ul>
                            </div>
                            <p class="mt-4 text-sm font-medium text-gray-700">โปรดยืนยันการดำเนินการ</p>
                        </div>
                    `,icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยันการออกจากหน้านี้",cancelButtonText:"ยกเลิกและกลับไปบันทึกข้อมูล",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",reverseButtons:!0})).isConfirmed)throw"Route Cancelled"};return t.events?.on("routeChangeStart",e),()=>{t.events?.off("routeChangeStart",e)}},[t,eu]),(0,s.useCallback)(async()=>{console.log("Validating form data...",W);let e=new Date(new Date(W.date));e.setDate(e.getDate()-1);let t=e.toISOString().split("T")[0],r=await er(t);if(!r.hasNightShift&&r.hasMorningShift)return await o.YU.fire({title:"ไม่สามารถบันทึกข้อมูลได้",html:`วันที่ ${(0,h.mI)(e)} ยังไม่ได้บันทึกข้อมูลกะดึก<br>กรุณาบันทึกข้อมูลกะดึกของวันที่ ${(0,h.mI)(e)} ก่อน`,icon:"error",confirmButtonColor:"#0ab4ab"}),!1;for(let e of[{condition:!W.date||""===W.date.trim(),message:"กรุณาเลือกวันที่ก่อนดำเนินการต่อ"},{condition:!W.shift||""===W.shift.trim(),message:"กรุณาเลือกกะการทำงาน"},{condition:ed(),message:"ไม่สามารถบันทึกข้อมูลล่วงหน้าเกิน 1 วันได้"},{condition:"19:00-07:00"===W.shift&&!q,message:"ไม่สามารถบันทึกข้อมูลกะดึกได้ เนื่องจากยังไม่มีการบันทึกข้อมูลกะเช้าก่อน"},{condition:a?.role?.toLowerCase()==="admin"&&(!T.supervisorFirstName?.trim()||!T.supervisorLastName?.trim()),message:"กรุณากรอกชื่อและนามสกุลผู้ตรวจการ"}])if(e.condition)return console.log("Validation failed:",e.message),e.message&&alert(e.message),!1;return!0},[W,T,ed,q]);let em=()=>{o.YU.fire({title:"ล้างข้อมูล?",text:"คุณต้องการล้างข้อมูลทั้งหมดใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33",confirmButtonText:"ใช่, ล้างข้อมูล",cancelButtonText:"ยกเลิก"}).then(e=>{e.isConfirmed&&(R(e=>{let t={};return Object.entries(e.wards).forEach(([e,a])=>{t[e]={...a,nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",availableBeds:"0",unavailable:"0",plannedDischarge:"0",comment:""}}),{...e,wards:t}}),M({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:""}),z(!1),o.YU.fire({title:"ล้างข้อมูลสำเร็จ",text:"กรุณาเลือกวันที่อีกครั้ง หรือตรวจสอบข้อมูลโดยรวมในหน้า Dashboard",icon:"success",confirmButtonColor:"#0ab4ab"}))})},ef=async(e,t)=>{try{let a=(0,l.rJ)(n.db,"staffRecords"),r=(0,l.P)(a,(0,l._M)("date","==",e),(0,l._M)("shift","==",t));if(!(await (0,l.GG)(r)).empty)return await o.YU.fire({title:"แจ้งเตือน",html:`มีข้อมูลของวันที่ ${(0,h.mI)(e)} กะ ${t} ในระบบแล้ว<br><br>หากต้องการแก้ไขข้อมูล กรุณาดำเนินการบันทึกข้อมูลใหม่`,icon:"info",confirmButtonColor:"#0ab4ab"}),!0;return!1}catch(e){return console.error("Error checking existing data:",e),!1}},ex=async(e=!1)=>{H(e=>({...e,savingData:!0})),G("กำลังบันทึกข้อมูล...");try{if(await eh(W.date))return o.YU.fire({title:"ไม่สามารถบันทึกข้อมูลได้",html:"พบข้อมูลของวันที่นี้ที่ยังรออนุมัติจาก Supervisor<br>กรุณารอการอนุมัติก่อนบันทึกข้อมูลใหม่",icon:"error",confirmButtonColor:"#0ab4ab"}),H(e=>({...e,savingData:!1})),!1;if("19:00-07:00"===W.shift&&!await ea(W.date))return o.YU.fire({title:"ไม่สามารถบันทึกข้อมูลได้",html:"ไม่พบข้อมูลกะเช้าของวันที่นี้<br>กรุณาบันทึกข้อมูลกะเช้าก่อน",icon:"error",confirmButtonColor:"#0ab4ab"}),H(e=>({...e,savingData:!1})),!1;let t=[];if(Object.entries(W.wards).forEach(([e,a])=>{a.nurseManager&&"0"!==a.nurseManager||t.push(`${e}: Nurse Manager`),a.RN&&"0"!==a.RN||t.push(`${e}: RN`),a.PN&&"0"!==a.PN||t.push(`${e}: PN`),a.WC&&"0"!==a.WC||t.push(`${e}: WC`),a.newAdmit&&"0"!==a.newAdmit||t.push(`${e}: New Admit`),a.transferIn&&"0"!==a.transferIn||t.push(`${e}: Transfer In`),a.referIn&&"0"!==a.referIn||t.push(`${e}: Refer In`),a.transferOut&&"0"!==a.transferOut||t.push(`${e}: Transfer Out`),a.referOut&&"0"!==a.referOut||t.push(`${e}: Refer Out`),a.discharge&&"0"!==a.discharge||t.push(`${e}: Discharge`),a.dead&&"0"!==a.dead||t.push(`${e}: Dead`),a.plannedDischarge&&"0"!==a.plannedDischarge||t.push(`${e}: Planned Discharge`),a.availableBeds&&"0"!==a.availableBeds||t.push(`${e}: Available Beds`),a.unavailable&&"0"!==a.unavailable||t.push(`${e}: Unavailable`)}),t.length>0)return o.YU.fire({title:"กรุณากรอกข้อมูลให้ครบถ้วน",html:`พบข้อมูลที่ยังไม่ได้กรอก:<br><ul class="text-left mt-2">${t.map(e=>`<li>- ${e}</li>`).join("")}</ul>`,icon:"warning",confirmButtonColor:"#0ab4ab"}),H(e=>({...e,savingData:!1})),!1;if(!(await o.YU.fire({title:"ยืนยันการบันทึกข้อมูล",text:"เมื่อบันทึกแล้ว ข้อมูลจะถูกส่งเพื่อรออนุมัติจาก Supervisor และไม่สามารถแก้ไขได้อีก ต้องการดำเนินการต่อหรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonText:"ใช่, บันทึกข้อมูล",cancelButtonText:"ยกเลิก",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"})).isConfirmed)return H(e=>({...e,savingData:!1})),!1;let r=new Date().toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":",""),s=W.date.replace(/-/g,""),i=e&&E?E.id:`data_${r}_${s}`;console.log("Saving data with ID:",i);let d={date:W.date,shift:W.shift,wards:Object.fromEntries(Object.entries(W.wards).map(([e,t])=>[e,{numberOfPatients:t.numberOfPatients||"0",nurseManager:t.nurseManager||"0",RN:t.RN||"0",PN:t.PN||"0",WC:t.WC||"0",newAdmit:t.newAdmit||"0",transferIn:t.transferIn||"0",referIn:t.referIn||"0",transferOut:t.transferOut||"0",referOut:t.referOut||"0",discharge:t.discharge||"0",dead:t.dead||"0",overallData:t.overallData||"0",availableBeds:t.availableBeds||"0",plannedDischarge:t.plannedDischarge||"0",unavailable:t.unavailable||"0",comment:t.comment||""}])),summaryData:{opdTotal24hr:T.opdTotal24hr||"",existingPatients:T.existingPatients||"",newPatients:T.newPatients||"",admissions24hr:T.admissions24hr||"",supervisorFirstName:T.supervisorFirstName||"",supervisorLastName:T.supervisorLastName||""},timestamp:(0,l.O5)(),lastModified:(0,l.O5)(),approvalStatus:"pending",submittedBy:a?{uid:a.uid,displayName:a.displayName||"",email:a.email||""}:null};console.log("Saving sanitized data:",d),await (0,l.BN)((0,l.H9)(n.db,"staffRecords",i),d);let c=Object.entries(W.wards).map(async([e,t])=>{if(Object.values(t).some(e=>"0"!==e&&""!==e)){let r=(0,l.H9)(n.db,"wardDailyRecords",`${W.date}_${e}`);try{await (0,l.BN)(r,{wardId:e,date:W.date,patientCensus:t.numberOfPatients||"0",overallData:t.overallData||"0",approvalStatus:"pending",lastUpdated:(0,l.O5)(),submittedBy:a?{uid:a.uid,displayName:a.displayName||"",email:a.email||""}:null,dateSubmitted:(0,l.O5)(),shifts:{[W.shift]:{nurseManager:t.nurseManager||"0",RN:t.RN||"0",PN:t.PN||"0",WC:t.WC||"0",newAdmit:t.newAdmit||"0",transferIn:t.transferIn||"0",referIn:t.referIn||"0",transferOut:t.transferOut||"0",referOut:t.referOut||"0",discharge:t.discharge||"0",dead:t.dead||"0",availableBeds:t.availableBeds||"0",unavailable:t.unavailable||"0",plannedDischarge:t.plannedDischarge||"0",comment:t.comment||""}}},{merge:!0})}catch(t){console.error(`Error saving wardDailyRecord for ${e}:`,t)}}});return await Promise.all(c),await K(W.date),G("บันทึกข้อมูลสำเร็จ กำลังรีเซ็ตฟอร์ม..."),await new Promise(e=>setTimeout(e,1e3)),console.log("Data saved successfully"),em(),o.YU.fire({title:"บันทึกข้อมูลสำเร็จ",html:`
                    <div class="text-center">
                        <p class="mb-2">ข้อมูลถูกบันทึกและส่งเพื่อรออนุมัติจาก Supervisor เรียบร้อยแล้ว</p>
                        <p class="text-sm text-gray-600">คุณจะสามารถบันทึกข้อมูลกะต่อไปได้หลังจากข้อมูลนี้ได้รับการอนุมัติแล้ว</p>
                    </div>
                `,icon:"success",confirmButtonColor:"#0ab4ab"}).then(()=>{window.location.reload()}),!0}catch(e){return console.error("Error saving data:",e),o.YU.fire({title:"เกิดข้อผิดพลาด",text:"ไม่สามารถบันทึกข้อมูลได้ กรุณาลองอีกครั้ง",icon:"error",confirmButtonColor:"#0ab4ab"}),!1}finally{H(e=>({...e,savingData:!1}))}},eh=async e=>{try{let t=(0,l.rJ)(n.db,"wardDailyRecords"),a=(0,l.P)(t,(0,l._M)("date","==",e),(0,l._M)("approvalStatus","==","pending"));return!(await (0,l.GG)(a)).empty}catch(e){return console.error("Error checking pending approval:",e),!1}},eb=async()=>{try{let e=(0,l.rJ)(n.db,"staffRecords"),t=new Date(new Date().getFullYear(),0,1),a=new Date(new Date().getFullYear(),11,31),r=(0,l.P)(e,(0,l._M)("date",">=",(0,h.Ol)(t)),(0,l._M)("date","<=",(0,h.Ol)(a))),s=await (0,l.GG)(r),i={};s.docs.forEach(e=>{let t=e.data();i[t.date]||(i[t.date]=new Set),i[t.date].add(t.shift)});let o=Object.entries(i).map(([e,t])=>({date:e,shifts:Array.from(t),isComplete:2===t.size}));O(o)}catch(e){console.error("Error fetching dates with data:",e),O([])}};(0,s.useEffect)(()=>{eb()},[]),(0,s.useEffect)(()=>()=>{w(!1),y(!1),C(!1)},[]);let ep=async e=>{if(await eh(W.date)){o.YU.fire({title:"ไม่สามารถเปลี่ยนกะได้",text:"ข้อมูลของวันนี้กำลังรออนุมัติจาก Supervisor ไม่สามารถเปลี่ยนกะได้",icon:"warning",confirmButtonColor:"#0ab4ab"});return}if("19:00-07:00"===e&&!await ea(W.date)){o.YU.fire({title:"ไม่สามารถเลือกกะดึกได้",html:"ไม่พบข้อมูลกะเช้าของวันที่นี้<br>กรุณาบันทึกข้อมูลกะเช้าก่อน",icon:"warning",confirmButtonColor:"#0ab4ab"});return}if(!F||(await o.YU.fire({title:"มีข้อมูลที่ยังไม่ได้บันทึก",text:"การเปลี่ยนกะจะทำให้ข้อมูลที่กำลังป้อนหายไป คุณต้องการดำเนินการต่อหรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonText:"ใช่, เปลี่ยนกะ",cancelButtonText:"ไม่, ยกเลิก",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed){if(await ef(W.date,e)){let t=await o.YU.fire({title:"พบข้อมูลในระบบ",html:`
                    <div class="text-left">
                        <p>พบข้อมูลของวันที่ ${(0,h.mI)(new Date(W.date))} กะ ${e} ในระบบแล้ว</p>
                        <p class="mt-2">คุณต้องการดำเนินการอย่างไร?</p>
                    </div>
                `,icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"โหลดข้อมูลเดิม",denyButtonText:"สร้างข้อมูลใหม่",cancelButtonText:"ยกเลิก",confirmButtonColor:"#0ab4ab",denyButtonColor:"#d33",cancelButtonColor:"#6c757d"});if(t.isConfirmed)em(),R(t=>({...t,shift:e})),await eg(W.date,e);else{if(!t.isDenied)return;em(),R(t=>({...t,shift:e}))}}else em(),R(t=>({...t,shift:e}));z(!1)}},eg=async(e,t)=>{try{G("กำลังดึงข้อมูลจากระบบ");let a=(0,l.rJ)(n.db,"wardDailyRecords"),r=new Date(e),s="";"19:00-07:00"===t?(s="07:00-19:00",G(`กำลังดึงข้อมูลจากกะเช้า-บ่าย (${s})`)):(r.setDate(r.getDate()-1),s="19:00-07:00",G(`กำลังดึงข้อมูลจากกะดึกของวันก่อนหน้า (${s})`));let i=(0,h.Ol)(r),o=(0,h.mI)(r).replace("เพิ่มข้อมูล วันที่: ","");G(`กำลังดึงข้อมูล Overall Data
จากวันที่ ${o}
กะ ${s}`);let d=(0,l.P)(a,(0,l._M)("date","==",i)),c=await (0,l.GG)(d),u={...W.wards};if(c.empty){G("กำลังค้นหาข้อมูลล่าสุด...");let e=(0,l.P)(a,(0,l._M)("date","<=",i),(0,l.My)("date","desc"),(0,l.AB)(1)),t=await (0,l.GG)(e);if(t.empty)G("ไม่พบข้อมูลก่อนหน้า"),setTimeout(()=>G(""),2e3);else{let e=t.docs[0].data(),a=(0,h.mI)(new Date(e.date)).replace("เพิ่มข้อมูล วันที่: ","");G(`พบข้อมูลล่าสุดจาก
วันที่ ${a}`),Object.keys(W.wards).forEach(e=>{let t=c.docs.find(t=>t.data().wardId===e)?.data();t&&(u[e]={...W.wards[e],numberOfPatients:t.overallData||"0",overallData:t.overallData||"0"})}),R(e=>({...e,wards:u})),setTimeout(()=>G(""),2e3)}}else c.docs.forEach(e=>{let t=e.data(),a=t.wardId;t.shifts&&t.shifts[s]&&(t.shifts[s],u[a]={...W.wards[a],numberOfPatients:t.overallData||"0",overallData:t.overallData||"0"})}),R(e=>({...e,wards:u})),G(`ดึงข้อมูลสำเร็จ
จากวันที่ ${o}
กะ ${s}`),setTimeout(()=>G(""),2e3)}catch(e){console.error("Error fetching previous shift data:",e),G(`เกิดข้อผิดพลาด: ${e.message}`),setTimeout(()=>G(""),3e3)}};(0,s.useEffect)(()=>{z(eu())},[W,T,eu]);let ev=async()=>{F?(await o.YU.fire({title:"แจ้งเตือนการเปลี่ยนหน้า",html:`
                    <div class="text-left">
                        <p class="font-semibold text-red-600">ข้อควรระวัง: พบข้อมูลที่ยังไม่ได้บันทึก</p>
                        <div className="mt-4 space-y-2">
                            <p className="text-gray-700">การเปลี่ยนไปยังหน้า Dashboard จะส่งผลดังนี้:</p>
                            <ul className="list-disc pl-5 space-y-1">
                                <li class="text-gray-600">ข้อมูลที่ท่านกรอกจะไม่ถูกบันทึก</li>
                                <li class="text-gray-600">ข้อมูลทั้งหมดในแบบฟอร์มจะถูกรีเซ็ต</li>
                                <li class="text-gray-600">ท่านจะต้องเริ่มกรอกข้อมูลใหม่เมื่อกลับมายังหน้านี้</li>
                            </ul>
                            <div className="mt-4 p-2 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <p className="text-sm text-yellow-700">
                                    <span class="font-medium">คำแนะนำ:</span> กรุณาบันทึกข้อมูลให้เรียบร้อยก่อนออกจากหน้านี้
                                </p>
                            </div>
                        </div>
                    </div>
                `,icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยันการเปลี่ยนหน้า",cancelButtonText:"ยกเลิกและกลับไปบันทึกข้อมูล",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",reverseButtons:!0})).isConfirmed&&t.push("/dashboard"):t.push("/dashboard")};return(0,r.jsxs)("div",{className:"w-full px-2 py-2",children:[V&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-[#0ab4ab]/95 to-blue-600/95 backdrop-blur-md flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl text-center space-y-4",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Logo",className:"w-24 h-24 mx-auto mb-4 animate-pulse"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-[#0ab4ab]",children:"แจ้งเตือนการใช้งาน"}),(0,r.jsxs)("div",{className:"space-y-3 text-gray-600",children:[(0,r.jsx)("p",{className:"font-medium",children:"ระบบอยู่ระหว่างการพัฒนาสำหรับอุปกรณ์มือถือ"}),(0,r.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-xl",children:[(0,r.jsx)("p",{className:"text-sm",children:"เพื่อประสิทธิภาพในการใช้งานสูงสุด กรุณาใช้งานผ่าน:"}),(0,r.jsxs)("ul",{className:"text-sm mt-2 space-y-1",children:[(0,r.jsx)("li",{children:"• คอมพิวเตอร์ตั้งโต๊ะ (Desktop)"}),(0,r.jsx)("li",{children:"• คอมพิวเตอร์พกพา (Laptop)"})]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"หากมีข้อสงสัยกรุณาติดต่อผู้ดูแลระบบ"})]})]})}),(0,r.jsxs)("form",{onSubmit:eo,className:"w-full mx-auto",children:[f&&(0,r.jsx)("div",{className:"fixed inset-0 bg-white flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Loading",className:"w-32 h-32 mx-auto mb-4 animate-pulse"}),(0,r.jsx)("p",{className:"text-gray-600",children:"กำลังโหลด..."})]})}),(0,r.jsx)(x,{showDataComparison:U,existingData:E,formData:W,summaryData:T,setShowDataComparison:A,saveData:ex,WARD_ORDER:i.UX}),(0,r.jsx)(g.A,{showCalendar:j,setShowCalendar:C,selectedDate:D,setSelectedDate:B,formData:W,setFormData:R,thaiDate:$,setThaiDate:k,fetchPreviousShiftData:eg,handleShiftChange:ep,datesWithData:S,checkExistingData:ef,setSummaryData:M}),(0,r.jsx)("div",{className:"hidden md:block w-full",children:(0,r.jsxs)("div",{className:"w-full mx-auto p-4 bg-white rounded-xl shadow-lg border border-gray-200",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-pink-400/20 to-white p-2 rounded-lg",children:(0,r.jsx)("h2",{className:"text-lg font-bold text-pink-600 text-center mb-1",children:"Form"})}),(0,r.jsx)(m,{WARD_ORDER:el,formData:W,handleInputChange:ei,displayValue:e=>null==e||""===e?"0":e,approvalStatuses:J,selectedDate:D,readOnly:a?.role?.toLowerCase()==="user"})]})}),(0,r.jsx)("div",{className:"hidden md:block mt-8",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-[#0ab4ab]/10 to-white rounded-xl shadow-lg p-6",children:a?.role?.toLowerCase()==="admin"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p,{summaryData:T,setSummaryData:M}),(0,r.jsx)(b,{summaryData:T,setSummaryData:M})]})})}),(0,r.jsx)("div",{className:"mt-8 flex justify-center p-6 bg-gradient-to-r from-[#0ab4ab]/10 to-white rounded-xl shadow-lg",children:a?.role?.toLowerCase()==="user"?(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center border border-gray-200",children:[(0,r.jsx)("div",{className:"text-gray-700 font-medium mb-2",children:"โหมดดูข้อมูลเท่านั้น"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"คุณสามารถดูข้อมูลได้ แต่ไม่สามารถแก้ไขหรือบันทึกข้อมูลได้"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"ข้อมูลที่แสดงเฉพาะ ward ของคุณเท่านั้น"})]}):(0,r.jsx)("button",{type:"submit",disabled:N||I,className:"px-12 py-4 bg-gradient-to-r from-[#0ab4ab] to-blue-400 text-white text-lg font-bold rounded-xl shadow-lg hover:from-[#0ab4ab] hover:to-blue-500 transition-all transform hover:scale-105 disabled:from-gray-400 disabled:to-gray-500 font-THSarabun",children:N?"Saving...":I?"View Only Mode":"Save Data"})}),(0,r.jsx)("button",{onClick:ev,className:"px-4 py-2 rounded-lg text-white hover:bg-[#0ab4ab]/80",children:"Dashboard"})]})]})}}};