exports.id=556,exports.ids=[556],exports.modules={1923:(e,t,r)=>{"use strict";r.d(t,{Sw:()=>d,YU:()=>i});var s=r(60687),a=r(43210);let o=(0,a.createContext)(null),n={fire:async e=>window.__alertService?window.__alertService.showAlert(e):(console.warn("AlertProvider is not found. Using fallback alert."),"error"===e.icon||"error"===e.type)?(alert(e.title?`${e.title}: ${e.text||""}`:e.text),{isConfirmed:!0}):"warning"===e.icon||"warning"===e.type?{isConfirmed:confirm(e.title?`${e.title}: ${e.text||""}`:e.text)}:(alert(e.title?`${e.title}: ${e.text||""}`:e.text),{isConfirmed:!0}),success:async(e,t)=>n.fire({title:e,text:t,icon:"success"}),error:async(e,t)=>n.fire({title:e,text:t,icon:"error"}),warning:async(e,t,r=!0)=>n.fire({title:e,text:t,icon:"warning",showCancelButton:r}),info:async(e,t)=>n.fire({title:e,text:t,icon:"info"}),confirm:async(e,t,r="ตกลง",s="ยกเลิก")=>n.fire({title:e,text:t,icon:"question",showCancelButton:!0,confirmButtonText:r,cancelButtonText:s}),showLoading:(e="กำลังโหลด...")=>{if(window.__alertService)return window.__alertService.showLoading(e);console.log("Loading:",e)},close:()=>{if(window.__alertService)return window.__alertService.closeAll();console.log("Closing alerts")}},i=n,l=({id:e,isOpen:t,onClose:r,title:o,text:n,icon:i="info",type:l="info",confirmButtonText:d="ตกลง",cancelButtonText:c="ยกเลิก",onConfirm:u,onCancel:m,showCancelButton:g=!1,allowOutsideClick:h=!0,timer:p=0,html:x=null,customClass:f={}})=>{let[b,w]=(0,a.useState)(t),[v,y]=(0,a.useState)(p>0?Math.floor(p/1e3):0),j=i||l;(0,a.useEffect)(()=>{if(!b)return;let e=e=>{"Escape"===e.key&&h&&S(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[b,h]),(0,a.useEffect)(()=>{if(!b||p<=0)return;let e=setInterval(()=>{y(t=>t<=1?(clearInterval(e),setTimeout(()=>S(!0),0),0):t-1)},1e3);return()=>clearInterval(e)},[b,p]);let S=e=>{w(!1),setTimeout(()=>{e?u&&u():m&&m(),r&&r(e)},300)};return t?(0,s.jsx)("div",{className:`fixed inset-0 flex items-center justify-center z-50 transition-opacity duration-300 ${b?"opacity-100":"opacity-0 pointer-events-none"} ${h?"cursor-pointer":""}`,onClick:e=>{e.target===e.currentTarget&&h&&S(!1)},style:{backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(2px)"},children:(0,s.jsx)("div",{className:`bg-white rounded-lg shadow-2xl max-w-md w-full m-4 transform transition-all duration-300 ${b?"scale-100 opacity-100":"scale-95 opacity-0"} cursor-default ${f.container||""}`,children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"text-center",children:["success"===j&&(0,s.jsx)("div",{className:"mx-auto bg-green-100 p-3 rounded-full w-fit mb-4",children:(0,s.jsx)("svg",{className:"w-10 h-10 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),"error"===j&&(0,s.jsx)("div",{className:"mx-auto bg-red-100 p-3 rounded-full w-fit mb-4",children:(0,s.jsx)("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),"info"===j&&(0,s.jsx)("div",{className:"mx-auto bg-blue-100 p-3 rounded-full w-fit mb-4",children:(0,s.jsx)("svg",{className:"w-10 h-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),"warning"===j&&(0,s.jsx)("div",{className:"mx-auto bg-yellow-100 p-3 rounded-full w-fit mb-4",children:(0,s.jsx)("svg",{className:"w-10 h-10 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),"question"===j&&(0,s.jsx)("div",{className:"mx-auto bg-purple-100 p-3 rounded-full w-fit mb-4",children:(0,s.jsx)("svg",{className:"w-10 h-10 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),"loading"===j&&(0,s.jsx)("div",{className:"mx-auto p-3 w-fit mb-4",children:(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-t-[#0ab4ab] border-r-[#0ab4ab] border-b-gray-200 border-l-gray-200 rounded-full animate-spin"})}),o&&(0,s.jsx)("h2",{className:`text-xl font-semibold mb-2 ${f.title||""}`,children:o}),n&&(0,s.jsx)("p",{className:`text-gray-600 ${f.text||""}`,children:n}),x&&(0,s.jsx)("div",{className:`mt-2 ${f.htmlContainer||""}`,dangerouslySetInnerHTML:{__html:x}}),v>0&&(0,s.jsxs)("div",{className:"mt-3 text-sm text-gray-500",children:["ปิดอัตโนมัติใน ",v," วินาที"]})]}),"loading"!==j&&(0,s.jsxs)("div",{className:"flex justify-center gap-3 mt-6",children:[g&&(0,s.jsx)("button",{onClick:()=>S(!1),className:`px-5 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 ${f.cancelButton||""}`,children:c}),(0,s.jsx)("button",{onClick:()=>S(!0),className:`px-5 py-2 bg-[#0ab4ab] text-white rounded-md hover:bg-[#099a92] ${f.confirmButton||""}`,children:d})]})]})})}):null},d=({children:e})=>{let[t,r]=(0,a.useState)([]),[n,i]=(0,a.useState)(null),d=(0,a.useRef)(0),c=()=>(d.current+=1,`${Date.now()}-${d.current}-${Math.random().toString(36).substr(2,5)}`);(0,a.useEffect)(()=>(window.__alertService={showAlert:u,showLoading:m,closeAll:h},()=>{delete window.__alertService}),[]);let u=e=>new Promise(t=>{let s=c(),a={id:s,isOpen:!0,...e,onClose:e=>{g(s),t({isConfirmed:e})}};r(e=>[...e,a])}),m=(e="กำลังโหลด...")=>{h();let t=c();return i({id:t,isOpen:!0,title:e,type:"loading",icon:"loading",allowOutsideClick:!1}),t},g=e=>{r(t=>t.map(t=>t.id===e?{...t,isOpen:!1}:t)),setTimeout(()=>{r(t=>t.filter(t=>t.id!==e))},300)},h=()=>{r(e=>e.map(e=>({...e,isOpen:!1}))),n&&(i({...n,isOpen:!1}),setTimeout(()=>{i(null)},300)),setTimeout(()=>{r([])},300)};return(0,s.jsxs)(o.Provider,{value:{showAlert:u,showLoading:m,closeAlert:g,closeAll:h},children:[e,t.map(e=>(0,s.jsx)(l,{...e},e.id)),n&&(0,s.jsx)(l,{...n},`loading-${n.id}`)]})}},9141:(e,t,r)=>{"use strict";r.d(t,{db:()=>l});var s=r(67989),a=r(75535),o=r(48075);console.log("Firebase Config Environment Variables:"),console.log("API Key available:",!0),console.log("Auth Domain available:",!0),console.log("Project ID available:",!0);let n={apiKey:"AIzaSyB9sZFJSn8cvkos5fysi47VpqJc5AsorA4",authDomain:"manpower-patient-summary.firebaseapp.com",projectId:"manpower-patient-summary",storageBucket:"manpower-patient-summary.firebasestorage.app",messagingSenderId:"644057496880",appId:"1:644057496880:web:6270efc29187b9c025dcf5"};console.log("Using Firebase config:",{...n,apiKey:"HIDDEN"});let i=null,l=null;try{i=(0,s.Dk)().length?(0,s.Dk)()[0]:(0,s.Wp)(n),l=(0,a.aU)(i),(0,o.xI)(i),console.log("Firebase initialized successfully")}catch(e){console.error("Error initializing Firebase:",e)}},23151:(e,t,r)=>{Promise.resolve().then(r.bind(r,34504))},32648:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n,metadata:()=>o});var s=r(37413);r(82704);var a=r(89855);let o={title:"Daily Patient Census and Staffing",description:"ระบบข้อมูลป่วยและตรากำคลากร",icons:{icon:[{url:"/images/bpk9.ico",type:"image/x-icon",sizes:"16x16"}]}};function n({children:e}){return(0,s.jsxs)("html",{lang:"th",suppressHydrationWarning:!0,children:[(0,s.jsxs)("head",{children:[(0,s.jsx)("meta",{charSet:"utf-8"}),(0,s.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap",rel:"stylesheet"})]}),(0,s.jsx)("body",{children:(0,s.jsx)(a.default,{children:e})})]})}},34504:(e,t,r)=>{"use strict";r.d(t,{default:()=>k});var s=r(60687),a=r(43210),o=r(84623),n=r(54868);function i(){return(0,s.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,s.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-lg shadow-lg px-4 py-2 border border-gray-200 hover:bg-white/90 transition-all duration-300",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"v.2.3.3.2025"})]})})})}function l({children:e}){return(0,s.jsx)(n.NP,{children:(0,s.jsxs)(o.O,{children:[e,(0,s.jsx)(i,{})]})})}var d=r(16189),c=r(1923);let u={WARD:"ward",SHIFT:"shift",FORM:"form",DASHBOARD:"dashboard",USER_MANAGEMENT:"user_management"},m={[u.WARD]:"Ward Form",[u.SHIFT]:"Shift Form",[u.FORM]:"Approval",[u.DASHBOARD]:"Dashboard",[u.USER_MANAGEMENT]:"User Management"},g=()=>{let{theme:e,toggleTheme:t}=(0,n.DP)();return(0,s.jsx)("button",{onClick:t,"aria-label":"dark"===e?"Switch to light mode":"Switch to dark mode",title:"dark"===e?"Switch to light mode":"Switch to dark mode",className:`p-2 rounded-full transition-colors duration-300 ${"dark"===e?"bg-gray-800 hover:bg-gray-700 text-yellow-300":"bg-white hover:bg-gray-100 text-gray-700"}`,children:"dark"===e?(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"})}):(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"})})})},h=()=>{let e=(0,d.useRouter)(),t=(0,d.usePathname)(),{user:r,logout:i}=(0,o.A)(),{theme:l}=(0,n.DP)(),[h,p]=(0,a.useState)();(0,a.useEffect)(()=>{if("/"===t){p(window.currentPage||u.FORM);let e=()=>{p(window.currentPage)};return window.addEventListener("currentPageChange",e),()=>{window.removeEventListener("currentPageChange",e)}}"/page/ward-form"===t||"/ward-form"===t?p(u.WARD):"/page/shift-form"===t||"/shift-form"===t?p(u.SHIFT):"/page/approval"===t||"/approval"===t?p(u.FORM):"/page/dashboard"===t||"/dashboard"===t?p(u.DASHBOARD):("/page/user-management"===t||t.includes("/admin/user-management"))&&p(u.USER_MANAGEMENT)},[t]);let x=t=>{if(t===u.USER_MANAGEMENT&&r?.role?.toLowerCase()!=="admin"){c.YU.fire({title:"ไม่มีสิทธิ์เข้าถึง",text:"คุณไม่มีสิทธิ์เข้าถึงหน้าจัดการผู้ใช้",icon:"warning",confirmButtonColor:"#0ab4ab"});return}switch(p(t),t){case u.WARD:e.push("/page/ward-form/");break;case u.SHIFT:e.push("/page/shift-form/");break;case u.FORM:e.push("/page/approval/");break;case u.DASHBOARD:e.push("/page/dashboard/");break;case u.USER_MANAGEMENT:e.push("/page/user-management/");break;default:e.push("/")}},f=async()=>{try{(await c.YU.fire({title:"ต้องการออกจากระบบ?",text:"คุณแน่ใจหรือไม่ว่าต้องการออกจากระบบ",icon:"question",showCancelButton:!0,confirmButtonText:"ใช่, ออกจากระบบ",cancelButtonText:"ยกเลิก",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed&&(await i(),e.push("/page/login"))}catch(e){console.error("Logout failed:",e),c.YU.fire({title:"เกิดข้อผิดพลาด",text:"ไม่สามารถออกจากระบบได้ กรุณาลองใหม่อีกครั้ง",icon:"error",confirmButtonColor:"#0ab4ab"})}};return r&&"/login"!==t&&"/page/login"!==t?(0,s.jsx)("div",{className:`${"dark"===l?"bg-gray-800":"bg-[#0ab4ab]"} text-white shadow-md p-3 fixed top-0 left-0 right-0 z-50 w-full transition-colors duration-300`,children:(0,s.jsxs)("div",{className:"container mx-auto flex flex-wrap justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center space-x-2 md:space-x-4 mb-2 md:mb-0",children:[(0,s.jsx)("button",{onClick:()=>x(u.WARD),className:`px-4 py-2 rounded-md font-medium text-base ${h===u.WARD?"bg-gray-700 text-white shadow-md border-2 border-white":"dark"===l?"bg-gray-700 text-white hover:bg-gray-600":"bg-[#0ab4ab] text-white hover:bg-teal-600"} transition-all duration-200`,children:(0,s.jsx)("span",{className:"font-bold",children:m[u.WARD]})}),(0,s.jsx)("button",{onClick:()=>x(u.FORM),className:`px-4 py-2 rounded-md font-medium text-base ${h===u.FORM?"bg-gray-700 text-white shadow-md border-2 border-white":"dark"===l?"bg-gray-700 text-white hover:bg-gray-600":"bg-[#0ab4ab] text-white hover:bg-teal-600"} transition-all duration-200`,children:(0,s.jsx)("span",{className:h===u.FORM?"font-bold":"",children:m[u.FORM]})}),(0,s.jsx)("button",{onClick:()=>x(u.DASHBOARD),className:`px-4 py-2 rounded-md font-medium text-base ${h===u.DASHBOARD?"bg-gray-700 text-white shadow-md border-2 border-white":"dark"===l?"bg-gray-700 text-white hover:bg-gray-600":"bg-[#0ab4ab] text-white hover:bg-teal-600"} transition-all duration-200`,children:(0,s.jsx)("span",{className:h===u.DASHBOARD?"font-bold":"",children:m[u.DASHBOARD]})}),r?.role?.toLowerCase()==="admin"&&(0,s.jsx)("button",{onClick:()=>x(u.USER_MANAGEMENT),className:`px-4 py-2 rounded-md font-medium text-base ${h===u.USER_MANAGEMENT?"bg-gray-700 text-white shadow-md border-2 border-white":"dark"===l?"bg-gray-700 text-white hover:bg-gray-600":"bg-[#0ab4ab] text-white hover:bg-teal-600"} transition-all duration-200`,children:(0,s.jsx)("span",{className:h===u.USER_MANAGEMENT?"font-bold":"",children:m[u.USER_MANAGEMENT]})})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center",children:[(0,s.jsxs)("div",{className:"text-white text-sm mr-4 mb-2 md:mb-0",children:["Logged in as: ",r.username||"user"," | Department: ",r.department||""," | Role: ",r.role||"user"]}),(0,s.jsx)("div",{className:"mr-3",children:(0,s.jsx)(g,{})}),(0,s.jsx)("button",{onClick:f,className:"py-2 px-3 rounded-md bg-red-500 text-white hover:bg-red-600 transition-colors duration-200",children:(0,s.jsx)("span",{children:"ออกจากระบบ"})})]})]})}):null};var p=r(9141),x=r(75535);let f=new Set,b=async(e,t,r=[])=>{try{let s=w(e,t,r);if(f.has(s))return{success:!0,validated:!0};let a=v(e,t,r);return await (0,x.GG)(a),f.add(s),{success:!0,validated:!0}}catch(e){if(console.error("Firebase Index Validation Error:",e),e.message&&e.message.includes("requires an index")){let t=y(e.message);return{success:!1,isIndexError:!0,message:e.message,indexUrl:t}}return{success:!1,isIndexError:!1,message:e.message}}},w=(e,t,r)=>{let s=t.map(e=>`${e.field}_${e.operator}_${e.value}`).join("|"),a=r.join("|");return`${e}_${s}_${a}`},v=(e,t,s)=>{let a=(0,x.P)((0,x.rJ)(p.db,e),(0,x.AB)(1));if(t.forEach(e=>{a=(0,x.P)(a,(0,x._M)(e.field,e.operator,e.value))}),s.length>0){let{orderBy:e}=r(25534);s.forEach(t=>{a="object"==typeof t?(0,x.P)(a,e(t.field,t.direction)):(0,x.P)(a,e(t))})}return a},y=e=>{let t=e.match(/(https:\/\/console\.firebase\.google\.com\S+)/);return t&&t[1]?t[1]:null},j=async(e,t=!1)=>{if(e.message&&e.message.includes("requires an index")){let r=y(e.message);if(r){let e=await c.YU.fire({title:"ต้องสร้าง Index ใน Firebase",html:`
          <p>การค้นหาข้อมูลนี้ต้องการ index เพิ่มเติม</p>
          <p>คลิกปุ่ม "สร้าง Index" เพื่อสร้าง index ใน Firebase Console</p>
          <p>หลังจากสร้างแล้ว ให้กลับมารีเฟรชหน้านี้</p>
          <div class="mt-4">
            <a href="${r}" target="_blank" rel="noopener noreferrer" 
               class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
              สร้าง Index
            </a>
          </div>
        `,icon:"warning",showCancelButton:!0,confirmButtonText:"รีเฟรชหน้านี้",cancelButtonText:"ยกเลิก",confirmButtonColor:"#0ab4ab"});return t&&window.open(r,"_blank"),e.isConfirmed&&window.location.reload(),!0}}return!1},S=async()=>{let e=[];for(let t of[{collection:"wardDataFinal",conditions:[{field:"wardId",operator:"==",value:"test"},{field:"date",operator:"==",value:"2023-01-01"},{field:"shift",operator:"==",value:"เช้า"}]},{collection:"wardDataHistory",conditions:[{field:"wardId",operator:"==",value:"test"},{field:"date",operator:"==",value:"2023-01-01"},{field:"shift",operator:"==",value:"เช้า"}],orderBy:[{field:"timestamp",direction:"desc"}]},{collection:"wardDailyRecords",conditions:[{field:"wardId",operator:"==",value:"test"},{field:"date",operator:">=",value:"2023-01-01"},{field:"date",operator:"<=",value:"2023-02-01"}]}])try{let r=await b(t.collection,t.conditions,t.orderBy||[]);e.push({collection:t.collection,success:r.success,...r})}catch(r){e.push({collection:t.collection,success:!1,error:r.message})}return e},N=()=>{let[e,t]=(0,a.useState)("pending"),[r,s]=(0,a.useState)([]);return(0,a.useEffect)(()=>{let e=async()=>{try{let e=(await S()).filter(e=>!e.success&&e.isIndexError);if(s(e),t(e.length>0?"missing":"complete"),e.length>0){let t=e[0];t.indexUrl&&await j({message:`The query requires an index. You can create it here: ${t.indexUrl}`},!1)}}catch(e){console.error("Error validating Firebase indexes:",e),t("error")}},r=setTimeout(()=>{e()},3e3);return()=>clearTimeout(r)},[]),null};function k({children:e}){let[t,r]=(0,a.useState)(!1),[i,u]=(0,a.useState)(null),m=(0,d.usePathname)(),g="/page/login"===m||"/login"===m;if(i)return(0,s.jsx)("div",{className:"min-h-screen bg-gray-100 flex flex-col items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full text-center",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"เกิดข้อผิดพลาด"}),(0,s.jsx)("p",{className:"mb-4",children:i}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"กรุณารีเฟรชหน้าเว็บหรือติดต่อผู้ดูแลระบบ"}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded",children:"รีเฟรชหน้า"})]})});if(!t)return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsx)("p",{className:"text-gray-500",children:"กำลังโหลด..."})});try{return(0,s.jsx)(c.Sw,{children:(0,s.jsx)(o.O,{children:(0,s.jsxs)(n.NP,{children:[(0,s.jsx)(N,{}),(0,s.jsxs)(l,{children:[!g&&(0,s.jsx)(h,{}),(0,s.jsx)("div",{className:g?"":"pt-16",children:e})]})]})})})}catch(e){return console.error("Error rendering ClientLayout:",e),(0,s.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full text-center",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"เกิดข้อผิดพลาดในการเรนเดอร์"}),(0,s.jsx)("p",{className:"mb-4",children:e.message||"ไม่สามารถแสดงผลแอปพลิเคชันได้"}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded",children:"ลองอีกครั้ง"})]})})}}},37734:(e,t,r)=>{"use strict";r.d(t,{Bh:()=>x,CF:()=>n,Lx:()=>o,TK:()=>l,YB:()=>p,dk:()=>g,hG:()=>d,nu:()=>i,ui:()=>u,zO:()=>h});var s=r(75535),a=r(9141);let o=async(e,t)=>{try{let r=(0,s.rJ)(a.db,"users"),o=(0,s.P)(r,(0,s._M)("username","==",e)),n=await (0,s.GG)(o);if(n.empty)return console.log("User not found in database:",e),{success:!1,error:"User not found"};let i=n.docs[0].data(),l=n.docs[0].id;if(console.log("Found user:",e,"Checking password..."),i.password!==t)return console.log("Invalid password for user:",e),{success:!1,error:"Invalid password"};console.log("Login successful for user:",e);let d=await c(l);d&&await u(d.id);let g=await m(l,e);return{success:!0,user:{uid:l,sessionId:g,...i}}}catch(e){return console.error("Login error:",e.message),{success:!1,error:"Login failed: "+e.message}}},n=async()=>{try{let e=(0,s.rJ)(a.db,"users");return(await (0,s.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting users:",e.message),[]}},i=async e=>{try{let t={...e,createdAt:(0,s.O5)(),updatedAt:(0,s.O5)()},r=await (0,s.gS)((0,s.rJ)(a.db,"users"),t);return{success:!0,id:r.id}}catch(e){return console.error("Error adding user:",e.message),{success:!1,error:e.message}}},l=async(e,t)=>{try{let r={...t,updatedAt:(0,s.O5)()};return await (0,s.mZ)((0,s.H9)(a.db,"users",e),r),{success:!0}}catch(e){return console.error("Error updating user:",e.message),{success:!1,error:e.message}}},d=async e=>{try{return await (0,s.kd)((0,s.H9)(a.db,"users",e)),{success:!0}}catch(e){return console.error("Error deleting user:",e.message),{success:!1,error:e.message}}},c=async e=>{try{let t=(0,s.rJ)(a.db,"userSessions"),r=(0,s.P)(t,(0,s._M)("userId","==",e),(0,s._M)("active","==",!0)),o=await (0,s.GG)(r);if(o.empty)return null;let n=o.docs[0];return{id:n.id,...n.data()}}catch(e){return console.error("Error checking active session:",e.message),null}},u=async e=>{try{return await (0,s.mZ)((0,s.H9)(a.db,"userSessions",e),{active:!1,logoutTime:(0,s.O5)()}),!0}catch(e){return console.error("Error invalidating session:",e.message),!1}},m=async(e,t)=>{try{let r=new Date,o=r.toISOString().split("T")[0].replace(/-/g,""),n=r.toISOString().split("T")[1].substring(0,8).replace(/:/g,""),i=`${e}_${o}_${n}`,l={userId:e,username:t,loginTime:(0,s.O5)(),active:!0,device:"Unknown",ip:"Unknown",createdAt:o+"_"+n};return await (0,s.BN)((0,s.H9)(a.db,"userSessions",i),l),i}catch(e){throw console.error("Error creating user session:",e.message),e}},g=async(e,t)=>{if(!e||!t)return!1;try{let r=await (0,s.x7)((0,s.H9)(a.db,"userSessions",t));if(!r.exists())return!1;let o=r.data();return o.userId===e&&!0===o.active}catch(e){return console.error("Error validating session:",e.message),!1}},h=async(e,t)=>{try{let r=new Date(t);r.setDate(r.getDate()-7);let o=e=>{let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${s}`};o(t),o(r);let n=[];for(let e=1;e<=7;e++){let r=new Date(t);r.setDate(r.getDate()-e),n.push(o(r))}let i=(0,s.rJ)(a.db,"wardDataFinal"),l=(0,s.P)(i,(0,s._M)("wardId","==",e),(0,s._M)("date","in",n)),d=await (0,s.GG)(l),c=new Set;if(d.docs.forEach(e=>{let t=e.data();c.add(t.date)}),0===c.size)return{hasData:!1,message:"ไม่พบข้อมูลย้อนหลัง 7 วันที่ผ่านมา กรุณาติดต่อผู้ดูแลระบบเพื่อตรวจสอบ",datesChecked:n,datesWithData:Array.from(c)};return{hasData:!0,message:"พบข้อมูลย้อนหลังในช่วง 7 วันที่ผ่านมา",datesChecked:n,datesWithData:Array.from(c)}}catch(e){return console.error("Error checking last 7 days data:",e.message),{hasData:!1,error:e.message,message:"เกิดข้อผิดพลาดในการตรวจสอบข้อมูลย้อนหลัง 7 วัน"}}},p=async(e,t=null,r=null,o=null)=>{try{let n=(0,s.rJ)(a.db,"wardDataDrafts"),i=[(0,s._M)("userId","==",e)];t&&i.push((0,s._M)("wardId","==",t)),r&&i.push((0,s._M)("date","==",r)),o&&i.push((0,s._M)("shift","==",o));let l=(0,s.P)(n,...i),d=await (0,s.GG)(l);if(d.empty)return[];return d.docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting user drafts:",e.message),[]}},x=async(e,t,r,o)=>{try{let n=(0,s.rJ)(a.db,"wardDataDrafts"),i=(0,s.P)(n,(0,s._M)("userId","==",e),(0,s._M)("wardId","==",t),(0,s._M)("date","==",r),(0,s._M)("shift","==",o)),l=await (0,s.GG)(i);if(l.empty)return null;let d=null,c=0;return l.docs.forEach(e=>{let t=e.data(),r=t.lastUpdated?.seconds||0;r>c&&(c=r,d={id:e.id,...t})}),d}catch(e){return console.error("Error getting latest draft:",e.message),null}}},45147:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,16444,23)),Promise.resolve().then(r.t.bind(r,16042,23)),Promise.resolve().then(r.t.bind(r,88170,23)),Promise.resolve().then(r.t.bind(r,49477,23)),Promise.resolve().then(r.t.bind(r,29345,23)),Promise.resolve().then(r.t.bind(r,12089,23)),Promise.resolve().then(r.t.bind(r,46577,23)),Promise.resolve().then(r.t.bind(r,31307,23))},54868:(e,t,r)=>{"use strict";r.d(t,{DP:()=>i,NP:()=>n});var s=r(60687),a=r(43210);let o=(0,a.createContext)({theme:"light",toggleTheme:()=>{}}),n=({children:e})=>{let[t,r]=(0,a.useState)("light");return(0,a.useEffect)(()=>{let e=localStorage.getItem("theme")||"light";r(e),"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[]),(0,s.jsx)(o.Provider,{value:{theme:t,toggleTheme:()=>{let e="light"===t?"dark":"light";r(e),localStorage.setItem("theme",e),"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),console.log(`Theme changed to ${e} mode`)}},children:(0,s.jsx)("div",{className:"dark"===t?"dark-theme":"light-theme",children:e})})},i=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},70007:(e,t,r)=>{Promise.resolve().then(r.bind(r,89855))},82704:()=>{},84623:(e,t,r)=>{"use strict";r.d(t,{O:()=>g,A:()=>m});var s=r(60687),a=r(43210),o=r(9141),n=r(75535),i=r(37734),l=r(84788);let d=(e,t={})=>{(0,l.$s)(e,t)},c=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Date.now().toString(36),u=(0,a.createContext)({user:null,loading:!0,isAuthenticated:!1,authError:null,login:async(e,t)=>{},logout:()=>{},clearAuthError:()=>{}}),m=()=>(0,a.useContext)(u);function g({children:e}){let[t,r]=(0,a.useState)(null),[l,m]=(0,a.useState)(!0),[g,h]=(0,a.useState)(null),p=async(e,t)=>{console.log("Login function called with username:",e),h(null);try{let s=await Promise.race([(0,i.Lx)(e,t),new Promise((e,t)=>setTimeout(()=>t(Error("Login timeout")),1e4))]);if(s&&s.success){let t=c();sessionStorage.setItem("sessionToken",t),sessionStorage.setItem("user",JSON.stringify(s.user)),r(s.user);let a=(0,n.H9)(o.db,"users",s.user.uid);await (0,n.mZ)(a,{sessionToken:t,lastActivity:(0,n.O5)(),lastLogin:(0,n.O5)()});try{d("user_login",{userId:s.user.uid,username:e,sessionId:s.user.sessionId,role:s.user.role,name:s.user.displayName,timestamp:new Date().toISOString(),action:"Login success"})}catch(e){console.warn("Login logging failed:",e)}}else s&&!s.success&&h(s.error||"การเข้าสู่ระบบล้มเหลว กรุณาตรวจสอบข้อมูลอีกครั้ง");return s}catch(e){return console.error("Login error:",e),h("Login timeout"===e.message?"การเข้าสู่ระบบใช้เวลานานเกินไป กรุณาลองใหม่อีกครั้ง":e.message||"เกิดข้อผิดพลาดในการเข้าสู่ระบบ"),{success:!1,error:e.message||"เกิดข้อผิดพลาดในการเข้าสู่ระบบ"}}};return(0,s.jsx)(u.Provider,{value:{user:t,loading:l,isAuthenticated:!!t,authError:g,login:p,logout:(e=!0)=>{try{sessionStorage.removeItem("user"),sessionStorage.removeItem("sessionToken"),e&&t&&t.uid&&t.sessionId&&(0,i.ui)(t.sessionId).catch(e=>{console.error("Error invalidating session:",e)}),r(null),h(null),console.log("Logged out successfully");try{t&&d("user_logout",{userId:t.uid,username:t.username,timestamp:new Date().toISOString(),action:"Logout"})}catch(e){console.warn("Logout logging failed:",e)}}catch(e){console.error("Logout error:",e),h("เกิดข้อผิดพลาดในการออกจากระบบ: "+e.message)}},clearAuthError:()=>{h(null)}},children:e})}},84788:(e,t,r)=>{"use strict";r.d(t,{$s:()=>o});let s="app_logs",a=async e=>{try{let t=await fetch("/api/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(`Server responded with status ${t.status}`);return!0}catch(e){return console.warn("Failed to send log to server:",e),!1}},o=async(e,t={})=>{try{let r={timestamp:new Date().toISOString(),event:e,properties:t},o=JSON.parse(localStorage.getItem(s)||"[]");o.push(r);let n=o.slice(-1e3);localStorage.setItem(s,JSON.stringify(n)),a(r).catch(e=>{console.warn("Error sending log to server:",e)}),process.env.NEXT_PUBLIC_EXTERNAL_LOGGING_URL&&fetch(process.env.NEXT_PUBLIC_EXTERNAL_LOGGING_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch(console.error)}catch(e){console.warn("Logging failed:",e)}}},89855:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});let s=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\B_SIR\\\\OneDrive\\\\เดสก์ท็อป\\\\Active 14-3-2025\\\\Summary_of_Personnel_Ratio\\\\app\\\\ClientLayout.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\B_SIR\\OneDrive\\เดสก์ท็อป\\Active 14-3-2025\\Summary_of_Personnel_Ratio\\app\\ClientLayout.js","default")},98291:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,86346,23)),Promise.resolve().then(r.t.bind(r,27924,23)),Promise.resolve().then(r.t.bind(r,35656,23)),Promise.resolve().then(r.t.bind(r,40099,23)),Promise.resolve().then(r.t.bind(r,38243,23)),Promise.resolve().then(r.t.bind(r,28827,23)),Promise.resolve().then(r.t.bind(r,62763,23)),Promise.resolve().then(r.t.bind(r,97173,23))}};