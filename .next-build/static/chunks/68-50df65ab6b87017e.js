(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[68],{1144:(e,t,n)=>{"use strict";var r,i,s,a,o=n(9509),l=n(9641).Buffer;Object.defineProperty(t,"__esModule",{value:!0});var u=n(9438),h=n(9910),c=n(3517),f=n(8793),d=n(7061),g=n(4905);let p="@firebase/firestore",m="4.7.9";class y{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}y.UNAUTHENTICATED=new y(null),y.GOOGLE_CREDENTIALS=new y("google-credentials-uid"),y.FIRST_PARTY=new y("first-party-uid"),y.MOCK_USER=new y("mock-user");let v="11.4.0",w=new c.Logger("@firebase/firestore");function b(){return w.logLevel}function _(e,...t){if(w.logLevel<=c.LogLevel.DEBUG){let n=t.map(T);w.debug(`Firestore (${v}): ${e}`,...n)}}function I(e,...t){if(w.logLevel<=c.LogLevel.ERROR){let n=t.map(T);w.error(`Firestore (${v}): ${e}`,...n)}}function E(e,...t){if(w.logLevel<=c.LogLevel.WARN){let n=t.map(T);w.warn(`Firestore (${v}): ${e}`,...n)}}function T(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function x(e="Unexpected state"){let t=`FIRESTORE (${v}) INTERNAL ASSERTION FAILED: `+e;throw I(t),Error(t)}let S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends f.FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class A{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class D{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class k{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(y.UNAUTHENTICATED))}shutdown(){}}class N{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class O{constructor(e){this.t=e,this.currentUser=y.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){void 0===this.o||x();let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new A;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new A,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new A)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||x(),new D(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||x(),new y(e)}}class L{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=y.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class R{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new L(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(y.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class M{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class P{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,u._isFirebaseServerApp(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){void 0===this.o||x();let n=e=>{null!=e.error&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.R;return this.R=e.token,_("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.A.getImmediate({optional:!0});e?r(e):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new M(this.V));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||x(),this.R=e.token,new M(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class F{getToken(){return Promise.resolve(new M(""))}invalidateToken(){}start(e,t){}shutdown(){}}class V{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function U(e,t){return e<t?-1:+(e>t)}function B(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class q{static now(){return q.fromMillis(Date.now())}static fromDate(e){return q.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new q(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new C(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new C(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?U(this.nanoseconds,e.nanoseconds):U(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class j{static fromTimestamp(e){return new j(e)}static min(){return new j(new q(0,0))}static max(){return new j(new q(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let z="__name__";class ${constructor(e,t,n){void 0===t?t=0:t>e.length&&x(),void 0===n?n=e.length-t:n>e.length-t&&x(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===$.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof $?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=$.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return Math.sign(e.length-t.length)}static compareSegments(e,t){let n=$.isNumericId(e),r=$.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?$.extractNumericId(e).compare($.extractNumericId(t)):e<t?-1:+(e>t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return d.Integer.fromString(e.substring(4,e.length-2))}}class K extends ${construct(e,t,n){return new K(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new C(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new K(t)}static emptyPath(){return new K([])}}let G=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Q extends ${construct(e,t,n){return new Q(e,t,n)}static isValidIdentifier(e){return G.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Q.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===z}static keyField(){return new Q([z])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new C(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new C(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new C(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new C(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Q(t)}static emptyPath(){return new Q([])}}class H{constructor(e){this.path=e}static fromPath(e){return new H(K.fromString(e))}static fromName(e){return new H(K.fromString(e).popFirst(5))}static empty(){return new H(K.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===K.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return K.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new H(new K(e.slice()))}}class W{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Y(e){return e.fields.find(e=>2===e.kind)}function J(e){return e.fields.filter(e=>2!==e.kind)}function X(e,t){let n=U(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=function(e,t){let n=Q.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:U(e.kind,t.kind)}(e.fields[r],t.fields[r])))return n;return U(e.fields.length,t.fields.length)}W.UNKNOWN_ID=-1;class Z{constructor(e,t){this.fieldPath=e,this.kind=t}}class ee{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ee(0,er.min())}}function et(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new er(j.fromTimestamp(1e9===r?new q(n+1,0):new q(n,r)),H.empty(),t)}function en(e){return new er(e.readTime,e.key,-1)}class er{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new er(j.min(),H.empty(),-1)}static max(){return new er(j.max(),H.empty(),-1)}}function ei(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=H.comparator(e.documentKey,t.documentKey))?n:U(e.largestBatchId,t.largestBatchId)}let es="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ea{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function eo(e){if(e.code!==S.FAILED_PRECONDITION||e.message!==es)throw e;_("LocalStore","Unexpectedly lost primary lease")}class el{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&x(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new el((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof el?t:el.resolve(t)}catch(e){return el.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):el.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):el.reject(t)}static resolve(e){return new el((t,n)=>{t(e)})}static reject(e){return new el((t,n)=>{n(e)})}static waitFor(e){return new el((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=el.resolve(!1);for(let n of e)t=t.next(e=>e?el.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new el((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new el((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}let eu="SimpleDb";class eh{static open(e,t,n,r){try{return new eh(t,e.transaction(r,n))}catch(e){throw new eg(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.m=new A,this.transaction.oncomplete=()=>{this.m.resolve()},this.transaction.onabort=()=>{t.error?this.m.reject(new eg(e,t.error)):this.m.resolve()},this.transaction.onerror=t=>{let n=ew(t.target.error);this.m.reject(new eg(e,n))}}get p(){return this.m.promise}abort(e){e&&this.m.reject(e),this.aborted||(_(eu,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}S(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new em(this.transaction.objectStore(e))}}class ec{static delete(e){return _(eu,"Removing database:",e),ey(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!f.isIndexedDBAvailable())return!1;if(ec.v())return!0;let e=f.getUA(),t=ec.C(e),n=ef(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static v(){var e;return void 0!==o&&"YES"===(null===(e=o.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static C(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,n){this.name=e,this.version=t,this.O=n,12.2===ec.C(f.getUA())&&I("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async N(e){return this.db||(_(eu,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new eg(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new C(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new C(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new eg(e,r))},r.onupgradeneeded=e=>{_(eu,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.O.B(t,r.transaction,e.oldVersion,this.version).next(()=>{_(eu,"Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db}k(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.N(e);let t=eh.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.S(),e)).catch(e=>(t.abort(e),el.reject(e))).toPromise();return s.catch(()=>{}),await t.p,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(_(eu,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ef(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class ed{constructor(e){this.q=e,this.$=!1,this.K=null}get isDone(){return this.$}get U(){return this.K}set cursor(e){this.q=e}done(){this.$=!0}W(e){this.K=e}delete(){return ey(this.q.delete())}}class eg extends C{constructor(e,t){super(S.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ep(e){return"IndexedDbTransactionError"===e.name}class em{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(_(eu,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(_(eu,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ey(n)}add(e){return _(eu,"ADD",this.store.name,e,e),ey(this.store.add(e))}get(e){return ey(this.store.get(e)).next(t=>(void 0===t&&(t=null),_(eu,"GET",this.store.name,e,t),t))}delete(e){return _(eu,"DELETE",this.store.name,e),ey(this.store.delete(e))}count(){return _(eu,"COUNT",this.store.name),ey(this.store.count())}G(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new el((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.j(e,(e,n)=>{t.push(n)}).next(()=>t)}}H(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new el((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}J(e,t){_(eu,"DELETE ALL",this.store.name);let n=this.options(e,t);n.Y=!1;let r=this.cursor(n);return this.j(r,(e,t,n)=>n.delete())}Z(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.j(r,t)}X(e){let t=this.cursor({});return new el((n,r)=>{t.onerror=e=>{r(ew(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}j(e,t){let n=[];return new el((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new ed(i),a=t(i.primaryKey,i.value,s);if(a instanceof el){let e=a.catch(e=>(s.done(),el.reject(e)));n.push(e)}s.isDone?r():null===s.U?i.continue():i.continue(s.U)}}).next(()=>el.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ey(e){return new el((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(ew(e.target.error))}})}let ev=!1;function ew(e){let t=ec.C(f.getUA());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ev||(ev=!0,setTimeout(()=>{throw e},0)),e}}return e}let eb="IndexBackfiller";class e_{constructor(e,t){this.asyncQueue=e,this.ee=t,this.task=null}start(){this.te(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}te(e){_(eb,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ee.ne();_(eb,`Documents written: ${e}`)}catch(e){ep(e)?_(eb,"Ignoring IndexedDB error during index backfill: ",e):await eo(e)}await this.te(6e4)})}}class eI{constructor(e,t){this.localStore=e,this.persistence=t}async ne(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.re(t,e))}re(e,t){let n=new Set,r=t,i=!0;return el.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return _(eb,`Processing collection: ${t}`),this.ie(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}ie(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.se(r,n)).next(n=>(_(eb,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}se(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=en(t);ei(r,n)>0&&(n=r)}),new er(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class eE{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.oe(e),this._e=e=>t.writeSequenceNumber(e))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this._e&&this._e(e),e}}function eT(e){return null==e}function ex(e){return 0===e&&1/e==-1/0}function eS(e){return"number"==typeof e&&Number.isInteger(e)&&!ex(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function eC(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}eE.ae=-1;function eA(e){let t=e.length;if(t>=2||x(),2===t)return"\x01"===e.charAt(0)&&"\x01"===e.charAt(1)||x(),K.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&x(),e.charAt(t+1)){case"\x01":let a;let o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:x()}s=t+2}return new K(r)}let eD="remoteDocuments",ek="owner",eN="owner",eO="mutationQueues",eL="mutations",eR="batchId",eM="userMutationsIndex",eP=["userId","batchId"],eF={},eV="documentMutations",eU="remoteDocumentsV14",eB=["prefixPath","collectionGroup","readTime","documentId"],eq="documentKeyIndex",ej=["prefixPath","collectionGroup","documentId"],ez="collectionGroupIndex",e$=["collectionGroup","readTime","prefixPath","documentId"],eK="remoteDocumentGlobal",eG="remoteDocumentGlobalKey",eQ="targets",eH="queryTargetsIndex",eW=["canonicalId","targetId"],eY="targetDocuments",eJ=["targetId","path"],eX="documentTargetsIndex",eZ=["path","targetId"],e0="targetGlobalKey",e1="targetGlobal",e2="collectionParents",e6=["collectionId","parent"],e5="clientMetadata",e3="bundles",e4="namedQueries",e8="indexConfiguration",e9="collectionGroupIndex",e7="indexState",te=["indexId","uid"],tt="sequenceNumberIndex",tn=["uid","sequenceNumber"],tr="indexEntries",ti=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ts="documentKeyIndex",ta=["indexId","uid","orderedDocumentKey"],to="documentOverlays",tl=["userId","collectionPath","documentId"],tu="collectionPathOverlayIndex",th=["userId","collectionPath","largestBatchId"],tc="collectionGroupOverlayIndex",tf=["userId","collectionGroup","largestBatchId"],td="globals",tg=[eO,eL,eV,eD,eQ,ek,e1,eY,e5,eK,e2,e3,e4],tp=[...tg,to],tm=[eO,eL,eV,eU,eQ,ek,e1,eY,e5,eK,e2,e3,e4,to],ty=[...tm,e8,e7,tr],tv=[...ty,td];class tw extends ea{constructor(e,t){super(),this.ue=e,this.currentSequenceNumber=t}}function tb(e,t){return ec.M(e.ue,t)}function t_(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function tI(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function tE(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}function tT(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tx{constructor(e,t){this.comparator=e,this.root=t||tC.EMPTY}insert(e,t){return new tx(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tC.BLACK,null,null))}remove(e){return new tx(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tC.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tS(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tS(this.root,e,this.comparator,!1)}getReverseIterator(){return new tS(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tS(this.root,e,this.comparator,!0)}}class tS{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class tC{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:tC.RED,this.left=null!=r?r:tC.EMPTY,this.right=null!=i?i:tC.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new tC(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return tC.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return tC.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,tC.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,tC.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw x();let e=this.left.check();if(e!==this.right.check())throw x();return e+ +!this.isRed()}}tC.EMPTY=null,tC.RED=!0,tC.BLACK=!1,tC.EMPTY=new class{constructor(){this.size=0}get key(){throw x()}get value(){throw x()}get color(){throw x()}get left(){throw x()}get right(){throw x()}copy(e,t,n,r,i){return this}insert(e,t,n){return new tC(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class tA{constructor(e){this.comparator=e,this.data=new tx(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tD(this.data.getIterator())}getIteratorFrom(e){return new tD(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof tA)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new tA(this.comparator);return t.data=e,t}}class tD{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function tk(e){return e.hasNext()?e.getNext():void 0}class tN{constructor(e){this.fields=e,e.sort(Q.comparator)}static empty(){return new tN([])}unionWith(e){let t=new tA(Q.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new tN(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return B(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class tO extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class tL{constructor(e){this.binaryString=e}static fromBase64String(e){return new tL(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new tO("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new tL(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return U(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}tL.EMPTY_BYTE_STRING=new tL("");let tR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tM(e){if(e||x(),"string"==typeof e){let t=0,n=tR.exec(e);if(n||x(),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:tP(e.seconds),nanos:tP(e.nanos)}}function tP(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function tF(e){return"string"==typeof e?tL.fromBase64String(e):tL.fromUint8Array(e)}let tV="server_timestamp",tU="__type__",tB="__previous_value__",tq="__local_write_time__";function tj(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[tU])||void 0===n?void 0:n.stringValue)===tV}function tz(e){let t=e.mapValue.fields[tB];return tj(t)?tz(t):t}function t$(e){let t=tM(e.mapValue.fields[tq].timestampValue);return new q(t.seconds,t.nanos)}class tK{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}let tG="(default)";class tQ{constructor(e,t){this.projectId=e,this.database=t||tG}static empty(){return new tQ("","")}get isDefaultDatabase(){return this.database===tG}isEqual(e){return e instanceof tQ&&e.projectId===this.projectId&&e.database===this.database}}let tH="__type__",tW="__max__",tY={mapValue:{fields:{__type__:{stringValue:tW}}}},tJ="__vector__",tX="value",tZ={nullValue:"NULL_VALUE"};function t0(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?tj(e)?4:ns(e)?0x1fffffffffffff:nr(e)?10:11:x()}function t1(e,t){if(e===t)return!0;let n=t0(e);if(n!==t0(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return t$(e).isEqual(t$(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=tM(e.timestampValue),r=tM(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return tF(e.bytesValue).isEqual(tF(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return tP(e.geoPointValue.latitude)===tP(t.geoPointValue.latitude)&&tP(e.geoPointValue.longitude)===tP(t.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return tP(e.integerValue)===tP(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=tP(e.doubleValue),r=tP(t.doubleValue);return n===r?ex(n)===ex(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return B(e.arrayValue.values||[],t.arrayValue.values||[],t1);case 10:case 11:return function(e,t){let n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(t_(n)!==t_(r))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!t1(n[e],r[e])))return!1;return!0}(e,t);default:return x()}}function t2(e,t){return void 0!==(e.values||[]).find(e=>t1(e,t))}function t6(e,t){if(e===t)return 0;let n=t0(e),r=t0(t);if(n!==r)return U(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return U(e.booleanValue,t.booleanValue);case 2:return function(e,t){let n=tP(e.integerValue||e.doubleValue),r=tP(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return t5(e.timestampValue,t.timestampValue);case 4:return t5(t$(e),t$(t));case 5:return U(e.stringValue,t.stringValue);case 6:return function(e,t){let n=tF(e),r=tF(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=U(n[e],r[e]);if(0!==t)return t}return U(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=U(tP(e.latitude),tP(t.latitude));return 0!==n?n:U(tP(e.longitude),tP(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return t3(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;let a=e.fields||{},o=t.fields||{},l=null===(n=a[tX])||void 0===n?void 0:n.arrayValue,u=null===(r=o[tX])||void 0===r?void 0:r.arrayValue,h=U((null===(i=null==l?void 0:l.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==h?h:t3(l,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===tY.mapValue&&t===tY.mapValue)return 0;if(e===tY.mapValue)return 1;if(t===tY.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=U(r[e],s[e]);if(0!==t)return t;let a=t6(n[r[e]],i[s[e]]);if(0!==a)return a}return U(r.length,s.length)}(e.mapValue,t.mapValue);default:throw x()}}function t5(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return U(e,t);let n=tM(e),r=tM(t),i=U(n.seconds,r.seconds);return 0!==i?i:U(n.nanos,r.nanos)}function t3(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=t6(n[e],r[e]);if(t)return t}return U(n.length,r.length)}function t4(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=tM(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?tF(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,H.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=t4(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${t4(e.fields[i])}`;return n+"}"}(e.mapValue):x()}function t8(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function t9(e){return!!e&&"integerValue"in e}function t7(e){return!!e&&"arrayValue"in e}function ne(e){return!!e&&"nullValue"in e}function nt(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nn(e){return!!e&&"mapValue"in e}function nr(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[tH])||void 0===n?void 0:n.stringValue)===tJ}function ni(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return tI(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=ni(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ni(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ns(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===tW}let na={mapValue:{fields:{[tH]:{stringValue:tJ},[tX]:{arrayValue:{}}}}};function no(e,t){let n=t6(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function nl(e,t){let n=t6(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class nu{constructor(e){this.value=e}static empty(){return new nu({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!nn(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ni(t)}setAll(e){let t=Q.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=ni(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());nn(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return t1(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];nn(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(tI(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new nu(ni(this.value))}}class nh{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new nh(e,0,j.min(),j.min(),j.min(),nu.empty(),0)}static newFoundDocument(e,t,n,r){return new nh(e,1,t,j.min(),n,r,0)}static newNoDocument(e,t){return new nh(e,2,t,j.min(),j.min(),nu.empty(),0)}static newUnknownDocument(e,t){return new nh(e,3,t,j.min(),j.min(),nu.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(j.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nu.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nu.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof nh&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nh(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class nc{constructor(e,t){this.position=e,this.inclusive=t}}function nf(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?H.comparator(H.fromName(a.referenceValue),n.key):t6(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function nd(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!t1(e.position[n],t.position[n]))return!1;return!0}class ng{constructor(e,t="asc"){this.field=e,this.dir=t}}class np{}class nm extends np{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new nE(e,t,n):"array-contains"===t?new nC(e,n):"in"===t?new nA(e,n):"not-in"===t?new nD(e,n):"array-contains-any"===t?new nk(e,n):new nm(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new nT(e,n):new nx(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(t6(t,this.value)):null!==t&&t0(this.value)===t0(t)&&this.matchesComparison(t6(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return x()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ny extends np{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new ny(e,t)}matches(e){return nv(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function nv(e){return"and"===e.op}function nw(e){return"or"===e.op}function nb(e){return n_(e)&&nv(e)}function n_(e){for(let t of e.filters)if(t instanceof ny)return!1;return!0}function nI(e,t){let n=e.filters.concat(t);return ny.create(n,e.op)}class nE extends nm{constructor(e,t,n){super(e,t,n),this.key=H.fromName(n.referenceValue)}matches(e){let t=H.comparator(e.key,this.key);return this.matchesComparison(t)}}class nT extends nm{constructor(e,t){super(e,"in",t),this.keys=nS("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class nx extends nm{constructor(e,t){super(e,"not-in",t),this.keys=nS("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function nS(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>H.fromName(e.referenceValue))}class nC extends nm{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return t7(t)&&t2(t.arrayValue,this.value)}}class nA extends nm{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&t2(this.value.arrayValue,t)}}class nD extends nm{constructor(e,t){super(e,"not-in",t)}matches(e){if(t2(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!t2(this.value.arrayValue,t)}}class nk extends nm{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!t7(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>t2(this.value.arrayValue,e))}}class nN{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.le=null}}function nO(e,t=null,n=[],r=[],i=null,s=null,a=null){return new nN(e,t,n,r,i,s,a)}function nL(e){if(null===e.le){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof nm)return t.field.canonicalString()+t.op.toString()+t4(t.value);if(nb(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),eT(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>t4(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>t4(e)).join(",")),e.le=t}return e.le}function nR(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof nm?n instanceof nm&&t.op===n.op&&t.field.isEqual(n.field)&&t1(t.value,n.value):t instanceof ny?n instanceof ny&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void x()}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!nd(e.startAt,t.startAt)&&nd(e.endAt,t.endAt)}function nM(e){return H.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function nP(e,t){return e.filters.filter(e=>e instanceof nm&&e.field.isEqual(t))}function nF(e,t,n){let r=tZ,i=!0;for(let n of nP(e,t)){let e=tZ,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?tZ:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?t8(tQ.empty(),H.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?nr(s)?na:{mapValue:{}}:x();break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=tZ}0>no({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>no({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function nV(e,t,n){let r=tY,i=!0;for(let n of nP(e,t)){let e=tY,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?t8(tQ.empty(),H.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?na:"mapValue"in s?nr(s)?{mapValue:{}}:tY:x(),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=tY}nl({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];nl({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class nU{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function nB(e){return new nU(e)}function nq(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function nj(e){return null!==e.collectionGroup}function nz(e){if(null===e.he){let t;e.he=[];let n=new Set;for(let t of e.explicitOrderBy)e.he.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new tA(Q.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.he.push(new ng(t,r))}),n.has(Q.keyField().canonicalString())||e.he.push(new ng(Q.keyField(),r))}return e.he}function n$(e){return e.Pe||(e.Pe=nG(e,nz(e))),e.Pe}function nK(e){return e.Te||(e.Te=nG(e,e.explicitOrderBy)),e.Te}function nG(e,t){if("F"===e.limitType)return nO(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new ng(e.field,t)});let n=e.endAt?new nc(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new nc(e.startAt.position,e.startAt.inclusive):null;return nO(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function nQ(e,t){let n=e.filters.concat([t]);return new nU(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function nH(e,t,n){return new nU(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function nW(e,t){return nR(n$(e),n$(t))&&e.limitType===t.limitType}function nY(e){return`${nL(n$(e))}|lt:${e.limitType}`}function nJ(e){var t;let n;return`Query(target=${n=(t=n$(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof nm?`${t.field.canonicalString()} ${t.op} ${t4(t.value)}`:t instanceof ny?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),eT(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>t4(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>t4(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function nX(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):H.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of nz(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let r=nf(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,nz(e),t))&&(!e.endAt||!!function(e,t,n){let r=nf(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,nz(e),t))}function nZ(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function n0(e){return(t,n)=>{let r=!1;for(let i of nz(e)){let e=function(e,t,n){let r=e.field.isKeyField()?H.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?t6(r,i):x()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return x()}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class n1{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){tI(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return tT(this.inner)}size(){return this.innerSize}}let n2=new tx(H.comparator),n6=new tx(H.comparator);function n5(...e){let t=n6;for(let n of e)t=t.insert(n.key,n);return t}function n3(e){let t=n6;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function n4(){return new n1(e=>e.toString(),(e,t)=>e.isEqual(t))}let n8=new tx(H.comparator),n9=new tA(H.comparator);function n7(...e){let t=n9;for(let n of e)t=t.add(n);return t}let re=new tA(U);function rt(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ex(t)?"-0":t}}function rn(e){return{integerValue:""+e}}function rr(e,t){return eS(t)?rn(t):rt(e,t)}class ri{constructor(){this._=void 0}}function rs(e,t){return e instanceof rc?t9(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class ra extends ri{}class ro extends ri{constructor(e){super(),this.elements=e}}function rl(e,t){let n=rd(t);for(let t of e.elements)n.some(e=>t1(e,t))||n.push(t);return{arrayValue:{values:n}}}class ru extends ri{constructor(e){super(),this.elements=e}}function rh(e,t){let n=rd(t);for(let t of e.elements)n=n.filter(e=>!t1(e,t));return{arrayValue:{values:n}}}class rc extends ri{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function rf(e){return tP(e.integerValue||e.doubleValue)}function rd(e){return t7(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class rg{constructor(e,t){this.field=e,this.transform=t}}class rp{constructor(e,t){this.version=e,this.transformResults=t}}class rm{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rm}static exists(e){return new rm(void 0,e)}static updateTime(e){return new rm(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ry(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class rv{}function rw(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new rC(e.key,rm.none()):new rI(e.key,e.data,rm.none());{let n=e.data,r=nu.empty(),i=new tA(Q.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new rE(e.key,r,new tN(i.toArray()),rm.none())}}function rb(e,t,n,r){return e instanceof rI?function(e,t,n,r){if(!ry(e.precondition,t))return n;let i=e.value.clone(),s=rS(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof rE?function(e,t,n,r){if(!ry(e.precondition,t))return n;let i=rS(e.fieldTransforms,r,t),s=t.data;return(s.setAll(rT(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):ry(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function r_(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&B(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof ro&&r instanceof ro||n instanceof ru&&r instanceof ru?B(n.elements,r.elements,t1):n instanceof rc&&r instanceof rc?t1(n.Ie,r.Ie):n instanceof ra&&r instanceof ra)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class rI extends rv{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class rE extends rv{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function rT(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function rx(e,t,n){var r;let i=new Map;e.length===n.length||x();for(let s=0;s<n.length;s++){let a=e[s],o=a.transform,l=t.data.field(a.field);i.set(a.field,(r=n[s],o instanceof ro?rl(o,l):o instanceof ru?rh(o,l):r))}return i}function rS(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,e instanceof ra?function(e,t){let n={fields:{[tU]:{stringValue:tV},[tq]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&tj(t)&&(t=tz(t)),t&&(n.fields[tB]=t),{mapValue:n}}(t,s):e instanceof ro?rl(e,s):e instanceof ru?rh(e,s):function(e,t){let n=rs(e,t),r=rf(n)+rf(e.Ie);return t9(n)&&t9(e.Ie)?rn(r):rt(e.serializer,r)}(e,s))}return r}class rC extends rv{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class rA extends rv{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class rD{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let i=this.mutations[t];if(i.key.isEqual(e.key)){var r;r=n[t],i instanceof rI?function(e,t,n){let r=e.value.clone(),i=rx(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(i,e,r):i instanceof rE?function(e,t,n){if(!ry(e.precondition,t))return void t.convertToUnknownDocument(n.version);let r=rx(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(rT(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(i,e,r):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,r)}}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=rb(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=rb(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=n4();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=rw(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(j.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),n7())}isEqual(e){return this.batchId===e.batchId&&B(this.mutations,e.mutations,(e,t)=>r_(e,t))&&B(this.baseMutations,e.baseMutations,(e,t)=>r_(e,t))}}class rk{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){e.mutations.length===n.length||x();let r=n8,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new rk(e,t,n,r)}}class rN{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class rO{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class rL{constructor(e,t){this.count=e,this.unchangedNames=t}}function rR(e){switch(e){case S.OK:return x();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return x()}}function rM(e){if(void 0===e)return I("GRPC error has no .code"),S.UNKNOWN;switch(e){case r.OK:return S.OK;case r.CANCELLED:return S.CANCELLED;case r.UNKNOWN:return S.UNKNOWN;case r.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case r.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case r.INTERNAL:return S.INTERNAL;case r.UNAVAILABLE:return S.UNAVAILABLE;case r.UNAUTHENTICATED:return S.UNAUTHENTICATED;case r.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case r.NOT_FOUND:return S.NOT_FOUND;case r.ALREADY_EXISTS:return S.ALREADY_EXISTS;case r.PERMISSION_DENIED:return S.PERMISSION_DENIED;case r.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case r.ABORTED:return S.ABORTED;case r.OUT_OF_RANGE:return S.OUT_OF_RANGE;case r.UNIMPLEMENTED:return S.UNIMPLEMENTED;case r.DATA_LOSS:return S.DATA_LOSS;default:return x()}}(i=r||(r={}))[i.OK=0]="OK",i[i.CANCELLED=1]="CANCELLED",i[i.UNKNOWN=2]="UNKNOWN",i[i.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",i[i.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",i[i.NOT_FOUND=5]="NOT_FOUND",i[i.ALREADY_EXISTS=6]="ALREADY_EXISTS",i[i.PERMISSION_DENIED=7]="PERMISSION_DENIED",i[i.UNAUTHENTICATED=16]="UNAUTHENTICATED",i[i.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",i[i.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",i[i.ABORTED=10]="ABORTED",i[i.OUT_OF_RANGE=11]="OUT_OF_RANGE",i[i.UNIMPLEMENTED=12]="UNIMPLEMENTED",i[i.INTERNAL=13]="INTERNAL",i[i.UNAVAILABLE=14]="UNAVAILABLE",i[i.DATA_LOSS=15]="DATA_LOSS";let rP=null;function rF(){return new TextEncoder}let rV=new d.Integer([0xffffffff,0xffffffff],0);function rU(e){let t=rF().encode(e),n=new d.Md5;return n.update(t),new Uint8Array(n.digest())}function rB(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new d.Integer([n,r],0),new d.Integer([i,s],0)]}class rq{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new rj(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new rj(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new rj(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=d.Integer.fromNumber(this.Ee)}Ae(e,t,n){let r=e.add(t.multiply(d.Integer.fromNumber(n)));return 1===r.compare(rV)&&(r=new d.Integer([r.getBits(0),r.getBits(1)],0)),r.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ee)return!1;let[t,n]=rB(rU(e));for(let e=0;e<this.hashCount;e++){let r=this.Ae(t,n,e);if(!this.Re(r))return!1}return!0}static create(e,t,n){let r=new rq(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.Ee)return;let[t,n]=rB(rU(e));for(let e=0;e<this.hashCount;e++){let r=this.Ae(t,n,e);this.Ve(r)}}Ve(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class rj extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class rz{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,r$.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new rz(j.min(),r,new tx(U),n2,n7())}}class r${constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r$(n,t,n7(),n7(),n7())}}class rK{constructor(e,t,n,r){this.me=e,this.removedTargetIds=t,this.key=n,this.fe=r}}class rG{constructor(e,t){this.targetId=e,this.ge=t}}class rQ{constructor(e,t,n=tL.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class rH{constructor(){this.pe=0,this.ye=rJ(),this.we=tL.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return 0!==this.pe}get ve(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.we=e)}Fe(){let e=n7(),t=n7(),n=n7();return this.ye.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:x()}}),new r$(this.we,this.be,e,t,n)}Me(){this.Se=!1,this.ye=rJ()}xe(e,t){this.Se=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.Se=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,this.pe>=0||x()}Le(){this.Se=!0,this.be=!0}}class rW{constructor(e){this.ke=e,this.qe=new Map,this.Qe=n2,this.$e=rY(),this.Ke=rY(),this.Ue=new tx(U)}We(e){for(let t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(let t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,t=>{let n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Ce(e.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.Ce(e.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(t);break;case 3:this.Je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Ce(e.resumeToken));break;default:x()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach((e,n)=>{this.Je(n)&&t(n)})}Ze(e){let t=e.targetId,n=e.ge.count,r=this.Xe(t);if(r){let i=r.target;if(nM(i)){if(0===n){let e=new H(i.path);this.ze(t,e,nh.newNoDocument(e,j.min()))}else 1===n||x()}else{let r=this.et(t);if(r!==n){let n=this.tt(e),i=n?this.nt(n,e,r):1;0!==i&&(this.Ye(t),this.Ue=this.Ue.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null==rP||rP.rt(function(e,t,n,r,i){var s,a,o,l,u,h;let c={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},f=t.unchangedNames;return f&&(c.bloomFilter={applied:0===i,hashCount:null!==(s=null==f?void 0:f.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(l=null===(o=null===(a=null==f?void 0:f.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==l?l:0,padding:null!==(h=null===(u=null==f?void 0:f.bits)||void 0===u?void 0:u.padding)&&void 0!==h?h:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),c}(r,e.ge,this.ke.it(),n,i))}}}}tt(e){let t,n;let r=e.ge.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=tF(i).toUint8Array()}catch(e){if(e instanceof tO)return E("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new rq(t,s,a)}catch(e){return E(e instanceof rj?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.Ee?null:n}nt(e,t,n){return 2*(t.ge.count!==n-this.st(e,t.targetId))}st(e,t){let n=this.ke.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.ke.it(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.ze(t,n,null),r++)}),r}ot(e){let t=new Map;this.qe.forEach((n,r)=>{let i=this.Xe(r);if(i){if(n.current&&nM(i.target)){let t=new H(i.target.path);this._t(t).has(r)||this.ut(r,t)||this.ze(r,t,nh.newNoDocument(t,e))}n.ve&&(t.set(r,n.Fe()),n.Me())}});let n=n7();this.Ke.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.Xe(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.Qe.forEach((t,n)=>n.setReadTime(e));let r=new rz(e,t,this.Ue,this.Qe,n);return this.Qe=n2,this.$e=rY(),this.Ke=rY(),this.Ue=new tx(U),r}Ge(e,t){if(!this.Je(e))return;let n=2*!!this.ut(e,t.key);this.He(e).xe(t.key,n),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ke=this.Ke.insert(t.key,this.ct(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;let r=this.He(e);this.ut(e,t)?r.xe(t,1):r.Oe(t),this.Ke=this.Ke.insert(t,this.ct(t).delete(e)),this.Ke=this.Ke.insert(t,this.ct(t).add(e)),n&&(this.Qe=this.Qe.insert(t,n))}removeTarget(e){this.qe.delete(e)}et(e){let t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new rH,this.qe.set(e,t)),t}ct(e){let t=this.Ke.get(e);return t||(t=new tA(U),this.Ke=this.Ke.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new tA(U),this.$e=this.$e.insert(e,t)),t}Je(e){let t=null!==this.Xe(e);return t||_("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){let t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new rH),this.ke.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function rY(){return new tx(H.comparator)}function rJ(){return new tx(H.comparator)}let rX={asc:"ASCENDING",desc:"DESCENDING"},rZ={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},r0={and:"AND",or:"OR"};class r1{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function r2(e,t){return e.useProto3Json||eT(t)?t:{value:t}}function r6(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function r5(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function r3(e){return e||x(),j.fromTimestamp(function(e){let t=tM(e);return new q(t.seconds,t.nanos)}(e))}function r4(e,t){return r8(e,t).canonicalString()}function r8(e,t){let n=new K(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function r9(e){let t=K.fromString(e);return iy(t)||x(),t}function r7(e,t){return r4(e.databaseId,t.path)}function ie(e,t){let n=r9(t);if(n.get(1)!==e.databaseId.projectId)throw new C(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new C(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new H(is(n))}function it(e,t){return r4(e.databaseId,t)}function ir(e){let t=r9(e);return 4===t.length?K.emptyPath():is(t)}function ii(e){return new K(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function is(e){return e.length>4&&"documents"===e.get(4)||x(),e.popFirst(5)}function ia(e,t,n){return{name:r7(e,t),fields:n.value.mapValue.fields}}function io(e,t,n){let r=ie(e,t.name),i=r3(t.updateTime),s=t.createTime?r3(t.createTime):j.min(),a=new nu({mapValue:{fields:t.fields}}),o=nh.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function il(e,t){var n;let r;if(t instanceof rI)r={update:ia(e,t.key,t.value)};else if(t instanceof rC)r={delete:r7(e,t.key)};else if(t instanceof rE)r={update:ia(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof rA))return x();r={verify:r7(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof ra)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ro)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ru)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof rc)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw x()})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:r6(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:x()),r}function iu(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?rm.updateTime(r3(n.updateTime)):void 0!==n.exists?rm.exists(n.exists):rm.none():rm.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{var n,r;let i;return n=e,i=null,"setToServerValue"in(r=t)?("REQUEST_TIME"===r.setToServerValue||x(),i=new ra):"appendMissingElements"in r?i=new ro(r.appendMissingElements.values||[]):"removeAllFromArray"in r?i=new ru(r.removeAllFromArray.values||[]):"increment"in r?i=new rc(n,r.increment):x(),new rg(Q.fromServerFormat(r.fieldPath),i)}):[];if(t.update){t.update.name;let n=ie(e,t.update.name),s=new nu({mapValue:{fields:t.update.fields}});return t.updateMask?new rE(n,s,new tN((t.updateMask.fieldPaths||[]).map(e=>Q.fromServerFormat(e))),r,i):new rI(n,s,r,i)}return t.delete?new rC(ie(e,t.delete),r):t.verify?new rA(ie(e,t.verify),r):x()}function ih(e,t){return{documents:[it(e,t.path)]}}function ic(e,t){var n,r;let i;let s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=it(e,i);let o=function(e){if(0!==e.length)return function e(t){return t instanceof nm?function(e){if("=="===e.op){if(nt(e.value))return{unaryFilter:{field:ip(e.field),op:"IS_NAN"}};if(ne(e.value))return{unaryFilter:{field:ip(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(nt(e.value))return{unaryFilter:{field:ip(e.field),op:"IS_NOT_NAN"}};if(ne(e.value))return{unaryFilter:{field:ip(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ip(e.field),op:rZ[e.op],value:e.value}}}(t):t instanceof ny?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:r0[t.op],filters:n}}}(t):x()}(ny.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:ip(e.field),direction:rX[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=r2(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{ht:s,parent:i}}function id(e,t,n,r){let{ht:i,parent:s}=ic(e,t),a={},o=[],l=0;return n.forEach(e=>{let t=r?e.alias:"aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:ip(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:ip(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},Pt:a,parent:s}}function ig(e){var t;let n,r=ir(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,a=null;if(s>0){1===s||x();let e=i.from[0];e.allDescendants?a=e.collectionId:r=r.child(e.collectionId)}let o=[];i.where&&(o=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=im(e.unaryFilter.field);return nm.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=im(e.unaryFilter.field);return nm.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=im(e.unaryFilter.field);return nm.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=im(e.unaryFilter.field);return nm.create(i,"!=",{nullValue:"NULL_VALUE"});default:return x()}}(t):void 0!==t.fieldFilter?nm.create(im(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return x()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?ny.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return x()}}(t.compositeFilter.op)):x()}(e);return t instanceof ny&&nb(t)?t.getFilters():[t]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new ng(im(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let u=null;i.limit&&(u=eT(n="object"==typeof(t=i.limit)?t.value:t)?null:n);let h=null;i.startAt&&(h=function(e){let t=!!e.before;return new nc(e.values||[],t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){let t=!e.before;return new nc(e.values||[],t)}(i.endAt)),new nU(r,a,l,o,u,"F",h,c)}function ip(e){return{fieldPath:e.canonicalString()}}function im(e){return Q.fromServerFormat(e.fieldPath)}function iy(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class iv{constructor(e,t,n,r,i=j.min(),s=j.min(),a=tL.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new iv(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iv(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iv(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iv(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iw{constructor(e){this.Tt=e}}function ib(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:i_(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:r7(i=e.Tt,t.key),fields:t.data.value.mapValue.fields,updateTime:r6(i,t.version.toTimestamp()),createTime:r6(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:iI(t.version)};else{if(!t.isUnknownDocument())return x();r.unknownDocument={path:n.path.toArray(),version:iI(t.version)}}return r}function i_(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function iI(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function iE(e){let t=new q(e.seconds,e.nanoseconds);return j.fromTimestamp(t)}function iT(e,t){let n=(t.baseMutations||[]).map(t=>iu(e.Tt,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>iu(e.Tt,t)),i=q.fromMillis(t.localWriteTimeMs);return new rD(t.batchId,i,n,r)}function ix(e){var t;let n=iE(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?iE(e.lastLimboFreeSnapshotVersion):j.min();return new iv(void 0!==e.query.documents?(1===(t=e.query).documents.length||x(),n$(nB(ir(t.documents[0])))):n$(ig(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,tL.fromBase64String(e.resumeToken))}function iS(e,t){let n;let r=iI(t.snapshotVersion),i=iI(t.lastLimboFreeSnapshotVersion);n=nM(t.target)?ih(e.Tt,t.target):ic(e.Tt,t.target).ht;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:nL(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function iC(e){let t=ig({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?nH(t,t.limit,"L"):t}function iA(e,t){return new rN(t.largestBatchId,iu(e.Tt,t.overlayMutation))}function iD(e,t){let n=t.path.lastSegment();return[e,eC(t.path.popLast()),n]}function ik(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:iI(r.readTime),documentKey:eC(r.documentKey.path),largestBatchId:r.largestBatchId}}class iN{getBundleMetadata(e,t){return tb(e,e3).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:iE(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return tb(e,e3).put({bundleId:t.id,createTime:iI(r3(t.createTime)),version:t.version})}getNamedQuery(e,t){return tb(e,e4).get(t).next(e=>{if(e)return{name:e.name,query:iC(e.bundledQuery),readTime:iE(e.readTime)}})}saveNamedQuery(e,t){return tb(e,e4).put({name:t.name,readTime:iI(r3(t.readTime)),bundledQuery:t.bundledQuery})}}class iO{constructor(e,t){this.serializer=e,this.userId=t}static It(e,t){return new iO(e,t.uid||"")}getOverlay(e,t){return tb(e,to).get(iD(this.userId,t)).next(e=>e?iA(this.serializer,e):null)}getOverlays(e,t){let n=n4();return el.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new rN(t,i);r.push(this.Et(e,s))}),el.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(eC(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(tb(e,to).J(tu,r))}),el.waitFor(i)}getOverlaysForCollection(e,t,n){let r=n4(),i=eC(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return tb(e,to).G(tu,s).next(e=>{for(let t of e){let e=iA(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i;let s=n4(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return tb(e,to).Z({index:tc,range:a},(e,t,n)=>{let a=iA(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}Et(e,t){return tb(e,to).put(function(e,t,n){let[r,i,s]=iD(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:il(e.Tt,n.mutation)}}(this.serializer,this.userId,t))}}class iL{dt(e){return tb(e,td)}getSessionToken(e){return this.dt(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?tL.fromUint8Array(t):tL.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class iR{constructor(){}At(e,t){this.Rt(e,t),t.Vt()}Rt(e,t){if("nullValue"in e)this.ft(t,5);else if("booleanValue"in e)this.ft(t,10),t.gt(+!!e.booleanValue);else if("integerValue"in e)this.ft(t,15),t.gt(tP(e.integerValue));else if("doubleValue"in e){let n=tP(e.doubleValue);isNaN(n)?this.ft(t,13):(this.ft(t,15),ex(n)?t.gt(0):t.gt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.ft(t,20),"string"==typeof n&&(n=tM(n)),t.yt(`${n.seconds||""}`),t.gt(n.nanos||0)}else if("stringValue"in e)this.wt(e.stringValue,t),this.bt(t);else if("bytesValue"in e)this.ft(t,30),t.St(tF(e.bytesValue)),this.bt(t);else if("referenceValue"in e)this.Dt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.ft(t,45),t.gt(n.latitude||0),t.gt(n.longitude||0)}else"mapValue"in e?ns(e)?this.ft(t,Number.MAX_SAFE_INTEGER):nr(e)?this.vt(e.mapValue,t):(this.Ct(e.mapValue,t),this.bt(t)):"arrayValue"in e?(this.Ft(e.arrayValue,t),this.bt(t)):x()}wt(e,t){this.ft(t,25),this.Mt(e,t)}Mt(e,t){t.yt(e)}Ct(e,t){let n=e.fields||{};for(let e of(this.ft(t,55),Object.keys(n)))this.wt(e,t),this.Rt(n[e],t)}vt(e,t){var n,r;let i=e.fields||{};this.ft(t,53);let s=(null===(r=null===(n=i[tX].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.ft(t,15),t.gt(tP(s)),this.wt(tX,t),this.Rt(i[tX],t)}Ft(e,t){let n=e.values||[];for(let e of(this.ft(t,50),n))this.Rt(e,t)}Dt(e,t){this.ft(t,37),H.fromName(e).path.forEach(e=>{this.ft(t,60),this.Mt(e,t)})}ft(e,t){e.gt(t)}bt(e){e.gt(2)}}function iM(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}iR.xt=new iR;class iP{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ot(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Nt(n.value),n=t.next();this.Bt()}Lt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.kt(n.value),n=t.next();this.qt()}Qt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Nt(e);else if(e<2048)this.Nt(960|e>>>6),this.Nt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Nt(480|e>>>12),this.Nt(128|63&e>>>6),this.Nt(128|63&e);else{let e=t.codePointAt(0);this.Nt(240|e>>>18),this.Nt(128|63&e>>>12),this.Nt(128|63&e>>>6),this.Nt(128|63&e)}}this.Bt()}$t(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.kt(e);else if(e<2048)this.kt(960|e>>>6),this.kt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.kt(480|e>>>12),this.kt(128|63&e>>>6),this.kt(128|63&e);else{let e=t.codePointAt(0);this.kt(240|e>>>18),this.kt(128|63&e>>>12),this.kt(128|63&e>>>6),this.kt(128|63&e)}}this.qt()}Kt(e){let t=this.Ut(e),n=iM(t);this.Wt(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Gt(e){let t=this.Ut(e),n=iM(t);this.Wt(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}zt(){this.jt(255),this.jt(255)}Ht(){this.Jt(255),this.Jt(255)}reset(){this.position=0}seed(e){this.Wt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Yt(){return this.buffer.slice(0,this.position)}Ut(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!n;return t}Nt(e){let t=255&e;0===t?(this.jt(0),this.jt(255)):255===t?(this.jt(255),this.jt(0)):this.jt(t)}kt(e){let t=255&e;0===t?(this.Jt(0),this.Jt(255)):255===t?(this.Jt(255),this.Jt(0)):this.Jt(e)}Bt(){this.jt(0),this.jt(1)}qt(){this.Jt(0),this.Jt(1)}jt(e){this.Wt(1),this.buffer[this.position++]=e}Jt(e){this.Wt(1),this.buffer[this.position++]=~e}Wt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class iF{constructor(e){this.Zt=e}St(e){this.Zt.Ot(e)}yt(e){this.Zt.Qt(e)}gt(e){this.Zt.Kt(e)}Vt(){this.Zt.zt()}}class iV{constructor(e){this.Zt=e}St(e){this.Zt.Lt(e)}yt(e){this.Zt.$t(e)}gt(e){this.Zt.Gt(e)}Vt(){this.Zt.Ht()}}class iU{constructor(){this.Zt=new iP,this.Xt=new iF(this.Zt),this.en=new iV(this.Zt)}seed(e){this.Zt.seed(e)}tn(e){return 0===e?this.Xt:this.en}Yt(){return this.Zt.Yt()}reset(){this.Zt.reset()}}class iB{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}nn(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new iB(this.indexId,this.documentKey,this.arrayValue,n)}}function iq(e,t){let n=e.indexId-t.indexId;return 0!==n?n:0!==(n=ij(e.arrayValue,t.arrayValue))?n:0!==(n=ij(e.directionalValue,t.directionalValue))?n:H.comparator(e.documentKey,t.documentKey)}function ij(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class iz{constructor(e){for(let t of(this.rn=new tA((e,t)=>Q.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.sn=e.orderBy,this._n=[],e.filters))t.isInequality()?this.rn=this.rn.add(t):this._n.push(t)}get an(){return this.rn.size>1}un(e){if(e.collectionGroup===this.collectionId||x(),this.an)return!1;let t=Y(e);if(void 0!==t&&!this.cn(t))return!1;let n=J(e),r=new Set,i=0,s=0;for(;i<n.length&&this.cn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.rn.size>0){let e=this.rn.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.ln(e,t)||!this.hn(this.sn[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.sn.length||!this.hn(this.sn[s++],e))return!1}return!0}Pn(){if(this.an)return null;let e=new tA(Q.comparator),t=[];for(let n of this._n)if(!n.field.isKeyField()){if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new Z(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Z(n.field,0))}}for(let n of this.sn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Z(n.field,+("asc"!==n.dir))));return new W(W.UNKNOWN_ID,this.collectionId,t,ee.empty())}cn(e){for(let t of this._n)if(this.ln(t,e))return!0;return!1}ln(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}hn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function i$(e){return e instanceof nm}function iK(e){return e instanceof ny&&nb(e)}function iG(e){return i$(e)||iK(e)||function(e){if(e instanceof ny&&nw(e)){for(let t of e.getFilters())if(!i$(t)&&!iK(t))return!1;return!0}return!1}(e)}function iQ(e,t){return e instanceof nm||e instanceof ny||x(),t instanceof nm||t instanceof ny||x(),iW(e instanceof nm?t instanceof nm?ny.create([e,t],"and"):iH(e,t):t instanceof nm?iH(t,e):function(e,t){if(e.filters.length>0&&t.filters.length>0||x(),nv(e)&&nv(t))return nI(e,t.getFilters());let n=nw(e)?e:t,r=nw(e)?t:e,i=n.filters.map(e=>iQ(e,r));return ny.create(i,"or")}(e,t))}function iH(e,t){if(nv(t))return nI(t,e.getFilters());{let n=t.filters.map(t=>iQ(e,t));return ny.create(n,"or")}}function iW(e){if(e instanceof nm||e instanceof ny||x(),e instanceof nm)return e;let t=e.getFilters();if(1===t.length)return iW(t[0]);if(n_(e))return e;let n=t.map(e=>iW(e)),r=[];return n.forEach(t=>{t instanceof nm?r.push(t):t instanceof ny&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:ny.create(r,e.op)}class iY{constructor(){this.Tn=new iJ}addToCollectionParentIndex(e,t){return this.Tn.add(t),el.resolve()}getCollectionParents(e,t){return el.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return el.resolve()}deleteFieldIndex(e,t){return el.resolve()}deleteAllFieldIndexes(e){return el.resolve()}createTargetIndexes(e,t){return el.resolve()}getDocumentsMatchingTarget(e,t){return el.resolve(null)}getIndexType(e,t){return el.resolve(0)}getFieldIndexes(e,t){return el.resolve([])}getNextCollectionGroupToUpdate(e){return el.resolve(null)}getMinOffset(e,t){return el.resolve(er.min())}getMinOffsetFromCollectionGroup(e,t){return el.resolve(er.min())}updateCollectionGroup(e,t,n){return el.resolve()}updateIndexEntries(e,t){return el.resolve()}}class iJ{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new tA(K.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new tA(K.comparator)).toArray()}}let iX="IndexedDbIndexManager",iZ=new Uint8Array(0);class i0{constructor(e,t){this.databaseId=t,this.In=new iJ,this.En=new n1(e=>nL(e),(e,t)=>nR(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.In.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.In.add(t)});let i={collectionId:n,parent:eC(r)};return tb(e,e2).put(i)}return el.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return tb(e,e2).G(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(eA(r.parent))}return n})}addFieldIndex(e,t){let n=tb(e,e8),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=tb(e,e7);return i.next(e=>{n.put(ik(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=tb(e,e8),r=tb(e,e7),i=tb(e,tr);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=tb(e,e8),n=tb(e,tr),r=tb(e,e7);return t.J().next(()=>n.J()).next(()=>r.J())}createTargetIndexes(e,t){return el.forEach(this.dn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new iz(t).Pn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=tb(e,tr),r=!0,i=new Map;return el.forEach(this.dn(t),t=>this.An(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=n7(),r=[];return el.forEach(i,(i,s)=>{_(iX,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${nL(t)}`);let a=function(e,t){let n=Y(t);if(void 0===n)return null;for(let t of nP(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of J(t))for(let t of nP(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of J(t)){let t=0===i.kind?nF(e,i.fieldPath,e.startAt):nV(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new nc(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of J(t)){let t=0===i.kind?nV(e,i.fieldPath,e.endAt):nF(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new nc(n,r)}(s,i),h=this.Rn(i,s,l),c=this.Rn(i,s,u),f=this.Vn(i,s,o),d=this.mn(i.indexId,a,h,l.inclusive,c,u.inclusive,f);return el.forEach(d,i=>n.H(i,t.limit).next(t=>{t.forEach(t=>{let n=H.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return el.resolve(null)})}dn(e){let t=this.En.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(t instanceof nm||t instanceof ny||x(),t instanceof nm)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=ny.create(n,t.op);return iG(r=iW(r))?r:(r instanceof ny||x(),nv(r)||x(),r.filters.length>1||x(),r.filters.reduce((e,t)=>iQ(e,t)))}(function e(t){var n,r;if(t instanceof nm||t instanceof ny||x(),t instanceof nm){if(t instanceof nA){let e=(null===(r=null===(n=t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e=>nm.create(t.field,"==",e)))||[];return ny.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return ny.create(i,t.op)}(e));return iG(t)||x(),i$(t)||iK(t)?[t]:t.getFilters()})(ny.create(e.filters,"and")).map(t=>nO(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.En.set(e,t)),t}mn(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.fn(t[h/l]):iZ,c=this.gn(e,o,n[h%l],r),f=this.pn(e,o,i[h%l],s),d=a.map(t=>this.gn(e,o,t,!0));u.push(...this.createRange(c,f,d))}return u}gn(e,t,n,r){let i=new iB(e,H.empty(),t,n);return r?i:i.nn()}pn(e,t,n,r){let i=new iB(e,H.empty(),t,n);return r?i.nn():i}An(e,t){let n=new iz(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.un(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.dn(t);return el.forEach(r,t=>this.An(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new tA(Q.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}yn(e,t){let n=new iU;for(let r of J(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.tn(r.kind);iR.xt.At(e,i)}return n.Yt()}fn(e){let t=new iU;return iR.xt.At(e,t.tn(0)),t.Yt()}wn(e,t){let n=new iU;return iR.xt.At(t8(this.databaseId,t),n.tn(function(e){let t=J(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Yt()}Vn(e,t,n){if(null===n)return[];let r=[];r.push(new iU);let i=0;for(let s of J(e)){let e=n[i++];for(let n of r)if(this.bn(t,s.fieldPath)&&t7(e))r=this.Sn(r,s,e);else{let t=n.tn(s.kind);iR.xt.At(e,t)}}return this.Dn(r)}Rn(e,t,n){return this.Vn(e,t,n.position)}Dn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Yt();return t}Sn(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new iU;r.seed(n.Yt()),iR.xt.At(e,r.tn(t.kind)),i.push(r)}return i}bn(e,t){return!!e.filters.find(e=>e instanceof nm&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=tb(e,e8),r=tb(e,e7);return(t?n.G(e9,IDBKeyRange.bound(t,t)):n.G()).next(e=>{let t=[];return el.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){let n=t?new ee(t.sequenceNumber,new er(iE(t.readTime),new H(eA(t.documentKey)),t.largestBatchId)):ee.empty(),r=e.fields.map(([e,t])=>new Z(Q.fromServerFormat(e),t));return new W(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:U(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=tb(e,e8),i=tb(e,e7);return this.vn(e).next(e=>r.G(e9,IDBKeyRange.bound(t,t)).next(t=>el.forEach(t,t=>i.put(ik(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return el.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?el.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),el.forEach(i,n=>this.Cn(e,t,n).next(t=>{let i=this.Fn(r,n);return t.isEqual(i)?el.resolve():this.Mn(e,r,n,t,i)}))))})}xn(e,t,n,r){return tb(e,tr).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.wn(n,t.key),documentKey:t.key.path.toArray()})}On(e,t,n,r){return tb(e,tr).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.wn(n,t.key),t.key.path.toArray()])}Cn(e,t,n){let r=tb(e,tr),i=new tA(iq);return r.Z({index:ts,range:IDBKeyRange.only([n.indexId,this.uid,this.wn(n,t)])},(e,r)=>{i=i.add(new iB(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}Fn(e,t){let n=new tA(iq),r=this.yn(t,e);if(null==r)return n;let i=Y(t);if(null!=i){let s=e.data.field(i.fieldPath);if(t7(s))for(let i of s.arrayValue.values||[])n=n.add(new iB(t.indexId,e.key,this.fn(i),r))}else n=n.add(new iB(t.indexId,e.key,iZ,r));return n}Mn(e,t,n,r,i){_(iX,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=tk(s),l=tk(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=tk(a)):t?(i(o),o=tk(s)):(o=tk(s),l=tk(a))}}(r,i,iq,r=>{s.push(this.xn(e,t,n,r))},r=>{s.push(this.On(e,t,n,r))}),el.waitFor(s)}vn(e){let t=1;return tb(e,e7).Z({index:tt,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>iq(e,t)).filter((e,t,n)=>!t||0!==iq(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=iq(i,e),s=iq(i,t);if(0===n)r[0]=e.nn();else if(n>0&&s<0)r.push(i),r.push(i.nn());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Nn(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,iZ,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,iZ,[]];i.push(IDBKeyRange.bound(t,n))}return i}Nn(e,t){return iq(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(i1)}getMinOffset(e,t){return el.mapArray(this.dn(t),t=>this.An(e,t).next(e=>e||x())).next(i1)}}function i1(e){0!==e.length||x();let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>ei(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new er(t.readTime,t.documentKey,n)}let i2={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class i6{static withCacheSize(e){return new i6(e,i6.DEFAULT_COLLECTION_PERCENTILE,i6.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function i5(e,t,n){let r=e.store(eL),i=e.store(eV),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.Z({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{1===o||x()}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,eC(h),c]);s.push(i.delete(r)),u.push(e.key)}return el.waitFor(s).next(()=>u)}function i3(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw x();t=e.noDocument}return JSON.stringify(t).length}i6.DEFAULT_COLLECTION_PERCENTILE=10,i6.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,i6.DEFAULT=new i6(0x2800000,i6.DEFAULT_COLLECTION_PERCENTILE,i6.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),i6.DISABLED=new i6(-1,0,0);class i4{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Bn={}}static It(e,t,n,r){return""!==e.uid||x(),new i4(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return i9(e).Z({index:eM,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=tb(e,eV),s=i9(e);return s.add({}).next(a=>{var o;"number"==typeof a||x();let l=new rD(a,t,n,r),u=function(e,t,n){let r=n.baseMutations.map(t=>il(e.Tt,t)),i=n.mutations.map(t=>il(e.Tt,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,l),h=[],c=new tA((e,t)=>U(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(o=this.userId,[o,eC(e.key.path),a]);c=c.add(e.key.path.popLast()),h.push(s.put(u)),h.push(i.put(t,eF))}return c.forEach(t=>{h.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Bn[a]=l.keys()}),el.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return i9(e).get(t).next(e=>e?(e.userId===this.userId||x(),iT(this.serializer,e)):null)}Ln(e,t){return this.Bn[t]?el.resolve(this.Bn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Bn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return i9(e).Z({index:eM,range:r},(e,t,r)=>{t.userId===this.userId&&(t.batchId>=n||x(),i=iT(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return i9(e).Z({index:eM,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return i9(e).G(eM,t).next(e=>e.map(e=>iT(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,eC(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return tb(e,eV).Z({range:r},(n,r,s)=>{let[a,o,l]=n,u=eA(o);if(a===this.userId&&t.path.isEqual(u))return i9(e).get(l).next(e=>{if(!e)throw x();e.userId===this.userId||x(),i.push(iT(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new tA(U),r=[];return t.forEach(t=>{let i=[this.userId,eC(t.path)],s=IDBKeyRange.lowerBound(i),a=tb(e,eV).Z({range:s},(e,r,i)=>{let[s,a,o]=e,l=eA(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),el.waitFor(r).next(()=>this.kn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,eC(n)],s=IDBKeyRange.lowerBound(i),a=new tA(U);return tb(e,eV).Z({range:s},(e,t,i)=>{let[s,o,l]=e,u=eA(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.kn(e,a))}kn(e,t){let n=[],r=[];return t.forEach(t=>{r.push(i9(e).get(t).next(e=>{if(null===e)throw x();e.userId===this.userId||x(),n.push(iT(this.serializer,e))}))}),el.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return i5(e.ue,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.qn(t.batchId)}),el.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}qn(e){delete this.Bn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return el.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return tb(e,eV).Z({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=eA(e[1]);r.push(t)}else n.done()}).next(()=>{0===r.length||x()})})}containsKey(e,t){return i8(e,this.userId,t)}Qn(e){return tb(e,eO).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function i8(e,t,n){let r=[t,eC(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return tb(e,eV).Z({range:s,Y:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function i9(e){return tb(e,eL)}class i7{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new i7(0)}static Un(){return new i7(-1)}}class se{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Wn(e).next(t=>{let n=new i7(t.highestTargetId);return t.highestTargetId=n.next(),this.Gn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Wn(e).next(e=>j.fromTimestamp(new q(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Wn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Wn(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Gn(e,r)))}addTargetData(e,t){return this.zn(e,t).next(()=>this.Wn(e).next(n=>(n.targetCount+=1,this.jn(t,n),this.Gn(e,n))))}updateTargetData(e,t){return this.zn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>tb(e,eQ).delete(t.targetId)).next(()=>this.Wn(e)).next(t=>(t.targetCount>0||x(),t.targetCount-=1,this.Gn(e,t)))}removeTargets(e,t,n){let r=0,i=[];return tb(e,eQ).Z((s,a)=>{let o=ix(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>el.waitFor(i)).next(()=>r)}forEachTarget(e,t){return tb(e,eQ).Z((e,n)=>{t(ix(n))})}Wn(e){return tb(e,e1).get(e0).next(e=>(null!==e||x(),e))}Gn(e,t){return tb(e,e1).put(e0,t)}zn(e,t){return tb(e,eQ).put(iS(this.serializer,t))}jn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Wn(e).next(e=>e.targetCount)}getTargetData(e,t){let n=nL(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return tb(e,eQ).Z({range:r,index:eH},(e,n,r)=>{let s=ix(n);nR(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=st(e);return t.forEach(t=>{let s=eC(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),el.waitFor(r)}removeMatchingKeys(e,t,n){let r=st(e);return el.forEach(t,t=>{let i=eC(t.path);return el.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=st(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=st(e),i=n7();return r.Z({range:n,Y:!0},(e,t,n)=>{let r=new H(eA(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=eC(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return st(e).Z({index:eX,Y:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}lt(e,t){return tb(e,eQ).get(t).next(e=>e?ix(e):null)}}function st(e){return tb(e,eY)}let sn="LruGarbageCollector";function sr([e,t],[n,r]){let i=U(e,n);return 0===i?U(t,r):i}class si{constructor(e){this.Hn=e,this.buffer=new tA(sr),this.Jn=0}Yn(){return++this.Jn}Zn(e){let t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>sr(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ss{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Xn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return null!==this.Xn}er(e){_(sn,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ep(e)?_(sn,"Ignoring IndexedDB error during garbage collection: ",e):await eo(e)}await this.er(3e5)})}}class sa{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return el.resolve(eE.ae);let n=new si(t);return this.tr.forEachTarget(e,e=>n.Zn(e.sequenceNumber)).next(()=>this.tr.rr(e,e=>n.Zn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.tr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector","Garbage collection skipped; disabled"),el.resolve(i2)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),i2):this.ir(e,t))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let n,r,i,s,a,o,l;let u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),b()<=c.LogLevel.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),el.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class so{constructor(e,t){this.db=e,this.garbageCollector=new sa(this,t)}nr(e){let t=this.sr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}sr(e){let t=0;return this.rr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}rr(e,t){return this._r(e,(e,n)=>t(n))}addReference(e,t,n){return sl(e,n)}removeReference(e,t,n){return sl(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return sl(e,t)}ar(e,t){let n;return n=!1,tb(e,eO).X(r=>i8(e,r,t).next(e=>(e&&(n=!0),el.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this._r(e,(s,a)=>{if(a<=t){let t=this.ar(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,j.min()),st(e).delete([0,eC(s.path)])))});r.push(t)}}).next(()=>el.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return sl(e,t)}_r(e,t){let n=st(e),r,i=eE.ae;return n.Z({index:eX},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==eE.ae&&t(new H(eA(r)),i),i=a,r=s):i=eE.ae}).next(()=>{i!==eE.ae&&t(new H(eA(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sl(e,t){var n;return st(e).put((n=e.currentSequenceNumber,{targetId:0,path:eC(t.path),sequenceNumber:n}))}class su{constructor(){this.changes=new n1(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,nh.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?el.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sh{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return tb(e,eU).put(n)}removeEntry(e,t,n){return tb(e,eU).delete(function(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],i_(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.ur(e,n)))}getEntry(e,t){let n=nh.newInvalidDocument(t);return tb(e,eU).Z({index:eq,range:IDBKeyRange.only(sf(t))},(e,r)=>{n=this.cr(t,r)}).next(()=>n)}lr(e,t){let n={size:0,document:nh.newInvalidDocument(t)};return tb(e,eU).Z({index:eq,range:IDBKeyRange.only(sf(t))},(e,r)=>{n={document:this.cr(t,r),size:i3(r)}}).next(()=>n)}getEntries(e,t){let n=n2;return this.hr(e,t,(e,t)=>{let r=this.cr(e,t);n=n.insert(e,r)}).next(()=>n)}Pr(e,t){let n=n2,r=new tx(H.comparator);return this.hr(e,t,(e,t)=>{let i=this.cr(e,t);n=n.insert(e,i),r=r.insert(e,i3(t))}).next(()=>({documents:n,Tr:r}))}hr(e,t,n){if(t.isEmpty())return el.resolve();let r=new tA(sg);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(sf(r.first()),sf(r.last())),s=r.getIterator(),a=s.getNext();return tb(e,eU).Z({index:eq,range:i},(e,t,r)=>{let i=H.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>sg(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.W(sf(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),i_(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return tb(e,eU).G(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=n2;for(let i of e){let e=this.cr(H.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(nX(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=n2,s=sd(t,n),a=sd(t,er.max());return tb(e,eU).Z({index:ez,range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.cr(H.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new sc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return tb(e,eK).get(eG).next(e=>(e||x(),e))}ur(e,t){return tb(e,eK).put(eG,t)}cr(e,t){if(t){let e=function(e,t){let n;if(t.document)n=io(e.Tt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=H.fromSegments(t.noDocument.path),r=iE(t.noDocument.readTime);n=nh.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return x();{let e=H.fromSegments(t.unknownDocument.path),r=iE(t.unknownDocument.version);n=nh.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){let t=new q(e[0],e[1]);return j.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(j.min())))return e}return nh.newInvalidDocument(e)}}class sc extends su{constructor(e,t){super(),this.Ir=e,this.trackRemovals=t,this.Er=new n1(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new tA((e,t)=>U(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Er.get(i);if(t.push(this.Ir.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=ib(this.Ir.serializer,s);r=r.add(i.path.popLast());let l=i3(o);n+=l-a.size,t.push(this.Ir.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=ib(this.Ir.serializer,s.convertToNoDocument(j.min()));t.push(this.Ir.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Ir.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Ir.updateMetadata(e,n)),el.waitFor(t)}getFromCache(e,t){return this.Ir.lr(e,t).next(e=>(this.Er.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Ir.Pr(e,t).next(({documents:e,Tr:t})=>(t.forEach((t,n)=>{this.Er.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function sf(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function sd(e,t){let n=t.documentKey.path.toArray();return[e,i_(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function sg(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=U(n[e],r[e]))return i;return(i=U(n.length,r.length))||(i=U(n[n.length-2],r[r.length-2]))||U(n[n.length-1],r[r.length-1])}class sp{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sm{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&rb(n.mutation,e,tN.empty(),q.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,n7()).next(()=>t))}getLocalViewOfDocuments(e,t,n=n7()){let r=n4();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=n5();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=n4();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,n7()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=n2,s=n4(),a=n4();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof rE)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),rb(a.mutation,t,a.mutation.getFieldMask(),q.now())):s.set(t.key,tN.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new sp(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=n4(),r=new tx((e,t)=>e-t),i=n7();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||tN.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||n7()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=n4();l.forEach(e=>{if(!i.has(e)){let r=rw(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return el.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return H.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):nj(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):el.resolve(n4()),a=-1,o=i;return s.next(t=>el.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?el.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,n7())).next(e=>({batchId:a,changes:n3(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new H(t)).next(e=>{let t=n5();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=n5();return this.indexManager.getCollectionParents(e,i).next(a=>el.forEach(a,a=>{let o=new nU(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,nh.newInvalidDocument(r)))});let n=n5();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&rb(s.mutation,r,tN.empty(),q.now()),nX(t,r)&&(n=n.insert(e,r))}),n})}}class sy{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return el.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,{id:t.id,version:t.version,createTime:r3(t.createTime)}),el.resolve()}getNamedQuery(e,t){return el.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,{name:t.name,query:iC(t.bundledQuery),readTime:r3(t.readTime)}),el.resolve()}}class sv{constructor(){this.overlays=new tx(H.comparator),this.Rr=new Map}getOverlay(e,t){return el.resolve(this.overlays.get(t))}getOverlays(e,t){let n=n4();return el.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.Et(e,t,r)}),el.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.Rr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Rr.delete(n)),el.resolve()}getOverlaysForCollection(e,t,n){let r=n4(),i=t.length+1,s=new H(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return el.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new tx((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=n4(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=n4(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return el.resolve(a)}Et(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.Rr.get(r.largestBatchId).delete(n.key);this.Rr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new rN(t,n));let i=this.Rr.get(t);void 0===i&&(i=n7(),this.Rr.set(t,i)),this.Rr.set(t,i.add(n.key))}}class sw{constructor(){this.sessionToken=tL.EMPTY_BYTE_STRING}getSessionToken(e){return el.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,el.resolve()}}class sb{constructor(){this.Vr=new tA(s_.mr),this.gr=new tA(s_.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){let n=new s_(e,t);this.Vr=this.Vr.add(n),this.gr=this.gr.add(n)}yr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.wr(new s_(e,t))}br(e,t){e.forEach(e=>this.removeReference(e,t))}Sr(e){let t=new H(new K([])),n=new s_(t,e),r=new s_(t,e+1),i=[];return this.gr.forEachInRange([n,r],e=>{this.wr(e),i.push(e.key)}),i}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){let t=new H(new K([])),n=new s_(t,e),r=new s_(t,e+1),i=n7();return this.gr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new s_(e,0),n=this.Vr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class s_{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return H.comparator(e.key,t.key)||U(e.Cr,t.Cr)}static pr(e,t){return U(e.Cr,t.Cr)||H.comparator(e.key,t.key)}}class sI{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new tA(s_.mr)}checkEmpty(e){return el.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new rD(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Mr=this.Mr.add(new s_(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return el.resolve(s)}lookupMutationBatch(e,t){return el.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.Nr(t+1),r=n<0?0:n;return el.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return el.resolve(0===this.mutationQueue.length?-1:this.Fr-1)}getAllMutationBatches(e){return el.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new s_(t,0),r=new s_(t,Number.POSITIVE_INFINITY),i=[];return this.Mr.forEachInRange([n,r],e=>{let t=this.Or(e.Cr);i.push(t)}),el.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new tA(U);return t.forEach(e=>{let t=new s_(e,0),r=new s_(e,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([t,r],e=>{n=n.add(e.Cr)})}),el.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;H.isDocumentKey(i)||(i=i.child(""));let s=new s_(new H(i),0),a=new tA(U);return this.Mr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Cr)),!0)},s),el.resolve(this.Br(a))}Br(e){let t=[];return e.forEach(e=>{let n=this.Or(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){0===this.Lr(t.batchId,"removed")||x(),this.mutationQueue.shift();let n=this.Mr;return el.forEach(t.mutations,r=>{let i=new s_(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Mr=n})}qn(e){}containsKey(e,t){let n=new s_(t,0),r=this.Mr.firstAfterOrEqual(n);return el.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,el.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Or(e){let t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sE{constructor(e){this.kr=e,this.docs=new tx(H.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.kr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return el.resolve(n?n.document.mutableCopy():nh.newInvalidDocument(t))}getEntries(e,t){let n=n2;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():nh.newInvalidDocument(e))}),el.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=n2,s=t.path,a=new H(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=ei(en(a),n)||(r.has(a.key)||nX(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return el.resolve(i)}getAllFromCollectionGroup(e,t,n,r){x()}qr(e,t){return el.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new sT(this)}getSize(e){return el.resolve(this.size)}}class sT extends su{constructor(e){super(),this.Ir=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Ir.addEntry(e,r)):this.Ir.removeEntry(n)}),el.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}class sx{constructor(e){this.persistence=e,this.Qr=new n1(e=>nL(e),nR),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.$r=0,this.Kr=new sb,this.targetCount=0,this.Ur=i7.Kn()}forEachTarget(e,t){return this.Qr.forEach((e,n)=>t(n)),el.resolve()}getLastRemoteSnapshotVersion(e){return el.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return el.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),el.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.$r&&(this.$r=t),el.resolve()}zn(e){this.Qr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Ur=new i7(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,el.resolve()}updateTargetData(e,t){return this.zn(t),el.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Kr.Sr(t.targetId),this.targetCount-=1,el.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.Qr.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Qr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),el.waitFor(i).next(()=>r)}getTargetCount(e){return el.resolve(this.targetCount)}getTargetData(e,t){let n=this.Qr.get(t)||null;return el.resolve(n)}addMatchingKeys(e,t,n){return this.Kr.yr(t,n),el.resolve()}removeMatchingKeys(e,t,n){this.Kr.br(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),el.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Kr.Sr(t),el.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Kr.vr(t);return el.resolve(n)}containsKey(e,t){return el.resolve(this.Kr.containsKey(t))}}class sS{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new eE(0),this.zr=!1,this.zr=!0,this.jr=new sw,this.referenceDelegate=e(this),this.Hr=new sx(this),this.indexManager=new iY,this.remoteDocumentCache=new sE(e=>this.referenceDelegate.Jr(e)),this.serializer=new iw(t),this.Yr=new sy(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Wr[e.toKey()];return n||(n=new sI(t,this.referenceDelegate),this.Wr[e.toKey()]=n),n}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,n){_("MemoryPersistence","Starting transaction:",e);let r=new sC(this.Gr.next());return this.referenceDelegate.Zr(),n(r).next(e=>this.referenceDelegate.Xr(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}ei(e,t){return el.or(Object.values(this.Wr).map(n=>()=>n.containsKey(e,t)))}}class sC extends ea{constructor(e){super(),this.currentSequenceNumber=e}}class sA{constructor(e){this.persistence=e,this.ti=new sb,this.ni=null}static ri(e){return new sA(e)}get ii(){if(this.ni)return this.ni;throw x()}addReference(e,t,n){return this.ti.addReference(n,t),this.ii.delete(n.toString()),el.resolve()}removeReference(e,t,n){return this.ti.removeReference(n,t),this.ii.add(n.toString()),el.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),el.resolve()}removeTarget(e,t){this.ti.Sr(t.targetId).forEach(e=>this.ii.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.ii.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return el.forEach(this.ii,n=>{let r=H.fromPath(n);return this.si(e,r).next(e=>{e||t.removeEntry(r,j.min())})}).next(()=>(this.ni=null,t.apply(e)))}updateLimboDocument(e,t){return this.si(e,t).next(e=>{e?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return el.or([()=>el.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class sD{constructor(e,t){this.persistence=e,this.oi=new n1(e=>eC(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new sa(this,t)}static ri(e,t){return new sD(e,t)}Zr(){}Xr(e){return el.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){let t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}sr(e){let t=0;return this.rr(e,e=>{t++}).next(()=>t)}rr(e,t){return el.forEach(this.oi,(n,r)=>this.ar(e,n,r).next(e=>e?el.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.qr(e,r=>this.ar(e,r,t).next(e=>{e||(n++,i.removeEntry(r,j.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),el.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),el.resolve()}removeReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),el.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),el.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(t0(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=tz(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return tF(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,tI(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw x()}}(e.data.value)),t}ar(e,t,n){return el.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.oi.get(t);return el.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class sk{constructor(e){this.serializer=e}B(e,t,n,r){let i=new eh("createOrUpgrade",t);n<1&&r>=1&&(!function(e){e.createObjectStore(ek)}(e),e.createObjectStore(eO,{keyPath:"userId"}),e.createObjectStore(eL,{keyPath:eR,autoIncrement:!0}).createIndex(eM,eP,{unique:!0}),e.createObjectStore(eV),sN(e),function(e){e.createObjectStore(eD)}(e));let s=el.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore(eY),e.deleteObjectStore(eQ),e.deleteObjectStore(e1),sN(e)),s=s.next(()=>(function(e){let t=e.store(e1),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return t.put(e0,n)})(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store(eL).G().next(t=>{e.deleteObjectStore(eL),e.createObjectStore(eL,{keyPath:eR,autoIncrement:!0}).createIndex(eM,eP,{unique:!0});let n=i.store(eL),r=t.map(e=>n.put(e));return el.waitFor(r)}))),s=s.next(()=>{!function(e){e.createObjectStore(e5,{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(s=s.next(()=>this._i(i))),n<6&&r>=6&&(s=s.next(()=>((function(e){e.createObjectStore(eK)})(e),this.ai(i)))),n<7&&r>=7&&(s=s.next(()=>this.ui(i))),n<8&&r>=8&&(s=s.next(()=>this.ci(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.li(i))),n<11&&r>=11&&(s=s.next(()=>{(function(e){e.createObjectStore(e3,{keyPath:"bundleId"})})(e),function(e){e.createObjectStore(e4,{keyPath:"name"})}(e)})),n<12&&r>=12&&(s=s.next(()=>{!function(e){let t=e.createObjectStore(to,{keyPath:tl});t.createIndex(tu,th,{unique:!1}),t.createIndex(tc,tf,{unique:!1})}(e)})),n<13&&r>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore(eU,{keyPath:eB});t.createIndex(eq,ej),t.createIndex(ez,e$)})(e)).next(()=>this.hi(e,i)).next(()=>e.deleteObjectStore(eD))),n<14&&r>=14&&(s=s.next(()=>this.Pi(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore(e8,{keyPath:"indexId",autoIncrement:!0}).createIndex(e9,"collectionGroup",{unique:!1}),e.createObjectStore(e7,{keyPath:te}).createIndex(tt,tn,{unique:!1}),e.createObjectStore(tr,{keyPath:ti}).createIndex(ts,ta,{unique:!1})})),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(e7).clear()}).next(()=>{t.objectStore(tr).clear()})),n<17&&r>=17&&(s=s.next(()=>{!function(e){e.createObjectStore(td,{keyPath:"name"})}(e)})),s}ai(e){let t=0;return e.store(eD).Z((e,n)=>{t+=i3(n)}).next(()=>{let n={byteSize:t};return e.store(eK).put(eG,n)})}_i(e){let t=e.store(eO),n=e.store(eL);return t.G().next(t=>el.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.G(eM,r).next(n=>el.forEach(n,n=>{n.userId===t.userId||x();let r=iT(this.serializer,n);return i5(e,t.userId,r).next(()=>{})}))}))}ui(e){let t=e.store(eY),n=e.store(eD);return e.store(e1).get(e0).next(e=>{let r=[];return n.Z((n,i)=>{let s=new K(n),a=[0,eC(s)];r.push(t.get(a).next(n=>n?el.resolve():t.put({targetId:0,path:eC(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>el.waitFor(r))})}ci(e,t){e.createObjectStore(e2,{keyPath:e6});let n=t.store(e2),r=new iJ,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:eC(r)})}};return t.store(eD).Z({Y:!0},(e,t)=>i(new K(e).popLast())).next(()=>t.store(eV).Z({Y:!0},([e,t,n],r)=>i(eA(t).popLast())))}li(e){let t=e.store(eQ);return t.Z((e,n)=>{let r=ix(n),i=iS(this.serializer,r);return t.put(i)})}hi(e,t){let n=t.store(eD),r=[];return n.Z((e,n)=>{let i=t.store(eU),s=(n.document?new H(K.fromString(n.document.name).popFirst(5)):n.noDocument?H.fromSegments(n.noDocument.path):n.unknownDocument?H.fromSegments(n.unknownDocument.path):x()).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>el.waitFor(r))}Pi(e,t){let n=t.store(eL),r=new sh(this.serializer),i=new sS(sA.ri,this.serializer.Tt);return n.G().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:n7();iT(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),el.forEach(n,(e,n)=>{let s=new y(n),a=iO.It(this.serializer,s),o=i.getIndexManager(s);return new sm(r,i4.It(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new tw(t,eE.ae),e).next()})})}}function sN(e){e.createObjectStore(eY,{keyPath:eJ}).createIndex(eX,eZ,{unique:!0}),e.createObjectStore(eQ,{keyPath:"targetId"}).createIndex(eH,eW,{unique:!0}),e.createObjectStore(e1)}let sO="IndexedDbPersistence",sL="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",sR="main";class sM{constructor(e,t,n,r,i,s,a,o,l,u,h=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ti=i,this.window=s,this.document=a,this.Ii=l,this.Ei=u,this.di=h,this.Gr=null,this.zr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ai=null,this.inForeground=!1,this.Ri=null,this.Vi=null,this.mi=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!sM.D())throw new C(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new so(this,r),this.gi=t+sR,this.serializer=new iw(o),this.pi=new ec(this.gi,this.di,new sk(this.serializer)),this.jr=new iL,this.Hr=new se(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new sh(this.serializer),this.Yr=new iN,this.window&&this.window.localStorage?this.yi=this.window.localStorage:(this.yi=null,!1===u&&I(sO,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(S.FAILED_PRECONDITION,sL);return this.bi(),this.Si(),this.Di(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Hr.getHighestSequenceNumber(e))}).then(e=>{this.Gr=new eE(e,this.Ii)}).then(()=>{this.zr=!0}).catch(e=>(this.pi&&this.pi.close(),Promise.reject(e)))}Ci(e){return this.fi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.pi.k(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ti.enqueueAndForget(async()=>{this.started&&await this.wi()}))}wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>tb(e,e5).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Fi(e).next(e=>{e||(this.isPrimary=!1,this.Ti.enqueueRetryable(()=>this.fi(!1)))})}).next(()=>this.Mi(e)).next(t=>this.isPrimary&&!t?this.xi(e).next(()=>!1):!!t&&this.Oi(e).next(()=>!0))).catch(e=>{if(ep(e))return _(sO,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return _(sO,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ti.enqueueRetryable(()=>this.fi(e)),this.isPrimary=e})}Fi(e){return tb(e,ek).get(eN).next(e=>el.resolve(this.Ni(e)))}Bi(e){return tb(e,e5).delete(this.clientId)}async Li(){if(this.isPrimary&&!this.ki(this.mi,18e5)){this.mi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=tb(e,e5);return t.G().next(e=>{let n=this.qi(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return el.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.yi)for(let t of e)this.yi.removeItem(this.Qi(t.clientId))}}Di(){this.Vi=this.Ti.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.wi().then(()=>this.Li()).then(()=>this.Di()))}Ni(e){return!!e&&e.ownerId===this.clientId}Mi(e){return this.Ei?el.resolve(!0):tb(e,ek).get(eN).next(t=>{if(null!==t&&this.ki(t.leaseTimestampMs,5e3)&&!this.$i(t.ownerId)){if(this.Ni(t)&&this.networkEnabled)return!0;if(!this.Ni(t)){if(!t.allowTabSynchronization)throw new C(S.FAILED_PRECONDITION,sL);return!1}}return!(!this.networkEnabled||!this.inForeground)||tb(e,e5).G().next(e=>void 0===this.qi(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&_(sO,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.zr=!1,this.Ki(),this.Vi&&(this.Vi.cancel(),this.Vi=null),this.Ui(),this.Wi(),await this.pi.runTransaction("shutdown","readwrite",[ek,e5],e=>{let t=new tw(e,eE.ae);return this.xi(t).next(()=>this.Bi(t))}),this.pi.close(),this.Gi()}qi(e,t){return e.filter(e=>this.ki(e.updateTimeMs,t)&&!this.$i(e.clientId))}zi(){return this.runTransaction("getActiveClients","readonly",e=>tb(e,e5).G().next(e=>this.qi(e,18e5).map(e=>e.clientId)))}get started(){return this.zr}getGlobalsCache(){return this.jr}getMutationQueue(e,t){return i4.It(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new i0(e,this.serializer.Tt.databaseId)}getDocumentOverlayCache(e){return iO.It(this.serializer,e)}getBundleCache(){return this.Yr}runTransaction(e,t,n){var r;let i;_(sO,"Starting transaction:",e);let s=17===(r=this.di)?tv:16===r?ty:15===r?ty:14===r?tm:13===r?tm:12===r?tp:11===r?tg:void x();return this.pi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new tw(r,this.Gr?this.Gr.next():eE.ae),"readwrite-primary"===t?this.Fi(i).next(e=>!!e||this.Mi(i)).next(t=>{if(!t)throw I(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ti.enqueueRetryable(()=>this.fi(!1)),new C(S.FAILED_PRECONDITION,es);return n(i)}).next(e=>this.Oi(i).next(()=>e)):this.ji(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}ji(e){return tb(e,ek).get(eN).next(e=>{if(null!==e&&this.ki(e.leaseTimestampMs,5e3)&&!this.$i(e.ownerId)&&!this.Ni(e)&&!(this.Ei||this.allowTabSynchronization&&e.allowTabSynchronization))throw new C(S.FAILED_PRECONDITION,sL)})}Oi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return tb(e,ek).put(eN,t)}static D(){return ec.D()}xi(e){let t=tb(e,ek);return t.get(eN).next(e=>this.Ni(e)?(_(sO,"Releasing primary lease."),t.delete(eN)):el.resolve())}ki(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(I(`Detected an update time that is in the future: ${e} > ${n}`),!1))}bi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ri=()=>{this.Ti.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.wi()))},this.document.addEventListener("visibilitychange",this.Ri),this.inForeground="visible"===this.document.visibilityState)}Ui(){this.Ri&&(this.document.removeEventListener("visibilitychange",this.Ri),this.Ri=null)}Si(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ai=()=>{this.Ki();let e=/(?:Version|Mobile)\/1[456]/;f.isSafari()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ti.enterRestrictedMode(!0),this.Ti.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ai))}Wi(){this.Ai&&(this.window.removeEventListener("pagehide",this.Ai),this.Ai=null)}$i(e){var t;try{let n=null!==(null===(t=this.yi)||void 0===t?void 0:t.getItem(this.Qi(e)));return _(sO,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return I(sO,"Failed to get zombied client id.",e),!1}}Ki(){if(this.yi)try{this.yi.setItem(this.Qi(this.clientId),String(Date.now()))}catch(e){I("Failed to set zombie client id.",e)}}Gi(){if(this.yi)try{this.yi.removeItem(this.Qi(this.clientId))}catch(e){}}Qi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function sP(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class sF{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Hi=n,this.Ji=r}static Yi(e,t){let n=n7(),r=n7();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new sF(e,t.fromCache,n,r)}}class sV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class sU{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=f.isSafari()?8:ef(f.getUA())>0?6:4}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.rs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ss(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new sV;return this._s(e,t,n).next(r=>{if(i.result=r,this.Xi)return this.us(e,t,n,r.size)})}).next(()=>i.result)}us(e,t,n,r){return n.documentReadCount<this.es?(b()<=c.LogLevel.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",nJ(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),el.resolve()):(b()<=c.LogLevel.DEBUG&&_("QueryEngine","Query:",nJ(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ts*r?(b()<=c.LogLevel.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",nJ(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,n$(t))):el.resolve())}rs(e,t){if(nq(t))return el.resolve(null);let n=n$(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=n$(t=nH(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=n7(...r);return this.ns.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.cs(t,r);return this.ls(t,s,i,n.readTime)?this.rs(e,nH(t,null,"F")):this.hs(e,s,t,n)}))})))}ss(e,t,n,r){return nq(t)||r.isEqual(j.min())?el.resolve(null):this.ns.getDocuments(e,n).next(i=>{let s=this.cs(t,i);return this.ls(t,s,n,r)?el.resolve(null):(b()<=c.LogLevel.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),nJ(t)),this.hs(e,s,t,et(r,-1)).next(e=>e))})}cs(e,t){let n=new tA(n0(e));return t.forEach((t,r)=>{nX(e,r)&&(n=n.add(r))}),n}ls(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}_s(e,t,n){return b()<=c.LogLevel.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",nJ(t)),this.ns.getDocumentsMatchingQuery(e,t,er.min(),n)}hs(e,t,n,r){return this.ns.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let sB="LocalStore";class sq{constructor(e,t,n,r){this.persistence=e,this.Ps=t,this.serializer=r,this.Ts=new tx(U),this.Is=new n1(e=>nL(e),nR),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(n)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sm(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ts))}}async function sj(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.As(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=n7();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({Rs:e,removedBatchIds:i,addedBatchIds:s}))})})}function sz(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Hr.getLastRemoteSnapshotVersion(t))}function s$(e,t,n){let r=n7(),i=n7();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=n2;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(j.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):_(sB,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{Vs:r,fs:i}})}function sK(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.Hr.getTargetData(n,t).next(i=>i?(r=i,el.resolve(r)):e.Hr.allocateTargetId(n).next(i=>(r=new iv(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.Hr.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.Ts.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.Ts=e.Ts.insert(n.targetId,n),e.Is.set(t,n.targetId)),n})}async function sG(e,t,n){let r=e.Ts.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!ep(e))throw e;_(sB,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ts=e.Ts.remove(t),e.Is.delete(r.target)}function sQ(e,t,n){let r=j.min(),i=n7();return e.persistence.runTransaction("Execute query","readwrite",s=>(function(e,t,n){let r=e.Is.get(n);return void 0!==r?el.resolve(e.Ts.get(r)):e.Hr.getTargetData(t,n)})(e,s,n$(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Hr.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Ps.getDocumentsMatchingQuery(s,t,n?r:j.min(),n?i:n7())).next(n=>(sY(e,nZ(t),n),{documents:n,gs:i})))}function sH(e,t){let n=e.Hr,r=e.Ts.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.lt(e,t).next(e=>e?e.target:null))}function sW(e,t){let n=e.Es.get(t)||j.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.ds.getAllFromCollectionGroup(r,t,et(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(sY(e,t,n),n))}function sY(e,t,n){let r=e.Es.get(t)||j.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Es.set(t,r)}async function sJ(e,t,n,r){let i=n7(),s=n2;for(let e of n){let n=t.ps(e.metadata.name);e.document&&(i=i.add(n));let r=t.ys(e);r.setReadTime(t.ws(e.metadata.readTime)),s=s.insert(n,r)}let a=e.ds.newChangeBuffer({trackRemovals:!0}),o=await sK(e,n$(nB(K.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>s$(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.Hr.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.Hr.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.Vs,n.fs)).next(()=>n.Vs)))}async function sX(e,t,n=n7()){let r=await sK(e,n$(iC(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=r3(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.Yr.saveNamedQuery(i,t);let a=r.withResumeToken(tL.EMPTY_BYTE_STRING,s);return e.Ts=e.Ts.insert(a.targetId,a),e.Hr.updateTargetData(i,a).next(()=>e.Hr.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.Hr.addMatchingKeys(i,n,r.targetId)).next(()=>e.Yr.saveNamedQuery(i,t))})}let sZ="firestore_clients";function s0(e,t){return`${sZ}_${e}_${t}`}let s1="firestore_mutations";function s2(e,t,n){let r=`${s1}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let s6="firestore_targets";function s5(e,t){return`${s6}_${e}_${t}`}let s3="SharedClientState";class s4{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static bs(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new C(r.error.code,r.error.message)),s?new s4(e,t,r.state,i):(I(s3,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ss(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class s8{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static bs(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new C(n.error.code,n.error.message)),i?new s8(e,n.state,r):(I(s3,`Failed to parse target state for ID '${e}': ${t}`),null)}Ss(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class s9{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static bs(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=re;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=eS(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new s9(e,i):(I(s3,`Failed to parse client data for instance '${e}': ${t}`),null)}}class s7{constructor(e,t){this.clientId=e,this.onlineState=t}static bs(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new s7(t.clientId,t.onlineState):(I(s3,`Failed to parse online state: ${e}`),null)}}class ae{constructor(){this.activeTargetIds=re}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ss(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class at{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.Ti=t,this.persistenceKey=n,this.Cs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Fs=this.Ms.bind(this),this.xs=new tx(U),this.started=!1,this.Os=[];let l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ns=s0(this.persistenceKey,this.Cs),this.Bs=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.xs=this.xs.insert(this.Cs,new ae),this.Ls=RegExp(`^${sZ}_${l}_([^_]*)$`),this.ks=RegExp(`^${s1}_${l}_(\\d+)(?:_(.*))?$`),this.qs=RegExp(`^${s6}_${l}_(\\d+)$`),this.Qs=(a=this.persistenceKey,`firestore_online_state_${a}`),this.$s=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.Fs)}static D(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.zi())){if(e===this.Cs)continue;let t=this.getItem(s0(this.persistenceKey,e));if(t){let n=s9.bs(e,t);n&&(this.xs=this.xs.insert(n.clientId,n))}}this.Ks();let e=this.storage.getItem(this.Qs);if(e){let t=this.Us(e);t&&this.Ws(t)}for(let e of this.Os)this.Ms(e);this.Os=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Bs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Gs(this.xs)}isActiveQueryTarget(e){let t=!1;return this.xs.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.zs(e,"pending")}updateMutationState(e,t,n){this.zs(e,t,n),this.js(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(s5(this.persistenceKey,e));if(t){let r=s8.bs(e,t);r&&(n=r.state)}}return t&&this.Hs.Ds(e),this.Ks(),n}removeLocalQueryTarget(e){this.Hs.vs(e),this.Ks()}isLocalQueryTarget(e){return this.Hs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(s5(this.persistenceKey,e))}updateQueryState(e,t,n){this.Js(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.js(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Ys(e)}notifyBundleLoaded(e){this.Zs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Fs),this.removeItem(this.Ns),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return _(s3,"READ",e,t),t}setItem(e,t){_(s3,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){_(s3,"REMOVE",e),this.storage.removeItem(e)}Ms(e){if(e.storageArea===this.storage){if(_(s3,"EVENT",e.key,e.newValue),e.key===this.Ns)return void I("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ti.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.Ls.test(e.key)){if(null==e.newValue){let t=this.Xs(e.key);return this.eo(t,null)}{let t=this.no(e.key,e.newValue);if(t)return this.eo(t.clientId,t)}}else if(this.ks.test(e.key)){if(null!==e.newValue){let t=this.ro(e.key,e.newValue);if(t)return this.io(t)}}else if(this.qs.test(e.key)){if(null!==e.newValue){let t=this.so(e.key,e.newValue);if(t)return this.oo(t)}}else if(e.key===this.Qs){if(null!==e.newValue){let t=this.Us(e.newValue);if(t)return this.Ws(t)}}else if(e.key===this.Bs){let t=function(e){let t=eE.ae;if(null!=e)try{let n=JSON.parse(e);"number"==typeof n||x(),t=n}catch(e){I(s3,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==eE.ae&&this.sequenceNumberHandler(t)}else if(e.key===this.$s){let t=this._o(e.newValue);await Promise.all(t.map(e=>this.syncEngine.ao(e)))}}}else this.Os.push(e)})}}get Hs(){return this.xs.get(this.Cs)}Ks(){this.setItem(this.Ns,this.Hs.Ss())}zs(e,t,n){let r=new s4(this.currentUser,e,t,n),i=s2(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ss())}js(e){let t=s2(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Ys(e){let t={clientId:this.Cs,onlineState:e};this.storage.setItem(this.Qs,JSON.stringify(t))}Js(e,t,n){let r=s5(this.persistenceKey,e),i=new s8(e,t,n);this.setItem(r,i.Ss())}Zs(e){let t=JSON.stringify(Array.from(e));this.setItem(this.$s,t)}Xs(e){let t=this.Ls.exec(e);return t?t[1]:null}no(e,t){let n=this.Xs(e);return s9.bs(n,t)}ro(e,t){let n=this.ks.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return s4.bs(new y(i),r,t)}so(e,t){let n=Number(this.qs.exec(e)[1]);return s8.bs(n,t)}Us(e){return s7.bs(e)}_o(e){return JSON.parse(e)}async io(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.uo(e.batchId,e.state,e.error);_(s3,`Ignoring mutation for non-active user ${e.user.uid}`)}oo(e){return this.syncEngine.co(e.targetId,e.state,e.error)}eo(e,t){let n=t?this.xs.insert(e,t):this.xs.remove(e),r=this.Gs(this.xs),i=this.Gs(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.lo(s,a).then(()=>{this.xs=n})}Ws(e){this.xs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Gs(e){let t=re;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class an{constructor(){this.ho=new ae,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,n){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new ae,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ar{To(e){}shutdown(){}}let ai="ConnectivityMonitor";class as{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){for(let e of(_(ai,"Network connectivity changed: AVAILABLE"),this.Vo))e(0)}Ro(){for(let e of(_(ai,"Network connectivity changed: UNAVAILABLE"),this.Vo))e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let aa=null;function ao(){return null===aa?aa=0x10000000+Math.round(0x80000000*Math.random()):aa++,"0x"+aa.toString(16)}let al="RestConnection",au={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ah{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${n}/databases/${r}`,this.wo=this.databaseId.database===tG?`project_id=${n}`:`project_id=${n}&database_id=${r}`}bo(e,t,n,r,i){let s=ao(),a=this.So(e,t.toUriEncodedString());_(al,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(o,r,i),this.vo(e,a,o,n).then(t=>(_(al,`Received RPC '${e}' ${s}: `,t),t),t=>{throw E(al,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}Co(e,t,n,r,i,s){return this.bo(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+v,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}So(e,t){let n=au[e];return`${this.po}/v1/${t}:${n}`}terminate(){}}class ac{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}}let af="WebChannelConnection";class ad extends ah{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,n,r){let i=ao();return new Promise((s,a)=>{let o=new g.XhrIo;o.setWithCredentials(!0),o.listenOnce(g.EventType.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case g.ErrorCode.NO_ERROR:let t=o.getResponseJson();_(af,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case g.ErrorCode.TIMEOUT:_(af,`RPC '${e}' ${i} timed out`),a(new C(S.DEADLINE_EXCEEDED,"Request time out"));break;case g.ErrorCode.HTTP_ERROR:let n=o.getStatus();if(_(af,`RPC '${e}' ${i} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(t)>=0?t:S.UNKNOWN}(t.status);a(new C(e,t.message))}else a(new C(S.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new C(S.UNAVAILABLE,"Connection failed."));break;default:x()}}finally{_(af,`RPC '${e}' ${i} completed.`)}});let l=JSON.stringify(r);_(af,`RPC '${e}' ${i} sending request:`,r),o.send(t,"POST",l,n,15)})}Wo(e,t,n){let i=ao(),s=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=g.createWebChannelTransport(),o=g.getStatEventTarget(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Do(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;let h=s.join("");_(af,`Creating RPC '${e}' stream ${i}: ${h}`,l);let c=a.createWebChannel(h,l),f=!1,d=!1,p=new ac({Fo:t=>{d?_(af,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(f||(_(af,`Opening RPC '${e}' stream ${i} transport.`),c.open(),f=!0),_(af,`RPC '${e}' stream ${i} sending:`,t),c.send(t))},Mo:()=>c.close()}),m=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(c,g.WebChannel.EventType.OPEN,()=>{d||(_(af,`RPC '${e}' stream ${i} transport opened.`),p.Qo())}),m(c,g.WebChannel.EventType.CLOSE,()=>{d||(d=!0,_(af,`RPC '${e}' stream ${i} transport closed`),p.Ko())}),m(c,g.WebChannel.EventType.ERROR,t=>{d||(d=!0,E(af,`RPC '${e}' stream ${i} transport errored:`,t),p.Ko(new C(S.UNAVAILABLE,"The operation could not be completed")))}),m(c,g.WebChannel.EventType.MESSAGE,t=>{var n;if(!d){let s=t.data[0];s||x();let a=(null==s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(a){_(af,`RPC '${e}' stream ${i} received error:`,a);let t=a.status,n=function(e){let t=r[e];if(void 0!==t)return rM(t)}(t),s=a.message;void 0===n&&(n=S.INTERNAL,s="Unknown error status: "+t+" with message "+a.message),d=!0,p.Ko(new C(n,s)),c.close()}else _(af,`RPC '${e}' stream ${i} received:`,s),p.Uo(s)}}),m(o,g.Event.STAT_EVENT,t=>{t.stat===g.Stat.PROXY?_(af,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===g.Stat.NOPROXY&&_(af,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{p.$o()},0),p}}function ag(){return"undefined"!=typeof window?window:null}function ap(){return"undefined"!=typeof document?document:null}function am(e){return new r1(e,!0)}class ay{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Ti=e,this.timerId=t,this.Go=n,this.zo=r,this.jo=i,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();let t=Math.floor(this.Ho+this.e_()),n=Math.max(0,Date.now()-this.Yo),r=Math.max(0,t-n);r>0&&_("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,r,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){null!==this.Jo&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){null!==this.Jo&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}let av="PersistentStream";class aw{constructor(e,t,n,r,i,s,a,o){this.Ti=e,this.n_=n,this.r_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new ay(e,t)}u_(){return 1===this.state||5===this.state||this.c_()}c_(){return 2===this.state||3===this.state}start(){this.__=0,4!==this.state?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&null===this.s_&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,4!==e?this.a_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(I(t.toString()),I("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===S.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;let e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.i_===t&&this.V_(e,n)},t=>{e(()=>{let e=new C(S.UNKNOWN,"Fetching auth token failed: "+t.message);return this.m_(e)})})}V_(e,t){let n=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{n(()=>this.listener.xo())}),this.stream.No(()=>{n(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(e=>{n(()=>this.m_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.__?this.g_(e):this.onNext(e))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return _(av,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget(()=>this.i_===e?t():(_(av,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ab extends aw{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:x(),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(void 0===i||"string"==typeof i||x(),tL.fromBase64String(i||"")):(void 0===i||i instanceof l||i instanceof Uint8Array||x(),tL.fromUint8Array(i||new Uint8Array))),u=t.targetChange.cause;n=new rQ(s,a,o,u&&new C(void 0===u.code?S.UNKNOWN:rM(u.code),u.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=ie(e,r.document.name),s=r3(r.document.updateTime),a=r.document.createTime?r3(r.document.createTime):j.min(),o=new nu({mapValue:{fields:r.document.fields}}),l=nh.newFoundDocument(i,s,a,o);n=new rK(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=ie(e,r.document),s=r.readTime?r3(r.readTime):j.min(),a=nh.newNoDocument(i,s);n=new rK([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=ie(e,r.document);n=new rK([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return x();{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new rL(r,i);n=new rG(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return j.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?j.min():t.readTime?r3(t.readTime):j.min()}(e);return this.listener.p_(t,n)}y_(e){let t={};t.database=ii(this.serializer),t.addTarget=function(e,t){let n;let r=t.target;if((n=nM(r)?{documents:ih(e,r)}:{query:ic(e,r).ht}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=r5(e,t.resumeToken);let r=r2(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(j.min())>0){n.readTime=r6(e,t.snapshotVersion.toTimestamp());let r=r2(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return x()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.I_(t)}w_(e){let t={};t.database=ii(this.serializer),t.removeTarget=e,this.I_(t)}}class a_ extends aw{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return e.streamToken||x(),this.lastStreamToken=e.streamToken,e.writeResults&&0!==e.writeResults.length&&x(),this.listener.D_()}onNext(e){var t,n;e.streamToken||x(),this.lastStreamToken=e.streamToken,this.a_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(void 0!==n||x(),t.map(e=>{let t;return(t=e.updateTime?r3(e.updateTime):r3(n)).isEqual(j.min())&&(t=r3(n)),new rp(t,e.transformResults||[])})):[]),i=r3(e.commitTime);return this.listener.v_(i,r)}C_(){let e={};e.database=ii(this.serializer),this.I_(e)}S_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>il(this.serializer,e))};this.I_(t)}}class aI{}class aE extends aI{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.F_=!1}M_(){if(this.F_)throw new C(S.FAILED_PRECONDITION,"The client has already been terminated.")}bo(e,t,n,r){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.bo(e,r8(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new C(S.UNKNOWN,e.toString())})}Co(e,t,n,r,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(e,r8(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new C(S.UNKNOWN,e.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class aT{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){0===this.x_&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){"Online"===this.state?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,"Online"===e&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(I(t),this.N_=!1):_("OnlineStateTracker",t)}Q_(){null!==this.O_&&(this.O_.cancel(),this.O_=null)}}let ax="RemoteStore";class aS{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=i,this.z_.To(e=>{n.enqueueAndForget(async()=>{aM(this)&&(_(ax,"Restarting streams for network reachability change."),await async function(e){e.W_.add(4),await aA(e),e.j_.set("Unknown"),e.W_.delete(4),await aC(e)}(this))})}),this.j_=new aT(n,r)}}async function aC(e){if(aM(e))for(let t of e.G_)await t(!0)}async function aA(e){for(let t of e.G_)await t(!1)}function aD(e,t){e.U_.has(t.targetId)||(e.U_.set(t.targetId,t),aR(e)?aL(e):aJ(e).c_()&&aN(e,t))}function ak(e,t){let n=aJ(e);e.U_.delete(t),n.c_()&&aO(e,t),0===e.U_.size&&(n.c_()?n.P_():aM(e)&&e.j_.set("Unknown"))}function aN(e,t){if(e.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(j.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}aJ(e).y_(t)}function aO(e,t){e.H_.Ne(t),aJ(e).w_(t)}function aL(e){e.H_=new rW({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>e.U_.get(t)||null,it:()=>e.datastore.serializer.databaseId}),aJ(e).start(),e.j_.B_()}function aR(e){return aM(e)&&!aJ(e).u_()&&e.U_.size>0}function aM(e){return 0===e.W_.size}async function aP(e){e.j_.set("Online")}async function aF(e){e.U_.forEach((t,n)=>{aN(e,t)})}async function aV(e,t){e.H_=void 0,aR(e)?(e.j_.q_(t),aL(e)):e.j_.set("Unknown")}async function aU(e,t,n){if(e.j_.set("Online"),t instanceof rQ&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.U_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.U_.delete(r),e.H_.removeTarget(r))}(e,t)}catch(n){_(ax,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await aB(e,n)}else if(t instanceof rK?e.H_.We(t):t instanceof rG?e.H_.Ze(t):e.H_.je(t),!n.isEqual(j.min()))try{let t=await sz(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.H_.ot(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.U_.get(r);i&&e.U_.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.U_.get(t);if(!r)return;e.U_.set(t,r.withResumeToken(tL.EMPTY_BYTE_STRING,r.snapshotVersion)),aO(e,t);let i=new iv(r.target,t,n,r.sequenceNumber);aN(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){_(ax,"Failed to raise snapshot:",t),await aB(e,t)}}async function aB(e,t,n){if(!ep(t))throw t;e.W_.add(1),await aA(e),e.j_.set("Offline"),n||(n=()=>sz(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{_(ax,"Retrying IndexedDB access"),await n(),e.W_.delete(1),await aC(e)})}function aq(e,t){return t().catch(n=>aB(e,n,t))}async function aj(e){var t;let n=aX(e),r=e.K_.length>0?e.K_[e.K_.length-1].batchId:-1;for(;aM(t=e)&&t.K_.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.K_.length&&n.P_();break}r=t.batchId,function(e,t){e.K_.push(t);let n=aX(e);n.c_()&&n.b_&&n.S_(t.mutations)}(e,t)}catch(t){await aB(e,t)}az(e)&&a$(e)}function az(e){return aM(e)&&!aX(e).u_()&&e.K_.length>0}function a$(e){aX(e).start()}async function aK(e){aX(e).C_()}async function aG(e){let t=aX(e);for(let n of e.K_)t.S_(n.mutations)}async function aQ(e,t,n){let r=e.K_.shift(),i=rk.from(r,t,n);await aq(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await aj(e)}async function aH(e,t){t&&aX(e).b_&&await async function(e,t){var n;if(rR(n=t.code)&&n!==S.ABORTED){let n=e.K_.shift();aX(e).h_(),await aq(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await aj(e)}}(e,t),az(e)&&a$(e)}async function aW(e,t){e.asyncQueue.verifyOperationInProgress(),_(ax,"RemoteStore received new credentials");let n=aM(e);e.W_.add(3),await aA(e),n&&e.j_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.W_.delete(3),await aC(e)}async function aY(e,t){t?(e.W_.delete(2),await aC(e)):t||(e.W_.add(2),await aA(e),e.j_.set("Unknown"))}function aJ(e){var t,n,r;return e.J_||(t=e.datastore,n=e.asyncQueue,r={xo:aP.bind(null,e),No:aF.bind(null,e),Lo:aV.bind(null,e),p_:aU.bind(null,e)},t.M_(),e.J_=new ab(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.G_.push(async t=>{t?(e.J_.h_(),aR(e)?aL(e):e.j_.set("Unknown")):(await e.J_.stop(),e.H_=void 0)})),e.J_}function aX(e){var t,n,r;return e.Y_||(t=e.datastore,n=e.asyncQueue,r={xo:()=>Promise.resolve(),No:aK.bind(null,e),Lo:aH.bind(null,e),D_:aG.bind(null,e),v_:aQ.bind(null,e)},t.M_(),e.Y_=new a_(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.G_.push(async t=>{t?(e.Y_.h_(),await aj(e)):(await e.Y_.stop(),e.K_.length>0&&(_(ax,`Stopping write stream with ${e.K_.length} pending writes`),e.K_=[]))})),e.Y_}class aZ{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new A,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new aZ(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function a0(e,t){if(I("AsyncQueue",`${t}: ${e}`),ep(e))return new C(S.UNAVAILABLE,`${t}: ${e}`);throw e}class a1{static emptySet(e){return new a1(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||H.comparator(t.key,n.key):(e,t)=>H.comparator(e.key,t.key),this.keyedMap=n5(),this.sortedSet=new tx(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof a1)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new a1;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class a2{constructor(){this.Z_=new tx(H.comparator)}track(e){let t=e.doc.key,n=this.Z_.get(t);n?0!==e.type&&3===n.type?this.Z_=this.Z_.insert(t,e):3===e.type&&1!==n.type?this.Z_=this.Z_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Z_=this.Z_.remove(t):1===e.type&&2===n.type?this.Z_=this.Z_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):x():this.Z_=this.Z_.insert(t,e)}X_(){let e=[];return this.Z_.inorderTraversal((t,n)=>{e.push(n)}),e}}class a6{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new a6(e,t,a1.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nW(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class a5{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class a3{constructor(){this.queries=a4(),this.onlineState="Unknown",this.ia=new Set}terminate(){!function(e,t){let n=e.queries;e.queries=a4(),n.forEach((e,n)=>{for(let e of n.ta)e.onError(t)})}(this,new C(S.ABORTED,"Firestore shutting down"))}}function a4(){return new n1(e=>nY(e),nW)}async function a8(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.na()&&t.ra()&&(n=2):(i=new a5,n=+!t.ra());try{switch(n){case 0:i.ea=await e.onListen(r,!0);break;case 1:i.ea=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=a0(n,`Initialization of query '${nJ(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.ta.push(t),t.sa(e.onlineState),i.ea&&t.oa(i.ea)&&ot(e)}async function a9(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.ta.indexOf(t);e>=0&&(i.ta.splice(e,1),0===i.ta.length?r=+!t.ra():!i.na()&&t.ra()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function a7(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.ta)e.oa(r)&&(n=!0);i.ea=r}}n&&ot(e)}function oe(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.ta)e.onError(n);e.queries.delete(t)}function ot(e){e.ia.forEach(e=>{e.next()})}(a=s||(s={}))._a="default",a.Cache="cache";class on{constructor(e,t,n){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=n||{}}oa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new a6(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){return!(e.fromCache&&this.ra())||(!this.options.Ta||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}la(e){if(e.docChanges.length>0)return!0;let t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Pa(e){e=a6.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==s.Cache}}class or{constructor(e,t){this.Ia=e,this.byteLength=t}Ea(){return"metadata"in this.Ia}}class oi{constructor(e){this.serializer=e}ps(e){return ie(this.serializer,e)}ys(e){return e.metadata.exists?io(this.serializer,e.document,!1):nh.newNoDocument(this.ps(e.metadata.name),this.ws(e.metadata.readTime))}ws(e){return r3(e)}}class os{constructor(e,t,n){this.da=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=oa(e)}Aa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Ia.namedQuery)this.queries.push(e.Ia.namedQuery);else if(e.Ia.documentMetadata){this.documents.push({metadata:e.Ia.documentMetadata}),e.Ia.documentMetadata.exists||++t;let n=K.fromString(e.Ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Ia.document&&(this.documents[this.documents.length-1].document=e.Ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ra(e){let t=new Map,n=new oi(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.ps(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||n7()).add(e);t.set(n,r)}}return t}async complete(){let e=await sJ(this.localStore,new oi(this.serializer),this.documents,this.da.id),t=this.Ra(this.documents);for(let e of this.queries)await sX(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Va:this.collectionGroups,ma:e}}}function oa(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class oo{constructor(e){this.key=e}}class ol{constructor(e){this.key=e}}class ou{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=n7(),this.mutatedKeys=n7(),this.ya=n0(e),this.wa=new a1(this.ya)}get ba(){return this.fa}Sa(e,t){let n=t?t.Da:new a2,r=t?t.wa:this.wa,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=nX(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),f=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),d=!1;u&&h?u.data.isEqual(h.data)?c!==f&&(n.track({type:3,doc:h}),d=!0):this.va(u,h)||(n.track({type:2,doc:h}),d=!0,(o&&this.ya(h,o)>0||l&&0>this.ya(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),d=!0):u&&!h&&(n.track({type:1,doc:u}),d=!0,(o||l)&&(a=!0)),d&&(h?(s=s.add(h),i=f?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{wa:s,Da:n,ls:a,mutatedKeys:i}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;let s=e.Da.X_();s.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return x()}};return n(e)-n(t)})(e.type,t.type)||this.ya(e.doc,t.doc)),this.Ca(n),r=null!=r&&r;let a=t&&!r?this.Fa():[],o=0===this.pa.size&&this.current&&!r?1:0,l=o!==this.ga;return(this.ga=o,0!==s.length||l)?{snapshot:new a6(this.query,e.wa,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ma:a}:{Ma:a}}sa(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({wa:this.wa,Da:new a2,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(e=>this.fa=this.fa.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.fa=this.fa.delete(e)),this.current=e.current)}Fa(){if(!this.current)return[];let e=this.pa;this.pa=n7(),this.wa.forEach(e=>{this.xa(e.key)&&(this.pa=this.pa.add(e.key))});let t=[];return e.forEach(e=>{this.pa.has(e)||t.push(new ol(e))}),this.pa.forEach(n=>{e.has(n)||t.push(new oo(n))}),t}Oa(e){this.fa=e.gs,this.pa=n7();let t=this.Sa(e.documents);return this.applyChanges(t,!0)}Na(){return a6.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,0===this.ga,this.hasCachedResults)}}let oh="SyncEngine";class oc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class of{constructor(e){this.key=e,this.Ba=!1}}class od{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.La={},this.ka=new n1(e=>nY(e),nW),this.qa=new Map,this.Qa=new Set,this.$a=new tx(H.comparator),this.Ka=new Map,this.Ua=new sb,this.Wa={},this.Ga=new Map,this.za=i7.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return!0===this.ja}}async function og(e,t,n=!0){let r;let i=oK(e),s=i.ka.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.Na()):r=await om(i,t,n,!0),r}async function op(e,t){let n=oK(e);await om(n,t,!0,!1)}async function om(e,t,n,r){let i;let s=await sK(e.localStore,n$(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n);return r&&(i=await oy(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&aD(e.remoteStore,s),i}async function oy(e,t,n,r,i){e.Ha=(t,n,r)=>(async function(e,t,n,r){let i=t.view.Sa(n);i.ls&&(i=await sQ(e.localStore,t.query,!1).then(({documents:e})=>t.view.Sa(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return oN(e,t.targetId,o.Ma),o.snapshot})(e,t,n,r);let s=await sQ(e.localStore,t,!0),a=new ou(t,s.gs),o=a.Sa(s.documents),l=r$.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);oN(e,n,u.Ma);let h=new oc(t,n,a);return e.ka.set(t,h),e.qa.has(n)?e.qa.get(n).push(t):e.qa.set(n,[t]),u.snapshot}async function ov(e,t,n){let r=e.ka.get(t),i=e.qa.get(r.targetId);if(i.length>1)return e.qa.set(r.targetId,i.filter(e=>!nW(e,t))),void e.ka.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await sG(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&ak(e.remoteStore,r.targetId),oD(e,r.targetId)}).catch(eo)):(oD(e,r.targetId),await sG(e.localStore,r.targetId,!0))}async function ow(e,t){let n=e.ka.get(t),r=e.qa.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),ak(e.remoteStore,n.targetId))}async function ob(e,t,n){let r=oG(e);try{var i;let e;let s=await function(e,t){let n,r;let i=q.now(),s=t.reduce((e,t)=>e.add(t.key),n7());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let o=n2,l=n7();return e.ds.getEntries(a,s).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,o)).next(r=>{n=r;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=rs(r.transform,e||null);null!=i&&(null===n&&(n=nu.empty()),n.set(r.field,i))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new rE(e.key,t,function e(t){let n=[];return tI(t.fields,(t,r)=>{let i=new Q([t]);if(nn(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new tN(n)}(t.value.mapValue),rm.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,s,t)}).next(t=>{r=t;let i=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:r.batchId,changes:n3(n)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),i=s.batchId,(e=r.Wa[r.currentUser.toKey()])||(e=new tx(U)),e=e.insert(i,n),r.Wa[r.currentUser.toKey()]=e,await oL(r,s.changes),await aj(r.remoteStore)}catch(t){let e=a0(t,"Failed to persist write");n.reject(e)}}async function o_(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,r=e.Ts;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let s=e.ds.newChangeBuffer({trackRemovals:!0});r=e.Ts;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=r.get(o);if(!u)return;a.push(e.Hr.removeMatchingKeys(i,s.removedDocuments,o).next(()=>e.Hr.addMatchingKeys(i,s.addedDocuments,o)));let h=u.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(tL.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),r=r.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(e.Hr.updateTargetData(i,h))});let o=n2,l=n7();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(i,n))}),a.push(s$(i,s,t.documentUpdates).next(e=>{o=e.Vs,l=e.fs})),!n.isEqual(j.min())){let t=e.Hr.getLastRemoteSnapshotVersion(i).next(t=>e.Hr.setTargetsMetadata(i,i.currentSequenceNumber,n));a.push(t)}return el.waitFor(a).next(()=>s.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,o,l)).next(()=>o)}).then(t=>(e.Ts=r,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let r=e.Ka.get(n);r&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||x(),t.addedDocuments.size>0?r.Ba=!0:t.modifiedDocuments.size>0?r.Ba||x():t.removedDocuments.size>0&&(r.Ba||x(),r.Ba=!1))}),await oL(e,n,t)}catch(e){await eo(e)}}function oI(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n;let i=[];e.ka.forEach((e,n)=>{let r=n.view.sa(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.ta)e.sa(t)&&(n=!0)}),n&&ot(r),i.length&&e.La.p_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function oE(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Ka.get(t),i=r&&r.key;if(i){let n=new tx(H.comparator);n=n.insert(i,nh.newNoDocument(i,j.min()));let r=n7().add(i),s=new rz(j.min(),new Map,new tx(U),n,r);await o_(e,s),e.$a=e.$a.remove(i),e.Ka.delete(t),oO(e)}else await sG(e.localStore,t,!1).then(()=>oD(e,t,n)).catch(eo)}async function oT(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore).persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.ds.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,r){let i=n.batch,s=i.keys(),a=el.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);null!==s||x(),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=n7();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))});oA(e,r,null),oC(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await oL(e,i)}catch(e){await eo(e)}}async function ox(e,t,n){var r;try{let i=await (r=e.localStore).persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(null!==t||x(),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))});oA(e,t,n),oC(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await oL(e,i)}catch(e){await eo(e)}}async function oS(e,t){var n;aM(e.remoteStore)||_(oh,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await (n=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>n.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===r)return void t.resolve();let i=e.Ga.get(r)||[];i.push(t),e.Ga.set(r,i)}catch(n){let e=a0(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function oC(e,t){(e.Ga.get(t)||[]).forEach(e=>{e.resolve()}),e.Ga.delete(t)}function oA(e,t,n){let r=e.Wa[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Wa[e.currentUser.toKey()]=r}}function oD(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.qa.get(t)))e.ka.delete(r),n&&e.La.Ja(r,n);e.qa.delete(t),e.isPrimaryClient&&e.Ua.Sr(t).forEach(t=>{e.Ua.containsKey(t)||ok(e,t)})}function ok(e,t){e.Qa.delete(t.path.canonicalString());let n=e.$a.get(t);null!==n&&(ak(e.remoteStore,n),e.$a=e.$a.remove(t),e.Ka.delete(n),oO(e))}function oN(e,t,n){for(let r of n)r instanceof oo?(e.Ua.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.$a.get(n)||e.Qa.has(r)||(_(oh,"New document in limbo: "+n),e.Qa.add(r),oO(e))}(e,r)):r instanceof ol?(_(oh,"Document no longer in limbo: "+r.key),e.Ua.removeReference(r.key,t),e.Ua.containsKey(r.key)||ok(e,r.key)):x()}function oO(e){for(;e.Qa.size>0&&e.$a.size<e.maxConcurrentLimboResolutions;){let t=e.Qa.values().next().value;e.Qa.delete(t);let n=new H(K.fromString(t)),r=e.za.next();e.Ka.set(r,new of(n)),e.$a=e.$a.insert(n,r),aD(e.remoteStore,new iv(n$(nB(n.path)),r,"TargetPurposeLimboResolution",eE.ae))}}async function oL(e,t,n){let r=[],i=[],s=[];e.ka.isEmpty()||(e.ka.forEach((a,o)=>{s.push(e.Ha(o,t,n).then(t=>{var s;if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:null===(s=null==n?void 0:n.targetChanges.get(o.targetId))||void 0===s?void 0:s.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=sF.Yi(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.La.p_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>el.forEach(t,t=>el.forEach(t.Hi,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>el.forEach(t.Ji,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!ep(e))throw e;_(sB,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ts.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Ts=e.Ts.insert(t,i)}}}(e.localStore,i))}async function oR(e,t){if(!e.currentUser.isEqual(t)){_(oh,"User change. New user:",t.toKey());let n=await sj(e.localStore,t);e.currentUser=t,e.Ga.forEach(e=>{e.forEach(e=>{e.reject(new C(S.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ga.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await oL(e,n.Rs)}}function oM(e,t){let n=e.Ka.get(t);if(n&&n.Ba)return n7().add(n.key);{let n=n7(),r=e.qa.get(t);if(!r)return n;for(let t of r){let r=e.ka.get(t);n=n.unionWith(r.view.ba)}return n}}async function oP(e,t){let n=await sQ(e.localStore,t.query,!0),r=t.view.Oa(n);return e.isPrimaryClient&&oN(e,t.targetId,r.Ma),r}async function oF(e,t){return sW(e.localStore,t).then(t=>oL(e,t))}async function oV(e,t,n,r){let i=await function(e,t){let n=e.mutationQueue;return e.persistence.runTransaction("Lookup mutation documents","readonly",r=>n.Ln(r,t).next(t=>t?e.localDocuments.getDocuments(r,t):el.resolve(null)))}(e.localStore,t);null!==i?("pending"===n?await aj(e.remoteStore):"acknowledged"===n||"rejected"===n?(oA(e,t,r||null),oC(e,t),function(e,t){e.mutationQueue.qn(t)}(e.localStore,t)):x(),await oL(e,i)):_(oh,"Cannot apply mutation batch with id: "+t)}async function oU(e,t){if(oK(e),oG(e),!0===t&&!0!==e.ja){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await oB(e,t.toArray());for(let t of(e.ja=!0,await aY(e.remoteStore,!0),n))aD(e.remoteStore,t)}else if(!1===t&&!1!==e.ja){let t=[],n=Promise.resolve();e.qa.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(oD(e,i),sG(e.localStore,i,!0))),ak(e.remoteStore,i)}),await n,await oB(e,t),e.Ka.forEach((t,n)=>{ak(e.remoteStore,n)}),e.Ua.Dr(),e.Ka=new Map,e.$a=new tx(H.comparator),e.ja=!1,await aY(e.remoteStore,!1)}}async function oB(e,t,n){let r=[],i=[];for(let n of t){let t;let s=e.qa.get(n);if(s&&0!==s.length)for(let n of(t=await sK(e.localStore,n$(s[0])),s)){let t=e.ka.get(n),r=await oP(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await sH(e.localStore,n);t=await sK(e.localStore,r),await oy(e,oq(r),n,!1,t.resumeToken)}r.push(t)}return e.La.p_(i),r}function oq(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new nU(t,n,r,i,s,"F",e.startAt,e.endAt)}function oj(e){return e.localStore.persistence.zi()}async function oz(e,t,n,r){if(e.ja)return void _(oh,"Ignoring unexpected query state notification.");let i=e.qa.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await sW(e.localStore,nZ(i[0])),s=rz.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,tL.EMPTY_BYTE_STRING);await oL(e,r,s);break}case"rejected":await sG(e.localStore,t,!0),oD(e,t,r);break;default:x()}}async function o$(e,t,n){let r=oK(e);if(r.ja){for(let e of t){if(r.qa.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){_(oh,"Adding an already active target "+e);continue}let t=await sH(r.localStore,e),n=await sK(r.localStore,t);await oy(r,oq(t),n.targetId,!1,n.resumeToken),aD(r.remoteStore,n)}for(let e of n)r.qa.has(e)&&await sG(r.localStore,e,!1).then(()=>{ak(r.remoteStore,e),oD(r,e)}).catch(eo)}}function oK(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=o_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=oM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=oE.bind(null,e),e.La.p_=a7.bind(null,e.eventManager),e.La.Ja=oe.bind(null,e.eventManager),e}function oG(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=oT.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ox.bind(null,e),e}class oQ{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=am(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){var t,n;return t=this.persistence,n=new sU,new sq(t,n,e.initialUser,this.serializer)}Xa(e){return new sS(sA.ri,this.serializer)}Za(e){return new an}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}oQ.provider={build:()=>new oQ};class oH extends oQ{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){return this.persistence.referenceDelegate instanceof sD||x(),new ss(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Xa(e){let t=void 0!==this.cacheSizeBytes?i6.withCacheSize(this.cacheSizeBytes):i6.DEFAULT;return new sS(e=>sD.ri(e,t),this.serializer)}}class oW extends oQ{constructor(e,t,n){super(),this.ru=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.ru.initialize(this,e),await oG(this.ru.syncEngine),await aj(this.ru.remoteStore),await this.persistence.Ci(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}eu(e){var t,n;return t=this.persistence,n=new sU,new sq(t,n,e.initialUser,this.serializer)}tu(e,t){return new ss(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}nu(e,t){let n=new eI(t,this.persistence);return new e_(e.asyncQueue,n)}Xa(e){let t=sP(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?i6.withCacheSize(this.cacheSizeBytes):i6.DEFAULT;return new sM(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,ag(),ap(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Za(e){return new an}}class oY extends oW{constructor(e,t){super(e,t,!1),this.ru=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.ru.syncEngine;this.sharedClientState instanceof at&&(this.sharedClientState.syncEngine={uo:oV.bind(null,t),co:oz.bind(null,t),lo:o$.bind(null,t),zi:oj.bind(null,t),ao:oF.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ci(async e=>{await oU(this.ru.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Za(e){let t=ag();if(!at.D(t))throw new C(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=sP(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new at(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class oJ{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>oI(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=oR.bind(null,this.syncEngine),await aY(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new a3}createDatastore(e){var t;let n=am(e.databaseInfo.databaseId),r=new ad(e.databaseInfo);return t=e.authCredentials,new aE(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new aS(t,n,e.asyncQueue,e=>oI(this.syncEngine,e,0),as.D()?new as:new ar)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){let o=new od(e,t,n,r,i,s);return a&&(o.ja=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){_(ax,"RemoteStore shutting down."),e.W_.add(5),await aA(e),e.z_.shutdown(),e.j_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}function oX(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}oJ.provider={build:()=>new oJ};class oZ{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):I("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class o0{constructor(e,t){this.ou=e,this.serializer=t,this.metadata=new A,this.buffer=new Uint8Array,this._u=new TextDecoder("utf-8"),this.au().then(e=>{e&&e.Ea()?this.metadata.resolve(e.Ia.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.Ia)}`))},e=>this.metadata.reject(e))}close(){return this.ou.cancel()}async getMetadata(){return this.metadata.promise}async Ya(){return await this.getMetadata(),this.au()}async au(){let e=await this.uu();if(null===e)return null;let t=this._u.decode(e),n=Number(t);return isNaN(n)&&this.cu(`length string (${t}) is not valid number`),new or(JSON.parse(await this.lu(n)),e.length+n)}hu(){return this.buffer.findIndex(e=>123===e)}async uu(){for(;0>this.hu()&&!await this.Pu(););if(0===this.buffer.length)return null;let e=this.hu();e<0&&this.cu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async lu(e){for(;this.buffer.length<e;)await this.Pu()&&this.cu("Reached the end of bundle when more is expected.");let t=this._u.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}cu(e){throw this.ou.cancel(),Error(`Invalid bundle format: ${e}`)}async Pu(){let e=await this.ou.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class o1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new C(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>r7(e.serializer,t))},r=await e.Co("BatchGetDocuments",e.serializer.databaseId,K.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r=(n=e.serializer,"found"in t?function(e,t){t.found||x(),t.found.name,t.found.updateTime;let n=ie(e,t.found.name),r=r3(t.found.updateTime),i=t.found.createTime?r3(t.found.createTime):j.min(),s=new nu({mapValue:{fields:t.found.fields}});return nh.newFoundDocument(n,r,i,s)}(n,t):"missing"in t?function(e,t){t.missing||x(),t.readTime||x();let n=ie(e,t.missing),r=r3(t.readTime);return nh.newNoDocument(n,r)}(n,t):x());i.set(r.key.toString(),r)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());t||x(),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new rC(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=H.fromPath(t);this.mutations.push(new rA(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>il(e.serializer,t))};await e.bo("Commit",e.serializer.databaseId,K.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw x();t=j.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new C(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(j.min())?rm.exists(!1):rm.updateTime(t):rm.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(j.min()))throw new C(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rm.updateTime(t)}return rm.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class o2{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Tu=n.maxAttempts,this.a_=new ay(this.asyncQueue,"transaction_retry")}Iu(){this.Tu-=1,this.Eu()}Eu(){this.a_.Xo(async()=>{let e=new o1(this.datastore),t=this.du(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Au(e)}))}).catch(e=>{this.Au(e)})})}du(e){try{let t=this.updateFunction(e);return!eT(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Au(e){this.Tu>0&&this.Ru(e)?(this.Tu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Eu(),Promise.resolve()))):this.deferred.reject(e)}Ru(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!rR(t)}return!1}}let o6="FirestoreClient";class o5{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=y.UNAUTHENTICATED,this.clientId=V.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{_(o6,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(_(o6,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new A;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=a0(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function o3(e,t){e.asyncQueue.verifyOperationInProgress(),_(o6,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await sj(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function o4(e,t){e.asyncQueue.verifyOperationInProgress();let n=await o8(e);_(o6,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>aW(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>aW(t.remoteStore,n)),e._onlineComponents=t}async function o8(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){_(o6,"Using user provided OfflineComponentProvider");try{await o3(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===S.FAILED_PRECONDITION||t.code===S.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;E("Error using user provided cache. Falling back to memory cache: "+t),await o3(e,new oQ)}}else _(o6,"Using default OfflineComponentProvider"),await o3(e,new oH(void 0))}return e._offlineComponents}async function o9(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(_(o6,"Using user provided OnlineComponentProvider"),await o4(e,e._uninitializedComponentsProvider._online)):(_(o6,"Using default OnlineComponentProvider"),await o4(e,new oJ))),e._onlineComponents}function o7(e){return o8(e).then(e=>e.persistence)}function le(e){return o8(e).then(e=>e.localStore)}function lt(e){return o9(e).then(e=>e.remoteStore)}function ln(e){return o9(e).then(e=>e.syncEngine)}function lr(e){return o9(e).then(e=>e.datastore)}async function li(e){let t=await o9(e),n=t.eventManager;return n.onListen=og.bind(null,t.syncEngine),n.onUnlisten=ov.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=op.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=ow.bind(null,t.syncEngine),n}function ls(e,t,n={}){let r=new A;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new oZ({next:o=>{s.su(),t.enqueueAndForget(()=>a9(e,a));let l=o.docs.has(n);!l&&o.fromCache?i.reject(new C(S.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&"server"===r.source?i.reject(new C(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new on(nB(n.path),s,{includeMetadataChanges:!0,Ta:!0});return a8(e,a)})(await li(e),e.asyncQueue,t,n,r)),r.promise}function la(e,t,n={}){let r=new A;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new oZ({next:n=>{s.su(),t.enqueueAndForget(()=>a9(e,a)),n.fromCache&&"server"===r.source?i.reject(new C(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new on(n,s,{includeMetadataChanges:!0,Ta:!0});return a8(e,a)})(await li(e),e.asyncQueue,t,n,r)),r.promise}function lo(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let ll=new Map;function lu(e,t,n){if(!n)throw new C(S.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function lh(e,t,n,r){if(!0===t&&!0===r)throw new C(S.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function lc(e){if(!H.isDocumentKey(e))throw new C(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function lf(e){if(H.isDocumentKey(e))throw new C(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ld(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":x()}function lg(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new C(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=ld(e);throw new C(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function lp(e,t){if(t<=0)throw new C(S.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}let lm="firestore.googleapis.com";class ly{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new C(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lm,this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new C(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}lh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lo(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lv{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ly({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new C(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new C(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ly(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new k;switch(e.type){case"firstParty":return new R(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new C(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=ll.get(e);t&&(_("ComponentProvider","Removing Datastore"),ll.delete(e),t.terminate())}(this),Promise.resolve()}}function lw(e,t,n,r={}){var i;let s=(e=lg(e,lv))._getSettings(),a=Object.assign(Object.assign({},s),{emulatorOptions:e._getEmulatorOptions()}),o=`${t}:${n}`;s.host!==lm&&s.host!==o&&E("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l=Object.assign(Object.assign({},s),{host:o,ssl:!1,emulatorOptions:r});if(!f.deepEqual(l,a)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=y.MOCK_USER;else{t=f.createMockUserToken(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new C(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new y(s)}e._authCredentials=new N(new D(t,n))}}class lb{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new lb(this.firestore,e,this._query)}}class l_{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lI(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new l_(this.firestore,e,this._key)}}class lI extends lb{constructor(e,t,n){super(e,t,nB(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new l_(this.firestore,null,new H(e))}withConverter(e){return new lI(this.firestore,e,this._path)}}function lE(e,t,...n){if(e=f.getModularInstance(e),1==arguments.length&&(t=V.newId()),lu("doc","path",t),e instanceof lv){let r=K.fromString(t,...n);return lc(r),new l_(e,null,new H(r))}{if(!(e instanceof l_||e instanceof lI))throw new C(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(K.fromString(t,...n));return lc(r),new l_(e.firestore,e instanceof lI?e.converter:null,new H(r))}}function lT(e,t){return e=f.getModularInstance(e),t=f.getModularInstance(t),e instanceof lb&&t instanceof lb&&e.firestore===t.firestore&&nW(e._query,t._query)&&e.converter===t.converter}let lx="AsyncQueue";class lS{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new ay(this,"async_queue_retry"),this.bu=()=>{let e=ap();e&&_(lx,"Visibility state changed to "+e.visibilityState),this.a_.t_()},this.Su=e;let t=ap();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;let t=ap();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bu)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});let t=new A;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(0!==this.Vu.length){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!ep(e))throw e;_(lx,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){let t=this.Su.then(()=>(this.pu=!0,e().catch(e=>{let t;throw this.gu=e,this.pu=!1,I("INTERNAL UNHANDLED ERROR: ",(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t)),e}).then(e=>(this.pu=!1,e))));return this.Su=t,t}enqueueAfterDelay(e,t,n){this.Du(),this.wu.indexOf(e)>-1&&(t=0);let r=aZ.createAndSchedule(this,e,t,n,e=>this.Fu(e));return this.fu.push(r),r}Du(){this.gu&&x()}verifyOperationInProgress(){}async Mu(){let e;do e=this.Su,await e;while(e!==this.Su)}xu(e){for(let t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{for(let t of(this.fu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.fu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){let t=this.fu.indexOf(e);this.fu.splice(t,1)}}function lC(e){return function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])}class lA{constructor(){this._progressObserver={},this._taskCompletionResolver=new A,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class lD extends lv{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new lS,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new lS(e),this._firestoreClient=void 0,await e}}}function lk(e){if(e._terminated)throw new C(S.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||lN(e),e._firestoreClient}function lN(e){var t,n,r,i,s;let a=e._freezeSettings(),o=(i=e._databaseId,s=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",new tK(i,s,e._persistenceKey,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,lo(a.experimentalLongPollingOptions),a.useFetchStreams));e._componentsProvider||(null===(n=a.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=a.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),e._firestoreClient=new o5(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&function(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}async function lO(e){E("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();lL(e,oJ.provider,{build:e=>new oY(e,t.cacheSizeBytes)})}function lL(e,t,n){if((e=lg(e,lD))._firestoreClient||e._terminated)throw new C(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new C(S.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},lN(e)}class lR{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class lM{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class lP{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lP(tL.fromBase64String(e))}catch(e){throw new C(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new lP(tL.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class lF{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new C(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Q(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class lV{constructor(e){this._methodName=e}}class lU{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new C(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new C(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return U(this._lat,e._lat)||U(this._long,e._long)}}class lB{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}let lq=/^__.*__$/;class lj{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new rE(e,this.data,this.fieldMask,t,this.fieldTransforms):new rI(e,this.data,t,this.fieldTransforms)}}class lz{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new rE(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function l$(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw x()}}class lK{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Bu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new lK(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ku({path:n,Qu:!1});return r.$u(e),r}Ku(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ku({path:n,Qu:!1});return r.Bu(),r}Uu(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return ut(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(0===e.length)throw this.Wu("Document fields must not be empty");if(l$(this.Lu)&&lq.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class lG{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||am(e)}ju(e,t,n,r=!1){return new lK({Lu:e,methodName:t,zu:n,path:Q.emptyPath(),Qu:!1,Gu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function lQ(e){let t=e._freezeSettings(),n=am(e._databaseId);return new lG(e._databaseId,!!t.ignoreUndefinedProperties,n)}function lH(e,t,n,r,i,s={}){let a,o;let l=e.ju(s.merge||s.mergeFields?2:0,t,n,i);l8("Data must be an object, but it was:",l,r);let u=l3(r,l);if(s.merge)a=new tN(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=l9(t,r,n);if(!l.contains(i))throw new C(S.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);un(e,i)||e.push(i)}a=new tN(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new lj(new nu(u),a,o)}class lW extends lV{_toFieldTransform(e){if(2!==e.Lu)throw 1===e.Lu?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof lW}}function lY(e,t,n){return new lK({Lu:3,zu:t.settings.zu,methodName:e._methodName,Qu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class lJ extends lV{_toFieldTransform(e){return new rg(e.path,new ra)}isEqual(e){return e instanceof lJ}}class lX extends lV{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){let t=lY(this,e,!0),n=new ro(this.Hu.map(e=>l5(e,t)));return new rg(e.path,n)}isEqual(e){return e instanceof lX&&f.deepEqual(this.Hu,e.Hu)}}class lZ extends lV{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){let t=lY(this,e,!0),n=new ru(this.Hu.map(e=>l5(e,t)));return new rg(e.path,n)}isEqual(e){return e instanceof lZ&&f.deepEqual(this.Hu,e.Hu)}}class l0 extends lV{constructor(e,t){super(e),this.Ju=t}_toFieldTransform(e){let t=new rc(e.serializer,rr(e.serializer,this.Ju));return new rg(e.path,t)}isEqual(e){return e instanceof l0&&this.Ju===e.Ju}}function l1(e,t,n,r){let i=e.ju(1,t,n);l8("Data must be an object, but it was:",i,r);let s=[],a=nu.empty();return tI(r,(e,r)=>{let o=ue(t,e,n);r=f.getModularInstance(r);let l=i.Ku(o);if(r instanceof lW)s.push(o);else{let e=l5(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new lz(a,new tN(s),i.fieldTransforms)}function l2(e,t,n,r,i,s){let a=e.ju(1,t,n),o=[l9(t,r,n)],l=[i];if(s.length%2!=0)throw new C(S.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(l9(t,s[e])),l.push(s[e+1]);let u=[],h=nu.empty();for(let e=o.length-1;e>=0;--e)if(!un(u,o[e])){let t=o[e],n=l[e];n=f.getModularInstance(n);let r=a.Ku(t);if(n instanceof lW)u.push(t);else{let e=l5(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new lz(h,new tN(u),a.fieldTransforms)}function l6(e,t,n,r=!1){return l5(n,e.ju(r?4:3,t))}function l5(e,t){if(l4(e=f.getModularInstance(e)))return l8("Unsupported field value:",t,e),l3(e,t);if(e instanceof lV)return function(e,t){if(!l$(t.Lu))throw t.Wu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Wu(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Qu&&4!==t.Lu)throw t.Wu("Nested arrays are not supported");return function(e,t){let n=[],r=0;for(let i of e){let e=l5(i,t.Uu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=f.getModularInstance(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return rr(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=q.fromDate(e);return{timestampValue:r6(t.serializer,n)}}if(e instanceof q){let n=new q(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:r6(t.serializer,n)}}if(e instanceof lU)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof lP)return{bytesValue:r5(t.serializer,e._byteString)};if(e instanceof l_){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Wu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:r4(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof lB)return{mapValue:{fields:{[tH]:{stringValue:tJ},[tX]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Wu("VectorValues must only contain numeric values.");return rt(t.serializer,e)})}}}}};throw t.Wu(`Unsupported field value: ${ld(e)}`)}(e,t)}function l3(e,t){let n={};return tT(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tI(e,(e,r)=>{let i=l5(r,t.qu(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function l4(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof q||e instanceof lU||e instanceof lP||e instanceof l_||e instanceof lV||e instanceof lB)}function l8(e,t,n){if(!l4(n)||"object"!=typeof n||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)){let r=ld(n);throw"an object"===r?t.Wu(e+" a custom object"):t.Wu(e+" "+r)}}function l9(e,t,n){if((t=f.getModularInstance(t))instanceof lF)return t._internalPath;if("string"==typeof t)return ue(e,t);throw ut("Field path arguments must be of type string or ",e,!1,void 0,n)}let l7=RegExp("[~\\*/\\[\\]]");function ue(e,t,n){if(t.search(l7)>=0)throw ut(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new lF(...t.split("."))._internalPath}catch(r){throw ut(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function ut(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new C(S.INVALID_ARGUMENT,o+e+l)}function un(e,t){return e.some(e=>e.isEqual(t))}class ur{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new l_(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new ui(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(us("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ui extends ur{data(){return super.data()}}function us(e,t){return"string"==typeof t?ue(e,t):t instanceof lF?t._internalPath:t._delegate._internalPath}function ua(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new C(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class uo{}class ul extends uo{}class uu extends ul{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new uu(e,t,n)}_apply(e){let t=this._parse(e);return uv(e._query,t),new lb(e.firestore,e.converter,nQ(e._query,t))}_parse(e){let t=lQ(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new C(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){uy(a,s);let t=[];for(let n of a)t.push(um(r,e,n));o={arrayValue:{values:t}}}else o=um(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||uy(a,s),o=l6(n,t,a,"in"===s||"not-in"===s);return nm.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class uh extends uo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new uh(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ny.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())uv(n,e),n=nQ(n,e)}(e._query,t),new lb(e.firestore,e.converter,nQ(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class uc extends ul{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new uc(e,t)}_apply(e){let t=function(e,t,n){if(null!==e.startAt)throw new C(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new C(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ng(t,n)}(e._query,this._field,this._direction);return new lb(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new nU(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class uf extends ul{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new uf(e,t,n)}_apply(e){return new lb(e.firestore,e.converter,nH(e._query,this._limit,this._limitType))}}class ud extends ul{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ud(e,t,n)}_apply(e){var t;let n=up(e,this.type,this._docOrFields,this._inclusive);return new lb(e.firestore,e.converter,new nU((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt))}}class ug extends ul{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ug(e,t,n)}_apply(e){var t;let n=up(e,this.type,this._docOrFields,this._inclusive);return new lb(e.firestore,e.converter,new nU((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n))}}function up(e,t,n,r){if(n[0]=f.getModularInstance(n[0]),n[0]instanceof ur)return function(e,t,n,r,i){if(!r)throw new C(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of nz(e))if(n.field.isKeyField())s.push(t8(t,r.key));else{let e=r.data.field(n.field);if(tj(e))throw new C(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new C(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new nc(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=lQ(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new C(S.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new C(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!nj(e)&&-1!==l.indexOf("/"))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(K.fromString(l));if(!H.isDocumentKey(n))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new H(n);o.push(t8(t,i))}else{let e=l6(n,r,l);o.push(e)}}return new nc(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function um(e,t,n){if("string"==typeof(n=f.getModularInstance(n))){if(""===n)throw new C(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nj(t)&&-1!==n.indexOf("/"))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(K.fromString(n));if(!H.isDocumentKey(r))throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return t8(e,new H(r))}if(n instanceof l_)return t8(e,n._key);throw new C(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ld(n)}.`)}function uy(e,t){if(!Array.isArray(e)||0===e.length)throw new C(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function uv(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new C(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new C(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function uw(e,t){if(!(t instanceof uu||t instanceof uh))throw new C(S.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class ub{convertValue(e,t="none"){switch(t0(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tP(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(tF(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw x()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return tI(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;return new lB(null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t[tX].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e=>tP(e.doubleValue)))}convertGeoPoint(e){return new lU(tP(e.latitude),tP(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=tz(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(t$(e));default:return null}}convertTimestamp(e){let t=tM(e);return new q(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=K.fromString(e);iy(n)||x();let r=new tQ(n.get(1),n.get(3)),i=new H(n.popFirst(5));return r.isEqual(t)||I(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function u_(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class uI extends ub{constructor(e){super(),this.firestore=e}convertBytes(e){return new lP(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new l_(this.firestore,null,t)}}function uE(){return new lR("count")}class uT{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ux extends ur{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new uS(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(us("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class uS extends ux{data(e={}){return super.data(e)}}class uC{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new uT(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new uS(this._firestore,this._userDataWriter,n.key,n,new uT(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new C(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new uS(e._firestore,e._userDataWriter,n.doc.key,n.doc,new uT(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new uS(e._firestore,e._userDataWriter,t.doc.key,t.doc,new uT(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return x()}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}class uA extends ub{constructor(e){super(),this.firestore=e}convertBytes(e){return new lP(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new l_(this.firestore,null,t)}}function uD(e,t){return function(e,t){let n=new A;return e.asyncQueue.enqueueAndForget(async()=>ob(await ln(e),t,n)),n.promise}(lk(e),t)}function uk(e,t,n){let r=n.docs.get(t._key),i=new uA(e);return new ux(e,i,t._key,r,new uT(n.hasPendingWrites,n.fromCache),t.converter)}function uN(e,t){let n=lg(e.firestore,lD),r=lk(n),i=tE(t,(e,t)=>new rO(t,e.aggregateType,e._internalFieldPath));return(function(e,t,n){let r=new A;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await lr(e);r.resolve(async function(e,t,n){var r;let{request:i,Pt:s,parent:a}=id(e.serializer,nK(t),n);e.connection.fo||delete i.parent;let o=(await e.Co("RunAggregationQuery",e.serializer.databaseId,a,i,1)).filter(e=>!!e.result);1===o.length||x();let l=null===(r=o[0].result)||void 0===r?void 0:r.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}(i,t,n))}catch(e){r.reject(e)}}),r.promise})(r,e._query,i).then(t=>new lM(e,new uA(n),t))}class uO{constructor(e){this.kind="memory",this._onlineComponentProvider=oJ.provider,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new oH(void 0)}}toJSON(){return{kind:this.kind}}}class uL{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=uV(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class uR{constructor(){this.kind="memoryEager",this._offlineComponentProvider=oQ.provider}toJSON(){return{kind:this.kind}}}class uM{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new oH(e)}}toJSON(){return{kind:this.kind}}}class uP{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=oJ.provider,this._offlineComponentProvider={build:t=>new oW(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class uF{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=oJ.provider,this._offlineComponentProvider={build:t=>new oY(t,null==e?void 0:e.cacheSizeBytes)}}}function uV(e){return new uP(null==e?void 0:e.forceOwnership)}let uU={maxAttempts:5};class uB{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=lQ(e)}set(e,t,n){this._verifyNotCommitted();let r=uq(e,this._firestore),i=u_(r.converter,t,n),s=lH(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,rm.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=uq(e,this._firestore);return i="string"==typeof(t=f.getModularInstance(t))||t instanceof lF?l2(this._dataReader,"WriteBatch.update",s._key,t,n,r):l1(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,rm.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=uq(e,this._firestore);return this._mutations=this._mutations.concat(new rC(t._key,rm.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function uq(e,t){if((e=f.getModularInstance(e)).firestore!==t)throw new C(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class uj{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=lQ(e)}get(e){let t=uq(e,this._firestore),n=new uI(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return x();let r=e[0];if(r.isFoundDocument())return new ur(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new ur(this._firestore,n,t._key,null,t.converter);throw x()})}set(e,t,n){let r=uq(e,this._firestore),i=u_(r.converter,t,n),s=lH(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i;let s=uq(e,this._firestore);return i="string"==typeof(t=f.getModularInstance(t))||t instanceof lF?l2(this._dataReader,"Transaction.update",s._key,t,n,r):l1(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=uq(e,this._firestore);return this._transaction.delete(t._key),this}}class uz extends uj{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=uq(e,this._firestore),n=new uA(this._firestore);return super.get(e).then(e=>new ux(this._firestore,n,t._key,e._document,new uT(!1,!1),t.converter))}}function u$(e,t){if("string"!=typeof e[t])throw new C(S.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class uK{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function uG(e,t){var n;(n=lk(e._firestore)).asyncQueue.enqueue(async()=>{(await le(n)).Ps.Xi=t}).then(e=>_(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>E(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let uQ=new WeakMap;class uH{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return uW.instance.onExistenceFilterMismatch(e)}}class uW{constructor(){this.Yu=new Map}static get instance(){return uY||function(e){if(rP)throw Error("a TestingHooksSpi instance is already set");rP=e}(uY=new uW),uY}rt(e){this.Yu.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.Yu;return n.set(t,e),()=>n.delete(t)}}let uY=null;!function(e=!0){v=u.SDK_VERSION,u._registerComponent(new h.Component("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new lD(new O(t.getProvider("auth-internal")),new P(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new C(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new tQ(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),u.registerVersion(p,m,void 0),u.registerVersion(p,m,"cjs2017")}(),t.AbstractUserDataWriter=ub,t.AggregateField=lR,t.AggregateQuerySnapshot=lM,t.Bytes=lP,t.CACHE_SIZE_UNLIMITED=-1,t.CollectionReference=lI,t.DocumentReference=l_,t.DocumentSnapshot=ux,t.FieldPath=lF,t.FieldValue=lV,t.Firestore=lD,t.FirestoreError=C,t.GeoPoint=lU,t.LoadBundleTask=lA,t.PersistentCacheIndexManager=uK,t.Query=lb,t.QueryCompositeFilterConstraint=uh,t.QueryConstraint=ul,t.QueryDocumentSnapshot=uS,t.QueryEndAtConstraint=ug,t.QueryFieldFilterConstraint=uu,t.QueryLimitConstraint=uf,t.QueryOrderByConstraint=uc,t.QuerySnapshot=uC,t.QueryStartAtConstraint=ud,t.SnapshotMetadata=uT,t.Timestamp=q,t.Transaction=uz,t.VectorValue=lB,t.WriteBatch=uB,t._AutoId=V,t._ByteString=tL,t._DatabaseId=tQ,t._DocumentKey=H,t._EmptyAppCheckTokenProvider=F,t._EmptyAuthCredentialsProvider=k,t._FieldPath=Q,t._TestingHooks=uH,t._cast=lg,t._debugAssert=function(e,t){e||x()},t._internalAggregationQueryToProtoRunAggregationQueryRequest=function(e,t){var n;let r=tE(t,(e,t)=>new rO(t,e.aggregateType,e._internalFieldPath)),i=null===(n=lk(lg(e.firestore,lD))._onlineComponents)||void 0===n?void 0:n.datastore.serializer;return void 0===i?null:id(i,nK(e._query),r,!0).request},t._internalQueryToProtoQueryTarget=function(e){var t;let n=null===(t=lk(lg(e.firestore,lD))._onlineComponents)||void 0===t?void 0:t.datastore.serializer;return void 0===n?null:ic(n,n$(e._query)).ht},t._isBase64Available=function(){return"undefined"!=typeof atob},t._logWarn=E,t._validateIsNotUsedTogether=lh,t.addDoc=function(e,t){let n=lg(e.firestore,lD),r=lE(e),i=u_(e.converter,t);return uD(n,[lH(lQ(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,rm.exists(!1))]).then(()=>r)},t.aggregateFieldEqual=function(e,t){var n,r;return e instanceof lR&&t instanceof lR&&e.aggregateType===t.aggregateType&&(null===(n=e._internalFieldPath)||void 0===n?void 0:n.canonicalString())===(null===(r=t._internalFieldPath)||void 0===r?void 0:r.canonicalString())},t.aggregateQuerySnapshotEqual=function(e,t){return lT(e.query,t.query)&&f.deepEqual(e.data(),t.data())},t.and=function(...e){return e.forEach(e=>uw("and",e)),uh._create("and",e)},t.arrayRemove=function(...e){return new lZ("arrayRemove",e)},t.arrayUnion=function(...e){return new lX("arrayUnion",e)},t.average=function(e){return new lR("avg",l9("average",e))},t.clearIndexedDbPersistence=function(e){if(e._initialized&&!e._terminated)throw new C(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new A;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!ec.D())return Promise.resolve();await ec.delete(e+sR)}(sP(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise},t.collection=function(e,t,...n){if(e=f.getModularInstance(e),lu("collection","path",t),e instanceof lv){let r=K.fromString(t,...n);return lf(r),new lI(e,null,r)}{if(!(e instanceof l_||e instanceof lI))throw new C(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(K.fromString(t,...n));return lf(r),new lI(e.firestore,null,r)}},t.collectionGroup=function(e,t){if(e=lg(e,lv),lu("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new C(S.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new lb(e,null,new nU(K.emptyPath(),t))},t.connectFirestoreEmulator=lw,t.count=uE,t.deleteAllPersistentCacheIndexes=function(e){var t;(t=lk(e._firestore)).asyncQueue.enqueue(async()=>(function(e){let t=e.indexManager;return e.persistence.runTransaction("Delete All Indexes","readwrite",e=>t.deleteAllFieldIndexes(e))})(await le(t))).then(e=>_("deleting all persistent cache indexes succeeded")).catch(e=>E("deleting all persistent cache indexes failed",e))},t.deleteDoc=function(e){return uD(lg(e.firestore,lD),[new rC(e._key,rm.none())])},t.deleteField=function(){return new lW("deleteField")},t.disableNetwork=function(e){var t;return(t=lk(e=lg(e,lD))).asyncQueue.enqueue(async()=>{let e=await o7(t),n=await lt(t);return e.setNetworkEnabled(!1),async function(e){e.W_.add(0),await aA(e),e.j_.set("Offline")}(n)})},t.disablePersistentCacheIndexAutoCreation=function(e){uG(e,!1)},t.doc=lE,t.documentId=function(){return new lF(z)},t.enableIndexedDbPersistence=function(e,t){E("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=e._freezeSettings();return lL(e,oJ.provider,{build:e=>new oW(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()},t.enableMultiTabIndexedDbPersistence=lO,t.enableNetwork=function(e){var t;return(t=lk(e=lg(e,lD))).asyncQueue.enqueue(async()=>{let e=await o7(t),n=await lt(t);return e.setNetworkEnabled(!0),n.W_.delete(0),aC(n)})},t.enablePersistentCacheIndexAutoCreation=function(e){uG(e,!0)},t.endAt=function(...e){return ug._create("endAt",e,!0)},t.endBefore=function(...e){return ug._create("endBefore",e,!1)},t.ensureFirestoreConfigured=lk,t.executeWrite=uD,t.getAggregateFromServer=uN,t.getCountFromServer=function(e){return uN(e,{count:uE()})},t.getDoc=function(e){e=lg(e,l_);let t=lg(e.firestore,lD);return ls(lk(t),e._key).then(n=>uk(t,e,n))},t.getDocFromCache=function(e){e=lg(e,l_);let t=lg(e.firestore,lD),n=lk(t),r=new uA(t);return(function(e,t){let n=new A;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new C(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=a0(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await le(e),t,n)),n.promise})(n,e._key).then(n=>new ux(t,r,e._key,n,new uT(null!==n&&n.hasLocalMutations,!0),e.converter))},t.getDocFromServer=function(e){e=lg(e,l_);let t=lg(e.firestore,lD);return ls(lk(t),e._key,{source:"server"}).then(n=>uk(t,e,n))},t.getDocs=function(e){e=lg(e,lb);let t=lg(e.firestore,lD),n=lk(t),r=new uA(t);return ua(e._query),la(n,e._query).then(n=>new uC(t,r,e,n))},t.getDocsFromCache=function(e){e=lg(e,lb);let t=lg(e.firestore,lD),n=lk(t),r=new uA(t);return(function(e,t){let n=new A;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await sQ(e,t,!0),i=new ou(t,r.gs),s=i.Sa(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=a0(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await le(e),t,n)),n.promise})(n,e._query).then(n=>new uC(t,r,e,n))},t.getDocsFromServer=function(e){e=lg(e,lb);let t=lg(e.firestore,lD),n=lk(t),r=new uA(t);return la(n,e._query,{source:"server"}).then(n=>new uC(t,r,e,n))},t.getFirestore=function(e,t){let n="object"==typeof e?e:u.getApp(),r="string"==typeof e?e:t||tG,i=u._getProvider(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let e=f.getDefaultEmulatorHostnameAndPort("firestore");e&&lw(i,...e)}return i},t.getPersistentCacheIndexManager=function(e){var t;e=lg(e,lD);let n=uQ.get(e);if(n)return n;if("persistent"!==(null===(t=lk(e)._uninitializedComponentsProvider)||void 0===t?void 0:t._offline.kind))return null;let r=new uK(e);return uQ.set(e,r),r},t.increment=function(e){return new l0("increment",e)},t.initializeFirestore=function(e,t,n){n||(n=tG);let r=u._getProvider(e,"firestore");if(r.isInitialized(n)){let e=r.getImmediate({identifier:n}),i=r.getOptions(n);if(f.deepEqual(i,t))return e;throw new C(S.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new C(S.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new C(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:t,instanceIdentifier:n})},t.limit=function(e){return lp("limit",e),uf._create("limit",e,"F")},t.limitToLast=function(e){return lp("limitToLast",e),uf._create("limitToLast",e,"L")},t.loadBundle=function(e,t){let n=lk(e=lg(e,lD)),r=new lA;return function(e,t,n,r){var i;let s=(i=am(t),new o0(function(e,t){if(e instanceof Uint8Array)return oX(e,void 0);if(e instanceof ArrayBuffer)return oX(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?rF().encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){(async function(e,t,n){try{var r;let i=await t.getMetadata();if(await function(e,t){let n=r3(t.createTime);return e.persistence.runTransaction("hasNewerBundle","readonly",n=>e.Yr.getBundleMetadata(n,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}(e.localStore,i))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);n._updateProgress(oa(i));let s=new os(i,e.localStore,t.serializer),a=await t.Ya();for(;a;){let e=await s.Aa(a);e&&n._updateProgress(e),a=await t.Ya()}let o=await s.complete();return await oL(e,o.ma,void 0),await (r=e.localStore).persistence.runTransaction("Save bundle","readwrite",e=>r.Yr.saveBundleMetadata(e,i)),n._completeWith(o.progress),Promise.resolve(o.Va)}catch(e){return E(oh,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(e,t,n).then(t=>{e.sharedClientState.notifyBundleLoaded(t)})}(await ln(e),s,r)})}(n,e._databaseId,t,r),r},t.memoryEagerGarbageCollector=function(){return new uR},t.memoryLocalCache=function(e){return new uO(e)},t.memoryLruGarbageCollector=function(e){return new uM(null==e?void 0:e.cacheSizeBytes)},t.namedQuery=function(e,t){var n;return(n=lk(e=lg(e,lD))).asyncQueue.enqueue(async()=>{var e;return(e=await le(n)).persistence.runTransaction("Get named query","readonly",n=>e.Yr.getNamedQuery(n,t))}).then(t=>t?new lb(e,null,t.query):null)},t.onSnapshot=function(e,...t){var n,r,i;let s,a,o;e=f.getModularInstance(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||lC(t[u])||(l=t[u],u++);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(lC(t[u])){let e=t[u];t[u]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[u+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[u+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}if(e instanceof l_)a=lg(e.firestore,lD),o=nB(e._key.path),s={next:n=>{t[u]&&t[u](uk(a,e,n))},error:t[u+1],complete:t[u+2]};else{let n=lg(e,lb);a=lg(n.firestore,lD),o=n._query;let r=new uA(a);s={next:e=>{t[u]&&t[u](new uC(a,r,n,e))},error:t[u+1],complete:t[u+2]},ua(e._query)}return function(e,t,n,r){let i=new oZ(r),s=new on(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>a8(await li(e),s)),()=>{i.su(),e.asyncQueue.enqueueAndForget(async()=>a9(await li(e),s))}}(lk(a),o,h,s)},t.onSnapshotsInSync=function(e,t){return function(e,t){let n=new oZ(t);return e.asyncQueue.enqueueAndForget(async()=>{(await li(e)).ia.add(n),n.next()}),()=>{n.su(),e.asyncQueue.enqueueAndForget(async()=>(function(e,t){e.ia.delete(t)})(await li(e),n))}}(lk(e=lg(e,lD)),lC(t)?t:{next:t})},t.or=function(...e){return e.forEach(e=>uw("or",e)),uh._create("or",e)},t.orderBy=function(e,t="asc"){let n=us("orderBy",e);return uc._create(n,t)},t.persistentLocalCache=function(e){return new uL(e)},t.persistentMultipleTabManager=function(){return new uF},t.persistentSingleTabManager=uV,t.query=function(e,t,...n){let r=[];for(let i of(t instanceof uo&&r.push(t),function(e){let t=e.filter(e=>e instanceof uh).length,n=e.filter(e=>e instanceof uu).length;if(t>1||t>0&&n>0)throw new C(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e},t.queryEqual=lT,t.refEqual=function(e,t){return e=f.getModularInstance(e),t=f.getModularInstance(t),(e instanceof l_||e instanceof lI)&&(t instanceof l_||t instanceof lI)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter},t.runTransaction=function(e,t,n){e=lg(e,lD);let r=Object.assign(Object.assign({},uU),n);return function(e){if(e.maxAttempts<1)throw new C(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){let r=new A;return e.asyncQueue.enqueueAndForget(async()=>{let i=await lr(e);new o2(e.asyncQueue,i,n,t,r).Iu()}),r.promise}(lk(e),n=>t(new uz(e,n)),r)},t.serverTimestamp=function(){return new lJ("serverTimestamp")},t.setDoc=function(e,t,n){e=lg(e,l_);let r=lg(e.firestore,lD),i=u_(e.converter,t,n);return uD(r,[lH(lQ(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,rm.none())])},t.setIndexConfiguration=function(e,t){let n=lk(e=lg(e,lD));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return E("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new C(S.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=u$(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=ue("setIndexConfiguration",u$(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new Z(e,2)):"ASCENDING"===t.order?r.push(new Z(e,0)):"DESCENDING"===t.order&&r.push(new Z(e,1))}n.push(new W(W.UNKNOWN_ID,t,r,ee.empty()))}return n}(t);return n.asyncQueue.enqueue(async()=>(async function(e,t){let n=e.indexManager,r=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(i=>(function(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])})(i,t,X,t=>{r.push(n.addFieldIndex(e,t))},t=>{r.push(n.deleteFieldIndex(e,t))})).next(()=>el.waitFor(r)))})(await le(n),r))},t.setLogLevel=function(e){w.setLogLevel(e)},t.snapshotEqual=function(e,t){return e instanceof ux&&t instanceof ux?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof uC&&t instanceof uC&&e._firestore===t._firestore&&lT(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)},t.startAfter=function(...e){return ud._create("startAfter",e,!1)},t.startAt=function(...e){return ud._create("startAt",e,!0)},t.sum=function(e){return new lR("sum",l9("sum",e))},t.terminate=function(e){return u._removeServiceInstance(e.app,"firestore",e._databaseId.database),e._delete()},t.updateDoc=function(e,t,n,...r){e=lg(e,l_);let i=lg(e.firestore,lD),s=lQ(i);return uD(i,[("string"==typeof(t=f.getModularInstance(t))||t instanceof lF?l2(s,"updateDoc",e._key,t,n,r):l1(s,"updateDoc",e._key,t)).toMutation(e._key,rm.exists(!0))])},t.vector=function(e){return new lB(e)},t.waitForPendingWrites=function(e){return function(e){let t=new A;return e.asyncQueue.enqueueAndForget(async()=>oS(await ln(e),t)),t.promise}(lk(e=lg(e,lD)))},t.where=function(e,t,n){let r=us("where",e);return uu._create(r,t,n)},t.writeBatch=function(e){return lk(e=lg(e,lD)),new uB(e,t=>uD(e,t))}},3517:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let n=[];t.LogLevel=void 0,function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(t.LogLevel||(t.LogLevel={}));let r={debug:t.LogLevel.DEBUG,verbose:t.LogLevel.VERBOSE,info:t.LogLevel.INFO,warn:t.LogLevel.WARN,error:t.LogLevel.ERROR,silent:t.LogLevel.SILENT},i=t.LogLevel.INFO,s={[t.LogLevel.DEBUG]:"log",[t.LogLevel.VERBOSE]:"log",[t.LogLevel.INFO]:"info",[t.LogLevel.WARN]:"warn",[t.LogLevel.ERROR]:"error"},a=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=s[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class o{constructor(e){this.name=e,this._logLevel=i,this._logHandler=a,this._userLogHandler=null,n.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in t.LogLevel))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?r[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.DEBUG,...e),this._logHandler(this,t.LogLevel.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.VERBOSE,...e),this._logHandler(this,t.LogLevel.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.INFO,...e),this._logHandler(this,t.LogLevel.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.WARN,...e),this._logHandler(this,t.LogLevel.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.ERROR,...e),this._logHandler(this,t.LogLevel.ERROR,...e)}}t.Logger=o,t.setLogLevel=function(e){n.forEach(t=>{t.setLogLevel(e)})},t.setUserLogHandler=function(e,i){for(let s of n){let n=null;i&&i.level&&(n=r[i.level]),null===e?s.userLogHandler=null:s.userLogHandler=(r,i,...s)=>{let a=s.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");i>=(null!=n?n:r.logLevel)&&e({level:t.LogLevel[i].toLowerCase(),message:a,args:s,type:r.name})}}}},4905:(e,t,n)=>{(function(){"use strict";var t,r,i,s="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},a=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n.g&&n.g];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=a;e=e.split(".");for(var r=0;r<e.length-1;r++){var i=e[r];if(!(i in n))break e;n=n[i]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&s(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,r;return e=this,e instanceof String&&(e+=""),t=0,n=!1,(r={next:function(){if(!n&&t<e.length){var r,i=t++;return{value:(r=0,e[i]),done:!1}}return n=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return r},r}});var o=o||{},l=this||self;function u(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function h(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function c(e,t,n){return e.call.apply(e.bind,arguments)}function f(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function d(e,t,n){return(d=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?c:f).apply(null,arguments)}function g(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function p(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function m(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function y(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(u(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}class v{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function w(e){return/^[\s\xa0]*$/.test(e)}function b(){var e=l.navigator;return e&&(e=e.userAgent)?e:""}function _(e){return _[" "](e),e}_[" "]=function(){};var I=-1!=b().indexOf("Gecko")&&(-1==b().toLowerCase().indexOf("webkit")||-1!=b().indexOf("Edge"))&&-1==b().indexOf("Trident")&&-1==b().indexOf("MSIE")&&-1==b().indexOf("Edge");function E(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function T(e){let t={};for(let n in e)t[n]=e[n];return t}let x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function S(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<x.length;t++)n=x[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}class C{constructor(){this.h=this.g=null}add(e,t){let n=A.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var A=new v(()=>new D,e=>e.reset());class D{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let k,N=!1,O=new C,L=()=>{let e=l.Promise.resolve(void 0);k=()=>{e.then(R)}};var R=()=>{let e;for(var t;e=null,O.g&&(e=O.g,O.g=O.g.next,O.g||(O.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){l.setTimeout(()=>{throw e},0)}(e)}A.j(t),100>A.h&&(A.h++,t.next=A.g,A.g=t)}N=!1};function M(){this.s=this.s,this.C=this.C}function P(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}M.prototype.s=!1,M.prototype.ma=function(){this.s||(this.s=!0,this.N())},M.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},P.prototype.h=function(){this.defaultPrevented=!0};var F=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};l.addEventListener("test",e,t),l.removeEventListener("test",e,t)}catch(e){}return e}();function V(e,t){if(P.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(I){e:{try{_(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:U[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&V.aa.h.call(this)}}p(V,P);var U={2:"touch",3:"pen",4:"mouse"};V.prototype.h=function(){V.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var B="closure_listenable_"+(1e6*Math.random()|0),q=0;function j(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++q,this.da=this.fa=!1}function z(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function $(e){this.src=e,this.g={},this.h=0}function K(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(z(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function G(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}$.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=G(e,t,r,i);return -1<a?(t=e[a],n||(t.fa=!1)):((t=new j(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Q="closure_lm_"+(1e6*Math.random()|0),H={},W=0;function Y(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=h(i)?!!i.capture:!!i,o=ee(e);if(o||(e[Q]=o=new $(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return Z.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)F||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(X(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return W++,n}function J(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[B])K(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(X(n),r):t.addListener&&t.removeListener&&t.removeListener(r),W--,(n=ee(t))?(K(n,e),0==n.h&&(n.src=null,t[Q]=null)):z(e)}}}function X(e){return e in H?H[e]:H[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new V(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&J(e),e=n.call(r,t)}return e}function ee(e){return(e=e[Q])instanceof $?e:null}var et="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return"function"==typeof e?e:(e[et]||(e[et]=function(t){return e.handleEvent(t)}),e[et])}function er(){M.call(this),this.i=new $(this),this.M=this,this.F=null}function ei(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new P(t,e);else if(t instanceof P)t.target=t.target||e;else{var i=t;S(t=new P(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=es(a,r,!0,t)&&i}if(i=es(a=t.g=e,r,!0,t)&&i,i=es(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=es(a=t.g=n[s],r,!1,t)&&i}function es(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&K(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function ea(e,t,n){if("function"==typeof e)n&&(e=d(e,n));else if(e&&"function"==typeof e.handleEvent)e=d(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:l.setTimeout(e,t||0)}p(er,M),er.prototype[B]=!0,er.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=h(i)?!!i.capture:!!i,r=en(r),t&&t[B])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=G(a=t.g[n],r,i,s))&&(z(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=ee(t))&&(n=t.g[n.toString()],t=-1,n&&(t=G(n,r,i,s)),(r=-1<t?n[t]:null)&&J(r))}(this,e,t,n,r)},er.prototype.N=function(){if(er.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)z(n[r]);delete t.g[e],t.h--}}this.F=null},er.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},er.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class eo extends M{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ea(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function el(e){M.call(this),this.h=e,this.g={}}p(el,M);var eu=[];function eh(e){E(e.g,function(e,t){this.g.hasOwnProperty(t)&&J(e)},e),e.g={}}el.prototype.N=function(){el.aa.N.call(this),eh(this)},el.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ec=l.JSON.stringify,ef=l.JSON.parse,ed=class{stringify(e){return l.JSON.stringify(e,void 0)}parse(e){return l.JSON.parse(e,void 0)}};function eg(){}function ep(e){return e.h||(e.h=e.i())}function em(){}eg.prototype.h=null;var ey={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ev(){P.call(this,"d")}function ew(){P.call(this,"c")}p(ev,P),p(ew,P);var eb={},e_=null;function eI(){return e_=e_||new er}function eE(e){P.call(this,eb.La,e)}function eT(e){let t=eI();ei(t,new eE(t,e))}function ex(e,t){P.call(this,eb.STAT_EVENT,e),this.stat=t}function eS(e){let t=eI();ei(t,new ex(t,e))}function eC(e,t){P.call(this,eb.Ma,e),this.size=t}function eA(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){e()},t)}function eD(){this.g=!0}function ek(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return ec(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eb.La="serverreachability",p(eE,P),eb.STAT_EVENT="statevent",p(ex,P),eb.Ma="timingevent",p(eC,P),eD.prototype.xa=function(){this.g=!1},eD.prototype.info=function(){};var eN={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eO={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eL(){}function eR(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new el(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eM}function eM(){this.i=null,this.g="",this.h=!1}p(eL,eg),eL.prototype.g=function(){return new XMLHttpRequest},eL.prototype.i=function(){return{}},r=new eL;var eP={},eF={};function eV(e,t,n){e.L=1,e.v=e7(e5(t)),e.m=n,e.P=!0,eU(e,null)}function eU(e,t){e.F=Date.now(),eq(e),e.A=e5(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),tf(n.i,"t",r),e.C=0,n=e.j.J,e.h=new eM,e.g=tX(e.j,n?t:null,!e.m),0<e.O&&(e.M=new eo(d(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(eu[0]=i.toString()),i=eu);for(var s=0;s<i.length;s++){var a=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=en(r),t&&t[B]?t.L(n,r,h(i)?!!i.capture:!!i,s):Y(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=en(r),t&&t[B]?t.K(n,r,h(i)?!!i.capture:!!i,s):Y(t,n,r,!1,i,s)}(n,i[s],r||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?T(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eT(1),function(e,t,n,r,i,s){e.info(function(){if(e.g){if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var u=o[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");a=2<=c.length&&"type"==c[1]?a+(h+"=")+u+"&":a+(h+"=redacted&")}}else a=null}else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.u,e.A,e.l,e.R,e.m)}function eB(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function eq(e){e.S=Date.now()+e.I,ej(e,e.I)}function ej(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eA(d(e.ba,e),t)}function ez(e){e.B&&(l.clearTimeout(e.B),e.B=null)}function e$(e){0==e.j.G||e.J||tQ(e.j,e)}function eK(e){ez(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,eh(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eG(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||eJ(n.h,e))){if(!e.K&&eJ(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(n.g.F+3e3<e.F)tG(n),tP(n);else break e}tz(n),eS(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=eA(d(n.Za,n),6e3));if(1>=eY(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else tW(n,11)}else if((e.K||n.g==e)&&tG(n),!w(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.T=o[0],o=o[1],2==n.G){if("c"==o[0]){n.K=o[1],n.ia=o[2];let t=o[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let i=o[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n.L=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eX(s,s.h),s.h=null))}if(r.D){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,e9(r.I,r.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(r=n).qa=tJ(r,r.J?r.ia:null,r.W),e.K){eZ(r.h,e);var a=r.L;a&&(e.I=a),e.B&&(ez(e),eq(e)),r.g=e}else tj(r);0<n.i.length&&tV(n)}else"stop"!=o[0]&&"close"!=o[0]||tW(n,7)}else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tW(n,7):tM(n):"noop"!=o[0]&&n.l&&n.l.ta(o),n.v=0)}}eT(4)}catch(e){}}eR.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tN(e)?t.j():this.Y(e)},eR.prototype.Y=function(e){try{if(e==this.g)e:{let f=tN(this.g);var t=this.g.Ba();let d=this.g.Z();if(!(3>f)&&(3!=f||this.g&&(this.h.h||this.g.oa()||tO(this.g)))){this.J||4!=f||7==t||(8==t||0>=d?eT(3):eT(2)),ez(this);var n=this.g.Z();this.X=n;t:if(eB(this)){var r=tO(this.g);e="";var i=r.length,s=4==tN(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eK(this),e$(this);var a="";break t}this.h.i=new l.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+a})}(this.i,this.u,this.A,this.l,this.R,f,n),this.o){if(this.T&&!this.K){t:{if(this.g){var o,u=this.g;if((o=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(o)){var h=o;break t}}h=null}if(n=h)ek(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eG(this,n);else{this.o=!1,this.s=3,eS(12),eK(this),e$(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;)if((e=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eF:isNaN(n=Number(t.substring(n,r)))?eP:(r+=1)+n>t.length?eF:(t=t.slice(r,r+n),e.C=r+n,t)}(this,a))==eF){4==f&&(this.s=4,eS(14),n=!1),ek(this.i,this.l,null,"[Incomplete Response]");break}else if(e==eP){this.s=4,eS(15),ek(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}else ek(this.i,this.l,e,null),eG(this,e);if(eB(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=a.length||this.h.h||(this.s=1,eS(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var c=this.j;c.g==this&&c.ba&&!c.M&&(c.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),t$(c),c.M=!0,eS(11))}}else ek(this.i,this.l,a,"[Invalid Chunked Response]"),eK(this),e$(this)}else ek(this.i,this.l,a,null),eG(this,a);4==f&&eK(this),this.o&&!this.J&&(4==f?tQ(this.j,this):(this.o=!1,eq(this)))}else(function(e){let t={};e=(e.g&&2<=tN(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(w(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(let n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,eS(12)):(this.s=0,eS(13)),eK(this),e$(this)}}}catch(e){}finally{}},eR.prototype.cancel=function(){this.J=!0,eK(this)},eR.prototype.ba=function(){this.B=null;let e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(eT(3),eS(17)),eK(this),this.s=2,e$(this)):ej(this,this.S-e)};var eQ=class{constructor(e,t){this.g=e,this.map=t}};function eH(e){this.l=e||10,e=l.PerformanceNavigationTiming?0<(e=l.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function eW(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eY(e){return e.h?1:e.g?e.g.size:0}function eJ(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eX(e,t){e.g?e.g.add(t):e.h=t}function eZ(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e0(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return m(e.i)}function e1(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(u(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(u(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(u(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}eH.prototype.cancel=function(){if(this.i=e0(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e2=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e6(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e6){this.h=e.h,e3(this,e.j),this.o=e.o,this.g=e.g,e4(this,e.s),this.l=e.l;var t=e.i,n=new tl;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),e8(this,n),this.m=e.m}else e&&(t=String(e).match(e2))?(this.h=!1,e3(this,t[1]||"",!0),this.o=te(t[2]||""),this.g=te(t[3]||"",!0),e4(this,t[4]),this.l=te(t[5]||"",!0),e8(this,t[6]||"",!0),this.m=te(t[7]||"")):(this.h=!1,this.i=new tl(null,this.h))}function e5(e){return new e6(e)}function e3(e,t,n){e.j=n?te(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e4(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function e8(e,t,n){var r,i;t instanceof tl?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tu(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(th(this,t),tf(this,n,e))},r)),r.j=i):(n||(t=tt(t,ta)),e.i=new tl(t,e.h))}function e9(e,t,n){e.i.set(t,n)}function e7(e){return e9(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function te(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,tn),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function tn(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e6.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tt(t,tr,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(tt(t,tr,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tt(n,"/"==n.charAt(0)?ts:ti,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",tt(n,to)),e.join("")};var tr=/[#\/\?@]/g,ti=/[#\?:]/g,ts=/[#\?]/g,ta=/[#\?@]/g,to=/#/g;function tl(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tu(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function th(e,t){tu(e),t=td(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tc(e,t){return tu(e),t=td(e,t),e.g.has(t)}function tf(e,t,n){th(e,t),0<n.length&&(e.i=null,e.g.set(td(e,t),m(n)),e.h+=n.length)}function td(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tg(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tp(){this.g=new ed}function tm(e){this.l=e.Ub||null,this.j=e.eb||!1}function ty(e,t){er.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tv(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tw(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tb(e)}function tb(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function t_(e){let t="";return E(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tI(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=t_(n),"string"==typeof e?(encodeURIComponent(String(t)),null!=n&&encodeURIComponent(String(n))):e9(e,t,n))}function tE(e){er.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(i=tl.prototype).add=function(e,t){tu(this),this.i=null,e=td(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},i.forEach=function(e,t){tu(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},i.na=function(){tu(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},i.V=function(e){tu(this);let t=[];if("string"==typeof e)tc(this,e)&&(t=t.concat(this.g.get(td(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},i.set=function(e,t){return tu(this),this.i=null,tc(this,e=td(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},i.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},i.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},p(tm,eg),tm.prototype.g=function(){return new ty(this.l,this.j)},tm.prototype.i=(t={},function(){return t}),p(ty,er),(i=ty.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tb(this)},i.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||l).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tw(this)),this.readyState=0},i.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tb(this)),this.g&&(this.readyState=3,tb(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==l.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tv(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))}},i.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tw(this):tb(this),3==this.readyState&&tv(this)}},i.Ra=function(e){this.g&&(this.response=this.responseText=e,tw(this))},i.Qa=function(e){this.g&&(this.response=e,tw(this))},i.ga=function(){this.g&&tw(this)},i.setRequestHeader=function(e,t){this.u.append(e,t)},i.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),p(tE,er);var tT=/^https?$/i,tx=["POST","PUT"];function tS(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tC(e),tD(e)}function tC(e){e.A||(e.A=!0,ei(e,"complete"),ei(e,"error"))}function tA(e){if(e.h&&void 0!==o&&(!e.v[1]||4!=tN(e)||2!=e.Z())){if(e.u&&4==tN(e))ea(e.Ea,0,e);else if(ei(e,"readystatechange"),4==tN(e)){e.h=!1;try{let a=e.Z();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===a){var i=String(e.D).match(e2)[1]||null;!i&&l.self&&l.self.location&&(i=l.self.location.protocol.slice(0,-1)),n=!tT.test(i?i.toLowerCase():"")}t=n}if(t)ei(e,"complete"),ei(e,"success");else{e.m=6;try{var s=2<tN(e)?e.g.statusText:""}catch(e){s=""}e.l=s+" ["+e.Z()+"]",tC(e)}}finally{tD(e)}}}}function tD(e,t){if(e.g){tk(e);let n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ei(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function tk(e){e.I&&(l.clearTimeout(e.I),e.I=null)}function tN(e){return e.g?e.g.readyState:0}function tO(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tL(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tR(e){this.Aa=0,this.i=[],this.j=new eD,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tL("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tL("baseRetryDelayMs",5e3,e),this.cb=tL("retryDelaySeedMs",1e4,e),this.Wa=tL("forwardChannelMaxRetries",2,e),this.wa=tL("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eH(e&&e.concurrentRequestLimit),this.Da=new tp,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tM(e){if(tF(e),3==e.G){var t=e.U++,n=e5(e.I);if(e9(n,"SID",e.K),e9(n,"RID",t),e9(n,"TYPE","terminate"),tB(e,n),(t=new eR(e,e.j,t)).L=2,t.v=e7(e5(n)),n=!1,l.navigator&&l.navigator.sendBeacon)try{n=l.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&l.Image&&((new Image).src=t.v,n=!0),n||(t.g=tX(t.j,null),t.g.ea(t.v)),t.F=Date.now(),eq(t)}tY(e)}function tP(e){e.g&&(t$(e),e.g.cancel(),e.g=null)}function tF(e){tP(e),e.u&&(l.clearTimeout(e.u),e.u=null),tG(e),e.h.cancel(),e.s&&("number"==typeof e.s&&l.clearTimeout(e.s),e.s=null)}function tV(e){if(!eW(e.h)&&!e.s){e.s=!0;var t=e.Ga;k||L(),N||(k(),N=!0),O.add(t,e),e.B=0}}function tU(e,t){var n;n=t?t.l:e.U++;let r=e5(e.I);e9(r,"SID",e.K),e9(r,"RID",n),e9(r,"AID",e.T),tB(e,r),e.m&&e.o&&tI(r,e.m,e.o),n=new eR(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tq(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),eX(e.h,n),eV(n,r,t)}function tB(e,t){e.H&&E(e.H,function(e,n){e9(t,n,e)}),e.l&&e1({},function(e,n){e9(t,n,e)})}function tq(e,t,n){n=Math.min(e.i.length,n);var r=e.l?d(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{e1(e,function(e,n){let i=e;h(e)&&(i=ec(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),r}function tj(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;k||L(),N||(k(),N=!0),O.add(t,e),e.v=0}}function tz(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eA(d(e.Fa,e),tH(e,e.v)),e.v++,!0)}function t$(e){null!=e.A&&(l.clearTimeout(e.A),e.A=null)}function tK(e){e.g=new eR(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e5(e.qa);e9(t,"RID","rpc"),e9(t,"SID",e.K),e9(t,"AID",e.T),e9(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&e9(t,"TO",e.ja),e9(t,"TYPE","xmlhttp"),tB(e,t),e.m&&e.o&&tI(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=e7(e5(t)),n.m=null,n.P=!0,eU(n,e)}function tG(e){null!=e.C&&(l.clearTimeout(e.C),e.C=null)}function tQ(e,t){var n=null;if(e.g==t){tG(e),t$(e),e.g=null;var r=2}else{if(!eJ(e.h,t))return;n=t.D,eZ(e.h,t),r=1}if(0!=e.G){if(t.o){if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i,s=e.B;ei(r=eI(),new eC(r,n,t,s)),tV(e)}else tj(e)}else if(3==(s=t.s)||0==s&&0<t.X||!(1==r&&(i=t,!(eY(e.h)>=e.h.j-+!!e.s)&&(e.s?(e.i=i.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eA(d(e.Ga,e,i),tH(e,e.B)),e.B++,!0)))||2==r&&tz(e)))switch(n&&0<n.length&&((t=e.h).i=t.i.concat(n)),s){case 1:tW(e,5);break;case 4:tW(e,10);break;case 3:tW(e,6);break;default:tW(e,2)}}}function tH(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function tW(e,t){if(e.j.info("Error code "+t),2==t){var n=d(e.fb,e),r=e.Xa;let t=!r;r=new e6(r||"//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||e3(r,"https"),e7(r),t?function(e,t){let n=new eD;if(l.Image){let r=new Image;r.onload=g(tg,n,"TestLoadImage: loaded",!0,t,r),r.onerror=g(tg,n,"TestLoadImage: error",!1,t,r),r.onabort=g(tg,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=g(tg,n,"TestLoadImage: timeout",!1,t,r),l.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){let n=new eD,r=new AbortController,i=setTimeout(()=>{r.abort(),tg(n,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(i),e.ok?tg(n,"TestPingServer: ok",!0,t):tg(n,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(i),tg(n,"TestPingServer: error",!1,t)})}(r.toString(),n)}else eS(2);e.G=0,e.l&&e.l.sa(t),tY(e),tF(e)}function tY(e){if(e.G=0,e.ka=[],e.l){let t=e0(e.h);(0!=t.length||0!=e.i.length)&&(y(e.ka,t),y(e.ka,e.i),e.h.i.length=0,m(e.i),e.i.length=0),e.l.ra()}}function tJ(e,t,n){var r=n instanceof e6?e5(n):new e6(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e4(r,r.s);else{var i=l.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new e6(null);r&&e3(s,r),t&&(s.g=t),i&&e4(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&e9(r,n,t),e9(r,"VER",e.la),tB(e,r),r}function tX(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tE(e.Ca&&!e.pa?new tm({eb:n}):e.pa)).Ha(e.J),t}function tZ(){}function t0(){}function t1(e,t){er.call(this),this.g=new tR(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!w(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!w(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t5(this)}function t2(e){ev.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t6(){ew.call(this),this.status=1}function t5(e){this.g=e}(i=tE.prototype).Ha=function(e){this.J=e},i.ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():r.g(),this.v=this.o?ep(this.o):ep(r),this.g.onreadystatechange=d(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){tS(this,e);return}if(e=n||"",n=new Map(this.headers),i){if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i))}for(let[r,a]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=l.FormData&&e instanceof l.FormData,!(0<=Array.prototype.indexOf.call(tx,t,void 0))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(r,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tk(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tS(this,e)}},i.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ei(this,"complete"),ei(this,"abort"),tD(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tD(this,!0)),tE.aa.N.call(this)},i.Ea=function(){this.s||(this.B||this.u||this.j?tA(this):this.bb())},i.bb=function(){tA(this)},i.isActive=function(){return!!this.g},i.Z=function(){try{return 2<tN(this)?this.g.status:-1}catch(e){return -1}},i.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},i.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ef(t)}},i.Ba=function(){return this.m},i.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(i=tR.prototype).la=8,i.G=1,i.connect=function(e,t,n,r){eS(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=tJ(this,null,this.W),tV(this)},i.Ga=function(e){if(this.s){if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eR(this,this.j,e),s=this.o;if(this.S&&(s?S(s=T(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tq(this,i,t),e9(n=e5(this.I),"RID",e),e9(n,"CVER",22),this.D&&e9(n,"X-HTTP-Session-Id",this.D),tB(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(t_(s)))+"&"+t:this.m&&tI(n,this.m,s)),eX(this.h,i),this.Ua&&e9(n,"TYPE","init"),this.P?(e9(n,"$req",t),e9(n,"SID","null"),i.T=!0,eV(i,n,null)):eV(i,n,t),this.G=2}}else 3==this.G&&(e?tU(this,e):0==this.i.length||eW(this.h)||tU(this))}},i.Fa=function(){if(this.u=null,tK(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eA(d(this.ab,this),e)}},i.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eS(10),tP(this),tK(this))},i.Za=function(){null!=this.C&&(this.C=null,tP(this),tz(this),eS(19))},i.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eS(2)):(this.j.info("Failed to ping google.com"),eS(1))},i.isActive=function(){return!!this.l&&this.l.isActive(this)},(i=tZ.prototype).ua=function(){},i.ta=function(){},i.sa=function(){},i.ra=function(){},i.isActive=function(){return!0},i.Na=function(){},t0.prototype.g=function(e,t){return new t1(e,t)},p(t1,er),t1.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t1.prototype.close=function(){tM(this.g)},t1.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ec(e),e=n);t.i.push(new eQ(t.Ya++,e)),3==t.G&&tV(t)},t1.prototype.N=function(){this.g.l=null,delete this.j,tM(this.g),delete this.g,t1.aa.N.call(this)},p(t2,ev),p(t6,ew),p(t5,tZ),t5.prototype.ua=function(){ei(this.g,"a")},t5.prototype.ta=function(e){ei(this.g,new t2(e))},t5.prototype.sa=function(e){ei(this.g,new t6(e))},t5.prototype.ra=function(){ei(this.g,"b")},t0.prototype.createWebChannel=t0.prototype.g,t1.prototype.send=t1.prototype.o,t1.prototype.open=t1.prototype.m,t1.prototype.close=t1.prototype.close,e.exports.createWebChannelTransport=function(){return new t0},e.exports.getStatEventTarget=function(){return eI()},e.exports.Event=eb,e.exports.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eN.NO_ERROR=0,eN.TIMEOUT=8,eN.HTTP_ERROR=6,e.exports.ErrorCode=eN,eO.COMPLETE="complete",e.exports.EventType=eO,em.EventType=ey,ey.OPEN="a",ey.CLOSE="b",ey.ERROR="c",ey.MESSAGE="d",er.prototype.listen=er.prototype.K,e.exports.WebChannel=em,e.exports.FetchXmlHttpFactory=tm,tE.prototype.listenOnce=tE.prototype.L,tE.prototype.getLastError=tE.prototype.Ka,tE.prototype.getLastErrorCode=tE.prototype.Ba,tE.prototype.getStatus=tE.prototype.Z,tE.prototype.getResponseJson=tE.prototype.Oa,tE.prototype.getResponseText=tE.prototype.oa,tE.prototype.send=tE.prototype.ea,tE.prototype.setWithCredentials=tE.prototype.Ha,e.exports.XhrIo=tE}).apply(void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},5006:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1144);Object.keys(r).forEach(function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},5695:(e,t,n)=>{"use strict";var r=n(8999);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},7061:(e,t,n)=>{(function(){"use strict";function t(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478&0xffffffff;a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[1]+0xe8c7b756&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[2]+0x242070db&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[3]+0xc1bdceee&0xffffffff,a=t+(s^(n=i+(a<<22&0xffffffff|a>>>10))&(i^s))+r[4]+0xf57c0faf&0xffffffff,a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[5]+0x4787c62a&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[6]+0xa8304613&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[7]+0xfd469501&0xffffffff,a=t+(s^(n=i+(a<<22&0xffffffff|a>>>10))&(i^s))+r[8]+0x698098d8&0xffffffff,a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[9]+0x8b44f7af&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[10]+0xffff5bb1&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[11]+0x895cd7be&0xffffffff,a=t+(s^(n=i+(a<<22&0xffffffff|a>>>10))&(i^s))+r[12]+0x6b901122&0xffffffff,a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[13]+0xfd987193&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[14]+0xa679438e&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[15]+0x49b40821&0xffffffff,n=i+(a<<22&0xffffffff|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa&0xffffffff,n=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8&0xffffffff,n=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed&0xffffffff,n=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a&0xffffffff,a=t+((n=i+(a<<20&0xffffffff|a>>>12))^i^s)+r[5]+0xfffa3942&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[8]+0x8771f681&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[11]+0x6d9d6122&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[14]+0xfde5380c&0xffffffff,a=t+((n=i+(a<<23&0xffffffff|a>>>9))^i^s)+r[1]+0xa4beea44&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[4]+0x4bdecfa9&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[7]+0xf6bb4b60&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[10]+0xbebfbc70&0xffffffff,a=t+((n=i+(a<<23&0xffffffff|a>>>9))^i^s)+r[13]+0x289b7ec6&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[0]+0xeaa127fa&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[3]+0xd4ef3085&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[6]+0x4881d05&0xffffffff,a=t+((n=i+(a<<23&0xffffffff|a>>>9))^i^s)+r[9]+0xd9d4d039&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[12]+0xe6db99e5&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[15]+0x1fa27cf8&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[2]+0xc4ac5665&0xffffffff,n=i+(a<<23&0xffffffff|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039&0xffffffff,n=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1&0xffffffff,n=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1&0xffffffff,n=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391&0xffffffff,e.g[0]=e.g[0]+t&0xffffffff,e.g[1]=e.g[1]+(i+(a<<21&0xffffffff|a>>>11))&0xffffffff,e.g[2]=e.g[2]+i&0xffffffff,e.g[3]=e.g[3]+s&0xffffffff}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,s=this.h,a=0;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i,s={};function a(e){var t;return -128<=e&&128>e?Object.prototype.hasOwnProperty.call(s,e)?s[e]:s[e]=new r([0|(t=e)],0>t?-1:0):new r([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return l;if(0>e)return d(o(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=0x100000000;return new r(t,0)}var l=a(0),u=a(1),h=a(0x1000000);function c(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function d(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(u)}function g(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function y(e,t){if(c(t))throw Error("division by zero");if(c(e))return new m(l,l);if(f(e))return t=y(d(e),t),new m(d(t.g),d(t.h));if(f(t))return t=y(e,d(t)),new m(d(t.g),t.h);if(30<e.g.length){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,r=t;0>=r.l(e);)n=v(n),r=v(r);var i=w(n,1),s=w(r,1);for(r=w(r,2),n=w(n,2);!c(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=w(r,1),n=w(n,1)}return t=g(e,i.j(t)),new m(i,t)}for(i=l;0<=e.l(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=o(n)).j(t);f(a)||0<a.l(e);)n-=r,a=(s=o(n)).j(t);c(s)&&(s=u),i=i.add(s),e=g(e,a)}return new m(i,e)}function v(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function w(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],a=0;a<i;a++)s[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new r(s,e.h)}(i=r.prototype).m=function(){if(f(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:0x100000000+r)*t,t*=0x100000000}return e},i.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(c(this))return"0";if(f(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,r="";;){var i=y(n,t).g,s=((0<(n=g(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(c(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},i.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},i.l=function(e){return f(e=g(this,e))?-1:+!c(e)},i.abs=function(){return f(this)?d(this):this},i.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var a=i+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=o>>>16,a&=65535,o&=65535,n[s]=o<<16|a}return new r(n,-0x80000000&n[n.length-1]?-1:0)},i.j=function(e){if(c(this)||c(e))return l;if(f(this))return f(e)?d(this).j(d(e)):d(d(this).j(e));if(f(e))return d(this.j(d(e)));if(0>this.l(h)&&0>e.l(h))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var a=this.i(i)>>>16,u=65535&this.i(i),g=e.i(s)>>>16,m=65535&e.i(s);n[2*i+2*s]+=u*m,p(n,2*i+2*s),n[2*i+2*s+1]+=a*m,p(n,2*i+2*s+1),n[2*i+2*s+1]+=u*g,p(n,2*i+2*s+1),n[2*i+2*s+2]+=a*g,p(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},i.A=function(e){return y(this,e).h},i.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},i.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},i.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,e.exports.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=l,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),u=parseInt(t.substring(s,s+a),n);8>a?(a=o(Math.pow(n,a)),i=i.j(a).add(o(u))):i=(i=i.j(r)).add(o(u))}return i},e.exports.Integer=r}).apply(void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},8560:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultsFromPostinstall=()=>void 0},8793:(e,t,n)=>{"use strict";var r=n(9509);Object.defineProperty(t,"__esModule",{value:!0});var i=n(8560);let s={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},a=function(e,t){if(!e)throw o(t)},o=function(e){return Error("Firebase Database ("+s.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},l=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},u=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[n++],a=((7&i)<<18|(63&s)<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},h={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,f=63&l;o||(f=64,s||(c=64)),r.push(n[u],n[h],n[c],n[f])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(l(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):u(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new c;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class c extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let f=function(e){let t=l(e);return h.encodeByteArray(t,!0)},d=function(e){return f(e).replace(/\./g,"")},g=function(e){try{return h.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function p(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(let n in t)if(t.hasOwnProperty(n)&&"__proto__"!==n)e[n]=p(e[n],t[n]);return e}function m(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw Error("Unable to locate global object.")}let y=()=>m().__FIREBASE_DEFAULTS__,v=()=>{if(void 0===r||void 0===r.env)return;let e=r.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},w=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&g(e[1]);return t&&JSON.parse(t)},b=()=>{try{return i.getDefaultsFromPostinstall()||y()||v()||w()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},_=e=>{var t,n;return null===(n=null===(t=b())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]};class I{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function E(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function T(){var e;let t=null===(e=b())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function x(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}class S extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,C.prototype.create)}}class C{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,r=i,n.replace(A,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new S(s,l,i)}}let A=/\{\$([^}]+)}/g;function D(e){return JSON.parse(e)}let k=function(e){let t={},n={},r={},i="";try{let s=e.split(".");t=D(g(s[0])||""),n=D(g(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}};function N(e){return null!==e&&"object"==typeof e}class O{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,r;t||(t=0);let i=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)i[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)i[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],a=this.chain_[1],o=this.chain_[2],l=this.chain_[3],u=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^a&(o^l),r=0x5a827999):(n=a^o^l,r=0x6ed9eba1):e<60?(n=a&o|l&(a|o),r=0x8f1bbcdc):(n=a^o^l,r=0xca62c1d6);let t=(s<<5|s>>>27)+n+u+r+i[e]&0xffffffff;u=l,l=o,o=(a<<30|a>>>2)&0xffffffff,a=s,s=t}this.chain_[0]=this.chain_[0]+s&0xffffffff,this.chain_[1]=this.chain_[1]+a&0xffffffff,this.chain_[2]=this.chain_[2]+o&0xffffffff,this.chain_[3]=this.chain_[3]+l&0xffffffff,this.chain_[4]=this.chain_[4]+u&0xffffffff}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}class L{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(r.next=R),void 0===r.error&&(r.error=R),void 0===r.complete&&(r.complete=R);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){!this.finalized&&(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function R(){}function M(e,t){return`${e} failed: ${t} argument `}t.CONSTANTS=s,t.DecodeBase64StringError=c,t.Deferred=I,t.ErrorFactory=C,t.FirebaseError=S,t.MAX_VALUE_MILLIS=144e5,t.RANDOM_FACTOR=.5,t.Sha1=O,t.areCookiesEnabled=function(){return"undefined"!=typeof navigator&&!!navigator.cookieEnabled},t.assert=a,t.assertionError=o,t.async=function(e,t){return(...n)=>{Promise.resolve(!0).then(()=>{e(...n)}).catch(e=>{t&&t(e)})}},t.base64=h,t.base64Decode=g,t.base64Encode=f,t.base64urlEncodeWithoutPadding=d,t.calculateBackoffMillis=function(e,t=1e3,n=2){let r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)},t.contains=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.createMockUserToken=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[d(JSON.stringify({alg:"none",type:"JWT"})),d(JSON.stringify(s)),""].join(".")},t.createSubscribe=function(e,t){let n=new L(e,t);return n.subscribe.bind(n)},t.decode=k,t.deepCopy=function(e){return p(void 0,e)},t.deepEqual=function e(t,n){if(t===n)return!0;let r=Object.keys(t),i=Object.keys(n);for(let s of r){if(!i.includes(s))return!1;let r=t[s],a=n[s];if(N(r)&&N(a)){if(!e(r,a))return!1}else if(r!==a)return!1}for(let e of i)if(!r.includes(e))return!1;return!0},t.deepExtend=p,t.errorPrefix=M,t.extractQuerystring=function(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)},t.getDefaultAppConfig=()=>{var e;return null===(e=b())||void 0===e?void 0:e.config},t.getDefaultEmulatorHost=_,t.getDefaultEmulatorHostnameAndPort=e=>{let t=_(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},t.getDefaults=b,t.getExperimentalSetting=e=>{var t;return null===(t=b())||void 0===t?void 0:t[`_${e}`]},t.getGlobal=m,t.getModularInstance=function(e){return e&&e._delegate?e._delegate:e},t.getUA=E,t.isAdmin=function(e){let t=k(e).claims;return"object"==typeof t&&!0===t.admin},t.isBrowser=function(){return"undefined"!=typeof window||x()},t.isBrowserExtension=function(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id},t.isCloudflareWorker=function(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent},t.isElectron=function(){return E().indexOf("Electron/")>=0},t.isEmpty=function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},t.isIE=function(){let e=E();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0},t.isIndexedDBAvailable=function(){try{return"object"==typeof indexedDB}catch(e){return!1}},t.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(E())},t.isNode=T,t.isNodeSdk=function(){return!0===s.NODE_CLIENT||!0===s.NODE_ADMIN},t.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},t.isSafari=function(){return!T()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")},t.isUWP=function(){return E().indexOf("MSAppHost/")>=0},t.isValidFormat=function(e){let t=k(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},t.isValidTimestamp=function(e){let t=k(e).claims,n=Math.floor(new Date().getTime()/1e3),r=0,i=0;return"object"==typeof t&&(t.hasOwnProperty("nbf")?r=t.nbf:t.hasOwnProperty("iat")&&(r=t.iat),i=t.hasOwnProperty("exp")?t.exp:r+86400),!!n&&!!r&&!!i&&n>=r&&n<=i},t.isWebWorker=x,t.issuedAtTime=function(e){let t=k(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?t.iat:null},t.jsonEval=D,t.map=function(e,t,n){let r={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r},t.ordinal=function(e){return Number.isFinite(e)?e+function(e){let t=(e=Math.abs(e))%100;if(t>=10&&t<=20)return"th";let n=e%10;return 1===n?"st":2===n?"nd":3===n?"rd":"th"}(e):`${e}`},t.promiseWithTimeout=function(e,t=2e3){let n=new I;return setTimeout(()=>n.reject("timeout!"),t),e.then(n.resolve,n.reject),n.promise},t.querystring=function(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""},t.querystringDecode=function(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t},t.safeGet=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0},t.stringLength=function(e){let t=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t},t.stringToByteArray=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){let t=i-55296;a(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},t.stringify=function(e){return JSON.stringify(e)},t.validateArgCount=function(e,t,n,r){let i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")},t.validateCallback=function(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw Error(M(e,t)+"must be a valid function.")},t.validateContextObject=function(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw Error(M(e,t)+"must be a valid context object.")},t.validateIndexedDBOpenable=function(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})},t.validateNamespace=function(e,t,n){if((!n||t)&&"string"!=typeof t)throw Error(M(e,"namespace")+"must be a valid firebase namespace.")}},9438:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9910),i=n(3517),s=n(8793),a=n(6984);class o{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let l="@firebase/app",u="0.11.2",h=new i.Logger("@firebase/app"),c="[DEFAULT]",f={[l]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},d=new Map,g=new Map,p=new Map;function m(e,t){try{e.container.addComponent(t)}catch(n){h.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function y(e){let t=e.name;if(p.has(t))return h.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(p.set(t,e),d.values()))m(n,e);for(let t of g.values())m(t,e);return!0}function v(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function w(e){return void 0!==e.options}let b=new s.ErrorFactory("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class _{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw b.create("app-deleted",{appName:this._name})}}function I(e,t){let n=s.base64Decode(e.split(".")[1]);if(null===n){console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`);return}if(void 0===JSON.parse(n).exp){console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`);return}let r=1e3*JSON.parse(n).exp;r-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class E extends _{constructor(e,t,n,r){let i=void 0!==t.automaticDataCollectionEnabled&&t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig=Object.assign({automaticDataCollectionEnabled:i},t),this._serverConfig.authIdToken&&I(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&I(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,S(l,u,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){!this.isDeleted&&(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){x(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw b.create("server-app-deleted")}}function T(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i=Object.assign({name:c,automaticDataCollectionEnabled:!1},t),a=i.name;if("string"!=typeof a||!a)throw b.create("bad-app-name",{appName:String(a)});if(n||(n=s.getDefaultAppConfig()),!n)throw b.create("no-options");let o=d.get(a);if(o){if(s.deepEqual(n,o.options)&&s.deepEqual(i,o.config))return o;throw b.create("duplicate-app",{appName:a})}let l=new r.ComponentContainer(a);for(let e of p.values())l.addComponent(e);let u=new _(n,i,l);return d.set(a,u),u}async function x(e){let t=!1,n=e.name;d.has(n)?(t=!0,d.delete(n)):g.has(n)&&0>=e.decRefCount()&&(g.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function S(e,t,n){var i;let s=null!==(i=f[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);let a=s.match(/\s|\//),o=t.match(/\s|\//);if(a||o){let e=[`Unable to register library "${s}" with version "${t}":`];a&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),a&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),h.warn(e.join(" "));return}y(new r.Component(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}let C="firebase-heartbeat-store",A=null;function D(){return A||(A=a.openDB("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(C)}catch(e){console.warn(e)}}}).catch(e=>{throw b.create("idb-open",{originalErrorMessage:e.message})})),A}async function k(e){try{let t=(await D()).transaction(C),n=await t.objectStore(C).get(O(e));return await t.done,n}catch(e){if(e instanceof s.FirebaseError)h.warn(e.message);else{let t=b.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});h.warn(t.message)}}}async function N(e,t){try{let n=(await D()).transaction(C,"readwrite"),r=n.objectStore(C);await r.put(t,O(e)),await n.done}catch(e){if(e instanceof s.FirebaseError)h.warn(e.message);else{let t=b.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});h.warn(t.message)}}}function O(e){return`${e.name}!${e.options.appId}`}class L{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new M(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=R();if((null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){h.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=R(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),P(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),P(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=s.base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return h.warn(e),""}}}function R(){return new Date().toISOString().substring(0,10)}class M{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!s.isIndexedDBAvailable()&&s.validateIndexedDBOpenable().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await k(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return N(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return N(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function P(e){return s.base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:e})).length}y(new r.Component("platform-logger",e=>new o(e),"PRIVATE")),y(new r.Component("heartbeat",e=>new L(e),"PRIVATE")),S(l,u,"node"),S(l,u,"cjs2017"),S("fire-js",""),Object.defineProperty(t,"FirebaseError",{enumerable:!0,get:function(){return s.FirebaseError}}),t.SDK_VERSION="11.4.0",t._DEFAULT_ENTRY_NAME=c,t._addComponent=m,t._addOrOverwriteComponent=function(e,t){e.container.addOrOverwriteComponent(t)},t._apps=d,t._clearComponents=function(){p.clear()},t._components=p,t._getProvider=v,t._isFirebaseApp=w,t._isFirebaseServerApp=function(e){return null!=e&&void 0!==e.settings},t._registerComponent=y,t._removeServiceInstance=function(e,t,n=c){v(e,t).clearInstance(n)},t._serverApps=g,t.deleteApp=x,t.getApp=function(e=c){let t=d.get(e);if(!t&&e===c&&s.getDefaultAppConfig())return T();if(!t)throw b.create("no-app",{appName:e});return t},t.getApps=function(){return Array.from(d.values())},t.initializeApp=T,t.initializeServerApp=function(e,t){let n;if(s.isBrowser()&&!s.isWebWorker())throw b.create("invalid-server-app-environment");void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!1),n=w(e)?e.options:e;let i=Object.assign(Object.assign({},t),n);if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==t.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw b.create("finalization-registry-not-supported",{});let a=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),o=g.get(a);if(o)return o.incRefCount(t.releaseOnDeref),o;let l=new r.ComponentContainer(a);for(let e of p.values())l.addComponent(e);let u=new E(n,t,a,l);return g.set(a,u),u},t.onLog=function(e,t){if(null!==e&&"function"!=typeof e)throw b.create("invalid-log-argument");i.setUserLogHandler(e,t)},t.registerVersion=S,t.setLogLevel=function(e){i.setLogLevel(e)}},9910:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8793);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let s="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new r.Deferred;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===s?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}return r||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class o{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}t.Component=i,t.ComponentContainer=o,t.Provider=a}}]);