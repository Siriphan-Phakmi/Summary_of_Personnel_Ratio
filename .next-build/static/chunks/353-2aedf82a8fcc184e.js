"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[353],{207:(e,t,r)=>{r.d(t,{vK:()=>C,fO:()=>h,C9:()=>c,iu:()=>x,BL:()=>m,Ay:()=>M.A,Q$:()=>o,hv:()=>f,rl:()=>u});var a=r(5155),n=r(5112),s=r(4197),l=r(4279);let i=new Map,o=async e=>{try{if(!e)return console.warn("fetchDatesWithData: selectedWard is undefined or null"),[];let t=(0,n.P)((0,n.rJ)(s.db,"wardDailyRecords"),(0,n._M)("wardId","==",e)),r=await (0,n.GG)(t),a=[];return r.forEach(e=>{let t=e.data();if(t.date){let e=new Date(t.date);isNaN(e.getTime())||a.push(e)}}),a}catch(e){return console.error("Error fetching dates with data:",e),[]}},d=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{let a;if(!t)return console.warn("fetchApprovalData: targetWard is undefined or null"),null;let i=(0,l.Ol)(new Date(e));a=r?(0,n.P)((0,n.rJ)(s.db,"wardDailyRecords"),(0,n._M)("wardId","==",t),(0,n._M)("date","==",i),(0,n._M)("shift","==",r)):(0,n.P)((0,n.rJ)(s.db,"wardDailyRecords"),(0,n._M)("wardId","==",t),(0,n._M)("date","==",i));let o=await (0,n.GG)(a);if(o.empty)return null;if(r){if(!o.empty){let e=o.docs[0],t=e.data();return{id:e.id,recorded:!0,approved:t.isApproved||!1,approvedBy:t.approvedBy,approvedAt:t.approvedAt,isDraft:t.isDraft||!1}}return null}let d={};return o.forEach(e=>{let t=e.data();d[t.shift]={id:e.id,recorded:!0,approved:t.isApproved||!1,approvedBy:t.approvedBy,approvedAt:t.approvedAt,isDraft:t.isDraft||!1}}),d}catch(e){return console.error("Error fetching approval data:",e),null}},c=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{let a=await d(e,t,r);if(!a)return{status:"not_recorded",message:"ยังไม่มีการบันทึกข้อมูล"};if(r){if(a.isDraft)return{status:"draft",message:"อยู่ในสถานะฉบับร่าง"};if(a.approved)return{status:"approved",message:"ได้รับการอนุมัติแล้ว",approvedBy:a.approvedBy,approvedAt:a.approvedAt};return{status:"pending_approval",message:"รอการอนุมัติ"}}let n={};return["เช้า","ดึก"].forEach(e=>{a[e]?a[e].isDraft?n[e]={status:"draft",message:"อยู่ในสถานะฉบับร่าง"}:a[e].approved?n[e]={status:"approved",message:"ได้รับการอนุมัติแล้ว",approvedBy:a[e].approvedBy,approvedAt:a[e].approvedAt}:n[e]={status:"pending_approval",message:"รอการอนุมัติ"}:n[e]={status:"not_recorded",message:"ยังไม่มีการบันทึกข้อมูล"}}),n}catch(e){return console.error("Error checking approval status:",e),{status:"error",message:"เกิดข้อผิดพลาดในการตรวจสอบสถานะ"}}},u=async(e,t,r)=>{console.log("fetchWardData called with:",{date:e,selectedWard:t,selectedShift:r});try{if(!e||!t||!r)return console.warn("fetchWardData: Missing required parameters",{date:e,selectedWard:t,selectedShift:r}),null;let a=new Date(e),o=(0,l.Ol)(a),d="".concat(o,"_").concat(t,"_").concat(r),c=i.get(d);if(c&&Date.now()-c.timestamp<6e4)return console.log("Returning cached data for:",d),c.data;console.log("Fetching ward data from Firestore:",{dateString:o,selectedWard:t,selectedShift:r});try{let e=(0,n.P)((0,n.rJ)(s.db,"wardDailyRecords"),(0,n._M)("date","==",o),(0,n._M)("wardId","==",t),(0,n._M)("shift","==",r)),a=await (0,n.GG)(e);if(a.empty)return console.log("No data found for ".concat(t," on ").concat(o,", shift: ").concat(r)),null;let l=a.docs[0],c=l.data(),u={id:l.id,patientCensus:c.patientCensus||"",overallData:c.overallData||"",newAdmit:c.newAdmit||"",transferIn:c.transferIn||"",referIn:c.referIn||"",transferOut:c.transferOut||"",referOut:c.referOut||"",discharge:c.discharge||"",dead:c.dead||"",rns:c.rns||"",pns:c.pns||"",nas:c.nas||"",aides:c.aides||"",studentNurses:c.studentNurses||"",notes:c.notes||"",date:c.date,shift:c.shift,wardId:c.wardId,isApproved:c.isApproved||!1,approvedBy:c.approvedBy||null,approvalDate:c.approvalDate||null,firstName:c.firstName||"",lastName:c.lastName||"",isDraft:c.isDraft||!1};return i.set(d,{data:u,timestamp:Date.now()}),u}catch(e){if("failed-precondition"===e.code&&e.message&&e.message.includes("index")){console.warn("Index error encountered, trying alternative query...");try{return await g(o,t,r)}catch(e){return console.error("Fallback query also failed:",e),null}}throw e}}catch(e){return console.error("Error fetching ward data:",e),null}},m=async(e,t)=>{try{if(!e||!t)return console.error("checkMorningShiftDataExists: Missing required parameters",{date:e,wardId:t}),!1;let r=new Date(e),a=(0,l.Ol)(r),i=(0,n.P)((0,n.rJ)(s.db,"wardDailyRecords"),(0,n._M)("wardId","==",t),(0,n._M)("date","==",a),(0,n._M)("shift","==","เช้า"));return!(await (0,n.GG)(i)).empty}catch(e){return console.error("Error checking morning shift data:",e),!1}},g=async(e,t,r)=>{try{let a=(0,n.P)((0,n.rJ)(s.db,"wardDailyRecords"),(0,n._M)("wardId","==",t)),l=await (0,n.GG)(a);if(l.empty)return null;let i=null;if(l.forEach(t=>{let a=t.data();a.date===e&&a.shift===r&&(i={id:t.id,...a})}),!i)return null;return{id:i.id,patientCensus:i.patientCensus||"",overallData:i.overallData||"",newAdmit:i.newAdmit||"",transferIn:i.transferIn||"",referIn:i.referIn||"",transferOut:i.transferOut||"",referOut:i.referOut||"",discharge:i.discharge||"",dead:i.dead||"",rns:i.rns||"",pns:i.pns||"",nas:i.nas||"",aides:i.aides||"",studentNurses:i.studentNurses||"",notes:i.notes||"",date:i.date,shift:i.shift,wardId:i.wardId,isApproved:i.isApproved||!1,approvedBy:i.approvedBy||null,approvalDate:i.approvalDate||null,firstName:i.firstName||"",lastName:i.lastName||"",isDraft:i.isDraft||!1}}catch(e){return console.error("Error in safeFetchWardData:",e),null}},h=e=>{if(!e)return"0";let t=parseInt(e.newAdmit||"0"),r=parseInt(e.transferIn||"0"),a=parseInt(e.referIn||"0"),n=parseInt(e.transferOut||"0"),s=parseInt(e.referOut||"0");return String(t+r+a-(n+s+parseInt(e.discharge||"0")+parseInt(e.dead||"0")))},f=async e=>{try{if(!e)return null;let t=(0,n.P)((0,n.rJ)(s.db,"wardDailyRecords"),(0,n._M)("wardId","==",e)),r=await (0,n.GG)(t);if(r.empty)return null;let a=new Date;a.setDate(a.getDate()-7);let i=(0,l.Ol)(a),o=[];return r.forEach(e=>{let t=e.data();t.date>=i&&o.push({id:e.id,...t})}),o.sort((e,t)=>t.date.localeCompare(e.date)),o.length>0?o[0]:null}catch(e){return console.error("Error fetching last 7 days data:",e),null}},x=async(e,t,r)=>{try{let a=await checkApprovalStatus(e,t,r);if(a&&"approved"===a.status)return{canEdit:!1,message:"ข้อมูลนี้ได้รับการอนุมัติแล้ว ไม่สามารถแก้ไขได้"};return{canEdit:!0}}catch(e){return console.error("Error checking final approval status:",e),{canEdit:!0}}};var p=r(2115);r(907);var b=r(4776),y=r(4822),v=r(4875);let w=e=>{let{selectedDate:t,onDateSelect:r,onDateChange:n,datesWithData:s=[],showCalendar:l,setShowCalendar:i,thaiDate:o,selectedShift:d,onShiftChange:c,theme:u="light"}=e,[m,g]=(0,p.useState)(new Date),[h,f]=(0,p.useState)(!1);(0,p.useEffect)(()=>{let e=setInterval(()=>{g(new Date)},1e3);return()=>clearInterval(e)},[]);let x="function"==typeof i?i:e=>{"function"==typeof i?i(e):(f(e),console.warn("Using local state for showCalendar in FormDateShiftSelector"))};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(y.A,{selectedDate:t,onDateSelect:e=>{"function"==typeof r?r(e):"function"==typeof n?(n(e),console.warn("Using onDateChange instead of onDateSelect in FormDateShiftSelector")):console.warn("Neither onDateSelect nor onDateChange is a function in FormDateShiftSelector")},datesWithData:s,showCalendar:void 0!==l?l:h,setShowCalendar:x,thaiDate:o,theme:u})}),(0,a.jsxs)("div",{className:"ml-4 p-3 rounded-lg ".concat("dark"===u?"bg-gray-800 text-white border border-gray-700":"bg-red-100 text-red-800 border border-red-200"),children:[(0,a.jsx)("div",{className:"text-center font-medium mb-1",children:"เวลาปัจจุบัน"}),(0,a.jsx)("div",{className:"text-xl font-bold",children:m.toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}),(0,a.jsx)("div",{className:"text-xs mt-1 opacity-80",children:m.getHours()>=7&&19>m.getHours()?"อยู่ในช่วงกะเช้า (07:00-19:00)":"อยู่ในช่วงกะดึก (19:00-07:00)"})]})]}),(0,a.jsxs)("div",{className:"".concat("dark"===u?"bg-gray-800/70 border border-gray-700 hover:bg-gray-700/80":"bg-white/60 hover:shadow-md"," backdrop-blur-sm rounded-xl p-4 shadow-sm transition-all"),children:[(0,a.jsxs)("div",{className:"mb-2 font-medium ".concat("dark"===u?"text-gray-100":"text-gray-700"),children:["กะทำงาน ",(0,a.jsx)("span",{className:"text-[#0ab4ab]",children:"*"})]}),(0,a.jsx)(v.A,{selectedShift:d,onShiftChange:e=>{"function"==typeof c?c(e):console.warn("onShiftChange is not a function in FormDateShiftSelector")},variant:"form",theme:u}),(0,a.jsx)("div",{className:"text-xs mt-2 ".concat("dark"===u?"text-gray-400":"text-gray-500"),children:"การเปลี่ยนกะจะทำให้ข้อมูลที่ยังไม่ได้บันทึกหายไป กรุณาบันทึกข้อมูลก่อนเปลี่ยนกะ"})]})]})};var j=r(5493);let N=e=>{let{formData:t,setFormData:r,setHasUnsavedChanges:n,selectedShift:s,theme:l}=e,i=e=>{if(!e)return"";let t=e=>{if(""===e||null==e)return 0;let t=parseInt(e,10);return isNaN(t)?0:t},r=t(e.newAdmit),a=t(e.transferIn),n=t(e.referIn),s=t(e.transferOut),l=t(e.referOut);return r+a+n-s-l-t(e.discharge)-t(e.dead)},o=e=>{let t=e.target.value.replace(/[^0-9]/g,""),a=e.target.name;r(e=>{let r={...e,[a]:t};if(["newAdmit","transferIn","referIn","transferOut","referOut","discharge","dead"].includes(a)){let e=i(r),t=parseInt(r.patientCensus)||0;r.overallData=(t+e).toString()}return r}),n&&n(!0)};return(0,p.useEffect)(()=>{if(t&&t.shift){let e=i(t);"เช้า"===t.shift?r(t=>({...t,patientCensus:e})):r(t=>({...t,overallData:e}))}},[null==t?void 0:t.newAdmit,null==t?void 0:t.transferIn,null==t?void 0:t.referIn,null==t?void 0:t.transferOut,null==t?void 0:t.referOut,null==t?void 0:t.discharge,null==t?void 0:t.dead]),(0,a.jsxs)("div",{className:"mb-6 p-4 rounded-lg shadow-md ".concat("dark"===l?"bg-gray-700 text-white":"bg-primary-pastel"),children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 ".concat("dark"===l?"text-white":"text-primary"),children:"Number of patients and movement"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:["Patient Census ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",name:"patientCensus",value:(null==t?void 0:t.patientCensus)||"",onChange:e=>{let t=e.target.value.replace(/[^0-9]/g,"");r(e=>({...e,patientCensus:t})),n&&n(!0)},className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-gray-100 border-primary-light text-gray-900"),readOnly:!0,inputMode:"numeric",pattern:"[0-9]*"}),"ดึก"===s&&(0,a.jsx)("p",{className:"text-xs mt-1 ".concat("dark"===l?"text-gray-300":"text-gray-500"),children:"*ค่านี้จะถูกคำนวณจากกะเช้าและไม่สามารถแก้ไขได้"}),"เช้า"===s&&(0,a.jsx)("p",{className:"text-xs mt-1 ".concat("dark"===l?"text-gray-300":"text-gray-500"),children:"*คำนวณอัตโนมัติจาก Overall Data ของกะดึกวันก่อนหน้า ไม่สามารถแก้ไขได้"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:["Overall Data ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",name:"overallData",value:(null==t?void 0:t.overallData)||"",className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-gray-100 border-primary-light text-gray-900"),readOnly:!0,inputMode:"numeric",pattern:"[0-9]*"}),(0,a.jsx)("p",{className:"text-xs mt-1 ".concat("dark"===l?"text-gray-300":"text-gray-500"),children:"*คำนวณตามสูตร: Patient Census + (New Admit + Transfer In + Refer In - Transfer Out - Refer Out - Discharge - Dead)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:"New Admit"}),(0,a.jsx)("input",{type:"text",name:"newAdmit",value:(null==t?void 0:t.newAdmit)||"",onChange:o,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:"Transfer In"}),(0,a.jsx)("input",{type:"text",name:"transferIn",value:(null==t?void 0:t.transferIn)||"",onChange:o,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:"Refer In"}),(0,a.jsx)("input",{type:"text",name:"referIn",value:(null==t?void 0:t.referIn)||"",onChange:o,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:"Transfer Out"}),(0,a.jsx)("input",{type:"text",name:"transferOut",value:(null==t?void 0:t.transferOut)||"",onChange:o,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:"Refer Out"}),(0,a.jsx)("input",{type:"text",name:"referOut",value:(null==t?void 0:t.referOut)||"",onChange:o,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:"Discharge"}),(0,a.jsx)("input",{type:"text",name:"discharge",value:(null==t?void 0:t.discharge)||"",onChange:o,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:"Dead"}),(0,a.jsx)("input",{type:"text",name:"dead",value:(null==t?void 0:t.dead)||"",onChange:o,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:"Available"}),(0,a.jsx)("input",{type:"text",name:"availableBeds",value:(null==t?void 0:t.availableBeds)||"",onChange:o,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:"Unavailable"}),(0,a.jsx)("input",{type:"text",name:"unavailable",value:(null==t?void 0:t.unavailable)||"",onChange:o,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===l?"text-gray-200":"text-gray-700"),children:"Planned Discharge"}),(0,a.jsx)("input",{type:"text",name:"plannedDischarge",value:(null==t?void 0:t.plannedDischarge)||"",onChange:o,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===l?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]})]})]})},k=e=>{let{formData:t,setFormData:r,setHasUnsavedChanges:n,theme:s}=e,l=e=>{let t=e.target.value.replace(/[^0-9]/g,""),a=e.target.name;r(e=>({...e,[a]:t})),n&&n(!0)};return(0,a.jsxs)("div",{className:"mb-6 p-4 rounded-lg shadow-md ".concat("dark"===s?"bg-gray-700 text-white":"bg-white"),children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 ".concat("dark"===s?"text-white":"text-primary"),children:"Number of Personnel"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===s?"text-gray-200":"text-gray-700"),children:"Nurse Manager"}),(0,a.jsx)("input",{type:"text",name:"nurseManager",value:(null==t?void 0:t.nurseManager)||"",onChange:l,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===s?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===s?"text-gray-200":"text-gray-700"),children:"RN"}),(0,a.jsx)("input",{type:"text",name:"RN",value:(null==t?void 0:t.RN)||"",onChange:l,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===s?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===s?"text-gray-200":"text-gray-700"),children:"PN"}),(0,a.jsx)("input",{type:"text",name:"PN",value:(null==t?void 0:t.PN)||"",onChange:l,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===s?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===s?"text-gray-200":"text-gray-700"),children:"WC"}),(0,a.jsx)("input",{type:"text",name:"WC",value:(null==t?void 0:t.WC)||"",onChange:l,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===s?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===s?"text-gray-200":"text-gray-700"),children:"NA"}),(0,a.jsx)("input",{type:"text",name:"NA",value:(null==t?void 0:t.NA)||"",onChange:l,className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===s?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),pattern:"[0-9]*",inputMode:"numeric"})]})]})]})},D=e=>{let{formData:t,setFormData:r,setHasUnsavedChanges:n,theme:s}=e;return(0,a.jsxs)("div",{className:"mb-6 p-4 rounded-lg shadow-md ".concat("dark"===s?"bg-gray-700 text-white":"bg-white"),children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 ".concat("dark"===s?"text-white":"text-primary"),children:"Comment"}),(0,a.jsx)("div",{children:(0,a.jsx)("textarea",{name:"comment",value:(null==t?void 0:t.comment)||"",onChange:e=>{r(t=>({...t,comment:e.target.value})),n(!0)},className:"w-full p-2 border rounded focus:ring-2 focus:ring-primary focus:border-transparent ".concat("dark"===s?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),rows:"3",placeholder:"Add comment..."})})]})},C=e=>{let{isLoading:t,selectedDate:r,selectedShift:n,selectedWard:s,formData:l,setFormData:i,handleLocalDateSelect:o,handleShiftChange:d,thaiDate:c,setThaiDate:u,showCalendar:m,setShowCalendar:g,datesWithData:h,theme:f,approvalStatus:x,setHasUnsavedChanges:p,onSaveDraft:y,onSubmit:v,isSubmitting:C,isDraftMode:M}=e;return(0,a.jsxs)("div",{className:"container mx-auto max-w-4xl p-4",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)(w,{selectedDate:r,onDateSelect:o,thaiDate:c,setThaiDate:u,selectedShift:"เช้า"===n?"07:00-19:00":"19:00-07:00",onShiftChange:e=>{"function"==typeof d?d("07:00-19:00"===e?"เช้า":"ดึก"):console.warn("handleShiftChange is not a function in MainFormContent")},showCalendar:m,setShowCalendar:g,datesWithData:h,theme:f}),x&&(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(j.A,{status:x,theme:f})})]}),(0,a.jsx)("div",{className:"space-y-8",children:t?(0,a.jsx)(b.A,{}):r&&n?(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),v()},className:"space-y-6",children:[M&&(0,a.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4 rounded-md",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,a.jsx)("span",{className:"font-medium",children:"โหมดฉบับร่าง:"})," คุณกำลังแก้ไขข้อมูลในโหมดฉบับร่าง กรุณาบันทึกข้อมูลฉบับสมบูรณ์เมื่อกรอกข้อมูลครบถ้วน"]})})]})}),(0,a.jsxs)("div",{className:"p-6 rounded-lg shadow-md border ".concat(M?"bg-yellow-50 border-yellow-200":"dark"===f?"bg-gray-800 border-gray-700 text-white":"bg-white border-gray-200"),children:[(0,a.jsx)(N,{formData:l,setFormData:i,setHasUnsavedChanges:p,selectedShift:n,theme:f}),(0,a.jsx)(k,{formData:l,setFormData:i,setHasUnsavedChanges:p,theme:f}),(0,a.jsx)(D,{formData:l,setFormData:i,setHasUnsavedChanges:p,theme:f}),(0,a.jsx)(S,{formData:l,setFormData:i,setHasUnsavedChanges:p,theme:f}),(0,a.jsx)(I,{onSaveDraft:y,isSubmitting:C})]})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 ".concat("dark"===f?"bg-gray-800 border-gray-700":"bg-gradient-to-r from-teal-50 to-blue-50 border-teal-100"," rounded-lg shadow-md border"),children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-2 ".concat("dark"===f?"text-teal-300":"text-teal-700"),children:"กรุณาเลือกข้อมูลเริ่มต้น"}),(0,a.jsx)("p",{className:"dark"===f?"text-gray-300":"text-gray-600",children:"โปรดเลือกวันที่และกะก่อนเริ่มกรอกข้อมูล"})]}),(0,a.jsx)("div",{className:"w-full max-w-md p-6 rounded-xl shadow-lg border ".concat("dark"===f?"bg-gray-800 border-gray-700":"bg-white border-teal-200"),children:(0,a.jsx)(w,{selectedDate:r,onDateSelect:o,thaiDate:c,setThaiDate:u,selectedShift:"เช้า"===n?"07:00-19:00":"19:00-07:00",onShiftChange:e=>{"function"==typeof d?d("07:00-19:00"===e?"เช้า":"ดึก"):console.warn("handleShiftChange is not a function in MainFormContent")},showCalendar:m,setShowCalendar:g,datesWithData:h,theme:f})})]})})]})},S=e=>{let{formData:t,setFormData:r,setHasUnsavedChanges:n,theme:s}=e;return(0,a.jsxs)("div",{className:"mb-6 p-4 rounded-lg shadow-md ".concat("dark"===s?"bg-gray-700 text-white":"bg-white"),children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold mb-4 ".concat("dark"===s?"text-white":"text-gray-800"),children:["Recording Officer ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===s?"text-gray-200":"text-gray-700"),children:["first name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",name:"firstName",value:t.firstName||"",onChange:e=>{r(t=>({...t,firstName:e.target.value})),n(!0)},className:"w-full p-2 border rounded-md ".concat("dark"===s?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-1 ".concat("dark"===s?"text-gray-200":"text-gray-700"),children:["last name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",name:"lastName",value:t.lastName||"",onChange:e=>{r(t=>({...t,lastName:e.target.value})),n(!0)},className:"w-full p-2 border rounded-md ".concat("dark"===s?"bg-gray-600 border-gray-500 text-white":"bg-white border-gray-300 text-gray-900"),required:!0})]})]})]})},I=e=>{let{onSaveDraft:t,isSubmitting:r}=e;return(0,a.jsxs)("div",{className:"flex flex-wrap justify-center gap-4 mb-8",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md transition",disabled:r,children:r?"กำลังบันทึก...":"Save Draft"}),(0,a.jsx)("button",{type:"submit",className:"px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-md transition",disabled:r,children:r?"กำลังบันทึก...":"Save Final"})]})};var M=r(6455)},907:(e,t,r)=>{r.d(t,{Sw:()=>d,YU:()=>i});var a=r(5155),n=r(2115);let s=(0,n.createContext)(null),l={fire:async e=>window.__alertService?window.__alertService.showAlert(e):(console.warn("AlertProvider is not found. Using fallback alert."),"error"===e.icon||"error"===e.type)?(alert(e.title?"".concat(e.title,": ").concat(e.text||""):e.text),{isConfirmed:!0}):"warning"===e.icon||"warning"===e.type?{isConfirmed:confirm(e.title?"".concat(e.title,": ").concat(e.text||""):e.text)}:(alert(e.title?"".concat(e.title,": ").concat(e.text||""):e.text),{isConfirmed:!0}),success:async(e,t)=>l.fire({title:e,text:t,icon:"success"}),error:async(e,t)=>l.fire({title:e,text:t,icon:"error"}),warning:async function(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return l.fire({title:e,text:t,icon:"warning",showCancelButton:r})},info:async(e,t)=>l.fire({title:e,text:t,icon:"info"}),confirm:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ตกลง",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"ยกเลิก";return l.fire({title:e,text:t,icon:"question",showCancelButton:!0,confirmButtonText:r,cancelButtonText:a})},showLoading:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"กำลังโหลด...";if(window.__alertService)return window.__alertService.showLoading(e);console.log("Loading:",e)},close:()=>{if(window.__alertService)return window.__alertService.closeAll();console.log("Closing alerts")}},i=l,o=e=>{let{id:t,isOpen:r,onClose:s,title:l,text:i,icon:o="info",type:d="info",confirmButtonText:c="ตกลง",cancelButtonText:u="ยกเลิก",onConfirm:m,onCancel:g,showCancelButton:h=!1,allowOutsideClick:f=!0,timer:x=0,html:p=null,customClass:b={}}=e,[y,v]=(0,n.useState)(r),[w,j]=(0,n.useState)(x>0?Math.floor(x/1e3):0),N=o||d;(0,n.useEffect)(()=>{if(!y)return;let e=e=>{"Escape"===e.key&&f&&k(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[y,f]),(0,n.useEffect)(()=>{if(!y||x<=0)return;let e=setInterval(()=>{j(t=>t<=1?(clearInterval(e),setTimeout(()=>k(!0),0),0):t-1)},1e3);return()=>clearInterval(e)},[y,x]);let k=e=>{v(!1),setTimeout(()=>{e?m&&m():g&&g(),s&&s(e)},300)};return r?(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 transition-opacity duration-300 ".concat(y?"opacity-100":"opacity-0 pointer-events-none"," ").concat(f?"cursor-pointer":""),onClick:e=>{e.target===e.currentTarget&&f&&k(!1)},style:{backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(2px)"},children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-2xl max-w-md w-full m-4 transform transition-all duration-300 ".concat(y?"scale-100 opacity-100":"scale-95 opacity-0"," cursor-default ").concat(b.container||""),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"text-center",children:["success"===N&&(0,a.jsx)("div",{className:"mx-auto bg-green-100 p-3 rounded-full w-fit mb-4",children:(0,a.jsx)("svg",{className:"w-10 h-10 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),"error"===N&&(0,a.jsx)("div",{className:"mx-auto bg-red-100 p-3 rounded-full w-fit mb-4",children:(0,a.jsx)("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),"info"===N&&(0,a.jsx)("div",{className:"mx-auto bg-blue-100 p-3 rounded-full w-fit mb-4",children:(0,a.jsx)("svg",{className:"w-10 h-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),"warning"===N&&(0,a.jsx)("div",{className:"mx-auto bg-yellow-100 p-3 rounded-full w-fit mb-4",children:(0,a.jsx)("svg",{className:"w-10 h-10 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),"question"===N&&(0,a.jsx)("div",{className:"mx-auto bg-purple-100 p-3 rounded-full w-fit mb-4",children:(0,a.jsx)("svg",{className:"w-10 h-10 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),"loading"===N&&(0,a.jsx)("div",{className:"mx-auto p-3 w-fit mb-4",children:(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-t-[#0ab4ab] border-r-[#0ab4ab] border-b-gray-200 border-l-gray-200 rounded-full animate-spin"})}),l&&(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2 ".concat(b.title||""),children:l}),i&&(0,a.jsx)("p",{className:"text-gray-600 ".concat(b.text||""),children:i}),p&&(0,a.jsx)("div",{className:"mt-2 ".concat(b.htmlContainer||""),dangerouslySetInnerHTML:{__html:p}}),w>0&&(0,a.jsxs)("div",{className:"mt-3 text-sm text-gray-500",children:["ปิดอัตโนมัติใน ",w," วินาที"]})]}),"loading"!==N&&(0,a.jsxs)("div",{className:"flex justify-center gap-3 mt-6",children:[h&&(0,a.jsx)("button",{onClick:()=>k(!1),className:"px-5 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 ".concat(b.cancelButton||""),children:u}),(0,a.jsx)("button",{onClick:()=>k(!0),className:"px-5 py-2 bg-[#0ab4ab] text-white rounded-md hover:bg-[#099a92] ".concat(b.confirmButton||""),children:c})]})]})})}):null},d=e=>{let{children:t}=e,[r,l]=(0,n.useState)([]),[i,d]=(0,n.useState)(null),c=(0,n.useRef)(0),u=()=>(c.current+=1,"".concat(Date.now(),"-").concat(c.current,"-").concat(Math.random().toString(36).substr(2,5)));(0,n.useEffect)(()=>(window.__alertService={showAlert:m,showLoading:g,closeAll:f},()=>{delete window.__alertService}),[]);let m=e=>new Promise(t=>{let r=u(),a={id:r,isOpen:!0,...e,onClose:e=>{h(r),t({isConfirmed:e})}};l(e=>[...e,a])}),g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"กำลังโหลด...";f();let t=u();return d({id:t,isOpen:!0,title:e,type:"loading",icon:"loading",allowOutsideClick:!1}),t},h=e=>{l(t=>t.map(t=>t.id===e?{...t,isOpen:!1}:t)),setTimeout(()=>{l(t=>t.filter(t=>t.id!==e))},300)},f=()=>{l(e=>e.map(e=>({...e,isOpen:!1}))),i&&(d({...i,isOpen:!1}),setTimeout(()=>{d(null)},300)),setTimeout(()=>{l([])},300)};return(0,a.jsxs)(s.Provider,{value:{showAlert:m,showLoading:g,closeAlert:h,closeAll:f},children:[t,r.map(e=>(0,a.jsx)(o,{...e},e.id)),i&&(0,a.jsx)(o,{...i},"loading-".concat(i.id))]})}},3932:(e,t,r)=>{r.d(t,{DP:()=>i,NP:()=>l});var a=r(5155),n=r(2115);let s=(0,n.createContext)({theme:"light",toggleTheme:()=>{}}),l=e=>{let{children:t}=e,[r,l]=(0,n.useState)("light");return(0,n.useEffect)(()=>{let e=localStorage.getItem("theme")||"light";l(e),"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[]),(0,a.jsx)(s.Provider,{value:{theme:r,toggleTheme:()=>{let e="light"===r?"dark":"light";l(e),localStorage.setItem("theme",e),"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),console.log("Theme changed to ".concat(e," mode"))}},children:(0,a.jsx)("div",{className:"dark"===r?"dark-theme":"light-theme",children:t})})},i=()=>{let e=(0,n.useContext)(s);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},3979:(e,t,r)=>{r.d(t,{Se:()=>a});let a=()=>{let e=new Date().getHours();return e>=7&&e<19?"07:00-19:00":"19:00-07:00"}},4875:(e,t,r)=>{r.d(t,{A:()=>n});var a=r(5155);r(2115);let n=e=>{let{selectedShift:t,onShiftChange:r,variant:n="form",theme:s="light"}=e,l=e=>{"function"==typeof r?r(e):console.warn("onShiftChange is not a function in ShiftSelection")};return(0,a.jsx)("div",{className:"".concat("dark"===s?"bg-gray-800/60 shadow-gray-900 border border-gray-700":"bg-white/60 shadow-gray-200"," backdrop-blur-sm rounded-xl p-3 shadow-sm hover:shadow-md transition-all"),children:(0,a.jsx)("div",{className:"flex flex-col md:flex-row justify-center gap-4",children:("dashboard"===n?[{id:"all",label:"ทั้งวัน",value:"all"},{id:"morning",label:"กะเช้า",value:"07:00-19:00"},{id:"night",label:"กะดึก",value:"19:00-07:00"}]:[{id:"morning",label:"กะเช้า",value:"07:00-19:00"},{id:"night",label:"กะดึก",value:"19:00-07:00"}]).map(e=>{let{id:r,label:n,value:i}=e;return(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsxs)("label",{className:"relative flex items-center gap-2 cursor-pointer group",children:[(0,a.jsx)("input",{type:"radio",name:"shift",value:i,checked:t===i,onChange:()=>l(i),className:"hidden"}),(0,a.jsx)("div",{className:"w-5 h-5 rounded-full border-2 transition-all ".concat(t===i?"border-[#0ab4ab] bg-[#0ab4ab]":"dark"===s?"border-gray-500 group-hover:border-[#0ab4ab]/70":"border-gray-300 group-hover:border-[#0ab4ab]/50"),children:t===i&&(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full m-auto mt-0.5"})}),(0,a.jsxs)("span",{className:"text-sm transition-colors ".concat(t===i?"text-[#0ab4ab] font-medium":"dark"===s?"text-gray-200":"text-gray-600"),children:[n,(0,a.jsxs)("span",{className:"dark"===s?"text-gray-400":"text-gray-500",children:["(",i,")"]})]})]})},r)})})})}},5493:(e,t,r)=>{r.d(t,{A:()=>n});var a=r(5155);r(2115);let n=e=>{let{status:t}=e,{bg:r,text:n,border:s,label:l,icon:i}=(()=>{switch(t){case"approved":return{bg:"bg-green-100",text:"text-green-800",border:"border-green-200",label:"อนุมัติแล้ว",icon:"✅"};case"rejected":return{bg:"bg-red-100",text:"text-red-800",border:"border-red-200",label:"ไม่อนุมัติ",icon:"❌"};case"pending":return{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200",label:"รออนุมัติ",icon:"⏳"};default:return{bg:"bg-gray-100",text:"text-gray-800",border:"border-gray-200",label:"ไม่ระบุสถานะ",icon:"❓"}}})();return(0,a.jsxs)("div",{className:"".concat(r," ").concat(n," ").concat(s," border px-4 py-3 rounded-lg"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 font-medium",children:[(0,a.jsx)("span",{children:i}),(0,a.jsxs)("span",{children:["สถานะ: ",l]})]}),(0,a.jsx)("div",{className:"mt-1 text-sm opacity-80",children:"pending"===t?"ข้อมูลนี้กำลังรอการอนุมัติจาก Supervisor":"approved"===t?"ข้อมูลนี้ได้รับการอนุมัติแล้ว ไม่สามารถแก้ไขได้อีก":"rejected"===t?"ข้อมูลนี้ไม่ได้รับการอนุมัติ กรุณาแก้ไขและบันทึกใหม่":"ไม่พบข้อมูลสถานะการอนุมัติ"})]})}},6455:(e,t,r)=>{r.d(t,{A:()=>x});var a=r(5155),n=r(207),s=r(9310),l=r(2808),i=r(3932),o=r(4279),d=r(3979),c=r(7423),u=r(5112),m=r(4197);let g={fire:async e=>(console.log("SweetAlert2 polyfill fire:",e),{isConfirmed:!0,isDismissed:!1,isDenied:!1,value:!0})};var h=r(2115);r(5493);let f=e=>{let{isOpen:t,onClose:r,ward:n,date:s,shift:l}=e;return t?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm transition-opacity",onClick:r}),(0,a.jsx)("div",{className:"fixed inset-x-0 bottom-0 z-10 transform transition-transform duration-300 ease-in-out",children:(0,a.jsxs)("div",{className:"bg-white rounded-t-2xl shadow-xl max-h-[90vh] overflow-auto",children:[(0,a.jsxs)("div",{className:"sticky top-0 bg-white z-10 px-4 py-3 border-b flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"ประวัติการอนุมัติ"}),(0,a.jsx)("button",{onClick:r,className:"p-1 rounded-full hover:bg-gray-100",children:"✕"})]}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"mb-4 text-sm text-gray-600",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"แผนก:"})," ",(null==n?void 0:n.name)||"-"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"วันที่:"})," ",(null==s?void 0:s.toLocaleDateString("th-TH"))||"-"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"กะ:"})," ",l||"-"]})]}),(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"ไม่พบประวัติการอนุมัติ"})})]})]})})]}):null},x=e=>{let{selectedWard:t,...r}=e,{user:x}=(0,l.A)(),{theme:p}=(0,i.DP)(),[b,y]=(0,h.useState)(!0),[v,w]=(0,h.useState)(null),[j,N]=(0,h.useState)(!1),[k,D]=(0,h.useState)(new Date),[C,S]=(0,h.useState)(()=>{let e=(0,d.Se)();return console.log("Initial shift set to:",e),e}),[I,M]=(0,h.useState)((0,o.Lg)()),[O,A]=(0,h.useState)(!1),[B,_]=(0,h.useState)([]),[E,L]=(0,h.useState)(null),[T,P]=(0,h.useState)(!1),[W,F]=(0,h.useState)(null),[R,G]=(0,h.useState)(null),[z,H]=(0,h.useState)(!1),[U,q]=(0,h.useState)(!1),[J,K]=(0,h.useState)(null),[Q,Y]=(0,h.useState)(!1),[$,V]=(0,h.useState)(!1),[X,Z]=(0,h.useState)(!1),[ee,et]=(0,h.useState)(null),[er,ea]=(0,h.useState)({patientCensus:"",overallData:"",newAdmit:"",transferIn:"",referIn:"",transferOut:"",referOut:"",discharge:"",dead:"",rns:"",pns:"",nas:"",aides:"",studentNurses:"",notes:"",firstName:(null==x?void 0:x.firstName)||"",lastName:(null==x?void 0:x.lastName)||"",isDraft:!1}),[en,es]=(0,h.useState)(!1);(0,h.useEffect)(()=>{let e=setTimeout(()=>{b&&(y(!1),w("การโหลดข้อมูลใช้เวลานานเกินไป กรุณาลองใหม่อีกครั้ง"))},15e3);return()=>clearTimeout(e)},[b]),(0,h.useEffect)(()=>{(async()=>{if(!t||!k){y(!1);return}y(!0),w(null);try{let e=await Promise.race([(0,n.Q$)(t),new Promise((e,t)=>setTimeout(()=>t(Error("Timeout")),1e4))]);_(e);let r=await (0,n.C9)(k,t);F(r),Y("pending"===r),V("approved"===r);let a=await (0,n.rl)(k,t,C);a&&(ea(a),et(a),P(!1)),N(!0)}catch(e){console.error("Error initializing data:",e),w("Timeout"===e.message?"การโหลดข้อมูลใช้เวลานานเกินไป กรุณาลองใหม่อีกครั้ง":"เกิดข้อผิดพลาดในการโหลดข้อมูล กรุณาลองใหม่อีกครั้ง"),g.fire({title:"Error",text:"ไม่สามารถโหลดข้อมูลได้ กรุณาลองใหม่อีกครั้ง",icon:"error",confirmButtonColor:"#0ab4ab",showConfirmButton:!0,confirmButtonText:"ลองใหม่"}).then(e=>{e.isConfirmed&&window.location.reload()})}finally{y(!1)}})()},[t,k,C,x]);let el=async e=>{try{y(!0),D(e),M((0,o.mI)(e));let r=await (0,n.C9)(e,t);F(r),Y("pending"===r),V("approved"===r);let a=await (0,s.zO)(t,e),l=(0,c.A)(e,"yyyy-MM-dd"),i=(0,u.P)((0,u.rJ)(m.db,"wardDataFinal"),(0,u._M)("wardId","==",t),(0,u._M)("date","==",l)),h=await (0,u.GG)(i);if(h.empty){if(a){if(await ei()){if((await g.fire({title:"พบข้อมูลฉบับร่าง",html:"พบข้อมูลฉบับร่างของวันและ ward นี้<br>คุณต้องการดำเนินการอย่างไร?",icon:"question",showDenyButton:!0,confirmButtonText:"ดึงข้อมูลฉบับร่าง",denyButtonText:"สร้างข้อมูลใหม่",confirmButtonColor:"#0ab4ab",denyButtonColor:"#d33"})).isConfirmed){let r=(0,c.A)(e,"yyyy-MM-dd"),a=C||(0,d.Se)(),n=await (0,s.Bh)(x.uid,t,r,a);n&&(ea(n),S(n.shift||(0,d.Se)()),H(!0),Z(!1),g.fire({title:"ดึงข้อมูลฉบับร่างสำเร็จ",text:"แสดงข้อมูลฉบับร่างล่าสุด คุณสามารถแก้ไขและบันทึกต่อได้",icon:"success",confirmButtonColor:"#0ab4ab"}))}else{let r=await (0,n.BL)(e,t);S(r?"19:00-07:00":(0,d.Se)()),H(!1),Z(!1),ea({patientCensus:"",overallData:"",newAdmit:"",transferIn:"",referIn:"",transferOut:"",referOut:"",discharge:"",dead:"",rns:"",pns:"",nas:"",aides:"",studentNurses:"",notes:"",firstName:(null==x?void 0:x.firstName)||"",lastName:(null==x?void 0:x.lastName)||"",isDraft:!1})}}else{let r=await (0,n.BL)(e,t);S(r?"19:00-07:00":(0,d.Se)()),Z(!1),H(!1),ea({patientCensus:"",overallData:"",newAdmit:"",transferIn:"",referIn:"",transferOut:"",referOut:"",discharge:"",dead:"",rns:"",pns:"",nas:"",aides:"",studentNurses:"",notes:"",firstName:(null==x?void 0:x.firstName)||"",lastName:(null==x?void 0:x.lastName)||"",isDraft:!1})}}}else{let r=await g.fire({title:"พบข้อมูลที่บันทึกไว้แล้ว",html:"มีข้อมูลของวันที่ ".concat((0,o.mI)(e)," ในระบบแล้ว<br>คุณต้องการดำเนินการอย่างไร?"),icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"เรียกดูข้อมูลเดิม",denyButtonText:"บันทึกข้อมูลใหม่ทับ",cancelButtonText:"ยกเลิก",confirmButtonColor:"#0ab4ab",denyButtonColor:"#d33"});if(r.isConfirmed){let e=h.docs[0].data();ea(e),S(e.shift||(0,d.Se)());let t=["pending","rejected"].includes(e.approvalStatus);Z(!t),g.fire({title:"ดึงข้อมูลสำเร็จ",text:t?"แสดงข้อมูลที่บันทึกไว้แล้ว คุณสามารถแก้ไขข้อมูลได้":"แสดงข้อมูลที่บันทึกไว้แล้ว (ข้อมูลนี้ถูกอนุมัติแล้ว ไม่สามารถแก้ไขได้)",icon:"success",confirmButtonColor:"#0ab4ab"})}else if(r.isDenied){let r=h.docs[0].data();if("approved"===r.approvalStatus){g.fire({title:"ไม่สามารถบันทึกทับได้",text:"ข้อมูลนี้ได้รับการอนุมัติแล้ว ไม่สามารถแก้ไขหรือบันทึกทับได้",icon:"error",confirmButtonColor:"#0ab4ab"}),Z(!0),ea(r),S(r.shift||(0,d.Se)());return}ea({patientCensus:"",overallData:"",newAdmit:"",transferIn:"",referIn:"",transferOut:"",referOut:"",discharge:"",dead:"",rns:"",pns:"",nas:"",aides:"",studentNurses:"",notes:"",firstName:(null==x?void 0:x.firstName)||"",lastName:(null==x?void 0:x.lastName)||"",isDraft:!1}),Z(!1);let a=await (0,n.BL)(e,t);S(a?"19:00-07:00":(0,d.Se)()),g.fire({title:"เริ่มต้นบันทึกข้อมูลใหม่",text:"คุณสามารถบันทึกข้อมูลใหม่เพื่อทับข้อมูลเดิมได้",icon:"info",confirmButtonColor:"#0ab4ab"})}}}catch(e){console.error("Error in handleLocalDateSelect:",e)}finally{y(!1)}},ei=async()=>{try{if(!(null==x?void 0:x.uid)||!t)return!1;let e=(0,c.A)(k,"yyyy-MM-dd"),r=await (0,s.YB)(x.uid,t);return r&&r.some(t=>t.date===e&&(t.shift===C||!C))}catch(e){return console.error("Error checking drafts:",e),!1}},eo=async e=>{console.log("Shift changed to ".concat(e)),S(e);try{let r=await (0,n.rl)(k,t,e);if(r){ea(r);return}if("เช้า"===e){let r=await (0,n.hv)(t);if(r){let a={patientCensus:(0,n.fO)(r),rns:r.rns||"",pns:r.pns||"",nas:r.nas||"",aides:r.aides||"",studentNurses:r.studentNurses||"",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",notes:"",date:getUTCDateString(k),shift:e,wardId:t};ea(a)}}else if("ดึก"===e){let r=await (0,n.rl)(k,t,"เช้า");if(r){let a={overallData:(0,n.fO)(r),rns:r.rns||"",pns:r.pns||"",nas:r.nas||"",aides:r.aides||"",studentNurses:r.studentNurses||"",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",notes:"",date:getUTCDateString(k),shift:e,wardId:t};ea(a)}}}catch(e){console.error("Error in handleLocalShiftChange:",e)}},ed=async()=>{try{let e=await (0,n.iu)(k,t,C);if(!e.canEdit){g.fire({icon:"error",title:"ไม่สามารถบันทึกได้",text:e.message});return}console.log("Submitting form:",er),null==x||x.uid,new Date().toISOString(),g.fire({icon:"success",title:"บันทึกข้อมูลเรียบร้อย",text:"ข้อมูลได้รับการอนุมัติแล้ว"})}catch(e){console.error("Error submitting form:",e),g.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง"})}};return v?(0,a.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md w-full",children:[(0,a.jsx)("h2",{className:"text-red-700 text-xl font-semibold mb-3",children:"เกิดข้อผิดพลาด"}),(0,a.jsx)("p",{className:"text-red-600 mb-4",children:v}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-md",children:"ลองใหม่อีกครั้ง"})]})}):(0,a.jsx)("div",{className:"w-full max-w-7xl mx-auto",children:b?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("div",{className:"w-10 h-10 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"กำลังโหลดข้อมูล..."})]}):(0,a.jsxs)("div",{className:"space-y-6 p-4",children:[console.log("Debug - States:",{showForm:j,selectedWard:t,selectedDate:k,selectedShift:C,isLoading:b,formData:er}),j&&(0,a.jsx)(n.vK,{isLoading:b,selectedDate:k,selectedShift:C,selectedWard:t,formData:er,setFormData:ea,handleLocalDateSelect:el,handleShiftChange:eo,thaiDate:I,setThaiDate:M,showCalendar:O,setShowCalendar:A,datesWithData:B,theme:p,approvalStatus:W,setHasUnsavedChanges:P,onSaveDraft:()=>{console.log("Save Draft clicked"),g.fire({title:"บันทึกฉบับร่าง",text:"ระบบกำลังพัฒนา ยังไม่สามารถบันทึกฉบับร่างได้ในขณะนี้",icon:"info",confirmButtonColor:"#0ab4ab"})},onSubmit:ed,isSubmitting:U,isDraftMode:z}),(0,a.jsx)(f,{isOpen:en,onClose:()=>es(!1),wardId:t,date:k,shift:C}),(0,a.jsxs)("div",{className:"mt-8 p-4 bg-gray-100 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Debug Info:"}),(0,a.jsxs)("p",{children:["showForm: ",j?"true":"false"]}),(0,a.jsxs)("p",{children:["selectedWard: ",t?JSON.stringify(t):"ไม่มี"]}),(0,a.jsxs)("p",{children:["selectedShift: ",C]}),(0,a.jsxs)("p",{children:["isLoading: ",b?"true":"false"]})]})]})})}}}]);