"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[688],{4279:(e,t,a)=>{a.d(t,{Lg:()=>s,Ol:()=>r,RB:()=>i,S2:()=>o,bU:()=>l,mI:()=>n});let n=e=>{if(!e)return"คุณยังไม่ได้เลือกวันที่";let t=new Date(e),a=t.getDate(),n=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"][t.getMonth()],s=t.getFullYear()+543;return"".concat(a," ").concat(n," ").concat(s)},s=()=>n(new Date),r=e=>{let t=new Date(e);return"".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0"))},l=e=>{let t=new Date(e),a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(a,"-").concat(n,"-").concat(s)},o=()=>["January","February","March","April","May","June","July","August","September","October","November","December"],i=e=>{let t=[];for(let e=2e3;e<=4e3;e++)t.push(e);return t}},4776:(e,t,a)=>{a.d(t,{A:()=>l});var n=a(5155),s=a(2115),r=a(6766);let l=e=>{let{timeout:t=15e3,onTimeout:a,showRetry:l=!1}=e,[o,i]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=setTimeout(()=>{i(!0),a&&a()},t);return()=>clearTimeout(e)},[t,a]),(0,n.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-white via-blue-50 to-[#0ab4ab]/10 flex items-center justify-center z-50",children:(0,n.jsx)("div",{className:"bg-white/80 p-8 rounded-2xl shadow-xl backdrop-blur-sm",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"relative w-32 h-32 mx-auto mb-4",children:(0,n.jsx)(r.default,{src:"/images/BPK.jpg",alt:"BPK Loading",fill:!0,style:{objectFit:"contain"},className:"rounded-lg ".concat(o?"":"animate-pulse"),priority:!0})}),(0,n.jsx)("div",{className:"flex flex-col items-center",children:o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-red-600 font-medium mb-2",children:"การโหลดข้อมูลใช้เวลานานเกินไป"}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"กรุณาตรวจสอบการเชื่อมต่อและลองใหม่อีกครั้ง"}),l&&(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-[#0ab4ab] text-white rounded-lg hover:bg-[#098f88] transition-colors",children:"ลองใหม่"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#0ab4ab] mb-3"}),(0,n.jsx)("p",{className:"text-gray-600 font-medium",children:"กำลังโหลดข้อมูล..."}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"โปรดรอสักครู่"})]})})]})})})}},4822:(e,t,a)=>{a.d(t,{A:()=>o});var n=a(5155),s=a(4279),r=a(8382),l=a(2115);let o=e=>{let{selectedDate:t,onDateSelect:a,datesWithData:o=[],showCalendar:i,setShowCalendar:c,thaiDate:d,variant:u="form",theme:m="light"}=e,[g,h]=(0,l.useState)(!1),x="function"==typeof c,b=void 0!==i?i:g,f=e=>{x?c(e):(h(e),console.warn("setShowCalendar is not a function in CalendarSection, using local state instead"))};return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"".concat("dark"===m?"bg-gray-800/60 border border-gray-700":"bg-white/60"," backdrop-blur-sm rounded-xl p-3 shadow-sm hover:shadow-md transition-all"),children:(0,n.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-3",children:[(0,n.jsx)("button",{type:"button",onClick:()=>{f(!b)},className:"w-full md:w-auto px-4 py-2 ".concat("dark"===m?"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700":"bg-gradient-to-r from-[#0ab4ab] to-blue-500 hover:from-[#0ab4ab]/90 hover:to-blue-600"," text-white rounded-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[#0ab4ab] focus:ring-opacity-50 shadow-md text-sm"),children:b?"ซ่อนปฏิทิน":"เลือกวันที่"}),(0,n.jsxs)("div",{className:"".concat("dark"===m?"text-gray-200":"text-gray-700"," space-y-0.5 text-center md:text-left text-sm"),children:[(0,n.jsxs)("div",{className:"font-medium text-[#0ab4ab]",children:["วันที่ปัจจุบัน : ",(0,s.mI)(new Date)]}),(0,n.jsxs)("div",{className:"".concat("dark"===m?"text-blue-400":"text-blue-600"),children:["วันที่เลือก : ",d]})]})]})}),b&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:(0,n.jsx)("div",{className:"relative ".concat("dark"===m?"bg-gray-800":"bg-white"," rounded-2xl shadow-2xl transform transition-all"),children:(0,n.jsx)(r.A,{selectedDate:t,onDateSelect:a,onClickOutside:()=>{f(!1)},datesWithData:o,variant:u,theme:m})})})]})}},7775:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(5155),s=a(2115),r=a(5695),l=a(2808),o=a(4776);function i(e){let{children:t,requiredRole:a=null}=e,{user:i,loading:c,isAuthenticated:d}=(0,l.A)(),u=(0,r.useRouter)(),[m,g]=(0,s.useState)(!1),[h,x]=(0,s.useState)(!0),[b,f]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{x(!1);try{if(!c){var e;console.log("AuthGuard checking auth:",{isAuthenticated:d,user:i,requiredRole:a}),d?"admin"===a&&(null==i?void 0:null===(e=i.role)||void 0===e?void 0:e.toLowerCase())!=="admin"?(console.log("User does not have admin role"),f(!0),g(!1)):(console.log("User is authenticated and authorized"),g(!0),f(!1)):(console.log("Not authenticated, redirecting to login"),u.push("/login"))}}catch(e){console.error("Error in AuthGuard:",e),g(!1)}},[c,d,i,u,a]),h)?(0,n.jsx)("div",{className:"min-h-screen"}):b?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow p-8 text-center",children:[(0,n.jsx)("div",{className:"text-red-500 text-5xl mb-4",children:"⚠️"}),(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"ไม่ได้เข้า"}),(0,n.jsxs)("p",{className:"text-gray-600 mb-6",children:["ไม่ได้เข้าหน้านี้ เนื่องจากต้องมีบทบาทเป็น ",a]}),(0,n.jsx)("button",{onClick:()=>u.push("/"),className:"px-4 py-2 bg-[#0ab4ab] text-white rounded-md hover:bg-[#0ab4ab]/90",children:"หน้าแรก"})]})}):c||!m?(console.log("Still loading or not authorized yet, showing LoadingScreen"),(0,n.jsx)(o.A,{})):(console.log("Rendering children - user authorized"),(0,n.jsx)(n.Fragment,{children:t}))}},8382:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(5155),s=a(2115),r=a(4279),l=a(7423),o=a(7434);let i=e=>{let t,{selectedDate:a,onDateSelect:i,onClickOutside:c,datesWithData:d=[],variant:u="form"}=e,[m,g]=(0,s.useState)(a||new Date),[h,x]=(0,s.useState)(a||new Date),b=(0,s.useRef)(null);(0,s.useEffect)(()=>{if("form"===u){let e=new Date;x(e),g(e)}},[u]),(0,s.useEffect)(()=>{a&&(g(a),"form"!==u&&x(a))},[a,u]),(0,s.useEffect)(()=>{let e=e=>{b.current&&!b.current.contains(e.target)&&c&&c()},t=e=>{e.preventDefault(),e.stopPropagation()},a=window.innerWidth-document.documentElement.clientWidth,n={overflow:window.getComputedStyle(document.body).overflow,paddingRight:window.getComputedStyle(document.body).paddingRight};return document.addEventListener("mousedown",e),document.addEventListener("wheel",t,{passive:!1}),document.addEventListener("touchmove",t,{passive:!1}),document.addEventListener("scroll",t,{passive:!1}),document.body.style.overflow="hidden",document.body.style.paddingRight="".concat(a,"px"),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("wheel",t),document.removeEventListener("touchmove",t),document.removeEventListener("scroll",t),document.body.style.overflow=n.overflow,document.body.style.paddingRight=n.paddingRight}},[c]);let f=(0,r.S2)(),v=new Date().getFullYear(),p=(0,r.RB)(v),w=(e,t)=>{if(!t)return;let a=new Date(h.getFullYear(),h.getMonth(),e);g(a),"function"==typeof i&&i(a),"function"==typeof c&&c()};new Date().setHours(0,0,0,0);let j=e=>{let t=new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().split("T")[0],a=d.find(e=>e.date===t);return a?{hasData:!0,isComplete:a.isComplete,shifts:a.shifts}:{hasData:!1,isComplete:!1,shifts:[]}},y=e=>{let{hasData:t,isComplete:n,shifts:s}=j(e),r=e.toDateString()===new Date().toDateString(),l=a&&e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear(),o="hover:bg-gray-100",i="text-gray-700",c="";return r&&(o="bg-[#0ab4ab]",i="text-white"),t&&(n?(o="bg-[#0ab4ab]/10 hover:bg-[#0ab4ab]/20",c="absolute top-1 right-1 w-1.5 h-1.5 rounded-full bg-[#0ab4ab]"):(o="bg-orange-100 hover:bg-orange-200",c="absolute top-1 right-1 w-1.5 h-1.5 rounded-full bg-orange-500")),l&&!r&&(o+=" ring-2 ring-[#0ab4ab]"),!(e<new Date(new Date().setHours(0,0,0,0)))||r||l||(i="text-gray-400"),{cellClass:"p-1 text-center",dayClass:"".concat("relative w-10 h-10 flex items-center justify-center rounded-full transition-all duration-200"," ").concat(o," ").concat(i," font-medium cursor-pointer"),dotClass:c}};return(0,n.jsx)("div",{ref:b,className:"bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 z-[9999]",onTouchMove:e=>e.preventDefault(),onScroll:e=>e.preventDefault(),children:(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsxs)("div",{className:"text-center mb-4",children:[(0,n.jsx)("div",{className:"text-lg font-medium mb-2",children:"เลือกวันที่"}),(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:["วันที่ปัจจุบัน: ",(t=new Date,(0,l.A)(t,"dd MMMM yyyy",{locale:o.A}))]})]}),(0,n.jsxs)("div",{className:"flex justify-center gap-4 mb-4",children:[(0,n.jsx)("select",{value:h.getMonth(),onChange:e=>{let t=new Date(h);if(t.setMonth(parseInt(e.target.value)),x(t),"form"===u){let e=new Date;t.setDate(e.getDate()),x(t)}},className:"px-3 py-1 border rounded-lg text-gray-700",children:f.map((e,t)=>(0,n.jsx)("option",{value:t,children:e},e))}),(0,n.jsx)("select",{value:h.getFullYear(),onChange:e=>{let t=new Date(h);if(t.setFullYear(parseInt(e.target.value)),x(t),"form"===u){let e=new Date;t.setDate(e.getDate()),x(t)}},className:"px-3 py-1 border rounded-lg text-gray-700",children:p.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]}),(0,n.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2 text-center",children:["อา","จ","อ","พ","พฤ","ศ","ส"].map(e=>(0,n.jsx)("div",{className:"text-sm font-medium text-gray-600",children:e},e))}),(0,n.jsx)("table",{className:"w-full",children:(0,n.jsx)("tbody",{children:(()=>{let e=h.getFullYear(),t=h.getMonth(),a=new Date(e,t,1),s=new Date(e,t+1,0).getDate(),r=a.getDay(),l=new Date(e,t,0).getDate(),o=[],i=[];for(let a=0;a<r;a++){let s=l-r+a+1,{cellClass:o,dayClass:c,dotClass:d}=y(new Date(e,t-1,s));i.push((0,n.jsx)("td",{className:o,children:(0,n.jsxs)("div",{onClick:()=>w(s,!1),className:"".concat(c," opacity-50"),children:[s,d&&(0,n.jsx)("div",{className:d})]})},"prev-".concat(s)))}for(let a=1;a<=s;a++){let{cellClass:s,dayClass:r,dotClass:l}=y(new Date(e,t,a));i.push((0,n.jsx)("td",{className:s,children:(0,n.jsxs)("div",{onClick:()=>w(a,!0),className:r,children:[a,l&&(0,n.jsx)("div",{className:l})]})},a)),7===i.length&&(o.push((0,n.jsx)("tr",{children:i},"week-".concat(o.length))),i=[])}if(i.length>0){let a=1;for(;i.length<7;){let{cellClass:s,dayClass:r,dotClass:l}=y(new Date(e,t+1,a));i.push((0,n.jsx)("td",{className:s,children:(0,n.jsxs)("div",{onClick:()=>w(a,!1),className:"".concat(r," opacity-50"),children:[a,l&&(0,n.jsx)("div",{className:l})]})},"next-".concat(a))),a++}o.push((0,n.jsx)("tr",{children:i},"week-".concat(o.length)))}return o})()})}),(0,n.jsxs)("div",{className:"mt-4 flex justify-center gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full bg-[#0ab4ab]"}),(0,n.jsx)("span",{className:"text-xs text-gray-600",children:"วันที่ปัจจุบัน"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-300"}),(0,n.jsx)("span",{className:"text-xs text-gray-600",children:"บันทึกครบ 2 กะ"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full bg-orange-300"}),(0,n.jsx)("span",{className:"text-xs text-gray-600",children:"บันทึกไม่ครบ"})]})]})]})})}}}]);