"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[305],{5305:(e,a,t)=>{t.r(a),t.d(a,{default:()=>u});var r=t(5155),s=t(2115),l=t(9310),n=t(2808),o=t(7775),d=t(4776),i=t(5695),c=t(9770);function u(){(0,i.useRouter)();let[e,a]=(0,s.useState)([]),[t,u]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),[p,h]=(0,s.useState)({username:"",password:"",firstName:"",lastName:"",fullName:"",position:"",department:"",role:"user"}),[b,g]=(0,s.useState)(null),[f,y]=(0,s.useState)(!1),{user:j}=(0,n.A)(),N=["In charge","ผู้จัดการแผนก","ผู้ตรวจการ"],v=async()=>{u(!0),console.log("Fetching users...");try{let e=await (0,l.CF)();console.log("Users fetched:",e),a(e)}catch(e){console.error("Error in fetchUsers:",e),x("Failed to load users")}finally{u(!1)}};(0,s.useEffect)(()=>{v()},[]),(0,s.useEffect)(()=>{let t=e.map(e=>{if((!e.firstName||!e.lastName)&&e.fullName){let a=e.fullName.split(" "),t=a[0]||"",r=a.slice(1).join(" ")||"";return{...e,firstName:e.firstName||t,lastName:e.lastName||r}}return e});JSON.stringify(t)!==JSON.stringify(e)&&a(t)},[e]);let w=async e=>{if(e.preventDefault(),console.log("Submitting new user:",p),!p.username||!p.password){x("กรุณากรอกชื่อผู้ใช้และรหัสผ่าน");return}try{console.log("Calling addUser function...");let e=await (0,l.nu)(p);if(console.log("addUser result:",e),e.success)console.log("User added successfully"),alert("เพิ่มผู้ใช้ ".concat(p.username," สำเร็จ")),await (0,c.$s)("user_management_add_success",{username:p.username,role:p.role,addedBy:null==j?void 0:j.displayName,addedById:null==j?void 0:j.uid,action:"เพิ่ม user สำเร็จ",timestamp:new Date().toISOString()}),h({username:"",password:"",firstName:"",lastName:"",fullName:"",position:"",department:"",role:"user"}),y(!1),console.log("Refreshing user list..."),v();else throw console.error("Failed to add user with error:",e.error),alert("เพิ่มผู้ใช้ไม่สำเร็จ: ".concat(e.error||"ไม่ทราบสาเหตุ")),Error(e.error||"Failed to add user")}catch(e){console.error("Error in handleAddUser:",e),x("Failed to add user: "+e.message),alert("เพิ่มผู้ใช้ไม่สำเร็จ: ".concat(e.message))}},C=async e=>{if(e.preventDefault(),b)try{let e={username:b.username,password:b.password,firstName:b.firstName,lastName:b.lastName,fullName:b.fullName,position:b.position,department:b.department,role:b.role},a=await (0,l.TK)(b.id,e);if(a.success)alert("แก้ไขข้อมูลผู้ใช้ ".concat(b.username," สำเร็จ")),await (0,c.$s)("user_management_update_success",{userId:b.id,username:b.username,role:b.role,updatedBy:null==j?void 0:j.displayName,updatedById:null==j?void 0:j.uid,action:"แก้ไข user สำเร็จ",timestamp:new Date().toISOString()}),g(null),v();else throw alert("แก้ไขข้อมูลผู้ใช้ไม่สำเร็จ: ".concat(a.error||"ไม่ทราบสาเหตุ")),Error(a.error||"Failed to update user")}catch(e){console.error("Error updating user:",e),x("Failed to update user: "+e.message),alert("แก้ไขข้อมูลผู้ใช้ไม่สำเร็จ: ".concat(e.message))}},k=async a=>{if(window.confirm("Are you sure you want to delete this user?"))try{let t=e.find(e=>e.id===a),r=await (0,l.hG)(a);if(r.success)alert("ลบผู้ใช้ ".concat((null==t?void 0:t.username)||a," สำเร็จ")),await (0,c.$s)("user_management_delete_success",{userId:a,username:null==t?void 0:t.username,role:null==t?void 0:t.role,deletedBy:null==j?void 0:j.displayName,deletedById:null==j?void 0:j.uid,action:"ลบ user สำเร็จ",timestamp:new Date().toISOString()}),v();else throw alert("ลบผู้ใช้ไม่สำเร็จ: ".concat(r.error||"ไม่ทราบสาเหตุ")),Error(r.error||"Failed to delete user")}catch(e){console.error("Error deleting user:",e),x("Failed to delete user: "+e.message),alert("ลบผู้ใช้ไม่สำเร็จ: ".concat(e.message))}};return t?(0,r.jsx)(d.A,{}):(0,r.jsx)(o.A,{requiredRole:"admin",children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,r.jsxs)("main",{className:"container mx-auto px-4 pt-20 pb-10",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Users Management"}),(0,r.jsx)("div",{className:"flex space-x-3",children:(0,r.jsx)("button",{onClick:()=>y(!0),className:"bg-[#0ab4ab] text-white px-4 py-2 rounded-lg hover:bg-[#0ab4ab]/90",children:"Add New User"})})]}),f&&(0,r.jsxs)("div",{className:"mb-8 p-6 bg-white rounded-lg shadow",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Add New User"}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,r.jsx)("input",{type:"text",value:p.username,onChange:e=>h({...p,username:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),(0,r.jsx)("input",{type:"text",value:p.firstName||"",onChange:e=>{let a=e.target.value;h({...p,firstName:a,fullName:"".concat(a," ").concat(p.lastName||"")})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),(0,r.jsx)("input",{type:"text",value:p.lastName||"",onChange:e=>{let a=e.target.value;h({...p,lastName:a,fullName:"".concat(p.firstName||""," ").concat(a)})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,r.jsx)("input",{type:"password",value:p.password,onChange:e=>h({...p,password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),(0,r.jsxs)("select",{value:p.department,onChange:e=>h({...p,department:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select Department"}),(0,r.jsx)("option",{value:"Ward6",children:"Ward 6"}),(0,r.jsx)("option",{value:"Ward7",children:"Ward 7"}),(0,r.jsx)("option",{value:"Ward8",children:"Ward 8"}),(0,r.jsx)("option",{value:"Ward9",children:"Ward 9"}),(0,r.jsx)("option",{value:"WardGI",children:"Ward GI"}),(0,r.jsx)("option",{value:"Ward10B",children:"Ward 10B"}),(0,r.jsx)("option",{value:"Ward11",children:"Ward 11"}),(0,r.jsx)("option",{value:"Ward12",children:"Ward 12"}),(0,r.jsx)("option",{value:"ICU",children:"ICU"}),(0,r.jsx)("option",{value:"CCU",children:"CCU"}),(0,r.jsx)("option",{value:"LR",children:"LR"}),(0,r.jsx)("option",{value:"NSY",children:"NSY"}),(0,r.jsx)("option",{value:"Admin",children:"Admin"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position"}),(0,r.jsxs)("select",{value:p.position,onChange:e=>h({...p,position:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select Position"}),N.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,r.jsxs)("select",{value:p.role,onChange:e=>h({...p,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-[#0ab4ab] text-white rounded-md hover:bg-[#0ab4ab]/90",children:"Add User"})]})]})]}),b&&(0,r.jsxs)("div",{className:"mb-8 p-6 bg-white rounded-lg shadow",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Edit User"}),(0,r.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,r.jsx)("input",{type:"text",value:b.username,onChange:e=>g({...b,username:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),(0,r.jsx)("input",{type:"text",value:b.firstName||"",onChange:e=>{let a=e.target.value;g({...b,firstName:a,fullName:"".concat(a," ").concat(b.lastName||"")})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),(0,r.jsx)("input",{type:"text",value:b.lastName||"",onChange:e=>{let a=e.target.value;g({...b,lastName:a,fullName:"".concat(b.firstName||""," ").concat(a)})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,r.jsx)("input",{type:"text",value:b.fullName||"",onChange:e=>g({...b,fullName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),(0,r.jsxs)("select",{value:b.department,onChange:e=>g({...b,department:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select Department"}),(0,r.jsx)("option",{value:"Ward6",children:"Ward 6"}),(0,r.jsx)("option",{value:"Ward7",children:"Ward 7"}),(0,r.jsx)("option",{value:"Ward8",children:"Ward 8"}),(0,r.jsx)("option",{value:"Ward9",children:"Ward 9"}),(0,r.jsx)("option",{value:"WardGI",children:"Ward GI"}),(0,r.jsx)("option",{value:"Ward10B",children:"Ward 10B"}),(0,r.jsx)("option",{value:"Ward11",children:"Ward 11"}),(0,r.jsx)("option",{value:"Ward12",children:"Ward 12"}),(0,r.jsx)("option",{value:"ICU",children:"ICU"}),(0,r.jsx)("option",{value:"CCU",children:"CCU"}),(0,r.jsx)("option",{value:"LR",children:"LR"}),(0,r.jsx)("option",{value:"NSY",children:"NSY"}),(0,r.jsx)("option",{value:"Admin",children:"Admin"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position"}),(0,r.jsxs)("select",{value:b.position,onChange:e=>g({...b,position:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select Position"}),N.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,r.jsxs)("select",{value:b.role,onChange:e=>g({...b,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,r.jsx)("input",{type:"password",value:b.password,onChange:e=>g({...b,password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>g(null),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-[#0ab4ab] text-white rounded-md hover:bg-[#0ab4ab]/90",children:"Update User"})]})]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Username"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"First Name"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Name"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Position"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created At"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Updated At"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200",children:[e.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.username}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.firstName||"-"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.lastName||"-"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.position||"-"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.department}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,r.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("admin"===e.role?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:e.role})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.createdAt?"object"==typeof e.createdAt&&e.createdAt.seconds?new Date(1e3*e.createdAt.seconds).toLocaleString():"string"==typeof e.createdAt?new Date(e.createdAt).toLocaleString():"-":"-"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.updatedAt?"object"==typeof e.updatedAt&&e.updatedAt.seconds?new Date(1e3*e.updatedAt.seconds).toLocaleString():"string"==typeof e.updatedAt?new Date(e.updatedAt).toLocaleString():"-":"-"}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,r.jsx)("button",{onClick:()=>g(e),className:"text-indigo-600 hover:text-indigo-900 mr-4",children:"Edit"}),(0,r.jsx)("button",{onClick:()=>k(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id)),0===e.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:"7",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No users found"})})]})]})})]})})})}},5695:(e,a,t)=>{var r=t(8999);t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}})},7775:(e,a,t)=>{t.d(a,{A:()=>d});var r=t(5155),s=t(2115),l=t(5695),n=t(2808),o=t(4776);function d(e){let{children:a,requiredRole:t=null}=e,{user:d,loading:i,isAuthenticated:c}=(0,n.A)(),u=(0,l.useRouter)(),[m,x]=(0,s.useState)(!1),[p,h]=(0,s.useState)(!0),[b,g]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{h(!1);try{if(!i){var e;console.log("AuthGuard checking auth:",{isAuthenticated:c,user:d,requiredRole:t}),c?"admin"===t&&(null==d?void 0:null===(e=d.role)||void 0===e?void 0:e.toLowerCase())!=="admin"?(console.log("User does not have admin role"),g(!0),x(!1)):(console.log("User is authenticated and authorized"),x(!0),g(!1)):(console.log("Not authenticated, redirecting to login"),u.push("/login"))}}catch(e){console.error("Error in AuthGuard:",e),x(!1)}},[i,c,d,u,t]),p)?(0,r.jsx)("div",{className:"min-h-screen"}):b?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow p-8 text-center",children:[(0,r.jsx)("div",{className:"text-red-500 text-5xl mb-4",children:"⚠️"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"ไม่ได้เข้า"}),(0,r.jsxs)("p",{className:"text-gray-600 mb-6",children:["ไม่ได้เข้าหน้านี้ เนื่องจากต้องมีบทบาทเป็น ",t]}),(0,r.jsx)("button",{onClick:()=>u.push("/"),className:"px-4 py-2 bg-[#0ab4ab] text-white rounded-md hover:bg-[#0ab4ab]/90",children:"หน้าแรก"})]})}):i||!m?(console.log("Still loading or not authorized yet, showing LoadingScreen"),(0,r.jsx)(o.A,{})):(console.log("Rendering children - user authorized"),(0,r.jsx)(r.Fragment,{children:a}))}}}]);