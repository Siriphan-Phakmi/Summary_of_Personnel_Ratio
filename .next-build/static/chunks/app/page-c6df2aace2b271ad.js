(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{439:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(5155),a=s(2115),n=s(5695),i=s(936),l=s(2808);function o(){let{user:e,loading:t,isAuthenticated:s}=(0,l.A)(),o=(0,n.useRouter)();return(0,a.useEffect)(()=>{if(t||s){if(!t&&s&&e){var r;let t=(null===(r=e.role)||void 0===r?void 0:r.toLowerCase())||"user";"admin"===t||"approver"===t?(console.log("Redirecting admin/approver to approval page..."),o.push("/page/approval/")):(console.log("Redirecting user to ward-form page..."),o.push("/page/ward-form/"))}}else o.push("/page/login/")},[t,s,o,e]),(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)(i.A,{})})}s(9092)},936:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var r=s(5155),a=s(8637),n=s.n(a);let i=e=>{let{fullScreen:t=!1}=e,s=(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-4",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#0ab4ab]"}),(0,r.jsx)("p",{className:"text-gray-600",children:"กำลังโหลดข้อมูล..."})]});return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-white bg-opacity-80 z-50 flex items-center justify-center",children:s}):(0,r.jsx)("div",{className:"flex items-center justify-center p-8",children:s})};i.propTypes={fullScreen:n().bool};let l=i},1238:(e,t,s)=>{Promise.resolve().then(s.bind(s,439))},2948:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},4613:(e,t,s)=>{"use strict";s.d(t,{h:()=>r});let r="v.2.3.3.2025"},4776:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var r=s(5155),a=s(2115),n=s(6766);let i=e=>{let{timeout:t=15e3,onTimeout:s,showRetry:i=!1}=e,[l,o]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let e=setTimeout(()=>{o(!0),s&&s()},t);return()=>clearTimeout(e)},[t,s]),(0,r.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-white via-blue-50 to-[#0ab4ab]/10 flex items-center justify-center z-50",children:(0,r.jsx)("div",{className:"bg-white/80 p-8 rounded-2xl shadow-xl backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"relative w-32 h-32 mx-auto mb-4",children:(0,r.jsx)(n.default,{src:"/images/BPK.jpg",alt:"BPK Loading",fill:!0,style:{objectFit:"contain"},className:"rounded-lg ".concat(l?"":"animate-pulse"),priority:!0})}),(0,r.jsx)("div",{className:"flex flex-col items-center",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-red-600 font-medium mb-2",children:"การโหลดข้อมูลใช้เวลานานเกินไป"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"กรุณาตรวจสอบการเชื่อมต่อและลองใหม่อีกครั้ง"}),i&&(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-[#0ab4ab] text-white rounded-lg hover:bg-[#098f88] transition-colors",children:"ลองใหม่"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#0ab4ab] mb-3"}),(0,r.jsx)("p",{className:"text-gray-600 font-medium",children:"กำลังโหลดข้อมูล..."}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"โปรดรอสักครู่"})]})})]})})})}},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},7775:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var r=s(5155),a=s(2115),n=s(5695),i=s(2808),l=s(4776);function o(e){let{children:t,requiredRole:s=null}=e,{user:o,loading:c,isAuthenticated:d}=(0,i.A)(),u=(0,n.useRouter)(),[m,h]=(0,a.useState)(!1),[x,p]=(0,a.useState)(!0),[f,g]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{p(!1);try{if(!c){var e;console.log("AuthGuard checking auth:",{isAuthenticated:d,user:o,requiredRole:s}),d?"admin"===s&&(null==o?void 0:null===(e=o.role)||void 0===e?void 0:e.toLowerCase())!=="admin"?(console.log("User does not have admin role"),g(!0),h(!1)):(console.log("User is authenticated and authorized"),h(!0),g(!1)):(console.log("Not authenticated, redirecting to login"),u.push("/login"))}}catch(e){console.error("Error in AuthGuard:",e),h(!1)}},[c,d,o,u,s]),x)?(0,r.jsx)("div",{className:"min-h-screen"}):f?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow p-8 text-center",children:[(0,r.jsx)("div",{className:"text-red-500 text-5xl mb-4",children:"⚠️"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"ไม่ได้เข้า"}),(0,r.jsxs)("p",{className:"text-gray-600 mb-6",children:["ไม่ได้เข้าหน้านี้ เนื่องจากต้องมีบทบาทเป็น ",s]}),(0,r.jsx)("button",{onClick:()=>u.push("/"),className:"px-4 py-2 bg-[#0ab4ab] text-white rounded-md hover:bg-[#0ab4ab]/90",children:"หน้าแรก"})]})}):c||!m?(console.log("Still loading or not authorized yet, showing LoadingScreen"),(0,r.jsx)(l.A,{})):(console.log("Rendering children - user authorized"),(0,r.jsx)(r.Fragment,{children:t}))}},8637:(e,t,s)=>{e.exports=s(9399)()},9092:(e,t,s)=>{"use strict";s.d(t,{A:()=>u});var r=s(5155),a=s(2115),n=s(5695),i=s(2808),l=s(7775),o=s(4776),c=s(4613),d=s(9770);function u(e){let{children:t,title:s,requiredRole:u="user",infoBox:m}=e,{user:h,loading:x,isAuthenticated:p}=(0,i.A)(),f=(0,n.useRouter)(),[g,b]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{x||p||f.push("/login"),h&&h.role&&("admin"===h.role.toLowerCase()?b(!0):"user"===u?b(!0):h.role.toLowerCase()===u.toLowerCase()?b(!0):(b(!1),(0,d.$s)("unauthorized_access_attempt",{userRole:h.role,requiredRole:u,page:s})))},[x,p,f,h,u,s]),x)?(0,r.jsx)(o.A,{}):p?g?(0,r.jsx)(l.A,{requiredRole:u,children:(0,r.jsxs)("div",{className:"min-h-screen pb-16 relative",children:[(0,r.jsxs)("main",{className:"container mx-auto px-4 pt-20",children:[s&&(0,r.jsx)("h1",{className:"text-2xl font-semibold text-gray-800 mb-6",children:s}),m&&(0,r.jsx)("div",{className:"mb-6",children:m}),t]}),(0,r.jsx)("div",{className:"fixed bottom-4 right-4 text-sm text-gray-500",children:c.h})]})}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"max-w-md w-full p-6 bg-white rounded-lg shadow-lg",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("svg",{className:"mx-auto h-16 w-16 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsx)("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"ไม่มีสิทธิ์เข้าถึง"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"คุณไม่มีสิทธิ์เพียงพอในการเข้าถึงหน้านี้ กรุณาติดต่อผู้ดูแลระบบหากคุณเชื่อว่านี่เป็นข้อผิดพลาด"}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)("button",{type:"button",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:()=>f.push("/"),children:"กลับไปยังหน้าหลัก"})})]})})}):null}},9399:(e,t,s)=>{"use strict";var r=s(2948);function a(){}function n(){}n.resetWarningCache=a,e.exports=function(){function e(e,t,s,a,n,i){if(i!==r){var l=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}function t(){return e}e.isRequired=e;var s={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:n,resetWarningCache:a};return s.PropTypes=s,s}}},e=>{var t=t=>e(e.s=t);e.O(0,[445,766,808,315,358],()=>t(1238)),_N_E=e.O()}]);