(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{5071:(e,t,a)=>{"use strict";a.d(t,{A:()=>y});var r=a(5155),s=a(2115),n=a(7982),l=a(7058);a(5279);let i={Ward6:"Ward 6",Ward7:"Ward 7",Ward8:"Ward 8",Ward9:"Ward 9",WardGI:"Ward GI",Ward10B:"Ward 10B",Ward11:"Ward 11",Ward12:"Ward 12",ICU:"ICU",CCU:"CCU",LR:"LR",NSY:"NSY"},o=["Ward6","Ward7","Ward8","Ward9","WardGI","Ward10B","Ward11","Ward12","ICU","CCU","LR","NSY"],d={numberOfPatients:"0",nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",overallData:"0",availableBeds:"0",plannedDischarge:"0",unavailable:"0",comment:""};var c=a(8897),u=a.n(c);let m=e=>{let{wardId:t,date:a,status:i="pending"}=e,[o,d]=(0,s.useState)(!1),c=async()=>{try{if(d(!0),!(await u().fire({title:"Approve Ward Data",html:'\n          <div class="text-left">\n            <p class="mb-2 font-medium">Are you sure you want to approve data for '.concat(t,'?</p>\n            <p class="text-sm text-gray-600">Date: ').concat(a,"</p>\n          </div>\n        "),icon:"question",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33"})).isConfirmed){d(!1);return}let e=(0,l.H9)(n.db,"wardDailyRecords","".concat(a,"_").concat(t));await (0,l.mZ)(e,{approvalStatus:"approved",approvedAt:new Date().toISOString()}),await u().fire({title:"Approved Successfully",text:"Data for ".concat(t," has been approved"),icon:"success",confirmButtonColor:"#0ab4ab"})}catch(e){console.error("Error approving ward data:",e),await u().fire({title:"Error",text:"Failed to approve ward data. Please try again.",icon:"error",confirmButtonColor:"#0ab4ab"})}finally{d(!1)}},m=async()=>{try{d(!0);let e=await u().fire({title:"Reject Ward Data",html:'\n          <div class="text-left">\n            <p class="mb-2 font-medium">Please provide a reason for rejection:</p>\n            <textarea id="rejection-reason" class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="3"></textarea>\n          </div>\n        ',icon:"warning",showCancelButton:!0,confirmButtonText:"Reject",cancelButtonText:"Cancel",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",preConfirm:()=>{let e=document.getElementById("rejection-reason").value;return e.trim()||u().showValidationMessage("Please provide a reason for rejection"),e}});if(!e.isConfirmed){d(!1);return}let r=e.value,s=(0,l.H9)(n.db,"wardDailyRecords","".concat(a,"_").concat(t));await (0,l.mZ)(s,{approvalStatus:"rejected",rejectedAt:new Date().toISOString(),rejectionReason:r}),await u().fire({title:"Rejected Successfully",text:"Data for ".concat(t," has been rejected"),icon:"info",confirmButtonColor:"#0ab4ab"})}catch(e){console.error("Error rejecting ward data:",e),await u().fire({title:"Error",text:"Failed to reject ward data. Please try again.",icon:"error",confirmButtonColor:"#0ab4ab"})}finally{d(!1)}};return"approved"===i?(0,r.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Approved"]}):"rejected"===i?(0,r.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),"Rejected"]}):(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:c,disabled:o,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",children:o?"Processing...":"Approve"}),(0,r.jsx)("button",{onClick:m,disabled:o,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:o?"Processing...":"Reject"})]})},f=e=>{let{WARD_ORDER:t,formData:a,handleInputChange:s,displayValue:n,approvalStatuses:l={},selectedDate:o}=e;return(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("div",{className:"inline-flex gap-1 min-w-max p-1",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h3",{className:"text-xs font-bold text-gray-700 font-THSarabun",children:"Wards"})}),t.map(e=>(0,r.jsx)("div",{className:"h-8 flex items-center",children:(0,r.jsx)("span",{className:"text-xs font-semibold text-[#0ab4ab] font-THSarabun whitespace-nowrap",children:i[e]||e})},e)),(0,r.jsx)("div",{className:"h-8 flex items-center",children:(0,r.jsx)("span",{className:"text-xs font-semibold text-purple-600 font-THSarabun",children:"Total"})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Patient Census"})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-[#0ab4ab]/20 to-[#0ab4ab]/10 rounded-md p-1 text-[#0ab4ab] shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(null===(t=a.wards[e])||void 0===t?void 0:t.numberOfPatients),className:"w-16 text-center text-sm font-bold bg-gray-100 border-b border-[#0ab4ab] focus:outline-none text-[#0ab4ab] placeholder-[#0ab4ab]/50 font-THSarabun cursor-not-allowed",placeholder:"0",readOnly:!0,disabled:!0})})},e)}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(a.totals.numberOfPatients),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Overall Data"})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-400/20 to-blue-500/10 rounded-md p-1 text-blue-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(null===(t=a.wards[e])||void 0===t?void 0:t.overallData),className:"w-16 text-center text-sm font-bold bg-gray-100 border-b border-blue-500 focus:outline-none text-blue-600 placeholder-blue-300 font-THSarabun cursor-not-allowed",placeholder:"0",readOnly:!0,disabled:!0})})},e)}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(a.totals.overallData),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]}),Object.entries({"Nurse Manager":"nurseManager",RN:"RN",PN:"PN",WC:"WC"}).map(e=>{let[l,i]=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:l})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-400/20 to-green-500/10 rounded-md p-1 text-green-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(null===(t=a.wards[e])||void 0===t?void 0:t[i]),onChange:t=>s("staff",e,{[i]:t.target.value}),className:"w-16 text-center text-sm font-bold bg-white border-b border-green-500 focus:outline-none focus:border-green-500 text-black placeholder-green-300 font-THSarabun",placeholder:"0",min:"0"})})},e)}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(a.totals[i]),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},i)}),Object.entries({"New Admit":"newAdmit","Transfer In":"transferIn","Refer In":"referIn","Transfer Out":"transferOut","Refer Out":"referOut",Discharge:"discharge",Dead:"dead"}).map(e=>{let[l,i]=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:l})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-yellow-400/20 to-yellow-500/10 rounded-md p-1 text-yellow-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(null===(t=a.wards[e])||void 0===t?void 0:t[i]),onChange:t=>s("movement",e,{[i]:t.target.value}),className:"w-16 text-center text-sm font-bold bg-white border-b border-yellow-500 focus:outline-none focus:border-yellow-500 text-black placeholder-yellow-300 font-THSarabun",placeholder:"0",min:"0"})})},e)}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(a.totals[i]),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},i)}),Object.entries({Available:"availableBeds",Unavailable:"unavailable","Planned Discharge":"plannedDischarge"}).map(e=>{let[l,i]=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:l})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-pink-400/20 to-pink-500/10 rounded-md p-1 text-pink-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(null===(t=a.wards[e])||void 0===t?void 0:t[i]),onChange:t=>s("info",e,{[i]:t.target.value}),className:"w-16 text-center text-sm font-bold bg-white border-b border-pink-500 focus:outline-none focus:border-pink-500 text-black placeholder-pink-300 font-THSarabun",placeholder:"0",min:"0"})})},e)}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(a.totals[i]),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},i)}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Comment"})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-gray-100 to-gray-200 rounded-md p-1 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",value:(null===(t=a.wards[e])||void 0===t?void 0:t.comment)||"",onChange:t=>s("comment",e,{comment:t.target.value}),className:"w-24 text-center text-xs bg-white border-b border-gray-400 focus:outline-none focus:border-gray-600 text-black placeholder-gray-300 font-THSarabun",placeholder:"Add comment..."})})},e)}),(0,r.jsx)("div",{className:"h-8"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Approval Status"})}),t.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-100 to-blue-200 rounded-md p-1 shadow h-8",children:(0,r.jsx)("div",{className:"text-center flex justify-center items-center",children:l[e]?(0,r.jsx)(m,{wardId:e,date:o,status:l[e]}):(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"No data"})})},e)),(0,r.jsx)("div",{className:"h-8"})]})]})})},h=e=>{let{label:t,oldValue:a,newValue:s}=e;return(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 py-1",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600",children:t}),(0,r.jsx)("div",{className:"text-sm text-purple-600",children:a||"-"}),(0,r.jsx)("div",{className:"text-sm text-pink-600",children:s||"-"})]})},b=e=>{let{showDataComparison:t,existingData:a,formData:s,summaryData:n,setShowDataComparison:l,saveData:i,WARD_ORDER:o}=e;return t&&a?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-xl font-medium mb-4",children:"Data Comparison"}),(0,r.jsx)("div",{className:"space-y-4",children:o.map(e=>{var t,n,l,i;return(0,r.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-lg mb-2",children:e}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-2",children:[(0,r.jsx)("div",{className:"font-medium",children:"Field"}),(0,r.jsx)("div",{className:"font-medium",children:"Current"}),(0,r.jsx)("div",{className:"font-medium",children:"New"})]}),(0,r.jsx)("div",{className:"space-y-1",children:(0,r.jsx)(h,{label:"Patient Census",oldValue:null==a?void 0:null===(n=a.wards)||void 0===n?void 0:null===(t=n[e])||void 0===t?void 0:t.numberOfPatients,newValue:null==s?void 0:null===(i=s.wards)||void 0===i?void 0:null===(l=i[e])||void 0===l?void 0:l.numberOfPatients})})]},e)})}),(0,r.jsxs)("div",{className:"mt-6 flex justify-end gap-4",children:[(0,r.jsx)("button",{onClick:()=>l(!1),className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"}),(0,r.jsx)("button",{onClick:i,className:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600",children:"Save Changes"})]})]})}):null};var x=a(3665),g=a(3470);let p=e=>{let{summaryData:t,setSummaryData:a}=e;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6",children:(0,r.jsx)("div",{className:"grid grid-cols-1 gap-8",children:(0,r.jsxs)("div",{className:"bg-green-50/80 rounded-xl p-5 shadow-sm",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-green-800 mb-4 bg-white/50 py-2 px-4 rounded-lg text-center shadow-sm",children:"Supervisor Signature"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-green-700",children:"First Name"}),(0,r.jsx)("input",{type:"text",value:t.supervisorFirstName,onChange:e=>a(t=>({...t,supervisorFirstName:e.target.value})),className:"w-full text-black px-3 py-2 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-300 focus:border-green-300 bg-white/70",placeholder:"ชื่อ"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-green-700",children:"Last Name"}),(0,r.jsx)("input",{type:"text",value:t.supervisorLastName,onChange:e=>a(t=>({...t,supervisorLastName:e.target.value})),className:"w-full text-black px-3 py-2 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-300 focus:border-green-300 bg-white/70",placeholder:"นามสกุล"})]})]})]})})})},v=e=>{let{summaryData:t,setSummaryData:a}=e;return(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-center mb-6 text-indigo-800 bg-white/50 py-2 rounded-lg shadow-sm",children:"ข้อมูลสรุป 24 ชั่วโมง"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"bg-pink-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-pink-700 mb-2",children:"OPD 24hr"}),(0,r.jsx)("input",{type:"number",value:t.opdTotal24hr,onChange:e=>a(t=>({...t,opdTotal24hr:e.target.value})),className:"w-full text-black px-3 py-2 border border-pink-200 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-pink-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-purple-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"Old Patient"}),(0,r.jsx)("input",{type:"number",value:t.existingPatients,onChange:e=>a(t=>({...t,existingPatients:e.target.value})),className:"w-full text-black px-3 py-2 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"New Patient"}),(0,r.jsx)("input",{type:"number",value:t.newPatients,onChange:e=>a(t=>({...t,newPatients:e.target.value})),className:"w-full text-black px-3 py-2 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-300 focus:border-blue-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-teal-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-teal-700 mb-2",children:"Admit 24hr"}),(0,r.jsx)("input",{type:"number",value:t.admissions24hr,onChange:e=>a(t=>({...t,admissions24hr:e.target.value})),className:"w-full text-black px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-300 focus:border-teal-300 bg-white/70",placeholder:"0"})]})]})]})};var w=a(2577);let N=e=>{let{showCalendar:t,setShowCalendar:a,selectedDate:s,setSelectedDate:n,formData:l,setFormData:i,thaiDate:o,setThaiDate:d,fetchPreviousShiftData:c,handleShiftChange:m,datesWithData:f,checkExistingData:h,setSummaryData:b}=e;return(0,r.jsxs)("div",{className:"bg-gradient-to-br from-[#0ab4ab]/5 via-blue-50 to-purple-50 rounded-2xl p-4 mb-3 shadow-lg",children:[(0,r.jsxs)("div",{className:"text-center mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Logo",className:"w-8 h-8 object-contain"}),(0,r.jsx)("h1",{className:"text-xl font-bold bg-gradient-to-r from-[#0ab4ab] to-blue-600 text-transparent bg-clip-text mb-1",children:"Daily Patient Census and Staffing"})]}),(0,r.jsx)("div",{className:"h-0.5 w-24 mx-auto bg-gradient-to-r from-[#0ab4ab] to-blue-600 rounded-full"})]}),(0,r.jsx)("div",{className:"space-y-3",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsx)("div",{className:"bg-white/60 backdrop-blur-sm rounded-xl p-3 shadow-sm hover:shadow-md transition-all",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>a(!t),className:"w-full md:w-auto px-4 py-2 bg-gradient-to-r from-[#0ab4ab] to-blue-500 text-white rounded-lg hover:from-[#0ab4ab]/90 hover:to-blue-600 transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[#0ab4ab] focus:ring-opacity-50 shadow-md text-sm",children:t?"ซ่อนปฏิทิน":"เลือกวันที่"}),(0,r.jsxs)("div",{className:"text-gray-700 space-y-0.5 text-center md:text-left text-sm",children:[(0,r.jsxs)("div",{className:"font-medium text-[#0ab4ab]",children:["วันที่ปัจจุบัน : ",(0,x.mI)(new Date)]}),(0,r.jsxs)("div",{className:"text-blue-600",children:["อัพเดทข้อมูลล่าสุด : ",o]})]})]})}),(0,r.jsx)("div",{className:"bg-white/60 backdrop-blur-sm rounded-xl p-3 shadow-sm hover:shadow-md transition-all",children:(0,r.jsx)("div",{className:"flex flex-col md:flex-row justify-center gap-4",children:["07:00-19:00","19:00-07:00"].map(e=>(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsxs)("label",{className:"relative flex items-center gap-2 cursor-pointer group",children:[(0,r.jsx)("input",{type:"radio",name:"shift",value:e,checked:l.shift===e,onChange:e=>m(e.target.value),className:"hidden"}),(0,r.jsx)("div",{className:"w-4 h-4 rounded-full border-2 transition-all ".concat(l.shift===e?"border-[#0ab4ab] bg-[#0ab4ab]":"border-gray-300 group-hover:border-[#0ab4ab]/50"),children:l.shift===e&&(0,r.jsx)("div",{className:"w-1.5 h-1.5 bg-white rounded-full m-auto mt-0.5"})}),(0,r.jsxs)("span",{className:"text-sm transition-colors ".concat(l.shift===e?"text-[#0ab4ab] font-medium":"text-gray-600"),children:["07:00-19:00"===e?"เช้า":"ดึก"," (",e,")",e===l.shift&&(0,r.jsx)("span",{className:"ml-1 text-xs px-1.5 py-0.5 bg-[#0ab4ab]/10 text-[#0ab4ab] rounded-full",children:"กะที่เลือกก่อนหน้านั้น"})]})]})},e))})})]})}),t&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:(0,r.jsx)("div",{className:"relative bg-white rounded-2xl shadow-2xl transform transition-all",children:(0,r.jsx)(w.A,{selectedDate:s,datesWithData:f,onDateSelect:async e=>{let t=new Date(e);t.setHours(0,0,0,0);let r=t.getTimezoneOffset();t.setMinutes(t.getMinutes()-r);let s=t.toISOString().split("T")[0];!await h(s,l.shift)&&(await u().fire({title:"ยืนยันการเปลี่ยนวันที่",html:'\n                                            <div class="text-left">\n                                                <p class="font-semibold mb-2">ข้อมูลต่อไปนี้จะถูกล้าง:</p>\n                                                <ul class="list-disc pl-5 space-y-1 text-sm">\n                                                    <li>ข้อมูลเจ้าหน้าที่ (Nurse Manager, RN, PN, WC)</li>\n                                                    <li>ข้อมูลการเคลื่อนย้ายผู้ป่วย</li>\n                                                    <li>ข้อมูลเตียง</li>\n                                                    <li>Comments</li>\n                                                    <li>ข้อมูลสรุป 24 ชั่วโมง</li>\n                                                    <li>ลายเซ็นผู้ตรวจการและผู้บันทึก</li>\n                                                </ul>\n                                                <p class="mt-4 text-sm text-gray-600">*Patient Census และ Overall Data จะถูกคำนวณใหม่</p>\n                                            </div>\n                                        ',icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed&&(await c(s,l.shift),i(e=>{let t={};return Object.entries(e.wards).forEach(e=>{let[a,r]=e;t[a]={numberOfPatients:r.numberOfPatients,overallData:r.overallData,nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",availableBeds:"0",unavailable:"0",plannedDischarge:"0",comment:""}}),{...e,date:s,wards:t}}),b({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:"",recorderFirstName:"",recorderLastName:""}),n(t),d((0,x.mI)(t)),a(!1),await u().fire({title:"ล้างข้อมูลสำเร็จ",text:"ระบบได้ล้างข้อมูลและคงค่า Patient Census และ Overall Data ไว้",icon:"success",confirmButtonColor:"#0ab4ab"}))},onClickOutside:()=>a(!1),variant:"form"})})})]})};var j=a(6046);let y=()=>{let e=(0,j.useRouter)(),[t,a]=(0,s.useState)(0),[i,c]=(0,s.useState)(!0),[m,h]=(0,s.useState)(!1),[w,y]=(0,s.useState)(!1),[D,C]=(0,s.useState)(new Date),[O,S]=(0,s.useState)([]),[I,P]=(0,s.useState)(""),[B,k]=(0,s.useState)({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:""}),[T,W]=(0,s.useState)({date:"",shift:"",wards:{Ward6:{...d},Ward7:{...d},Ward8:{...d},Ward9:{...d},WardGI:{...d},Ward10B:{...d},Ward11:{...d},Ward12:{...d},ICU:{...d},CCU:{...d},LR:{...d},NSY:{...d}},totals:{...d}}),[R,M]=(0,s.useState)(!1),[E,A]=(0,s.useState)(null),[L,H]=(0,s.useState)({initialLoading:!0,savingData:!1,checkingDuplicates:!1,fetchingDates:!1}),[_,G]=(0,s.useState)(""),[F,z]=(0,s.useState)(!1),[U,J]=(0,s.useState)(!1),[Y,V]=(0,s.useState)({});(0,s.useEffect)(()=>{let e=()=>window.innerWidth<768,t=()=>{J(e())};return J(e()),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),(0,s.useEffect)(()=>{setTimeout(()=>{c(!1)},1e3)},[]);let K=async e=>{try{if(!e)return;let t=(0,x.Ol)(new Date(e)),a=(0,l.rJ)(n.db,"wardDailyRecords"),r={};for(let e of o){let s=(0,l.P)(a,(0,l._M)("date","==",t),(0,l._M)("wardId","==",e)),n=await (0,l.GG)(s);if(n.empty)r[e]=null;else{let t=n.docs[0].data();r[e]=t.approvalStatus||"pending"}}V(r),console.log("Fetched approval statuses:",r)}catch(e){console.error("Error fetching approval statuses:",e)}};(0,s.useEffect)(()=>{{let e=new Date;C(e);let t=e.toISOString().split("T")[0],a=(0,g.Se)();W(e=>({...e,date:t,shift:a})),P((0,x.mI)(e)),$(t),ee(t),eh(),em(),K(t)}},[]);let[q,Z]=(0,s.useState)(!1),[Q,X]=(0,s.useState)(!1),$=async e=>{try{let t=(0,l.rJ)(n.db,"staffRecords"),a=(0,l.P)(t,(0,l._M)("date","==",e),(0,l._M)("shift","==","07:00-19:00")),r=!(await (0,l.GG)(a)).empty;return Z(r),r}catch(e){return console.error("Error checking morning shift data:",e),Z(!1),!1}},ee=async e=>{try{let t=(0,l.rJ)(n.db,"staffRecords"),a=new Date(e);a.setDate(a.getDate()-1);let r=a.toISOString().split("T")[0],s=(0,l.P)(t,(0,l._M)("date","==",r),(0,l._M)("shift","==","19:00-07:00")),i=!(await (0,l.GG)(s)).empty;return X(i),i}catch(e){return console.error("Error checking previous night shift data:",e),X(!1),!1}},et=async e=>{try{let t=(0,l.rJ)(n.db,"staffRecords"),a=(0,l.P)(t,(0,l._M)("date","==",e)),r=await (0,l.GG)(a),s=new Set(r.docs.map(e=>e.data().shift));return{hasMorningShift:s.has("07:00-19:00"),hasNightShift:s.has("19:00-07:00")}}catch(e){return console.error("Error checking date shifts:",e),{hasMorningShift:!1,hasNightShift:!1}}},ea=(0,s.useMemo)(()=>Object.values(T.wards).reduce((e,t)=>({numberOfPatients:e.numberOfPatients+(Number(t.numberOfPatients)||0),nurseManager:e.nurseManager+(Number(t.nurseManager)||0),RN:e.RN+(Number(t.RN)||0),PN:e.PN+(Number(t.PN)||0),WC:e.WC+(Number(t.WC)||0),newAdmit:e.newAdmit+(Number(t.newAdmit)||0),transferIn:e.transferIn+(Number(t.transferIn)||0),referIn:e.referIn+(Number(t.referIn)||0),transferOut:e.transferOut+(Number(t.transferOut)||0),referOut:e.referOut+(Number(t.referOut)||0),discharge:e.discharge+(Number(t.discharge)||0),dead:e.dead+(Number(t.dead)||0),overallData:e.overallData+(Number(t.overallData)||0),availableBeds:e.availableBeds+(Number(t.availableBeds)||0),unavailable:e.unavailable+(Number(t.unavailable)||0),plannedDischarge:e.plannedDischarge+(Number(t.plannedDischarge)||0)}),{numberOfPatients:0,nurseManager:0,RN:0,PN:0,WC:0,newAdmit:0,transferIn:0,referIn:0,transferOut:0,referOut:0,discharge:0,dead:0,overallData:0,availableBeds:0,unavailable:0,plannedDischarge:0}),[T.wards]);(0,s.useEffect)(()=>{W(e=>({...e,totals:ea}))},[ea]);let er=(0,s.useCallback)((e,t,a)=>{W(e=>{let r={...e.wards[t],...a},s=parseInt(r.numberOfPatients||"0"),n=parseInt(r.newAdmit||"0"),l=parseInt(r.transferIn||"0"),i=parseInt(r.referIn||"0"),o=parseInt(r.transferOut||"0"),d=Math.max(0,s+n+l+i+o-parseInt(r.referOut||"0")-parseInt(r.discharge||"0")-parseInt(r.dead||"0")).toString();r.overallData=d;let c={...e.wards,[t]:r},u=Object.values(c).reduce((e,t)=>({numberOfPatients:e.numberOfPatients+(parseInt(t.numberOfPatients)||0),nurseManager:e.nurseManager+(parseInt(t.nurseManager)||0),RN:e.RN+(parseInt(t.RN)||0),PN:e.PN+(parseInt(t.PN)||0),WC:e.WC+(parseInt(t.WC)||0),newAdmit:e.newAdmit+(parseInt(t.newAdmit)||0),transferIn:e.transferIn+(parseInt(t.transferIn)||0),referIn:e.referIn+(parseInt(t.referIn)||0),transferOut:e.transferOut+(parseInt(t.transferOut)||0),referOut:e.referOut+(parseInt(t.referOut)||0),discharge:e.discharge+(parseInt(t.discharge)||0),dead:e.dead+(parseInt(t.dead)||0),overallData:e.overallData+(parseInt(t.overallData)||0),availableBeds:e.availableBeds+(parseInt(t.availableBeds)||0),unavailable:e.unavailable+(parseInt(t.unavailable)||0),plannedDischarge:e.plannedDischarge+(parseInt(t.plannedDischarge)||0)}),{numberOfPatients:0,nurseManager:0,RN:0,PN:0,WC:0,newAdmit:0,transferIn:0,referIn:0,transferOut:0,referOut:0,discharge:0,dead:0,overallData:0,availableBeds:0,unavailable:0,plannedDischarge:0});return{...e,wards:c,totals:u}})},[]);(0,s.useCallback)(()=>{let e=new Date,t=new Date(D);return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},[D]);let es=()=>{if(!T.date)return!1;let e=new Date(T.date),t=new Date;return t.setDate(t.getDate()+1),e.setHours(0,0,0,0),t.setHours(0,0,0,0),e>t};(0,s.useCallback)(()=>Object.values(T.wards).some(e=>Object.entries(e).some(e=>{let[t,a]=e;return"comment"!==t&&""!==a&&"0"!==a})),[T.wards]);let en=(0,s.useCallback)(()=>{let e={staff:!1,movement:!1,additional:!1};return Object.values(T.wards).forEach(t=>{("0"!==t.nurseManager||"0"!==t.RN||"0"!==t.PN||"0"!==t.WC)&&(e.staff=!0),("0"!==t.newAdmit||"0"!==t.transferIn||"0"!==t.referIn||"0"!==t.transferOut||"0"!==t.referOut||"0"!==t.discharge||"0"!==t.dead)&&(e.movement=!0),("0"!==t.availableBeds||"0"!==t.unavailable||"0"!==t.plannedDischarge||""!==t.comment.trim())&&(e.additional=!0)}),e},[T.wards]),el=(0,s.useCallback)(()=>{let e=en(T);return e.staff||e.movement||e.additional},[T]);(0,s.useEffect)(()=>{z(el())},[T,el]),(0,s.useEffect)(()=>{let e=e=>{F&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[F]),(0,s.useEffect)(()=>{var t;let a=async()=>{if(F&&!(await u().fire({title:"แจ้งเตือนการออกจากหน้าบันทึกข้อมูล",html:'\n                        <div class="text-left">\n                            <p class="font-semibold">ท่านกำลังดำเนินการบันทึกข้อมูลอยู่</p>\n                            <div class="mt-4 space-y-2">\n                                <p class="text-gray-600">การออกจากหน้านี้จะส่งผลให้:</p>\n                                <ul class="list-disc pl-5 text-sm text-gray-600">\n                                    <li>ข้อมูลที่กำลังบันทึกจะถูกรีเซ็ตทั้งหมด</li>\n                                    <li>ท่านจะต้องเริ่มกรอกข้อมูลใหม่เมื่อกลับมาที่หน้านี้</li>\n                                </ul>\n                            </div>\n                            <p class="mt-4 text-sm font-medium text-gray-700">โปรดยืนยันการดำเนินการ</p>\n                        </div>\n                    ',icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยันการออกจากหน้านี้",cancelButtonText:"ยกเลิกและกลับไปบันทึกข้อมูล",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",reverseButtons:!0})).isConfirmed)throw"Route Cancelled"};return null===(t=e.events)||void 0===t||t.on("routeChangeStart",a),()=>{var t;null===(t=e.events)||void 0===t||t.off("routeChangeStart",a)}},[F,e]);let ei=(0,s.useCallback)(async()=>{var e,t;console.log("Validating form data...",T);let a=new Date(new Date(T.date));a.setDate(a.getDate()-1);let r=a.toISOString().split("T")[0],s=await et(r);if(!s.hasNightShift&&s.hasMorningShift)return await u().fire({title:"ไม่สามารถบันทึกข้อมูลได้",html:"วันที่ ".concat((0,x.mI)(a)," ยังไม่ได้บันทึกข้อมูลกะดึก<br>กรุณาบันทึกข้อมูลกะดึกของวันที่ ").concat((0,x.mI)(a)," ก่อน"),icon:"error",confirmButtonColor:"#0ab4ab"}),!1;for(let a of[{condition:!T.date||""===T.date.trim(),message:"กรุณาเลือกวันที่ก่อนดำเนินการต่อ"},{condition:!T.shift||""===T.shift.trim(),message:"กรุณาเลือกกะการทำงาน"},{condition:es(),message:"ไม่สามารถบันทึกข้อมูลล่วงหน้าเกิน 1 วันได้"},{condition:"19:00-07:00"===T.shift&&!q,message:"ไม่สามารถบันทึกข้อมูลกะดึกได้ เนื่องจากยังไม่มีการบันทึกข้อมูลกะเช้าก่อน"},{condition:!(null===(e=B.supervisorFirstName)||void 0===e?void 0:e.trim())||!(null===(t=B.supervisorLastName)||void 0===t?void 0:t.trim()),message:"กรุณากรอกชื่อและนามสกุลผู้ตรวจการ"}])if(a.condition)return console.log("Validation failed:",a.message),a.message&&alert(a.message),!1;return!0},[T,B,es,q]),eo=()=>{u().fire({title:"ล้างข้อมูล?",text:"คุณต้องการล้างข้อมูลทั้งหมดใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33",confirmButtonText:"ใช่, ล้างข้อมูล",cancelButtonText:"ยกเลิก"}).then(e=>{e.isConfirmed&&(W(e=>{let t={};return Object.entries(e.wards).forEach(e=>{let[a,r]=e;t[a]={...r,nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",availableBeds:"0",unavailable:"0",plannedDischarge:"0",comment:""}}),{...e,wards:t}}),k({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:""}),z(!1),u().fire({title:"ล้างข้อมูลสำเร็จ",text:"กรุณาเลือกวันที่อีกครั้ง หรือตรวจสอบข้อมูลโดยรวมในหน้า Dashboard",icon:"success",confirmButtonColor:"#0ab4ab"}))})},ed=async e=>{if(e.preventDefault(),await ei()&&(await u().fire({title:"ยืนยันการบันทึกข้อมูล",text:"โปรดยืนยันว่าข้อมูลได้รับการตรวจสอบเรียบร้อยแล้ว",icon:"question",showCancelButton:!0,confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33",confirmButtonText:"บันทึกข้อมูล",cancelButtonText:"แก้ไขข้อมูล"})).isConfirmed)try{u().fire({title:"กำลังตรวจสอบข้อมูล",text:"กรุณารอสักครู่",allowOutsideClick:!1,didOpen:()=>{u().showLoading()}});let e=(0,l.rJ)(n.db,"staffRecords"),t=(0,l.P)(e,(0,l._M)("date","==",T.date),(0,l._M)("shift","==",T.shift)),a=await (0,l.GG)(t);if(!a.empty){let e=await u().fire({title:"พบข้อมูลซ้ำ",html:"พบข้อมูลของวันที่ ".concat((0,x.mI)(T.date)," กะ ").concat(T.shift," ในระบบแล้ว<br><br>คุณต้องการดำเนินการอย่างไร?"),icon:"warning",showCancelButton:!0,showDenyButton:!0,confirmButtonText:"บันทึกทับ",denyButtonText:"ดูข้อมูลเดิม",cancelButtonText:"ยกเลิก",confirmButtonColor:"#0ab4ab",denyButtonColor:"#3085d6",cancelButtonColor:"#d33"});if(e.isDenied){let e=a.docs[0];A({id:e.id,...e.data()}),M(!0)}else e.isConfirmed&&(await eu(!0),window.location.reload());return}await eu(),z(!1)}catch(e){console.error("Error checking duplicates:",e),u().fire({title:"เกิดข้อผิดพลาด",text:e.message,icon:"error",confirmButtonColor:"#0ab4ab"})}},ec=async(e,t)=>{try{let a=(0,l.rJ)(n.db,"staffRecords"),r=(0,l.P)(a,(0,l._M)("date","==",e),(0,l._M)("shift","==",t));if(!(await (0,l.GG)(r)).empty)return await u().fire({title:"แจ้งเตือน",html:"มีข้อมูลของวันที่ ".concat((0,x.mI)(e)," กะ ").concat(t," ในระบบแล้ว<br><br>หากต้องการแก้ไขข้อมูล กรุณาดำเนินการบันทึกข้อมูลใหม่"),icon:"info",confirmButtonColor:"#0ab4ab"}),!0;return!1}catch(e){return console.error("Error checking existing data:",e),!1}},eu=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];H(e=>({...e,savingData:!0})),G("กำลังบันทึกข้อมูล...");try{let t=new Date().toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":",""),a=T.date.replace(/-/g,""),r=e&&E?E.id:"data_".concat(t,"_").concat(a);console.log("Saving data with ID:",r);let s={date:T.date,shift:T.shift,wards:Object.fromEntries(Object.entries(T.wards).map(e=>{let[t,a]=e;return[t,{numberOfPatients:a.numberOfPatients||"0",nurseManager:a.nurseManager||"0",RN:a.RN||"0",PN:a.PN||"0",WC:a.WC||"0",newAdmit:a.newAdmit||"0",transferIn:a.transferIn||"0",referIn:a.referIn||"0",transferOut:a.transferOut||"0",referOut:a.referOut||"0",discharge:a.discharge||"0",dead:a.dead||"0",overallData:a.overallData||"0",availableBeds:a.availableBeds||"0",plannedDischarge:a.plannedDischarge||"0",unavailable:a.unavailable||"0",comment:a.comment||""}]})),summaryData:{opdTotal24hr:B.opdTotal24hr||"",existingPatients:B.existingPatients||"",newPatients:B.newPatients||"",admissions24hr:B.admissions24hr||"",supervisorFirstName:B.supervisorFirstName||"",supervisorLastName:B.supervisorLastName||""},timestamp:(0,l.O5)(),lastModified:(0,l.O5)()};console.log("Saving sanitized data:",s),await (0,l.BN)((0,l.H9)(n.db,"staffRecords",r),s);let i=Object.entries(T.wards).map(async e=>{let[t,a]=e;if(Object.values(a).some(e=>"0"!==e&&""!==e)){let e=(0,l.H9)(n.db,"wardDailyRecords","".concat(T.date,"_").concat(t));try{await (0,l.BN)(e,{wardId:t,date:T.date,patientCensus:a.numberOfPatients||"0",overallData:a.overallData||"0",approvalStatus:"pending",lastUpdated:(0,l.O5)(),shifts:{[T.shift]:{nurseManager:a.nurseManager||"0",RN:a.RN||"0",PN:a.PN||"0",WC:a.WC||"0",newAdmit:a.newAdmit||"0",transferIn:a.transferIn||"0",referIn:a.referIn||"0",transferOut:a.transferOut||"0",referOut:a.referOut||"0",discharge:a.discharge||"0",dead:a.dead||"0",availableBeds:a.availableBeds||"0",unavailable:a.unavailable||"0",plannedDischarge:a.plannedDischarge||"0",comment:a.comment||""}}},{merge:!0})}catch(e){console.error("Error saving wardDailyRecord for ".concat(t,":"),e)}}});await Promise.all(i),await K(T.date),G("บันทึกข้อมูลสำเร็จ กำลังรีเซ็ตฟอร์ม..."),await new Promise(e=>setTimeout(e,1e3)),console.log("Data saved successfully"),eo(),u().fire({title:"บันทึกข้อมูลสำเร็จ",text:"ข้อมูลถูกบันทึกเรียบร้อยแล้ว",icon:"success",confirmButtonColor:"#0ab4ab"}).then(()=>{window.location.reload()})}catch(e){console.error("Error saving data:",e),u().fire({title:"เกิดข้อผิดพลาด",text:e.message,icon:"error",confirmButtonColor:"#0ab4ab"})}finally{H(e=>({...e,savingData:!1,checkingDuplicates:!1})),G(""),M(!1)}},em=async()=>{try{let e=(0,l.rJ)(n.db,"staffRecords"),t=new Date(new Date().getFullYear(),0,1),a=new Date(new Date().getFullYear(),11,31),r=(0,l.P)(e,(0,l._M)("date",">=",(0,x.Ol)(t)),(0,l._M)("date","<=",(0,x.Ol)(a))),s=await (0,l.GG)(r),i={};s.docs.forEach(e=>{let t=e.data();i[t.date]||(i[t.date]=new Set),i[t.date].add(t.shift)});let o=Object.entries(i).map(e=>{let[t,a]=e;return{date:t,shifts:Array.from(a),isComplete:2===a.size}});S(o)}catch(e){console.error("Error fetching dates with data:",e),S([])}};(0,s.useEffect)(()=>{em()},[]),(0,s.useEffect)(()=>()=>{c(!1),h(!1),y(!1)},[]);let ef=async(e,t)=>{try{G("กำลังดึงข้อมูลจากระบบ");let a=(0,l.rJ)(n.db,"wardDailyRecords"),r=new Date(e),s="";"19:00-07:00"===t?(s="07:00-19:00",G("กำลังดึงข้อมูลจากกะเช้า-บ่าย (".concat(s,")"))):(r.setDate(r.getDate()-1),s="19:00-07:00",G("กำลังดึงข้อมูลจากกะดึกของวันก่อนหน้า (".concat(s,")")));let i=(0,x.Ol)(r),o=(0,x.mI)(r).replace("เพิ่มข้อมูล วันที่: ","");G("กำลังดึงข้อมูล Overall Data\nจากวันที่ ".concat(o,"\nกะ ").concat(s));let d=(0,l.P)(a,(0,l._M)("date","==",i)),c=await (0,l.GG)(d),u={...T.wards};if(c.empty){G("กำลังค้นหาข้อมูลล่าสุด...");let e=(0,l.P)(a,(0,l._M)("date","<=",i),(0,l.My)("date","desc"),(0,l.AB)(1)),t=await (0,l.GG)(e);if(t.empty)G("ไม่พบข้อมูลก่อนหน้า"),setTimeout(()=>G(""),2e3);else{let e=t.docs[0].data(),a=(0,x.mI)(new Date(e.date)).replace("เพิ่มข้อมูล วันที่: ","");G("พบข้อมูลล่าสุดจาก\nวันที่ ".concat(a)),Object.keys(T.wards).forEach(e=>{var t;let a=null===(t=c.docs.find(t=>t.data().wardId===e))||void 0===t?void 0:t.data();a&&(u[e]={...T.wards[e],numberOfPatients:a.overallData||"0",overallData:a.overallData||"0"})}),W(e=>({...e,wards:u})),setTimeout(()=>G(""),2e3)}}else c.docs.forEach(e=>{let t=e.data(),a=t.wardId;t.shifts&&t.shifts[s]&&(t.shifts[s],u[a]={...T.wards[a],numberOfPatients:t.overallData||"0",overallData:t.overallData||"0"})}),W(e=>({...e,wards:u})),G("ดึงข้อมูลสำเร็จ\nจากวันที่ ".concat(o,"\nกะ ").concat(s)),setTimeout(()=>G(""),2e3)}catch(e){console.error("Error fetching previous shift data:",e),G("เกิดข้อผิดพลาด: ".concat(e.message)),setTimeout(()=>G(""),3e3)}},eh=async()=>{try{u().fire({title:"กำลังโหลดข้อมูล...",text:"กรุณารอสักครู่",allowOutsideClick:!1,didOpen:()=>{u().showLoading()}});let e=(0,l.rJ)(n.db,"staffRecords"),t=(0,l.P)(e,(0,l.My)("timestamp","desc"),(0,l.AB)(1)),a=await (0,l.GG)(t);if(a.empty)console.log("No data found"),u().fire({title:"ไม่พบข้อมูล",text:"ไม่พบข้อมูลการบันทึกล่าสุด",icon:"info",confirmButtonColor:"#0ab4ab"});else{let e=a.docs[0].data(),t=(0,x.mI)(new Date(e.date));u().fire({title:"โหลดข้อมูลสำเร็จ",text:"ดึงข้อมูลล่าสุดจากวันที่ ".concat(t," กะ ").concat(e.shift),icon:"success",confirmButtonColor:"#0ab4ab"});let r={};Object.entries(e.wards||{}).forEach(e=>{let[t,a]=e;r[t]={...d,...a,numberOfPatients:((null==a?void 0:a.numberOfPatients)||"0").toString(),nurseManager:((null==a?void 0:a.nurseManager)||"0").toString(),RN:((null==a?void 0:a.RN)||"0").toString(),PN:((null==a?void 0:a.PN)||"0").toString(),WC:((null==a?void 0:a.WC)||"0").toString(),newAdmit:((null==a?void 0:a.newAdmit)||"0").toString(),transferIn:((null==a?void 0:a.transferIn)||"0").toString(),referIn:((null==a?void 0:a.referIn)||"0").toString(),transferOut:((null==a?void 0:a.transferOut)||"0").toString(),referOut:((null==a?void 0:a.referOut)||"0").toString(),discharge:((null==a?void 0:a.discharge)||"0").toString(),dead:((null==a?void 0:a.dead)||"0").toString(),overallData:((null==a?void 0:a.overallData)||"0").toString(),availableBeds:((null==a?void 0:a.availableBeds)||"0").toString(),unavailable:((null==a?void 0:a.unavailable)||"0").toString(),plannedDischarge:((null==a?void 0:a.plannedDischarge)||"0").toString(),comment:(null==a?void 0:a.comment)||""}}),W(t=>({...t,date:e.date||new Date().toISOString().split("T")[0],shift:e.shift||"",wards:{...t.wards,...r}})),e.summaryData&&k(t=>({...t,opdTotal24hr:e.summaryData.opdTotal24hr||"",existingPatients:e.summaryData.existingPatients||"",newPatients:e.summaryData.newPatients||"",admissions24hr:e.summaryData.admissions24hr||"",supervisorFirstName:e.summaryData.supervisorFirstName||"",supervisorLastName:e.summaryData.supervisorLastName||""}));let s=new Date(e.date);C(s),P((0,x.mI)(s)),console.log("Data loaded successfully:",r)}}catch(e){console.error("Error fetching latest data:",e),u().fire({title:"เกิดข้อผิดพลาด",text:e.message,icon:"error",confirmButtonColor:"#0ab4ab"})}finally{setTimeout(()=>{G("")},2e3)}},eb=(0,s.useCallback)(()=>{let e=Object.values(T.wards).some(e=>"0"!==e.nurseManager||"0"!==e.RN||"0"!==e.PN||"0"!==e.WC||"0"!==e.newAdmit||"0"!==e.transferIn||"0"!==e.referIn||"0"!==e.transferOut||"0"!==e.referOut||"0"!==e.discharge||"0"!==e.dead||"0"!==e.availableBeds||"0"!==e.unavailable||"0"!==e.plannedDischarge||""!==e.comment.trim()),t=""!==B.opdTotal24hr||""!==B.existingPatients||""!==B.newPatients||""!==B.admissions24hr||""!==B.supervisorFirstName||""!==B.supervisorLastName;return e||t},[T.wards,B]);(0,s.useEffect)(()=>{z(eb())},[T,B,eb]);let ex=async()=>{F?(await u().fire({title:"แจ้งเตือนการเปลี่ยนหน้า",html:'\n                    <div class="text-left">\n                        <p class="font-semibold text-red-600">ข้อควรระวัง: พบข้อมูลที่ยังไม่ได้บันทึก</p>\n                        <div class="mt-4 space-y-2">\n                            <p class="text-gray-700">การเปลี่ยนไปยังหน้า Dashboard จะส่งผลดังนี้:</p>\n                            <ul className="list-disc pl-5 space-y-1">\n                                <li class="text-gray-600">ข้อมูลที่ท่านกรอกจะไม่ถูกบันทึก</li>\n                                <li class="text-gray-600">ข้อมูลทั้งหมดในแบบฟอร์มจะถูกรีเซ็ต</li>\n                                <li class="text-gray-600">ท่านจะต้องเริ่มกรอกข้อมูลใหม่เมื่อกลับมายังหน้านี้</li>\n                            </ul>\n                            <div className="mt-4 p-2 bg-yellow-50 border border-yellow-200 rounded-lg">\n                                <p className="text-sm text-yellow-700">\n                                    <span class="font-medium">คำแนะนำ:</span> กรุณาบันทึกข้อมูลให้เรียบร้อยก่อนออกจากหน้านี้\n                                </p>\n                                        </div>\n                                        </div>\n                                    </div>\n                ',icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยันการเปลี่ยนหน้า",cancelButtonText:"ยกเลิกและกลับไปบันทึกข้อมูล",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",reverseButtons:!0})).isConfirmed&&e.push("/dashboard"):e.push("/dashboard")};return(0,r.jsxs)("div",{className:"w-full px-2 py-2",children:[U&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-[#0ab4ab]/95 to-blue-600/95 backdrop-blur-md flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl text-center space-y-4",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Logo",className:"w-24 h-24 mx-auto mb-4 animate-pulse"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-[#0ab4ab]",children:"แจ้งเตือนการใช้งาน"}),(0,r.jsxs)("div",{className:"space-y-3 text-gray-600",children:[(0,r.jsx)("p",{className:"font-medium",children:"ระบบอยู่ระหว่างการพัฒนาสำหรับอุปกรณ์มือถือ"}),(0,r.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-xl",children:[(0,r.jsx)("p",{className:"text-sm",children:"เพื่อประสิทธิภาพในการใช้งานสูงสุด กรุณาใช้งานผ่าน:"}),(0,r.jsxs)("ul",{className:"text-sm mt-2 space-y-1",children:[(0,r.jsx)("li",{children:"• คอมพิวเตอร์ตั้งโต๊ะ (Desktop)"}),(0,r.jsx)("li",{children:"• คอมพิวเตอร์พกพา (Laptop)"})]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"หากมีข้อสงสัยกรุณาติดต่อผู้ดูแลระบบ"})]})]})}),(0,r.jsxs)("form",{onSubmit:ed,className:"w-full mx-auto",children:[i&&(0,r.jsx)("div",{className:"fixed inset-0 bg-white flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Loading",className:"w-32 h-32 mx-auto mb-4 animate-pulse"}),(0,r.jsx)("p",{className:"text-gray-600",children:"กำลังโหลด..."})]})}),(0,r.jsx)(b,{showDataComparison:R,existingData:E,formData:T,summaryData:B,setShowDataComparison:M,saveData:eu,WARD_ORDER:o}),(0,r.jsx)(N,{showCalendar:w,setShowCalendar:y,selectedDate:D,setSelectedDate:C,formData:T,setFormData:W,thaiDate:I,setThaiDate:P,fetchPreviousShiftData:ef,handleShiftChange:e=>{W(t=>({...t,shift:e}))},datesWithData:O,checkExistingData:ec,setSummaryData:k}),(0,r.jsx)("div",{className:"hidden md:block w-full",children:(0,r.jsxs)("div",{className:"w-full mx-auto p-4 bg-white rounded-xl shadow-lg border border-gray-200",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-pink-400/20 to-white p-2 rounded-lg",children:(0,r.jsx)("h2",{className:"text-lg font-bold text-pink-600 text-center mb-1",children:"Form"})}),(0,r.jsx)(f,{WARD_ORDER:o,formData:T,handleInputChange:er,displayValue:e=>null==e||""===e?"0":e,approvalStatuses:Y,selectedDate:D})]})}),(0,r.jsx)("div",{className:"hidden md:block mt-8",children:(0,r.jsxs)("div",{className:"bg-gradient-to-r from-[#0ab4ab]/10 to-white rounded-xl shadow-lg p-6",children:[(0,r.jsx)(v,{summaryData:B,setSummaryData:k}),(0,r.jsx)(p,{summaryData:B,setSummaryData:k})]})}),(0,r.jsx)("div",{className:"mt-8 flex justify-center p-6 bg-gradient-to-r from-[#0ab4ab]/10 to-white rounded-xl shadow-lg",children:(0,r.jsx)("button",{type:"submit",disabled:m,className:"px-12 py-4 bg-gradient-to-r from-[#0ab4ab] to-blue-400 text-white text-lg font-bold rounded-xl shadow-lg hover:from-[#0ab4ab] hover:to-blue-500 transition-all transform hover:scale-105 disabled:from-gray-400 disabled:to-gray-500 font-THSarabun",children:m?"Saving...":"Save Data"})}),(0,r.jsx)("button",{onClick:ex,className:"px-4 py-2 rounded-lg text-white hover:bg-[#0ab4ab]/80",children:"Dashboard"})]})]})}},3470:(e,t,a)=>{"use strict";a.d(t,{Se:()=>r});let r=()=>{let e=new Date().getHours();return e>=7&&e<19?"07:00-19:00":"19:00-07:00"}},5279:()=>{}}]);