(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1905:(e,r,t)=>{Promise.resolve().then(t.bind(t,5709)),Promise.resolve().then(t.t.bind(t,9324,23))},2808:(e,r,t)=>{"use strict";t.d(r,{O:()=>d,A:()=>c});var o=t(5155),a=t(2115);t(4197),t(5112);var s=t(9310),n=t(9770);let i=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,n.$s)(e,r)},l=(0,a.createContext)({user:null,loading:!0,isAuthenticated:!1,login:async(e,r)=>{},logout:()=>{}}),c=()=>(0,a.useContext)(l);function d(e){let{children:r}=e,[t,n]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(()=>{try{let e=localStorage.getItem("user");e&&n(JSON.parse(e)),d(!1)}catch(e){console.error("Error checking localStorage:",e),d(!1)}})()},[]);let u={user:t,loading:c,isAuthenticated:!!t,login:async(e,r)=>{console.log("Login function called with username:",e);try{let t=await (0,s.Lx)(e,r);if(t&&t.success){localStorage.setItem("user",JSON.stringify(t.user)),n(t.user);try{i("user_login",{userId:t.user.uid,username:e,role:t.user.role,name:t.user.displayName,timestamp:new Date().toISOString(),action:"Login success"})}catch(e){console.warn("Login logging failed:",e)}}return t}catch(e){return console.error("Login error:",e),{success:!1,error:e.message||"เกิดข้อผิดพลาดในการเข้าสู่ระบบ"}}},logout:()=>{try{let e=null==t?void 0:t.uid;return localStorage.removeItem("user"),n(null),i("user_logout",{userId:e,username:null==t?void 0:t.username,role:null==t?void 0:t.role,name:null==t?void 0:t.displayName,timestamp:new Date().toISOString(),action:"Logout success"}),!0}catch(e){return console.error("Logout error:",e),!1}}};return console.log("AuthContext value:",{user:!!u.user,loading:u.loading,isAuthenticated:u.isAuthenticated,hasLogin:"function"==typeof u.login,hasLogout:"function"==typeof u.logout}),(0,o.jsx)(l.Provider,{value:u,children:r})}},4197:(e,r,t)=>{"use strict";t.d(r,{db:()=>i});var o=t(3915),a=t(5112),s=t(7051);let n=(0,o.Dk)().length?(0,o.Dk)()[0]:(0,o.Wp)({apiKey:"AIzaSyB9sZFJSn8cvkos5fysi47VpqJc5AsorA4",authDomain:"manpower-patient-summary.firebaseapp.com",projectId:"manpower-patient-summary",storageBucket:"manpower-patient-summary.firebasestorage.app",messagingSenderId:"644057496880",appId:"1:644057496880:web:6270efc29187b9c025dcf5"}),i=(0,a.aU)(n);(0,s.xI)(n)},5695:(e,r,t)=>{"use strict";var o=t(8999);t.o(o,"usePathname")&&t.d(r,{usePathname:function(){return o.usePathname}}),t.o(o,"useRouter")&&t.d(r,{useRouter:function(){return o.useRouter}})},5709:(e,r,t)=>{"use strict";t.d(r,{default:()=>p});var o=t(5155),a=t(2115),s=t(2808),n=t(3932);function i(){return(0,o.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,o.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-lg shadow-lg px-4 py-2 border border-gray-200 hover:bg-white/90 transition-all duration-300",children:(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,o.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"v.2.3.3.2025"})]})})})}function l(e){let{children:r}=e;return(0,a.useEffect)(()=>{console.log("Providers component mounted")},[]),(0,o.jsx)(n.N,{children:(0,o.jsxs)(s.O,{children:[r,(0,o.jsx)(i,{})]})})}var c=t(5695),d=t(650);let u={WARD:"ward",FORM:"form",DASHBOARD:"dashboard",USER_MANAGEMENT:"user_management"},g={[u.WARD]:"Ward Form",[u.FORM]:"Approval",[u.DASHBOARD]:"Dashboard",[u.USER_MANAGEMENT]:"User Management"},m=()=>{let{theme:e,toggleTheme:r}=(0,n.D)();return(0,o.jsx)("button",{onClick:r,type:"button",className:"flex items-center justify-center p-1.5 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":"dark"===e?"Switch to light mode":"Switch to dark mode",title:"dark"===e?"Switch to light mode":"Switch to dark mode",children:"light"===e?(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}):(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-yellow-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})})},h=()=>{var e;let r=(0,c.useRouter)(),t=(0,c.usePathname)(),{user:i,logout:l}=(0,s.A)(),{theme:h}=(0,n.D)(),[p,b]=(0,a.useState)();(0,a.useEffect)(()=>{if("/"===t){b(window.currentPage||u.FORM);let e=()=>{b(window.currentPage)};return window.addEventListener("currentPageChange",e),()=>{window.removeEventListener("currentPageChange",e)}}"/page/ward-form"===t||"/ward-form"===t?b(u.WARD):"/page/approval"===t||"/approval"===t?b(u.FORM):"/page/dashboard"===t||"/dashboard"===t?b(u.DASHBOARD):("/page/user-management"===t||t.includes("/admin/user-management"))&&b(u.USER_MANAGEMENT)},[t]);let w=e=>{var t;if(e===u.USER_MANAGEMENT&&(null==i?void 0:null===(t=i.role)||void 0===t?void 0:t.toLowerCase())!=="admin"){d.YU.fire({title:"ไม่มีสิทธิ์เข้าถึง",text:"คุณไม่มีสิทธิ์เข้าถึงหน้าจัดการผู้ใช้",icon:"warning",confirmButtonColor:"#0ab4ab"});return}switch(b(e),e){case u.WARD:r.push("/page/ward-form/");break;case u.FORM:r.push("/page/approval/");break;case u.DASHBOARD:r.push("/page/dashboard/");break;case u.USER_MANAGEMENT:r.push("/page/user-management/");break;default:r.push("/")}},x=async()=>{try{(await d.YU.fire({title:"ต้องการออกจากระบบ?",text:"คุณแน่ใจหรือไม่ว่าต้องการออกจากระบบ",icon:"question",showCancelButton:!0,confirmButtonText:"ใช่, ออกจากระบบ",cancelButtonText:"ยกเลิก",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed&&(await l(),r.push("/page/login"))}catch(e){console.error("Logout failed:",e),d.YU.fire({title:"เกิดข้อผิดพลาด",text:"ไม่สามารถออกจากระบบได้ กรุณาลองใหม่อีกครั้ง",icon:"error",confirmButtonColor:"#0ab4ab"})}};return i&&"/login"!==t&&"/page/login"!==t?(0,o.jsx)("div",{className:"".concat("dark"===h?"bg-gray-800":"bg-[#0ab4ab]"," text-white shadow-md p-3 fixed top-0 left-0 right-0 z-50 w-full transition-colors duration-300"),children:(0,o.jsxs)("div",{className:"container mx-auto flex flex-wrap justify-between items-center",children:[(0,o.jsxs)("div",{className:"flex flex-wrap items-center space-x-2 md:space-x-4 mb-2 md:mb-0",children:[(0,o.jsx)("button",{onClick:()=>w(u.WARD),className:"px-4 py-2 rounded-md font-medium text-base ".concat(p===u.WARD?"bg-gray-700 text-white shadow-md border-2 border-white":"dark"===h?"bg-gray-700 text-white hover:bg-gray-600":"bg-[#0ab4ab] text-white hover:bg-teal-600"," transition-all duration-200"),children:(0,o.jsx)("span",{className:"font-bold",children:g[u.WARD]})}),(0,o.jsx)("button",{onClick:()=>w(u.FORM),className:"px-4 py-2 rounded-md font-medium text-base ".concat(p===u.FORM?"bg-gray-700 text-white shadow-md border-2 border-white":"dark"===h?"bg-gray-700 text-white hover:bg-gray-600":"bg-[#0ab4ab] text-white hover:bg-teal-600"," transition-all duration-200"),children:(0,o.jsx)("span",{className:p===u.FORM?"font-bold":"",children:g[u.FORM]})}),(0,o.jsx)("button",{onClick:()=>w(u.DASHBOARD),className:"px-4 py-2 rounded-md font-medium text-base ".concat(p===u.DASHBOARD?"bg-gray-700 text-white shadow-md border-2 border-white":"dark"===h?"bg-gray-700 text-white hover:bg-gray-600":"bg-[#0ab4ab] text-white hover:bg-teal-600"," transition-all duration-200"),children:(0,o.jsx)("span",{className:p===u.DASHBOARD?"font-bold":"",children:g[u.DASHBOARD]})}),(null==i?void 0:null===(e=i.role)||void 0===e?void 0:e.toLowerCase())==="admin"&&(0,o.jsx)("button",{onClick:()=>w(u.USER_MANAGEMENT),className:"px-4 py-2 rounded-md font-medium text-base ".concat(p===u.USER_MANAGEMENT?"bg-gray-700 text-white shadow-md border-2 border-white":"dark"===h?"bg-gray-700 text-white hover:bg-gray-600":"bg-[#0ab4ab] text-white hover:bg-teal-600"," transition-all duration-200"),children:(0,o.jsx)("span",{className:p===u.USER_MANAGEMENT?"font-bold":"",children:g[u.USER_MANAGEMENT]})})]}),(0,o.jsxs)("div",{className:"flex flex-wrap items-center",children:[(0,o.jsxs)("div",{className:"text-white text-sm mr-4 mb-2 md:mb-0",children:["Logged in as: ",i.username||"user"," | Department: ",i.department||""," | Role: ",i.role||"user"]}),(0,o.jsx)("div",{className:"mr-3",children:(0,o.jsx)(m,{})}),(0,o.jsxs)("button",{onClick:x,className:"flex items-center px-4 py-2 ".concat("dark"===h?"bg-red-700 hover:bg-red-800":"bg-red-600 hover:bg-red-700"," rounded-md transition-all duration-200 font-medium text-base"),children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"ออกจากระบบ"]})]})]})}):null};function p(e){let{children:r}=e,[t,s]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{s(!0),console.log("ClientLayout mounted - setting up providers"),"function"!=typeof d.Sw?console.error("AlertProvider is not a valid component:",d.Sw):console.log("AlertProvider loaded correctly"),console.log("Providers loaded correctly")},[]),t)?(0,o.jsx)(l,{children:(0,o.jsxs)(d.Sw,{children:[(0,o.jsx)(h,{}),(0,o.jsx)("div",{className:"pt-8",children:r})]})}):(0,o.jsx)("div",{className:"min-h-screen bg-gray-50"})}},9310:(e,r,t)=>{"use strict";t.d(r,{CF:()=>n,Lx:()=>s,TK:()=>l,hG:()=>c,nu:()=>i});var o=t(5112),a=t(4197);localStorage.removeItem("useMockData"),localStorage.setItem("useMockData","false");let s=async(e,r)=>{try{let t=(0,o.rJ)(a.db,"users"),s=(0,o.P)(t,(0,o._M)("username","==",e)),n=await (0,o.GG)(s);if(n.empty)return console.log("User not found in database:",e),{success:!1,error:"User not found"};let i=n.docs[0].data(),l=n.docs[0].id;if(console.log("Found user:",e,"Checking password..."),i.password!==r)return console.log("Invalid password for user:",e),{success:!1,error:"Invalid password"};return console.log("Login successful for user:",e),{success:!0,user:{uid:l,...i}}}catch(e){return console.error("Login error:",e.message),{success:!1,error:"Login failed: "+e.message}}},n=async()=>{try{let e=(0,o.rJ)(a.db,"users");return(await (0,o.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting users:",e.message),[]}},i=async e=>{try{let r={...e,createdAt:(0,o.O5)(),updatedAt:(0,o.O5)()},t=await (0,o.gS)((0,o.rJ)(a.db,"users"),r);return{success:!0,id:t.id}}catch(e){return console.error("Error adding user:",e.message),{success:!1,error:e.message}}},l=async(e,r)=>{try{let t={...r,updatedAt:(0,o.O5)()};return await (0,o.mZ)((0,o.H9)(a.db,"users",e),t),{success:!0}}catch(e){return console.error("Error updating user:",e.message),{success:!1,error:e.message}}},c=async e=>{try{return await (0,o.kd)((0,o.H9)(a.db,"users",e)),{success:!0}}catch(e){return console.error("Error deleting user:",e.message),{success:!1,error:e.message}}}},9324:()=>{},9770:(e,r,t)=>{"use strict";t.d(r,{$s:()=>n});var o=t(9509);let a="app_logs",s=async e=>{try{let r=await fetch("/api/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw Error("Server responded with status ".concat(r.status));return!0}catch(e){return console.warn("Failed to send log to server:",e),!1}},n=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let t={timestamp:new Date().toISOString(),event:e,properties:r},n=JSON.parse(localStorage.getItem(a)||"[]");n.push(t);let i=n.slice(-1e3);localStorage.setItem(a,JSON.stringify(i)),s(t).catch(e=>{console.warn("Error sending log to server:",e)}),o.env.NEXT_PUBLIC_EXTERNAL_LOGGING_URL&&fetch(o.env.NEXT_PUBLIC_EXTERNAL_LOGGING_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(console.error)}catch(e){console.warn("Logging failed:",e)}}}},e=>{var r=r=>e(e.s=r);e.O(0,[533,932,696,315,358],()=>r(1905)),_N_E=e.O()}]);