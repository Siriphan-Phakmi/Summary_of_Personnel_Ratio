(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[288],{2683:(e,s,r)=>{Promise.resolve().then(r.bind(r,954))},954:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>c});var t=r(5155),a=r(2115),o=r(1340);function c(){let[e,s]=(0,a.useState)([]),{user:r}=(0,o.A)();return(0,a.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/logs"),r=await e.json();s(r)}catch(e){console.error("Error fetching logs:",e)}};r&&e()},[r]),(0,t.jsxs)("div",{className:"container mx-auto p-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"System Logs"}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full bg-white",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2",children:"Timestamp"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Event"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Details"})]})}),(0,t.jsx)("tbody",{children:e.map((e,s)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"border px-4 py-2",children:new Date(e.timestamp).toLocaleString()}),(0,t.jsx)("td",{className:"border px-4 py-2",children:e.event}),(0,t.jsx)("td",{className:"border px-4 py-2",children:JSON.stringify(e.properties)})]},s))})]})})]})}},1340:(e,s,r)=>{"use strict";r.d(s,{A:()=>l,O:()=>i});var t=r(5155),a=r(2115);r(7982),r(7058);var o=r(9525),c=r(6772);let n=(0,a.createContext)({}),l=()=>(0,a.useContext)(n);function i(e){let{children:s}=e,[r,l]=(0,a.useState)(null),[i,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(()=>{try{let e=localStorage.getItem("user");e&&l(JSON.parse(e)),u(!1)}catch(e){console.error("Error checking localStorage:",e),u(!1)}})()},[]);let d=async(e,s)=>{try{let r=await (0,o.Lx)(e,s);if(r&&r.success){localStorage.setItem("user",JSON.stringify(r.user)),l(r.user);try{(0,c.$s)("user_login",{userId:r.user.uid,timestamp:new Date().toISOString()})}catch(e){console.warn("Login logging failed:",e)}}return r}catch(e){return console.error("Login error:",e),{success:!1,error:e.message}}},m=null!==r;return(0,t.jsx)(n.Provider,{value:{user:r,loading:i,isAuthenticated:m,login:d,logout:()=>{try{let e=null==r?void 0:r.uid;return localStorage.removeItem("user"),l(null),(0,c.$s)("user_logout",{userId:e,timestamp:new Date().toISOString()}),!0}catch(e){return console.error("Logout error:",e),!1}}},children:s})}},9525:(e,s,r)=>{"use strict";r.d(s,{CF:()=>c,F7:()=>u,Lx:()=>o,TK:()=>l,hG:()=>i,nu:()=>n});var t=r(7058),a=r(7982);localStorage.removeItem("useMockData"),localStorage.setItem("useMockData","false");let o=async(e,s)=>{try{let r=(0,t.rJ)(a.db,"users"),o=(0,t.P)(r,(0,t._M)("username","==",e)),c=await (0,t.GG)(o);if(c.empty)return console.log("User not found in database:",e),{success:!1,error:"User not found"};let n=c.docs[0].data(),l=c.docs[0].id;if(console.log("Found user:",e,"Checking password..."),n.password!==s)return console.log("Invalid password for user:",e),{success:!1,error:"Invalid password"};return console.log("Login successful for user:",e),{success:!0,user:{uid:l,...n}}}catch(e){return console.error("Login error:",e.message),{success:!1,error:"Login failed: "+e.message}}},c=async()=>{try{let e=(0,t.rJ)(a.db,"users");return(await (0,t.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting users:",e.message),[]}},n=async e=>{try{let s={...e,createdAt:(0,t.O5)(),updatedAt:(0,t.O5)()},r=await (0,t.gS)((0,t.rJ)(a.db,"users"),s);return{success:!0,id:r.id}}catch(e){return console.error("Error adding user:",e.message),{success:!1,error:e.message}}},l=async(e,s)=>{try{let r={...s,updatedAt:(0,t.O5)()};return await (0,t.mZ)((0,t.H9)(a.db,"users",e),r),{success:!0}}catch(e){return console.error("Error updating user:",e.message),{success:!1,error:e.message}}},i=async e=>{try{return await (0,t.kd)((0,t.H9)(a.db,"users",e)),{success:!0}}catch(e){return console.error("Error deleting user:",e.message),{success:!1,error:e.message}}},u=async()=>{try{let e=(await c()).map(async e=>{let s={};if((!e.firstName||!e.lastName)&&e.fullName){let r=(e.fullName||"").split(" ");s.firstName=r[0]||"",s.lastName=r.slice(1).join(" ")||""}return(e.position||(e.role&&"admin"===e.role.toLowerCase()?s.position="ผู้ดูแลระบบ":s.position="เจ้าหน้าที่พยาบาล"),Object.keys(s).length>0)?(s.updatedAt=(0,t.O5)(),(0,t.mZ)((0,t.H9)(a.db,"users",e.id),s)):Promise.resolve()});return await Promise.all(e),{success:!0,message:"Updated all users successfully"}}catch(e){return console.error("Error updating users:",e.message),{success:!1,error:e.message}}}},7982:(e,s,r)=>{"use strict";r.d(s,{db:()=>n});var t=r(9904),a=r(7058),o=r(4565);let c=(0,t.Dk)().length?(0,t.Dk)()[0]:(0,t.Wp)({apiKey:"AIzaSyB9sZFJSn8cvkos5fysi47VpqJc5AsorA4",authDomain:"manpower-patient-summary.firebaseapp.com",projectId:"manpower-patient-summary",storageBucket:"manpower-patient-summary.firebasestorage.app",messagingSenderId:"644057496880",appId:"1:644057496880:web:6270efc29187b9c025dcf5"}),n=(0,a.aU)(c);(0,o.xI)(c)},6772:(e,s,r)=>{"use strict";r.d(s,{$s:()=>c});var t=r(7358);let a="app_logs",o=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r={timestamp:new Date().toISOString(),event:e,properties:s},o=JSON.parse(localStorage.getItem(a)||"[]");o.push(r);let c=o.slice(-1e3);localStorage.setItem(a,JSON.stringify(c)),t.env.NEXT_PUBLIC_EXTERNAL_LOGGING_URL&&fetch(t.env.NEXT_PUBLIC_EXTERNAL_LOGGING_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch(console.error)}catch(e){console.warn("Logging failed:",e)}},c=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(e,s)}}},e=>{var s=s=>e(e.s=s);e.O(0,[992,888,118,441,517,358],()=>s(2683)),_N_E=e.O()}]);