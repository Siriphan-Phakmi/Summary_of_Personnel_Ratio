(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[288],{2683:(e,r,s)=>{Promise.resolve().then(s.bind(s,2687))},2687:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>n});var t=s(5155),o=s(2115),a=s(2808);function n(){let[e,r]=(0,o.useState)([]),{user:s}=(0,a.A)();return(0,o.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/logs"),s=await e.json();r(s)}catch(e){console.error("Error fetching logs:",e)}};s&&e()},[s]),(0,t.jsxs)("div",{className:"container mx-auto p-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"System Logs"}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full bg-white",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2",children:"Timestamp"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Event"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Details"})]})}),(0,t.jsx)("tbody",{children:e.map((e,r)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"border px-4 py-2",children:new Date(e.timestamp).toLocaleString()}),(0,t.jsx)("td",{className:"border px-4 py-2",children:e.event}),(0,t.jsx)("td",{className:"border px-4 py-2",children:JSON.stringify(e.properties)})]},r))})]})})]})}},2808:(e,r,s)=>{"use strict";s.d(r,{O:()=>u,A:()=>i});var t=s(5155),o=s(2115);s(4197),s(5112);var a=s(9310),n=s(9770);let c=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,n.$s)(e,r)},l=(0,o.createContext)({user:null,loading:!0,isAuthenticated:!1,login:async(e,r)=>{},logout:()=>{}}),i=()=>(0,o.useContext)(l);function u(e){let{children:r}=e,[s,n]=(0,o.useState)(null),[i,u]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(()=>{try{let e=localStorage.getItem("user");e&&n(JSON.parse(e)),u(!1)}catch(e){console.error("Error checking localStorage:",e),u(!1)}})()},[]);let d={user:s,loading:i,isAuthenticated:!!s,login:async(e,r)=>{console.log("Login function called with username:",e);try{let s=await (0,a.Lx)(e,r);if(s&&s.success){localStorage.setItem("user",JSON.stringify(s.user)),n(s.user);try{c("user_login",{userId:s.user.uid,username:e,role:s.user.role,name:s.user.displayName,timestamp:new Date().toISOString(),action:"Login success"})}catch(e){console.warn("Login logging failed:",e)}}return s}catch(e){return console.error("Login error:",e),{success:!1,error:e.message||"เกิดข้อผิดพลาดในการเข้าสู่ระบบ"}}},logout:()=>{try{let e=null==s?void 0:s.uid;return localStorage.removeItem("user"),n(null),c("user_logout",{userId:e,username:null==s?void 0:s.username,role:null==s?void 0:s.role,name:null==s?void 0:s.displayName,timestamp:new Date().toISOString(),action:"Logout success"}),!0}catch(e){return console.error("Logout error:",e),!1}}};return console.log("AuthContext value:",{user:!!d.user,loading:d.loading,isAuthenticated:d.isAuthenticated,hasLogin:"function"==typeof d.login,hasLogout:"function"==typeof d.logout}),(0,t.jsx)(l.Provider,{value:d,children:r})}},4197:(e,r,s)=>{"use strict";s.d(r,{db:()=>c});var t=s(3915),o=s(5112),a=s(7051);let n=(0,t.Dk)().length?(0,t.Dk)()[0]:(0,t.Wp)({apiKey:"AIzaSyB9sZFJSn8cvkos5fysi47VpqJc5AsorA4",authDomain:"manpower-patient-summary.firebaseapp.com",projectId:"manpower-patient-summary",storageBucket:"manpower-patient-summary.firebasestorage.app",messagingSenderId:"644057496880",appId:"1:644057496880:web:6270efc29187b9c025dcf5"}),c=(0,o.aU)(n);(0,a.xI)(n)},9310:(e,r,s)=>{"use strict";s.d(r,{CF:()=>n,Lx:()=>a,TK:()=>l,hG:()=>i,nu:()=>c});var t=s(5112),o=s(4197);localStorage.removeItem("useMockData"),localStorage.setItem("useMockData","false");let a=async(e,r)=>{try{let s=(0,t.rJ)(o.db,"users"),a=(0,t.P)(s,(0,t._M)("username","==",e)),n=await (0,t.GG)(a);if(n.empty)return console.log("User not found in database:",e),{success:!1,error:"User not found"};let c=n.docs[0].data(),l=n.docs[0].id;if(console.log("Found user:",e,"Checking password..."),c.password!==r)return console.log("Invalid password for user:",e),{success:!1,error:"Invalid password"};return console.log("Login successful for user:",e),{success:!0,user:{uid:l,...c}}}catch(e){return console.error("Login error:",e.message),{success:!1,error:"Login failed: "+e.message}}},n=async()=>{try{let e=(0,t.rJ)(o.db,"users");return(await (0,t.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting users:",e.message),[]}},c=async e=>{try{let r={...e,createdAt:(0,t.O5)(),updatedAt:(0,t.O5)()},s=await (0,t.gS)((0,t.rJ)(o.db,"users"),r);return{success:!0,id:s.id}}catch(e){return console.error("Error adding user:",e.message),{success:!1,error:e.message}}},l=async(e,r)=>{try{let s={...r,updatedAt:(0,t.O5)()};return await (0,t.mZ)((0,t.H9)(o.db,"users",e),s),{success:!0}}catch(e){return console.error("Error updating user:",e.message),{success:!1,error:e.message}}},i=async e=>{try{return await (0,t.kd)((0,t.H9)(o.db,"users",e)),{success:!0}}catch(e){return console.error("Error deleting user:",e.message),{success:!1,error:e.message}}}},9770:(e,r,s)=>{"use strict";s.d(r,{$s:()=>n});var t=s(9509);let o="app_logs",a=async e=>{try{let r=await fetch("/api/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw Error("Server responded with status ".concat(r.status));return!0}catch(e){return console.warn("Failed to send log to server:",e),!1}},n=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let s={timestamp:new Date().toISOString(),event:e,properties:r},n=JSON.parse(localStorage.getItem(o)||"[]");n.push(s);let c=n.slice(-1e3);localStorage.setItem(o,JSON.stringify(c)),a(s).catch(e=>{console.warn("Error sending log to server:",e)}),t.env.NEXT_PUBLIC_EXTERNAL_LOGGING_URL&&fetch(t.env.NEXT_PUBLIC_EXTERNAL_LOGGING_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).catch(console.error)}catch(e){console.warn("Logging failed:",e)}}}},e=>{var r=r=>e(e.s=r);e.O(0,[932,315,358],()=>r(2683)),_N_E=e.O()}]);