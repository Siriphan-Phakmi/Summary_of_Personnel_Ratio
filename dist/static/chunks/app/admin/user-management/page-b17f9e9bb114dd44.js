(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[408],{6295:(e,a,r)=>{Promise.resolve().then(r.bind(r,1594))},1594:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>c});var s=r(5155),t=r(2115),l=r(9525),o=r(1340),n=r(4898),d=r(3693),i=r(6046);function c(){(0,i.useRouter)();let[e,a]=(0,t.useState)([]),[r,c]=(0,t.useState)(!0),[u,x]=(0,t.useState)(null),[m,p]=(0,t.useState)({username:"",password:"",firstName:"",lastName:"",fullName:"",position:"",department:"",role:"user"}),[b,h]=(0,t.useState)(null),[g,f]=(0,t.useState)(!1),{user:j}=(0,o.A)(),y=async()=>{c(!0),console.log("Fetching users...");try{let e=await (0,l.CF)();console.log("Users fetched:",e),a(e)}catch(e){console.error("Error in fetchUsers:",e),x("Failed to load users")}finally{c(!1)}};(0,t.useEffect)(()=>{y()},[]),(0,t.useEffect)(()=>{let r=e.map(e=>{if((!e.firstName||!e.lastName)&&e.fullName){let a=e.fullName.split(" "),r=a[0]||"",s=a.slice(1).join(" ")||"";return{...e,firstName:e.firstName||r,lastName:e.lastName||s}}return e});JSON.stringify(r)!==JSON.stringify(e)&&a(r)},[e]);let N=async e=>{e.preventDefault(),console.log("Submitting new user:",m);try{console.log("Calling addUser function...");let e=await (0,l.nu)(m);if(console.log("addUser result:",e),e.success)console.log("User added successfully"),p({username:"",password:"",firstName:"",lastName:"",fullName:"",position:"",department:"",role:"user"}),f(!1),console.log("Refreshing user list..."),y();else throw console.error("Failed to add user with error:",e.error),Error(e.error||"Failed to add user")}catch(e){console.error("Error in handleAddUser:",e),x("Failed to add user: "+e.message)}},v=async e=>{if(e.preventDefault(),b)try{let e={username:b.username,password:b.password,firstName:b.firstName,lastName:b.lastName,fullName:b.fullName,position:b.position,department:b.department,role:b.role},a=await (0,l.TK)(b.id,e);if(a.success)h(null),y();else throw Error(a.error||"Failed to update user")}catch(e){console.error("Error updating user:",e),x("Failed to update user: "+e.message)}},w=async e=>{if(window.confirm("Are you sure you want to delete this user?"))try{let a=await (0,l.hG)(e);if(a.success)y();else throw Error(a.error||"Failed to delete user")}catch(e){console.error("Error deleting user:",e),x("Failed to delete user: "+e.message)}};return r?(0,s.jsx)(d.A,{}):(0,s.jsx)(n.A,{requiredRole:"admin",children:(0,s.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,s.jsxs)("main",{className:"container mx-auto px-4 pt-20 pb-10",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Users Management"}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)("button",{onClick:async()=>{try{c(!0);let e=await (0,l.F7)();if(e.success)y(),alert("Successfully updated all users name fields!");else throw Error(e.error)}catch(e){console.error("Error updating user names:",e),x("Failed to update name fields: "+e.message)}finally{c(!1)}},className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600",children:"Update All Names"}),(0,s.jsx)("button",{onClick:()=>f(!0),className:"bg-[#0ab4ab] text-white px-4 py-2 rounded-lg hover:bg-[#0ab4ab]/90",children:"Add New User"})]})]}),g&&(0,s.jsxs)("div",{className:"mb-8 p-6 bg-white rounded-lg shadow",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Add New User"}),(0,s.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,s.jsx)("input",{type:"text",value:m.username,onChange:e=>p({...m,username:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),(0,s.jsx)("input",{type:"text",value:m.firstName||"",onChange:e=>{let a=e.target.value;p({...m,firstName:a,fullName:"".concat(a," ").concat(m.lastName||"")})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),(0,s.jsx)("input",{type:"text",value:m.lastName||"",onChange:e=>{let a=e.target.value;p({...m,lastName:a,fullName:"".concat(m.firstName||""," ").concat(a)})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,s.jsx)("input",{type:"password",value:m.password,onChange:e=>p({...m,password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),(0,s.jsxs)("select",{value:m.department,onChange:e=>p({...m,department:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select Department"}),(0,s.jsx)("option",{value:"Ward6",children:"Ward 6"}),(0,s.jsx)("option",{value:"Ward7",children:"Ward 7"}),(0,s.jsx)("option",{value:"Ward8",children:"Ward 8"}),(0,s.jsx)("option",{value:"Ward9",children:"Ward 9"}),(0,s.jsx)("option",{value:"WardGI",children:"Ward GI"}),(0,s.jsx)("option",{value:"Ward10B",children:"Ward 10B"}),(0,s.jsx)("option",{value:"Ward11",children:"Ward 11"}),(0,s.jsx)("option",{value:"Ward12",children:"Ward 12"}),(0,s.jsx)("option",{value:"ICU",children:"ICU"}),(0,s.jsx)("option",{value:"CCU",children:"CCU"}),(0,s.jsx)("option",{value:"LR",children:"LR"}),(0,s.jsx)("option",{value:"NSY",children:"NSY"}),(0,s.jsx)("option",{value:"Admin",children:"Admin"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position"}),(0,s.jsxs)("select",{value:m.position,onChange:e=>p({...m,position:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select Position"}),(0,s.jsx)("option",{value:"เจ้าหน้าที่พยาบาล",children:"เจ้าหน้าที่พยาบาล"}),(0,s.jsx)("option",{value:"ผู้ดูแลระบบ",children:"ผู้ดูแลระบบ"}),(0,s.jsx)("option",{value:"หัวหน้าแผนก",children:"หัวหน้าแผนก"}),(0,s.jsx)("option",{value:"แพทย์",children:"แพทย์"}),(0,s.jsx)("option",{value:"ผู้ช่วยพยาบาล",children:"ผู้ช่วยพยาบาล"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,s.jsxs)("select",{value:m.role,onChange:e=>p({...m,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,s.jsx)("option",{value:"user",children:"User"}),(0,s.jsx)("option",{value:"admin",children:"Admin"})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>f(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-[#0ab4ab] text-white rounded-md hover:bg-[#0ab4ab]/90",children:"Add User"})]})]})]}),b&&(0,s.jsxs)("div",{className:"mb-8 p-6 bg-white rounded-lg shadow",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Edit User"}),(0,s.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,s.jsx)("input",{type:"text",value:b.username,onChange:e=>h({...b,username:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),(0,s.jsx)("input",{type:"text",value:b.firstName||"",onChange:e=>{let a=e.target.value;h({...b,firstName:a,fullName:"".concat(a," ").concat(b.lastName||"")})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),(0,s.jsx)("input",{type:"text",value:b.lastName||"",onChange:e=>{let a=e.target.value;h({...b,lastName:a,fullName:"".concat(b.firstName||""," ").concat(a)})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,s.jsx)("input",{type:"text",value:b.fullName||"",onChange:e=>h({...b,fullName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),(0,s.jsxs)("select",{value:b.department,onChange:e=>h({...b,department:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select Department"}),(0,s.jsx)("option",{value:"Ward6",children:"Ward 6"}),(0,s.jsx)("option",{value:"Ward7",children:"Ward 7"}),(0,s.jsx)("option",{value:"Ward8",children:"Ward 8"}),(0,s.jsx)("option",{value:"Ward9",children:"Ward 9"}),(0,s.jsx)("option",{value:"WardGI",children:"Ward GI"}),(0,s.jsx)("option",{value:"Ward10B",children:"Ward 10B"}),(0,s.jsx)("option",{value:"Ward11",children:"Ward 11"}),(0,s.jsx)("option",{value:"Ward12",children:"Ward 12"}),(0,s.jsx)("option",{value:"ICU",children:"ICU"}),(0,s.jsx)("option",{value:"CCU",children:"CCU"}),(0,s.jsx)("option",{value:"LR",children:"LR"}),(0,s.jsx)("option",{value:"NSY",children:"NSY"}),(0,s.jsx)("option",{value:"Admin",children:"Admin"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position"}),(0,s.jsxs)("select",{value:b.position||"",onChange:e=>h({...b,position:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select Position"}),(0,s.jsx)("option",{value:"เจ้าหน้าที่พยาบาล",children:"เจ้าหน้าที่พยาบาล"}),(0,s.jsx)("option",{value:"ผู้ดูแลระบบ",children:"ผู้ดูแลระบบ"}),(0,s.jsx)("option",{value:"หัวหน้าแผนก",children:"หัวหน้าแผนก"}),(0,s.jsx)("option",{value:"แพทย์",children:"แพทย์"}),(0,s.jsx)("option",{value:"ผู้ช่วยพยาบาล",children:"ผู้ช่วยพยาบาล"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,s.jsxs)("select",{value:b.role,onChange:e=>h({...b,role:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0,children:[(0,s.jsx)("option",{value:"user",children:"User"}),(0,s.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,s.jsx)("input",{type:"password",value:b.password,onChange:e=>h({...b,password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-[#0ab4ab] focus:border-[#0ab4ab]",required:!0})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>h(null),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-[#0ab4ab] text-white rounded-md hover:bg-[#0ab4ab]/90",children:"Update User"})]})]})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Username"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"First Name"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Name"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Position"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created At"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Updated At"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200",children:[e.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.username}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.firstName||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.lastName||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.position||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.department}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("admin"===e.role?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:e.role})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.createdAt?"object"==typeof e.createdAt&&e.createdAt.seconds?new Date(1e3*e.createdAt.seconds).toLocaleString():"string"==typeof e.createdAt?new Date(e.createdAt).toLocaleString():"-":"-"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.updatedAt?"object"==typeof e.updatedAt&&e.updatedAt.seconds?new Date(1e3*e.updatedAt.seconds).toLocaleString():"string"==typeof e.updatedAt?new Date(e.updatedAt).toLocaleString():"-":"-"}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,s.jsx)("button",{onClick:()=>h(e),className:"text-indigo-600 hover:text-indigo-900 mr-4",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>w(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id)),0===e.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:"7",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No users found"})})]})]})})]})})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,888,118,738,898,441,517,358],()=>a(6295)),_N_E=e.O()}]);