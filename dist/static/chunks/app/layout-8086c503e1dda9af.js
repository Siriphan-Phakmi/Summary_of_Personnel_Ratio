(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{4604:(e,r,t)=>{Promise.resolve().then(t.bind(t,8576)),Promise.resolve().then(t.bind(t,4752)),Promise.resolve().then(t.t.bind(t,9324,23))},8576:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var s=t(5155),a=t(6046),o=t(1340),n=t(8897),i=t.n(n),c=t(4015),l=t(2115);let u=()=>{let e=(0,a.useRouter)(),r=(0,a.usePathname)(),{user:t,logout:n}=(0,o.A)(),[u,d]=(0,l.useState)();(0,l.useEffect)(()=>{if("/"===r){d(window.currentPage||c.Nb.FORM);let e=()=>{d(window.currentPage)};return window.addEventListener("currentPageChange",e),()=>{window.removeEventListener("currentPageChange",e)}}"/ward-form"===r?d(c.Nb.WARD):"/approval"===r?d(c.Nb.FORM):"/dashboard"===r?d(c.Nb.DASHBOARD):r.includes("/admin/user-management")&&d(c.Nb.USER_MANAGEMENT)},[r]);let m=r=>{var s;if(r===c.Nb.USER_MANAGEMENT&&(null==t?void 0:null===(s=t.role)||void 0===s?void 0:s.toLowerCase())!=="admin"){i().fire({title:"ไม่มีสิทธิ์เข้าถึง",text:"คุณไม่มีสิทธิ์เข้าถึงหน้าจัดการผู้ใช้",icon:"warning",confirmButtonColor:"#0ab4ab"});return}switch(d(r),r){case c.Nb.WARD:e.push("/ward-form");break;case c.Nb.FORM:e.push("/approval");break;case c.Nb.DASHBOARD:e.push("/dashboard");break;case c.Nb.USER_MANAGEMENT:e.push("/admin/user-management");break;default:e.push("/")}},g=async()=>{try{(await i().fire({title:"ต้องการออกจากระบบ?",text:"คุณแน่ใจหรือไม่ว่าต้องการออกจากระบบ",icon:"question",showCancelButton:!0,confirmButtonText:"ใช่, ออกจากระบบ",cancelButtonText:"ยกเลิก",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed&&(await n(),e.push("/login"))}catch(e){console.error("Logout failed:",e),i().fire({title:"เกิดข้อผิดพลาด",text:"ไม่สามารถออกจากระบบได้ กรุณาลองใหม่อีกครั้ง",icon:"error",confirmButtonColor:"#0ab4ab"})}};return t&&"/login"!==r?(0,s.jsx)("div",{className:"bg-[#0ab4ab] text-white shadow-md p-3 fixed top-0 left-0 right-0 z-50 w-full",children:(0,s.jsxs)("div",{className:"container mx-auto flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:()=>m(c.Nb.WARD),className:"px-3 py-1 rounded ".concat(u===c.Nb.WARD?"bg-white text-[#0ab4ab]":"bg-[#0ab4ab] text-white hover:bg-teal-600"," transition font-medium"),children:c.gN[c.Nb.WARD]}),(0,s.jsx)("button",{onClick:()=>m(c.Nb.FORM),className:"px-3 py-1 rounded ".concat(u===c.Nb.FORM?"bg-white text-[#0ab4ab]":"bg-[#0ab4ab] text-white hover:bg-teal-600"," transition font-medium"),children:c.gN[c.Nb.FORM]}),(0,s.jsx)("button",{onClick:()=>m(c.Nb.DASHBOARD),className:"px-3 py-1 rounded ".concat(u===c.Nb.DASHBOARD?"bg-white text-[#0ab4ab]":"bg-[#0ab4ab] text-white hover:bg-teal-600"," transition font-medium"),children:c.gN[c.Nb.DASHBOARD]}),(0,s.jsx)("button",{onClick:()=>m(c.Nb.USER_MANAGEMENT),className:"px-3 py-1 rounded ".concat(u===c.Nb.USER_MANAGEMENT?"bg-white text-[#0ab4ab]":"bg-[#0ab4ab] text-white hover:bg-teal-600"," transition font-medium"),children:c.gN[c.Nb.USER_MANAGEMENT]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"text-white text-sm mr-4",children:["Logged in as: ",t.username||"user"," | Department: ",t.department||""," | Role: ",t.role||"user"]}),(0,s.jsxs)("button",{onClick:g,className:"flex items-center px-3 py-1 bg-red-600 rounded-lg hover:bg-red-700 transition-all",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"ออกจากระบบ"]})]})]})}):null}},4015:(e,r,t)=>{"use strict";t.d(r,{Nb:()=>s,gN:()=>a});let s={WARD:"ward",FORM:"form",DASHBOARD:"dashboard",USER_MANAGEMENT:"user_management"},a={[s.WARD]:"Ward Form",[s.FORM]:"Approval",[s.DASHBOARD]:"Dashboard",[s.USER_MANAGEMENT]:"User Management"}},1340:(e,r,t)=>{"use strict";t.d(r,{A:()=>c,O:()=>l});var s=t(5155),a=t(2115);t(7982),t(7058);var o=t(9525),n=t(6772);let i=(0,a.createContext)({}),c=()=>(0,a.useContext)(i);function l(e){let{children:r}=e,[t,c]=(0,a.useState)(null),[l,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(()=>{try{let e=localStorage.getItem("user");e&&c(JSON.parse(e)),u(!1)}catch(e){console.error("Error checking localStorage:",e),u(!1)}})()},[]);let d=async(e,r)=>{try{let t=await (0,o.Lx)(e,r);if(t&&t.success){localStorage.setItem("user",JSON.stringify(t.user)),c(t.user);try{(0,n.$s)("user_login",{userId:t.user.uid,timestamp:new Date().toISOString()})}catch(e){console.warn("Login logging failed:",e)}}return t}catch(e){return console.error("Login error:",e),{success:!1,error:e.message}}},m=null!==t;return(0,s.jsx)(i.Provider,{value:{user:t,loading:l,isAuthenticated:m,login:d,logout:()=>{try{let e=null==t?void 0:t.uid;return localStorage.removeItem("user"),c(null),(0,n.$s)("user_logout",{userId:e,timestamp:new Date().toISOString()}),!0}catch(e){return console.error("Logout error:",e),!1}}},children:r})}},4752:(e,r,t)=>{"use strict";t.r(r),t.d(r,{Providers:()=>n});var s=t(5155);t(2115);var a=t(1340);function o(){return(0,s.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,s.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-lg shadow-lg px-4 py-2 border border-gray-200 hover:bg-white/90 transition-all duration-300",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"v.2.3.3.2025"})]})})})}function n(e){let{children:r}=e;return(0,s.jsxs)(a.O,{children:[r,(0,s.jsx)(o,{})]})}},9525:(e,r,t)=>{"use strict";t.d(r,{CF:()=>n,F7:()=>u,Lx:()=>o,TK:()=>c,hG:()=>l,nu:()=>i});var s=t(7058),a=t(7982);localStorage.removeItem("useMockData"),localStorage.setItem("useMockData","false");let o=async(e,r)=>{try{let t=(0,s.rJ)(a.db,"users"),o=(0,s.P)(t,(0,s._M)("username","==",e)),n=await (0,s.GG)(o);if(n.empty)return console.log("User not found in database:",e),{success:!1,error:"User not found"};let i=n.docs[0].data(),c=n.docs[0].id;if(console.log("Found user:",e,"Checking password..."),i.password!==r)return console.log("Invalid password for user:",e),{success:!1,error:"Invalid password"};return console.log("Login successful for user:",e),{success:!0,user:{uid:c,...i}}}catch(e){return console.error("Login error:",e.message),{success:!1,error:"Login failed: "+e.message}}},n=async()=>{try{let e=(0,s.rJ)(a.db,"users");return(await (0,s.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting users:",e.message),[]}},i=async e=>{try{let r={...e,createdAt:(0,s.O5)(),updatedAt:(0,s.O5)()},t=await (0,s.gS)((0,s.rJ)(a.db,"users"),r);return{success:!0,id:t.id}}catch(e){return console.error("Error adding user:",e.message),{success:!1,error:e.message}}},c=async(e,r)=>{try{let t={...r,updatedAt:(0,s.O5)()};return await (0,s.mZ)((0,s.H9)(a.db,"users",e),t),{success:!0}}catch(e){return console.error("Error updating user:",e.message),{success:!1,error:e.message}}},l=async e=>{try{return await (0,s.kd)((0,s.H9)(a.db,"users",e)),{success:!0}}catch(e){return console.error("Error deleting user:",e.message),{success:!1,error:e.message}}},u=async()=>{try{let e=(await n()).map(async e=>{let r={};if((!e.firstName||!e.lastName)&&e.fullName){let t=(e.fullName||"").split(" ");r.firstName=t[0]||"",r.lastName=t.slice(1).join(" ")||""}return(e.position||(e.role&&"admin"===e.role.toLowerCase()?r.position="ผู้ดูแลระบบ":r.position="เจ้าหน้าที่พยาบาล"),Object.keys(r).length>0)?(r.updatedAt=(0,s.O5)(),(0,s.mZ)((0,s.H9)(a.db,"users",e.id),r)):Promise.resolve()});return await Promise.all(e),{success:!0,message:"Updated all users successfully"}}catch(e){return console.error("Error updating users:",e.message),{success:!1,error:e.message}}}},7982:(e,r,t)=>{"use strict";t.d(r,{db:()=>i});var s=t(9904),a=t(7058),o=t(4565);let n=(0,s.Dk)().length?(0,s.Dk)()[0]:(0,s.Wp)({apiKey:"AIzaSyB9sZFJSn8cvkos5fysi47VpqJc5AsorA4",authDomain:"manpower-patient-summary.firebaseapp.com",projectId:"manpower-patient-summary",storageBucket:"manpower-patient-summary.firebasestorage.app",messagingSenderId:"644057496880",appId:"1:644057496880:web:6270efc29187b9c025dcf5"}),i=(0,a.aU)(n);(0,o.xI)(n)},6772:(e,r,t)=>{"use strict";t.d(r,{$s:()=>n});var s=t(7358);let a="app_logs",o=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let t={timestamp:new Date().toISOString(),event:e,properties:r},o=JSON.parse(localStorage.getItem(a)||"[]");o.push(t);let n=o.slice(-1e3);localStorage.setItem(a,JSON.stringify(n)),s.env.NEXT_PUBLIC_EXTERNAL_LOGGING_URL&&fetch(s.env.NEXT_PUBLIC_EXTERNAL_LOGGING_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(console.error)}catch(e){console.warn("Logging failed:",e)}},n=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(e,r)}},6046:(e,r,t)=>{"use strict";var s=t(6658);t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}})},9324:()=>{}},e=>{var r=r=>e(e.s=r);e.O(0,[533,992,888,320,118,441,517,358],()=>r(4604)),_N_E=e.O()}]);