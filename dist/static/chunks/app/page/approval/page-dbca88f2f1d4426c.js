(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[590],{650:(e,t,a)=>{"use strict";a.d(t,{Sw:()=>i,YU:()=>c});var r=a(5155),s=a(2115);let n=e=>{let{isOpen:t=!1,onClose:a,title:n,message:l,type:o="info",confirmText:i="ตกลง",cancelText:d="ยกเลิก",onConfirm:c,onCancel:u,showCancel:m=!1,allowOutsideClick:f=!0,timer:x=0}=e,[b,h]=(0,s.useState)(!1),[g,p]=(0,s.useState)(x>0?x:0);(0,s.useEffect)(()=>{if(t)h(!0);else{let e=setTimeout(()=>h(!1),300);return()=>clearTimeout(e)}},[t]),(0,s.useEffect)(()=>{if(x>0&&t){p(x);let e=setInterval(()=>{p(t=>t<=100?(clearInterval(e),a(),0):t-100)},100);return()=>clearInterval(e)}},[t,x,a]);let v={success:(0,r.jsx)("svg",{className:"w-20 h-20 mx-auto text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),error:(0,r.jsx)("svg",{className:"w-20 h-20 mx-auto text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),warning:(0,r.jsx)("svg",{className:"w-20 h-20 mx-auto text-amber-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),info:(0,r.jsx)("svg",{className:"w-20 h-20 mx-auto text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),question:(0,r.jsx)("svg",{className:"w-20 h-20 mx-auto text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},w={success:"border-green-200 bg-green-50",error:"border-red-200 bg-red-50",warning:"border-amber-200 bg-amber-50",info:"border-blue-200 bg-blue-50",question:"border-purple-200 bg-purple-50",confirm:"border-blue-200 bg-blue-50"},j={success:"bg-green-600 hover:bg-green-700 focus:ring-green-500",error:"bg-red-600 hover:bg-red-700 focus:ring-red-500",warning:"bg-amber-600 hover:bg-amber-700 focus:ring-amber-500",info:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500",question:"bg-purple-600 hover:bg-purple-700 focus:ring-purple-500",confirm:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"},N=w[o]||w.info,y=j[o]||j.info;return b?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 ".concat(t?"opacity-100":"opacity-0"," transition-opacity duration-300"),onClick:e=>{f&&e.target===e.currentTarget&&a()},children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40"}),(0,r.jsxs)("div",{className:"relative border rounded-lg shadow-xl transform ".concat(t?"scale-100 alert-scale-in":"scale-95"," transition-transform duration-300 w-full max-w-md p-6 ").concat(N," bg-white"),children:[(0,r.jsx)("div",{className:"mb-6",children:v[o]}),(0,r.jsx)("h3",{className:"text-xl font-semibold text-center mb-3",children:n}),(0,r.jsx)("div",{className:"text-center mb-6",children:"string"==typeof l?(0,r.jsx)("p",{children:l}):l}),x>0&&(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mb-6",children:(0,r.jsx)("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:"".concat(g/x*100,"%")}})}),(0,r.jsxs)("div",{className:"flex justify-center space-x-4",children:[m&&(0,r.jsx)("button",{className:"px-5 py-2.5 text-gray-800 bg-gray-200 rounded hover:bg-gray-300 transition focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",onClick:()=>{u&&u(),a()},children:d}),(0,r.jsx)("button",{className:"px-5 py-2.5 text-white rounded transition focus:outline-none focus:ring-2 focus:ring-offset-2 ".concat(y),onClick:()=>{c&&c(),a()},children:i})]})]})]}):null};var l=a(2669);let o=(0,s.createContext)(null),i=e=>{let{children:t}=e,[a,l]=(0,s.useState)([]),[i,d]=(0,s.useState)(0),c=(0,s.useCallback)(e=>(d(e=>e+1),l(t=>[...t,{id:i,...e}]),i),[i]),u=(0,s.useCallback)(e=>{l(t=>t.map(t=>t.id===e?{...t,isOpen:!1}:t)),setTimeout(()=>{l(t=>t.filter(t=>t.id!==e))},300)},[]);return(0,r.jsxs)(o.Provider,{value:{addAlert:c,removeAlert:u},children:[t,a.map(e=>(0,r.jsx)(n,{isOpen:!1!==e.isOpen,onClose:()=>u(e.id),title:e.title,message:e.message||e.text,type:e.icon||e.type||"info",confirmText:e.confirmButtonText||"ตกลง",cancelText:e.cancelButtonText||"ยกเลิก",onConfirm:()=>{e.resolve&&e.resolve({isConfirmed:!0,value:!0}),e.onConfirm&&e.onConfirm()},onCancel:()=>{e.resolve&&e.resolve({isConfirmed:!1,value:!1}),e.onCancel&&e.onCancel()},showCancel:e.showCancelButton,allowOutsideClick:!1!==e.allowOutsideClick,timer:e.timer||0},e.id))]})},d=null,c={fire:(e,t,a)=>{let s=document.createElement("div");return document.body.appendChild(s),new Promise(o=>{let i=!1,d=e=>{i||(i=!0,setTimeout(()=>{s&&s.parentNode&&document.body.removeChild(s)},300),o(e))},c="object"==typeof e?{...e,isOpen:!0}:{title:e,text:t,icon:a,isOpen:!0},u={...c,onConfirm:()=>d({isConfirmed:!0,value:!0}),onCancel:()=>d({isConfirmed:!1,value:!1}),onClose:()=>d({isConfirmed:!1,value:!1})};c.timer&&c.timer>0&&setTimeout(()=>{d({isConfirmed:!1,value:!1})},c.timer),(0,l.createRoot)(s).render((0,r.jsx)(n,{isOpen:!0,title:u.title,message:u.text||u.html,type:u.icon,confirmText:u.confirmButtonText||"ตกลง",cancelText:u.cancelButtonText||"ยกเลิก",showCancel:u.showCancelButton,allowOutsideClick:!1!==u.allowOutsideClick,timer:u.timer||0,onConfirm:u.onConfirm,onCancel:u.onCancel,onClose:u.onClose}))})},showLoading:()=>{if(d)return d;let e=document.createElement("div");document.body.appendChild(e);let t=(0,l.createRoot)(e);return t.render((0,r.jsx)(()=>(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40"}),(0,r.jsx)("div",{className:"relative transform transition-transform duration-300 scale-100 alert-scale-in p-6",children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("p",{className:"mt-4 text-white font-medium",children:"กำลังประมวลผล..."})]})})]}),{})),d={close:()=>{e&&e.parentNode&&(t.unmount(),document.body.removeChild(e),d=null)}}},close:()=>{d&&d.close()},showValidationMessage:e=>{console.warn("Validation message shown:",e),c.fire({title:"แจ้งเตือน",text:e,icon:"warning",confirmButtonText:"ตกลง"})},success:(e,t)=>c.fire(e,t,"success"),error:(e,t)=>c.fire(e,t,"error"),warning:(e,t)=>c.fire(e,t,"warning"),info:(e,t)=>c.fire(e,t,"info"),question:(e,t)=>c.fire(e,t,"question")}},3979:(e,t,a)=>{"use strict";a.d(t,{Se:()=>r});let r=()=>{let e=new Date().getHours();return e>=7&&e<19?"07:00-19:00":"19:00-07:00"}},5279:()=>{},7160:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var r=a(5155),s=a(2115),n=a(5695),l=a(4197),o=a(5112);a(5279);let i={Ward6:"Ward 6",Ward7:"Ward 7",Ward8:"Ward 8",Ward9:"Ward 9",WardGI:"Ward GI",Ward10B:"Ward 10B",Ward11:"Ward 11",Ward12:"Ward 12",ICU:"ICU",CCU:"CCU",LR:"LR",NSY:"NSY"},d=["Ward6","Ward7","Ward8","Ward9","WardGI","Ward10B","Ward11","Ward12","ICU","CCU","LR","NSY"],c={numberOfPatients:"0",nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",overallData:"0",availableBeds:"0",plannedDischarge:"0",unavailable:"0",comment:""};var u=a(650),m=a(9770),f=a(2808);let x=e=>{let{wardId:t,date:a,status:n="pending"}=e,[i,d]=(0,s.useState)(!1),{user:c}=(0,f.A)(),x=async()=>{try{if(d(!0),!(await u.YU.fire({title:"Approve Ward Data",html:'\n          <div class="text-left">\n            <p class="mb-2 font-medium">Are you sure you want to approve data for '.concat(t,'?</p>\n            <p class="text-sm text-gray-600">Date: ').concat(a,"</p>\n          </div>\n        "),icon:"question",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33"})).isConfirmed){d(!1);return}let e=(0,o.H9)(l.db,"wardDailyRecords","".concat(a,"_").concat(t));await (0,o.mZ)(e,{approvalStatus:"approved",approvedAt:new Date().toISOString()}),(0,m.$s)("approval_success",{wardId:t,date:a,action:"Approve ข้อมูลสำเร็จ",approvedBy:null==c?void 0:c.displayName,approvedById:null==c?void 0:c.uid,timestamp:new Date().toISOString()}),await u.YU.fire({title:"Approved Successfully",text:"Data for ".concat(t," has been approved"),icon:"success",confirmButtonColor:"#0ab4ab"})}catch(e){console.error("Error approving ward data:",e),await u.YU.fire({title:"Error",text:"Failed to approve ward data. Please try again.",icon:"error",confirmButtonColor:"#0ab4ab"})}finally{d(!1)}},b=async()=>{try{d(!0);let e=await u.YU.fire({title:"Reject Ward Data",html:'\n          <div class="text-left">\n            <p class="mb-2 font-medium">Please provide a reason for rejection:</p>\n            <textarea id="rejection-reason" class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="3"></textarea>\n          </div>\n        ',icon:"warning",showCancelButton:!0,confirmButtonText:"Reject",cancelButtonText:"Cancel",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",preConfirm:()=>{let e=document.getElementById("rejection-reason").value;return e.trim()||u.YU.showValidationMessage("Please provide a reason for rejection"),e}});if(!e.isConfirmed){d(!1);return}let r=e.value,s=(0,o.H9)(l.db,"wardDailyRecords","".concat(a,"_").concat(t));await (0,o.mZ)(s,{approvalStatus:"rejected",rejectedAt:new Date().toISOString(),rejectionReason:r}),(0,m.$s)("rejection_success",{wardId:t,date:a,action:"Reject ข้อมูลสำเร็จ",rejectedBy:null==c?void 0:c.displayName,rejectedById:null==c?void 0:c.uid,rejectionReason:r,timestamp:new Date().toISOString()}),await u.YU.fire({title:"Rejected Successfully",text:"Data for ".concat(t," has been rejected"),icon:"info",confirmButtonColor:"#0ab4ab"})}catch(e){console.error("Error rejecting ward data:",e),await u.YU.fire({title:"Error",text:"Failed to reject ward data. Please try again.",icon:"error",confirmButtonColor:"#0ab4ab"})}finally{d(!1)}};return"approved"===n?(0,r.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Approved"]}):"rejected"===n?(0,r.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),"Rejected"]}):(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:x,disabled:i,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",children:i?"Processing...":"Approve"}),(0,r.jsx)("button",{onClick:b,disabled:i,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:i?"Processing...":"Reject"})]})},b=e=>{let{WARD_ORDER:t,formData:a,handleInputChange:s,displayValue:n,approvalStatuses:l={},selectedDate:o,readOnly:d=!1}=e;return(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("div",{className:"inline-flex gap-1 min-w-max p-1",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h3",{className:"text-xs font-bold text-gray-700 font-THSarabun",children:"Wards"})}),t.map(e=>(0,r.jsx)("div",{className:"h-8 flex items-center",children:(0,r.jsx)("span",{className:"text-xs font-semibold text-[#0ab4ab] font-THSarabun whitespace-nowrap",children:i[e]||e})},e)),(0,r.jsx)("div",{className:"h-8 flex items-center",children:(0,r.jsx)("span",{className:"text-xs font-semibold text-purple-600 font-THSarabun",children:"Total"})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Patient Census"})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-[#0ab4ab]/20 to-[#0ab4ab]/10 rounded-md p-1 text-[#0ab4ab] shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(null===(t=a.wards[e])||void 0===t?void 0:t.numberOfPatients),className:"w-16 text-center text-sm font-bold bg-gray-100 border-b border-[#0ab4ab] focus:outline-none text-[#0ab4ab] placeholder-[#0ab4ab]/50 font-THSarabun cursor-not-allowed",placeholder:"0",readOnly:!0,disabled:!0})})},e)}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(a.totals.numberOfPatients),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Overall Data"})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-400/20 to-blue-500/10 rounded-md p-1 text-blue-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(null===(t=a.wards[e])||void 0===t?void 0:t.overallData),className:"w-16 text-center text-sm font-bold bg-gray-100 border-b border-blue-500 focus:outline-none text-blue-600 placeholder-blue-300 font-THSarabun cursor-not-allowed",placeholder:"0",readOnly:!0,disabled:!0})})},e)}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(a.totals.overallData),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]}),Object.entries({"Nurse Manager":"nurseManager",RN:"RN",PN:"PN",WC:"WC"}).map(e=>{let[l,o]=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:l})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-400/20 to-green-500/10 rounded-md p-1 text-green-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(null===(t=a.wards[e])||void 0===t?void 0:t[o]),onChange:t=>s("staff",e,{[o]:t.target.value}),className:"w-16 text-center text-sm font-bold ".concat(d?"bg-gray-100 cursor-not-allowed":"bg-white"," border-b border-green-500 focus:outline-none focus:border-green-500 text-black placeholder-green-300 font-THSarabun"),placeholder:"0",min:"0",readOnly:d,disabled:d})})},e)}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(a.totals[o]),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},o)}),Object.entries({"New Admit":"newAdmit","Transfer In":"transferIn","Refer In":"referIn","Transfer Out":"transferOut","Refer Out":"referOut",Discharge:"discharge",Dead:"dead"}).map(e=>{let[l,o]=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:l})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-yellow-400/20 to-yellow-500/10 rounded-md p-1 text-yellow-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(null===(t=a.wards[e])||void 0===t?void 0:t[o]),onChange:t=>s("movement",e,{[o]:t.target.value}),className:"w-16 text-center text-sm font-bold ".concat(d?"bg-gray-100 cursor-not-allowed":"bg-white"," border-b border-yellow-500 focus:outline-none focus:border-yellow-500 text-black placeholder-yellow-300 font-THSarabun"),placeholder:"0",min:"0",readOnly:d,disabled:d})})},e)}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(a.totals[o]),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},o)}),Object.entries({Available:"availableBeds",Unavailable:"unavailable","Planned Discharge":"plannedDischarge"}).map(e=>{let[l,o]=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:l})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-pink-400/20 to-pink-500/10 rounded-md p-1 text-pink-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(null===(t=a.wards[e])||void 0===t?void 0:t[o]),onChange:t=>s("info",e,{[o]:t.target.value}),className:"w-16 text-center text-sm font-bold ".concat(d?"bg-gray-100 cursor-not-allowed":"bg-white"," border-b border-pink-500 focus:outline-none focus:border-pink-500 text-black placeholder-pink-300 font-THSarabun"),placeholder:"0",min:"0",readOnly:d,disabled:d})})},e)}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:n(a.totals[o]),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},o)}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Comment"})}),t.map(e=>{var t;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-gray-100 to-gray-200 rounded-md p-1 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",value:(null===(t=a.wards[e])||void 0===t?void 0:t.comment)||"",onChange:t=>s("comment",e,{comment:t.target.value}),className:"w-24 text-center text-xs ".concat(d?"bg-gray-100 cursor-not-allowed":"bg-white"," border-b border-gray-400 focus:outline-none focus:border-gray-600 text-black placeholder-gray-300 font-THSarabun"),placeholder:"Add comment...",readOnly:d,disabled:d})})},e)}),(0,r.jsx)("div",{className:"h-8"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Approval Status"})}),t.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-100 to-blue-200 rounded-md p-1 shadow h-8",children:(0,r.jsx)("div",{className:"text-center flex justify-center items-center",children:l[e]?(0,r.jsx)(x,{wardId:e,date:o,status:l[e]}):(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"No data"})})},e)),(0,r.jsx)("div",{className:"h-8"})]})]})})},h=e=>{let{label:t,oldValue:a,newValue:s}=e;return(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 py-1",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600",children:t}),(0,r.jsx)("div",{className:"text-sm text-purple-600",children:a||"-"}),(0,r.jsx)("div",{className:"text-sm text-pink-600",children:s||"-"})]})},g=e=>{let{showDataComparison:t,existingData:a,formData:s,summaryData:n,setShowDataComparison:l,saveData:o,WARD_ORDER:i}=e;return t&&a?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-xl font-medium mb-4",children:"Data Comparison"}),(0,r.jsx)("div",{className:"space-y-4",children:i.map(e=>{var t,n,l,o;return(0,r.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-lg mb-2",children:e}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-2",children:[(0,r.jsx)("div",{className:"font-medium",children:"Field"}),(0,r.jsx)("div",{className:"font-medium",children:"Current"}),(0,r.jsx)("div",{className:"font-medium",children:"New"})]}),(0,r.jsx)("div",{className:"space-y-1",children:(0,r.jsx)(h,{label:"Patient Census",oldValue:null==a?void 0:null===(n=a.wards)||void 0===n?void 0:null===(t=n[e])||void 0===t?void 0:t.numberOfPatients,newValue:null==s?void 0:null===(o=s.wards)||void 0===o?void 0:null===(l=o[e])||void 0===l?void 0:l.numberOfPatients})})]},e)})}),(0,r.jsxs)("div",{className:"mt-6 flex justify-end gap-4",children:[(0,r.jsx)("button",{onClick:()=>l(!1),className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"}),(0,r.jsx)("button",{onClick:o,className:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600",children:"Save Changes"})]})]})}):null};var p=a(6660),v=a(3979);let w=e=>{let{summaryData:t,setSummaryData:a}=e;return(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6",children:(0,r.jsx)("div",{className:"grid grid-cols-1 gap-8",children:(0,r.jsxs)("div",{className:"bg-green-50/80 rounded-xl p-5 shadow-sm",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-green-800 mb-4 bg-white/50 py-2 px-4 rounded-lg text-center shadow-sm",children:"Supervisor Signature"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-green-700",children:"First Name"}),(0,r.jsx)("input",{type:"text",value:t.supervisorFirstName,onChange:e=>a(t=>({...t,supervisorFirstName:e.target.value})),className:"w-full text-black px-3 py-2 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-300 focus:border-green-300 bg-white/70",placeholder:"ชื่อ"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-green-700",children:"Last Name"}),(0,r.jsx)("input",{type:"text",value:t.supervisorLastName,onChange:e=>a(t=>({...t,supervisorLastName:e.target.value})),className:"w-full text-black px-3 py-2 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-300 focus:border-green-300 bg-white/70",placeholder:"นามสกุล"})]})]})]})})})},j=e=>{let{summaryData:t,setSummaryData:a}=e;return(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-center mb-6 text-indigo-800 bg-white/50 py-2 rounded-lg shadow-sm",children:"ข้อมูลสรุป 24 ชั่วโมง"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"bg-pink-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-pink-700 mb-2",children:"OPD 24hr"}),(0,r.jsx)("input",{type:"number",value:t.opdTotal24hr,onChange:e=>a(t=>({...t,opdTotal24hr:e.target.value})),className:"w-full text-black px-3 py-2 border border-pink-200 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-pink-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-purple-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"Old Patient"}),(0,r.jsx)("input",{type:"number",value:t.existingPatients,onChange:e=>a(t=>({...t,existingPatients:e.target.value})),className:"w-full text-black px-3 py-2 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"New Patient"}),(0,r.jsx)("input",{type:"number",value:t.newPatients,onChange:e=>a(t=>({...t,newPatients:e.target.value})),className:"w-full text-black px-3 py-2 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-300 focus:border-blue-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-teal-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-teal-700 mb-2",children:"Admit 24hr"}),(0,r.jsx)("input",{type:"number",value:t.admissions24hr,onChange:e=>a(t=>({...t,admissions24hr:e.target.value})),className:"w-full text-black px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-300 focus:border-teal-300 bg-white/70",placeholder:"0"})]})]})]})};var N=a(8382);let y=e=>{let{showCalendar:t,setShowCalendar:a,selectedDate:s,setSelectedDate:n,formData:l,setFormData:o,thaiDate:i,setThaiDate:d,fetchPreviousShiftData:c,handleShiftChange:m,datesWithData:f,checkExistingData:x,setSummaryData:b}=e;return(0,r.jsxs)("div",{className:"bg-gradient-to-br from-[#0ab4ab]/5 via-blue-50 to-purple-50 rounded-2xl p-4 mb-3 shadow-lg",children:[(0,r.jsxs)("div",{className:"text-center mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Logo",className:"w-8 h-8 object-contain"}),(0,r.jsx)("h1",{className:"text-xl font-bold bg-gradient-to-r from-[#0ab4ab] to-blue-600 text-transparent bg-clip-text mb-1",children:"Daily Patient Census and Staffing"})]}),(0,r.jsx)("div",{className:"h-0.5 w-24 mx-auto bg-gradient-to-r from-[#0ab4ab] to-blue-600 rounded-full"})]}),(0,r.jsx)("div",{className:"space-y-3",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsx)("div",{className:"bg-white/60 backdrop-blur-sm rounded-xl p-3 shadow-sm hover:shadow-md transition-all",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>a(!t),className:"w-full md:w-auto px-4 py-2 bg-gradient-to-r from-[#0ab4ab] to-blue-500 text-white rounded-lg hover:from-[#0ab4ab]/90 hover:to-blue-600 transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[#0ab4ab] focus:ring-opacity-50 shadow-md text-sm",children:t?"ซ่อนปฏิทิน":"เลือกวันที่"}),(0,r.jsxs)("div",{className:"text-gray-700 space-y-0.5 text-center md:text-left text-sm",children:[(0,r.jsxs)("div",{className:"font-medium text-[#0ab4ab]",children:["วันที่ปัจจุบัน : ",(0,p.mI)(new Date)]}),(0,r.jsxs)("div",{className:"text-blue-600",children:["อัพเดทข้อมูลล่าสุด : ",i]})]})]})}),(0,r.jsx)("div",{className:"bg-white/60 backdrop-blur-sm rounded-xl p-3 shadow-sm hover:shadow-md transition-all",children:(0,r.jsx)("div",{className:"flex flex-col md:flex-row justify-center gap-4",children:["07:00-19:00","19:00-07:00"].map(e=>(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsxs)("label",{className:"relative flex items-center gap-2 cursor-pointer group",children:[(0,r.jsx)("input",{type:"radio",name:"shift",value:e,checked:l.shift===e,onChange:e=>m(e.target.value),className:"hidden"}),(0,r.jsx)("div",{className:"w-4 h-4 rounded-full border-2 transition-all ".concat(l.shift===e?"border-[#0ab4ab] bg-[#0ab4ab]":"border-gray-300 group-hover:border-[#0ab4ab]/50"),children:l.shift===e&&(0,r.jsx)("div",{className:"w-1.5 h-1.5 bg-white rounded-full m-auto mt-0.5"})}),(0,r.jsxs)("span",{className:"text-sm transition-colors ".concat(l.shift===e?"text-[#0ab4ab] font-medium":"text-gray-600"),children:["07:00-19:00"===e?"เช้า":"ดึก"," (",e,")",e===l.shift&&(0,r.jsx)("span",{className:"ml-1 text-xs px-1.5 py-0.5 bg-[#0ab4ab]/10 text-[#0ab4ab] rounded-full",children:"กะที่เลือกก่อนหน้านั้น"})]})]})},e))})})]})}),t&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:(0,r.jsx)("div",{className:"relative bg-white rounded-2xl shadow-2xl transform transition-all",children:(0,r.jsx)(N.A,{selectedDate:s,datesWithData:f,onDateSelect:async e=>{let t=new Date(e);t.setHours(0,0,0,0);let r=t.getTimezoneOffset();t.setMinutes(t.getMinutes()-r);let s=t.toISOString().split("T")[0];!await x(s,l.shift)&&(await u.YU.fire({title:"ยืนยันการเปลี่ยนวันที่",html:'\n                                            <div class="text-left">\n                                                <p class="font-semibold mb-2">ข้อมูลต่อไปนี้จะถูกล้าง:</p>\n                                                <ul class="list-disc pl-5 space-y-1 text-sm">\n                                                    <li>ข้อมูลเจ้าหน้าที่ (Nurse Manager, RN, PN, WC)</li>\n                                                    <li>ข้อมูลการเคลื่อนย้ายผู้ป่วย</li>\n                                                    <li>ข้อมูลเตียง</li>\n                                                    <li>Comments</li>\n                                                    <li>ข้อมูลสรุป 24 ชั่วโมง</li>\n                                                    <li>ลายเซ็นผู้ตรวจการและผู้บันทึก</li>\n                                                </ul>\n                                                <p class="mt-4 text-sm text-gray-600">*Patient Census และ Overall Data จะถูกคำนวณใหม่</p>\n                                            </div>\n                                        ',icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed&&(await c(s,l.shift),o(e=>{let t={};return Object.entries(e.wards).forEach(e=>{let[a,r]=e;t[a]={numberOfPatients:r.numberOfPatients,overallData:r.overallData,nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",availableBeds:"0",unavailable:"0",plannedDischarge:"0",comment:""}}),{...e,date:s,wards:t}}),b({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:"",recorderFirstName:"",recorderLastName:""}),n(t),d((0,p.mI)(t)),a(!1),await u.YU.fire({title:"ล้างข้อมูลสำเร็จ",text:"ระบบได้ล้างข้อมูลและคงค่า Patient Census และ Overall Data ไว้",icon:"success",confirmButtonColor:"#0ab4ab"}))},onClickOutside:()=>a(!1),variant:"form"})})})]})},C=e=>{var t,a,i;let{isApprovalMode:m=!1}=e,x=(0,n.useRouter)(),{user:h}=(0,f.A)(),[N,C]=(0,s.useState)(0),[D,O]=(0,s.useState)(!0),[S,k]=(0,s.useState)(!1),[B,P]=(0,s.useState)(!1),[T,I]=(0,s.useState)(new Date),[W,R]=(0,s.useState)([]),[L,M]=(0,s.useState)(""),[E,A]=(0,s.useState)(!1),[H,U]=(0,s.useState)({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:""}),[_,Y]=(0,s.useState)({date:"",shift:"",wards:{Ward6:{...c},Ward7:{...c},Ward8:{...c},Ward9:{...c},WardGI:{...c},Ward10B:{...c},Ward11:{...c},Ward12:{...c},ICU:{...c},CCU:{...c},LR:{...c},NSY:{...c}},totals:{...c}}),[F,G]=(0,s.useState)(!1),[z,V]=(0,s.useState)(null),[q,J]=(0,s.useState)({initialLoading:!0,savingData:!1,checkingDuplicates:!1,fetchingDates:!1}),[K,$]=(0,s.useState)(""),[Z,Q]=(0,s.useState)(!1),[X,ee]=(0,s.useState)(!1),[et,ea]=(0,s.useState)({});(0,s.useEffect)(()=>{let e=()=>window.innerWidth<768,t=()=>{ee(e())};return ee(e()),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),(0,s.useEffect)(()=>{setTimeout(()=>{O(!1)},1e3)},[]);let er=async e=>{try{if(!e)return;let t=(0,p.Ol)(new Date(e)),a=(0,o.rJ)(l.db,"wardDailyRecords"),r={};for(let e of d){let s=(0,o.P)(a,(0,o._M)("date","==",t),(0,o._M)("wardId","==",e)),n=await (0,o.GG)(s);if(n.empty)r[e]=null;else{let t=n.docs[0].data();r[e]=t.approvalStatus||"pending"}}ea(r),console.log("Fetched approval statuses:",r)}catch(e){console.error("Error fetching approval statuses:",e)}};(0,s.useEffect)(()=>{console.log("ShiftForm running in ".concat(m?"approval":"normal"," mode")),m&&A(!0);{let e=new Date;I(e);let t=e.toISOString().split("T")[0],a=(0,v.Se)();Y(e=>({...e,date:t,shift:a})),M((0,p.mI)(e)),ei(t),ed(t),eN(),er(t)}},[m]);let[es,en]=(0,s.useState)(!1),[el,eo]=(0,s.useState)(!1),ei=async e=>{try{let t=(0,o.rJ)(l.db,"staffRecords"),a=(0,o.P)(t,(0,o._M)("date","==",e),(0,o._M)("shift","==","07:00-19:00")),r=!(await (0,o.GG)(a)).empty;return en(r),r}catch(e){return console.error("Error checking morning shift data:",e),en(!1),!1}},ed=async e=>{try{let t=(0,o.rJ)(l.db,"staffRecords"),a=new Date(e);a.setDate(a.getDate()-1);let r=a.toISOString().split("T")[0],s=(0,o.P)(t,(0,o._M)("date","==",r),(0,o._M)("shift","==","19:00-07:00")),n=!(await (0,o.GG)(s)).empty;return eo(n),n}catch(e){return console.error("Error checking previous night shift data:",e),eo(!1),!1}},ec=async e=>{try{let t=(0,o.rJ)(l.db,"staffRecords"),a=(0,o.P)(t,(0,o._M)("date","==",e)),r=await (0,o.GG)(a),s=new Set(r.docs.map(e=>e.data().shift));return{hasMorningShift:s.has("07:00-19:00"),hasNightShift:s.has("19:00-07:00")}}catch(e){return console.error("Error checking date shifts:",e),{hasMorningShift:!1,hasNightShift:!1}}},eu=(0,s.useMemo)(()=>Object.values(_.wards).reduce((e,t)=>({numberOfPatients:e.numberOfPatients+(Number(t.numberOfPatients)||0),nurseManager:e.nurseManager+(Number(t.nurseManager)||0),RN:e.RN+(Number(t.RN)||0),PN:e.PN+(Number(t.PN)||0),WC:e.WC+(Number(t.WC)||0),newAdmit:e.newAdmit+(Number(t.newAdmit)||0),transferIn:e.transferIn+(Number(t.transferIn)||0),referIn:e.referIn+(Number(t.referIn)||0),transferOut:e.transferOut+(Number(t.transferOut)||0),referOut:e.referOut+(Number(t.referOut)||0),discharge:e.discharge+(Number(t.discharge)||0),dead:e.dead+(Number(t.dead)||0),overallData:e.overallData+(Number(t.overallData)||0),availableBeds:e.availableBeds+(Number(t.availableBeds)||0),unavailable:e.unavailable+(Number(t.unavailable)||0),plannedDischarge:e.plannedDischarge+(Number(t.plannedDischarge)||0)}),{numberOfPatients:0,nurseManager:0,RN:0,PN:0,WC:0,newAdmit:0,transferIn:0,referIn:0,transferOut:0,referOut:0,discharge:0,dead:0,overallData:0,availableBeds:0,unavailable:0,plannedDischarge:0}),[_.wards]);(0,s.useEffect)(()=>{Y(e=>({...e,totals:eu}))},[eu]);let em=(0,s.useCallback)(()=>{var e,t;if(!h||(null===(e=h.role)||void 0===e?void 0:e.toLowerCase())==="admin"||(null===(t=h.role)||void 0===t?void 0:t.toLowerCase())==="approver")return d;let a=h.department;return a&&d.includes(a)?[a]:d},[h]),ef=(0,s.useMemo)(()=>em(),[em]),ex=(0,s.useCallback)((e,t,a)=>{var r;if((null==h?void 0:null===(r=h.role)||void 0===r?void 0:r.toLowerCase())==="user"){console.log("View only mode: Changes are disabled");return}},[_,Y,h]),eb=async e=>{var t;if(e.preventDefault(),E){u.YU.fire({title:"โหมดดูข้อมูลเท่านั้น",text:"ข้อมูลอยู่ในโหมดดูอย่างเดียว ไม่สามารถบันทึกได้",icon:"info",confirmButtonColor:"#0ab4ab"});return}if((null==h?void 0:null===(t=h.role)||void 0===t?void 0:t.toLowerCase())==="user"){u.YU.fire({title:"โหมดดูข้อมูลเท่านั้น",text:"คุณไม่มีสิทธิ์บันทึกข้อมูล กรุณาติดต่อผู้ดูแลระบบ",icon:"info",confirmButtonColor:"#0ab4ab"});return}};(0,s.useCallback)(()=>{let e=new Date,t=new Date(T);return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},[T]);let eh=()=>{if(!_.date)return!1;let e=new Date(_.date),t=new Date;return t.setDate(t.getDate()+1),e.setHours(0,0,0,0),t.setHours(0,0,0,0),e>t};(0,s.useCallback)(()=>Object.values(_.wards).some(e=>Object.entries(e).some(e=>{let[t,a]=e;return"comment"!==t&&""!==a&&"0"!==a})),[_.wards]);let eg=(0,s.useCallback)(()=>{let e={staff:!1,movement:!1,additional:!1};return Object.values(_.wards).forEach(t=>{("0"!==t.nurseManager||"0"!==t.RN||"0"!==t.PN||"0"!==t.WC)&&(e.staff=!0),("0"!==t.newAdmit||"0"!==t.transferIn||"0"!==t.referIn||"0"!==t.transferOut||"0"!==t.referOut||"0"!==t.discharge||"0"!==t.dead)&&(e.movement=!0),("0"!==t.availableBeds||"0"!==t.unavailable||"0"!==t.plannedDischarge||""!==t.comment.trim())&&(e.additional=!0)}),e},[_.wards]),ep=(0,s.useCallback)(()=>{let e=eg(_);return e.staff||e.movement||e.additional},[_]);(0,s.useEffect)(()=>{Q(ep())},[_,ep]),(0,s.useEffect)(()=>{let e=e=>{Z&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[Z]),(0,s.useEffect)(()=>{var e;let t=async()=>{if(Z&&!(await u.YU.fire({title:"แจ้งเตือนการออกจากหน้าบันทึกข้อมูล",html:'\n                        <div class="text-left">\n                            <p class="font-semibold">ท่านกำลังดำเนินการบันทึกข้อมูลอยู่</p>\n                            <div class="mt-4 space-y-2">\n                                <p class="text-gray-600">การออกจากหน้านี้จะส่งผลให้:</p>\n                                <ul class="list-disc pl-5 text-sm text-gray-600">\n                                    <li>ข้อมูลที่กำลังบันทึกจะถูกรีเซ็ตทั้งหมด</li>\n                                    <li>ท่านจะต้องเริ่มกรอกข้อมูลใหม่เมื่อกลับมาที่หน้านี้</li>\n                                </ul>\n                            </div>\n                            <p class="mt-4 text-sm font-medium text-gray-700">โปรดยืนยันการดำเนินการ</p>\n                        </div>\n                    ',icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยันการออกจากหน้านี้",cancelButtonText:"ยกเลิกและกลับไปบันทึกข้อมูล",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",reverseButtons:!0})).isConfirmed)throw"Route Cancelled"};return null===(e=x.events)||void 0===e||e.on("routeChangeStart",t),()=>{var e;null===(e=x.events)||void 0===e||e.off("routeChangeStart",t)}},[Z,x]),(0,s.useCallback)(async()=>{var e,t,a;console.log("Validating form data...",_);let r=new Date(new Date(_.date));r.setDate(r.getDate()-1);let s=r.toISOString().split("T")[0],n=await ec(s);if(!n.hasNightShift&&n.hasMorningShift)return await u.YU.fire({title:"ไม่สามารถบันทึกข้อมูลได้",html:"วันที่ ".concat((0,p.mI)(r)," ยังไม่ได้บันทึกข้อมูลกะดึก<br>กรุณาบันทึกข้อมูลกะดึกของวันที่ ").concat((0,p.mI)(r)," ก่อน"),icon:"error",confirmButtonColor:"#0ab4ab"}),!1;for(let r of[{condition:!_.date||""===_.date.trim(),message:"กรุณาเลือกวันที่ก่อนดำเนินการต่อ"},{condition:!_.shift||""===_.shift.trim(),message:"กรุณาเลือกกะการทำงาน"},{condition:eh(),message:"ไม่สามารถบันทึกข้อมูลล่วงหน้าเกิน 1 วันได้"},{condition:"19:00-07:00"===_.shift&&!es,message:"ไม่สามารถบันทึกข้อมูลกะดึกได้ เนื่องจากยังไม่มีการบันทึกข้อมูลกะเช้าก่อน"},{condition:(null==h?void 0:null===(e=h.role)||void 0===e?void 0:e.toLowerCase())==="admin"&&(!(null===(t=H.supervisorFirstName)||void 0===t?void 0:t.trim())||!(null===(a=H.supervisorLastName)||void 0===a?void 0:a.trim())),message:"กรุณากรอกชื่อและนามสกุลผู้ตรวจการ"}])if(r.condition)return console.log("Validation failed:",r.message),r.message&&alert(r.message),!1;return!0},[_,H,eh,es]);let ev=()=>{u.YU.fire({title:"ล้างข้อมูล?",text:"คุณต้องการล้างข้อมูลทั้งหมดใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33",confirmButtonText:"ใช่, ล้างข้อมูล",cancelButtonText:"ยกเลิก"}).then(e=>{e.isConfirmed&&(Y(e=>{let t={};return Object.entries(e.wards).forEach(e=>{let[a,r]=e;t[a]={...r,nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",availableBeds:"0",unavailable:"0",plannedDischarge:"0",comment:""}}),{...e,wards:t}}),U({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:""}),Q(!1),u.YU.fire({title:"ล้างข้อมูลสำเร็จ",text:"กรุณาเลือกวันที่อีกครั้ง หรือตรวจสอบข้อมูลโดยรวมในหน้า Dashboard",icon:"success",confirmButtonColor:"#0ab4ab"}))})},ew=async(e,t)=>{try{let a=(0,o.rJ)(l.db,"staffRecords"),r=(0,o.P)(a,(0,o._M)("date","==",e),(0,o._M)("shift","==",t));if(!(await (0,o.GG)(r)).empty)return await u.YU.fire({title:"แจ้งเตือน",html:"มีข้อมูลของวันที่ ".concat((0,p.mI)(e)," กะ ").concat(t," ในระบบแล้ว<br><br>หากต้องการแก้ไขข้อมูล กรุณาดำเนินการบันทึกข้อมูลใหม่"),icon:"info",confirmButtonColor:"#0ab4ab"}),!0;return!1}catch(e){return console.error("Error checking existing data:",e),!1}},ej=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];J(e=>({...e,savingData:!0})),$("กำลังบันทึกข้อมูล...");try{let t=new Date().toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":",""),a=_.date.replace(/-/g,""),r=e&&z?z.id:"data_".concat(t,"_").concat(a);console.log("Saving data with ID:",r);let s={date:_.date,shift:_.shift,wards:Object.fromEntries(Object.entries(_.wards).map(e=>{let[t,a]=e;return[t,{numberOfPatients:a.numberOfPatients||"0",nurseManager:a.nurseManager||"0",RN:a.RN||"0",PN:a.PN||"0",WC:a.WC||"0",newAdmit:a.newAdmit||"0",transferIn:a.transferIn||"0",referIn:a.referIn||"0",transferOut:a.transferOut||"0",referOut:a.referOut||"0",discharge:a.discharge||"0",dead:a.dead||"0",overallData:a.overallData||"0",availableBeds:a.availableBeds||"0",plannedDischarge:a.plannedDischarge||"0",unavailable:a.unavailable||"0",comment:a.comment||""}]})),summaryData:{opdTotal24hr:H.opdTotal24hr||"",existingPatients:H.existingPatients||"",newPatients:H.newPatients||"",admissions24hr:H.admissions24hr||"",supervisorFirstName:H.supervisorFirstName||"",supervisorLastName:H.supervisorLastName||""},timestamp:(0,o.O5)(),lastModified:(0,o.O5)()};console.log("Saving sanitized data:",s),await (0,o.BN)((0,o.H9)(l.db,"staffRecords",r),s);let n=Object.entries(_.wards).map(async e=>{let[t,a]=e;if(Object.values(a).some(e=>"0"!==e&&""!==e)){let e=(0,o.H9)(l.db,"wardDailyRecords","".concat(_.date,"_").concat(t));try{await (0,o.BN)(e,{wardId:t,date:_.date,patientCensus:a.numberOfPatients||"0",overallData:a.overallData||"0",approvalStatus:"pending",lastUpdated:(0,o.O5)(),shifts:{[_.shift]:{nurseManager:a.nurseManager||"0",RN:a.RN||"0",PN:a.PN||"0",WC:a.WC||"0",newAdmit:a.newAdmit||"0",transferIn:a.transferIn||"0",referIn:a.referIn||"0",transferOut:a.transferOut||"0",referOut:a.referOut||"0",discharge:a.discharge||"0",dead:a.dead||"0",availableBeds:a.availableBeds||"0",unavailable:a.unavailable||"0",plannedDischarge:a.plannedDischarge||"0",comment:a.comment||""}}},{merge:!0})}catch(e){console.error("Error saving wardDailyRecord for ".concat(t,":"),e)}}});await Promise.all(n),await er(_.date),$("บันทึกข้อมูลสำเร็จ กำลังรีเซ็ตฟอร์ม..."),await new Promise(e=>setTimeout(e,1e3)),console.log("Data saved successfully"),ev(),u.YU.fire({title:"บันทึกข้อมูลสำเร็จ",text:"ข้อมูลถูกบันทึกเรียบร้อยแล้ว",icon:"success",confirmButtonColor:"#0ab4ab"}).then(()=>{window.location.reload()})}catch(e){console.error("Error saving data:",e),u.YU.fire({title:"เกิดข้อผิดพลาด",text:e.message,icon:"error",confirmButtonColor:"#0ab4ab"})}finally{J(e=>({...e,savingData:!1,checkingDuplicates:!1})),$(""),G(!1)}},eN=async()=>{try{let e=(0,o.rJ)(l.db,"staffRecords"),t=new Date(new Date().getFullYear(),0,1),a=new Date(new Date().getFullYear(),11,31),r=(0,o.P)(e,(0,o._M)("date",">=",(0,p.Ol)(t)),(0,o._M)("date","<=",(0,p.Ol)(a))),s=await (0,o.GG)(r),n={};s.docs.forEach(e=>{let t=e.data();n[t.date]||(n[t.date]=new Set),n[t.date].add(t.shift)});let i=Object.entries(n).map(e=>{let[t,a]=e;return{date:t,shifts:Array.from(a),isComplete:2===a.size}});R(i)}catch(e){console.error("Error fetching dates with data:",e),R([])}};(0,s.useEffect)(()=>{eN()},[]),(0,s.useEffect)(()=>()=>{O(!1),k(!1),P(!1)},[]);let ey=async(e,t)=>{try{$("กำลังดึงข้อมูลจากระบบ");let a=(0,o.rJ)(l.db,"wardDailyRecords"),r=new Date(e),s="";"19:00-07:00"===t?(s="07:00-19:00",$("กำลังดึงข้อมูลจากกะเช้า-บ่าย (".concat(s,")"))):(r.setDate(r.getDate()-1),s="19:00-07:00",$("กำลังดึงข้อมูลจากกะดึกของวันก่อนหน้า (".concat(s,")")));let n=(0,p.Ol)(r),i=(0,p.mI)(r).replace("เพิ่มข้อมูล วันที่: ","");$("กำลังดึงข้อมูล Overall Data\nจากวันที่ ".concat(i,"\nกะ ").concat(s));let d=(0,o.P)(a,(0,o._M)("date","==",n)),c=await (0,o.GG)(d),u={..._.wards};if(c.empty){$("กำลังค้นหาข้อมูลล่าสุด...");let e=(0,o.P)(a,(0,o._M)("date","<=",n),(0,o.My)("date","desc"),(0,o.AB)(1)),t=await (0,o.GG)(e);if(t.empty)$("ไม่พบข้อมูลก่อนหน้า"),setTimeout(()=>$(""),2e3);else{let e=t.docs[0].data(),a=(0,p.mI)(new Date(e.date)).replace("เพิ่มข้อมูล วันที่: ","");$("พบข้อมูลล่าสุดจาก\nวันที่ ".concat(a)),Object.keys(_.wards).forEach(e=>{var t;let a=null===(t=c.docs.find(t=>t.data().wardId===e))||void 0===t?void 0:t.data();a&&(u[e]={..._.wards[e],numberOfPatients:a.overallData||"0",overallData:a.overallData||"0"})}),Y(e=>({...e,wards:u})),setTimeout(()=>$(""),2e3)}}else c.docs.forEach(e=>{let t=e.data(),a=t.wardId;t.shifts&&t.shifts[s]&&(t.shifts[s],u[a]={..._.wards[a],numberOfPatients:t.overallData||"0",overallData:t.overallData||"0"})}),Y(e=>({...e,wards:u})),$("ดึงข้อมูลสำเร็จ\nจากวันที่ ".concat(i,"\nกะ ").concat(s)),setTimeout(()=>$(""),2e3)}catch(e){console.error("Error fetching previous shift data:",e),$("เกิดข้อผิดพลาด: ".concat(e.message)),setTimeout(()=>$(""),3e3)}},eC=(0,s.useCallback)(()=>{let e=Object.values(_.wards).some(e=>"0"!==e.nurseManager||"0"!==e.RN||"0"!==e.PN||"0"!==e.WC||"0"!==e.newAdmit||"0"!==e.transferIn||"0"!==e.referIn||"0"!==e.transferOut||"0"!==e.referOut||"0"!==e.discharge||"0"!==e.dead||"0"!==e.availableBeds||"0"!==e.unavailable||"0"!==e.plannedDischarge||""!==e.comment.trim()),t=""!==H.opdTotal24hr||""!==H.existingPatients||""!==H.newPatients||""!==H.admissions24hr||""!==H.supervisorFirstName||""!==H.supervisorLastName;return e||t},[_.wards,H]);(0,s.useEffect)(()=>{Q(eC())},[_,H,eC]);let eD=async()=>{Z?(await u.YU.fire({title:"แจ้งเตือนการเปลี่ยนหน้า",html:'\n                    <div class="text-left">\n                        <p class="font-semibold text-red-600">ข้อควรระวัง: พบข้อมูลที่ยังไม่ได้บันทึก</p>\n                        <div class="mt-4 space-y-2">\n                            <p class="text-gray-700">การเปลี่ยนไปยังหน้า Dashboard จะส่งผลดังนี้:</p>\n                            <ul className="list-disc pl-5 space-y-1">\n                                <li class="text-gray-600">ข้อมูลที่ท่านกรอกจะไม่ถูกบันทึก</li>\n                                <li class="text-gray-600">ข้อมูลทั้งหมดในแบบฟอร์มจะถูกรีเซ็ต</li>\n                                <li class="text-gray-600">ท่านจะต้องเริ่มกรอกข้อมูลใหม่เมื่อกลับมายังหน้านี้</li>\n                            </ul>\n                            <div className="mt-4 p-2 bg-yellow-50 border border-yellow-200 rounded-lg">\n                                <p className="text-sm text-yellow-700">\n                                    <span class="font-medium">คำแนะนำ:</span> กรุณาบันทึกข้อมูลให้เรียบร้อยก่อนออกจากหน้านี้\n                                </p>\n                                        </div>\n                                        </div>\n                                    </div>\n                ',icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยันการเปลี่ยนหน้า",cancelButtonText:"ยกเลิกและกลับไปบันทึกข้อมูล",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",reverseButtons:!0})).isConfirmed&&x.push("/dashboard"):x.push("/dashboard")};return(0,r.jsxs)("div",{className:"w-full px-2 py-2",children:[X&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-[#0ab4ab]/95 to-blue-600/95 backdrop-blur-md flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl text-center space-y-4",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Logo",className:"w-24 h-24 mx-auto mb-4 animate-pulse"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-[#0ab4ab]",children:"แจ้งเตือนการใช้งาน"}),(0,r.jsxs)("div",{className:"space-y-3 text-gray-600",children:[(0,r.jsx)("p",{className:"font-medium",children:"ระบบอยู่ระหว่างการพัฒนาสำหรับอุปกรณ์มือถือ"}),(0,r.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-xl",children:[(0,r.jsx)("p",{className:"text-sm",children:"เพื่อประสิทธิภาพในการใช้งานสูงสุด กรุณาใช้งานผ่าน:"}),(0,r.jsxs)("ul",{className:"text-sm mt-2 space-y-1",children:[(0,r.jsx)("li",{children:"• คอมพิวเตอร์ตั้งโต๊ะ (Desktop)"}),(0,r.jsx)("li",{children:"• คอมพิวเตอร์พกพา (Laptop)"})]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"หากมีข้อสงสัยกรุณาติดต่อผู้ดูแลระบบ"})]})]})}),(0,r.jsxs)("form",{onSubmit:eb,className:"w-full mx-auto",children:[D&&(0,r.jsx)("div",{className:"fixed inset-0 bg-white flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Loading",className:"w-32 h-32 mx-auto mb-4 animate-pulse"}),(0,r.jsx)("p",{className:"text-gray-600",children:"กำลังโหลด..."})]})}),(0,r.jsx)(g,{showDataComparison:F,existingData:z,formData:_,summaryData:H,setShowDataComparison:G,saveData:ej,WARD_ORDER:d}),(0,r.jsx)(y,{showCalendar:B,setShowCalendar:P,selectedDate:T,setSelectedDate:I,formData:_,setFormData:Y,thaiDate:L,setThaiDate:M,fetchPreviousShiftData:ey,handleShiftChange:e=>{Y(t=>({...t,shift:e}))},datesWithData:W,checkExistingData:ew,setSummaryData:U}),(0,r.jsx)("div",{className:"hidden md:block w-full",children:(0,r.jsxs)("div",{className:"w-full mx-auto p-4 bg-white rounded-xl shadow-lg border border-gray-200",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-pink-400/20 to-white p-2 rounded-lg",children:(0,r.jsx)("h2",{className:"text-lg font-bold text-pink-600 text-center mb-1",children:"Form"})}),(0,r.jsx)(b,{WARD_ORDER:ef,formData:_,handleInputChange:ex,displayValue:e=>null==e||""===e?"0":e,approvalStatuses:et,selectedDate:T,readOnly:(null==h?void 0:null===(t=h.role)||void 0===t?void 0:t.toLowerCase())==="user"})]})}),(0,r.jsx)("div",{className:"hidden md:block mt-8",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-[#0ab4ab]/10 to-white rounded-xl shadow-lg p-6",children:(null==h?void 0:null===(a=h.role)||void 0===a?void 0:a.toLowerCase())==="admin"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j,{summaryData:H,setSummaryData:U}),(0,r.jsx)(w,{summaryData:H,setSummaryData:U})]})})}),(0,r.jsx)("div",{className:"mt-8 flex justify-center p-6 bg-gradient-to-r from-[#0ab4ab]/10 to-white rounded-xl shadow-lg",children:(null==h?void 0:null===(i=h.role)||void 0===i?void 0:i.toLowerCase())==="user"?(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center border border-gray-200",children:[(0,r.jsx)("div",{className:"text-gray-700 font-medium mb-2",children:"โหมดดูข้อมูลเท่านั้น"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"คุณสามารถดูข้อมูลได้ แต่ไม่สามารถแก้ไขหรือบันทึกข้อมูลได้"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"ข้อมูลที่แสดงเฉพาะ ward ของคุณเท่านั้น"})]}):(0,r.jsx)("button",{type:"submit",disabled:S||E,className:"px-12 py-4 bg-gradient-to-r from-[#0ab4ab] to-blue-400 text-white text-lg font-bold rounded-xl shadow-lg hover:from-[#0ab4ab] hover:to-blue-500 transition-all transform hover:scale-105 disabled:from-gray-400 disabled:to-gray-500 font-THSarabun",children:S?"Saving...":E?"View Only Mode":"Save Data"})}),(0,r.jsx)("button",{onClick:eD,className:"px-4 py-2 rounded-lg text-white hover:bg-[#0ab4ab]/80",children:"Dashboard"})]})]})};function D(){var e,t;let{user:a}=(0,f.A)();(0,n.useRouter)();let[l,o]=(0,s.useState)(!0),i=(null==a?void 0:null===(e=a.role)||void 0===e?void 0:e.toLowerCase())==="approver"||(null==a?void 0:null===(t=a.role)||void 0===t?void 0:t.toLowerCase())==="admin";return(0,s.useEffect)(()=>{(0,m.$s)("approval_page_accessed",{userId:(null==a?void 0:a.uid)||"unknown",userRole:(null==a?void 0:a.role)||"unknown"}),o(!1)},[a]),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"bg-yellow-50 p-4 mb-6 rounded-lg border border-yellow-200",children:[(0,r.jsx)("h2",{className:"font-medium text-yellow-700 mb-2",children:i?"หน้าสำหรับการอนุมัติข้อมูล":"หน้าแสดงสถานะการอนุมัติข้อมูล"}),(0,r.jsx)("p",{className:"text-sm text-yellow-600",children:i?"คุณสามารถตรวจสอบและอนุมัติข้อมูลได้ในหน้านี้ ข้อมูลที่อนุมัติแล้วจะไม่สามารถแก้ไขได้อีก":"คุณสามารถดูสถานะการอนุมัติข้อมูลของแผนกคุณได้ในหน้านี้ แต่ไม่สามารถอนุมัติข้อมูลได้"})]}),(0,r.jsx)(C,{isApprovalMode:!0})]})}var O=a(9092);function S(){return(0,r.jsx)(O.A,{title:"อนุมัติข้อมูล",requiredRole:"user",children:(0,r.jsx)(D,{})})}},8939:(e,t,a)=>{Promise.resolve().then(a.bind(a,7160))}},e=>{var t=t=>e(e.s=t);e.O(0,[302,932,766,653,775,505,315,358],()=>t(8939)),_N_E=e.O()}]);