(()=>{var e={};e.id=590,e.ids=[590],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},1645:e=>{"use strict";e.exports=require("net")},1820:e=>{"use strict";e.exports=require("os")},1900:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var r=a(5239),s=a(8088),n=a(8170),l=a.n(n),i=a(893),o={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);a.d(t,o);let d={children:["",{children:["page",{children:["approval",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,7317)),"C:\\Users\\B_SIR\\OneDrive\\เดสก์ท็อป\\Summary_of_Personnel_Ratio\\Summary_of_Personnel_Ratio\\app\\page\\approval\\page.js"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,2648)),"C:\\Users\\B_SIR\\OneDrive\\เดสก์ท็อป\\Summary_of_Personnel_Ratio\\Summary_of_Personnel_Ratio\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(a.t.bind(a,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(a.t.bind(a,5284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,c=["C:\\Users\\B_SIR\\OneDrive\\เดสก์ท็อป\\Summary_of_Personnel_Ratio\\Summary_of_Personnel_Ratio\\app\\page\\approval\\page.js"],u={require:a,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/page/approval/page",pathname:"/page/approval",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3496:e=>{"use strict";e.exports=require("http2")},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4471:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var r=a(687),s=a(3210),n=a(6189),l=a(9141),i=a(5535);a(9863);let o={Ward6:"Ward 6",Ward7:"Ward 7",Ward8:"Ward 8",Ward9:"Ward 9",WardGI:"Ward GI",Ward10B:"Ward 10B",Ward11:"Ward 11",Ward12:"Ward 12",ICU:"ICU",CCU:"CCU",LR:"LR",NSY:"NSY"},d=["Ward6","Ward7","Ward8","Ward9","WardGI","Ward10B","Ward11","Ward12","ICU","CCU","LR","NSY"],c={numberOfPatients:"0",nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",overallData:"0",availableBeds:"0",plannedDischarge:"0",unavailable:"0",comment:""};var u=a(8972),m=a(4788),x=a(4623);let f=({wardId:e,date:t,status:a="pending"})=>{let[n,o]=(0,s.useState)(!1),{user:d}=(0,x.A)(),c=async()=>{try{if(o(!0),!(await u.YU.fire({title:"Approve Ward Data",html:`
          <div class="text-left">
            <p class="mb-2 font-medium">Are you sure you want to approve data for ${e}?</p>
            <p class="text-sm text-gray-600">Date: ${t}</p>
          </div>
        `,icon:"question",showCancelButton:!0,confirmButtonText:"Approve",cancelButtonText:"Cancel",confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33"})).isConfirmed){o(!1);return}let a=(0,i.H9)(l.db,"wardDailyRecords",`${t}_${e}`);await (0,i.mZ)(a,{approvalStatus:"approved",approvedAt:new Date().toISOString()}),(0,m.$s)("approval_success",{wardId:e,date:t,action:"Approve ข้อมูลสำเร็จ",approvedBy:d?.displayName,approvedById:d?.uid,timestamp:new Date().toISOString()}),await u.YU.fire({title:"Approved Successfully",text:`Data for ${e} has been approved`,icon:"success",confirmButtonColor:"#0ab4ab"})}catch(e){console.error("Error approving ward data:",e),await u.YU.fire({title:"Error",text:"Failed to approve ward data. Please try again.",icon:"error",confirmButtonColor:"#0ab4ab"})}finally{o(!1)}},f=async()=>{try{o(!0);let a=await u.YU.fire({title:"Reject Ward Data",html:`
          <div class="text-left">
            <p class="mb-2 font-medium">Please provide a reason for rejection:</p>
            <textarea id="rejection-reason" class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="3"></textarea>
          </div>
        `,icon:"warning",showCancelButton:!0,confirmButtonText:"Reject",cancelButtonText:"Cancel",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",preConfirm:()=>{let e=document.getElementById("rejection-reason").value;return e.trim()||u.YU.showValidationMessage("Please provide a reason for rejection"),e}});if(!a.isConfirmed){o(!1);return}let r=a.value,s=(0,i.H9)(l.db,"wardDailyRecords",`${t}_${e}`);await (0,i.mZ)(s,{approvalStatus:"rejected",rejectedAt:new Date().toISOString(),rejectionReason:r}),(0,m.$s)("rejection_success",{wardId:e,date:t,action:"Reject ข้อมูลสำเร็จ",rejectedBy:d?.displayName,rejectedById:d?.uid,rejectionReason:r,timestamp:new Date().toISOString()}),await u.YU.fire({title:"Rejected Successfully",text:`Data for ${e} has been rejected`,icon:"info",confirmButtonColor:"#0ab4ab"})}catch(e){console.error("Error rejecting ward data:",e),await u.YU.fire({title:"Error",text:"Failed to reject ward data. Please try again.",icon:"error",confirmButtonColor:"#0ab4ab"})}finally{o(!1)}};return"approved"===a?(0,r.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Approved"]}):"rejected"===a?(0,r.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),"Rejected"]}):(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:c,disabled:n,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",children:n?"Processing...":"Approve"}),(0,r.jsx)("button",{onClick:f,disabled:n,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:n?"Processing...":"Reject"})]})},p=({WARD_ORDER:e,formData:t,handleInputChange:a,displayValue:s,approvalStatuses:n={},selectedDate:l,readOnly:i=!1})=>(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("div",{className:"inline-flex gap-1 min-w-max p-1",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h3",{className:"text-xs font-bold text-gray-700 font-THSarabun",children:"Wards"})}),e.map(e=>(0,r.jsx)("div",{className:"h-8 flex items-center",children:(0,r.jsx)("span",{className:"text-xs font-semibold text-[#0ab4ab] font-THSarabun whitespace-nowrap",children:o[e]||e})},e)),(0,r.jsx)("div",{className:"h-8 flex items-center",children:(0,r.jsx)("span",{className:"text-xs font-semibold text-purple-600 font-THSarabun",children:"Total"})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Patient Census"})}),e.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-[#0ab4ab]/20 to-[#0ab4ab]/10 rounded-md p-1 text-[#0ab4ab] shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:s(t.wards[e]?.numberOfPatients),className:"w-16 text-center text-sm font-bold bg-gray-100 border-b border-[#0ab4ab] focus:outline-none text-[#0ab4ab] placeholder-[#0ab4ab]/50 font-THSarabun cursor-not-allowed",placeholder:"0",readOnly:!0,disabled:!0})})},e)),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:s(t.totals.numberOfPatients),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Overall Data"})}),e.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-400/20 to-blue-500/10 rounded-md p-1 text-blue-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:s(t.wards[e]?.overallData),className:"w-16 text-center text-sm font-bold bg-gray-100 border-b border-blue-500 focus:outline-none text-blue-600 placeholder-blue-300 font-THSarabun cursor-not-allowed",placeholder:"0",readOnly:!0,disabled:!0})})},e)),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:s(t.totals.overallData),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]}),Object.entries({"Nurse Manager":"nurseManager",RN:"RN",PN:"PN",WC:"WC"}).map(([n,l])=>(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:n})}),e.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-400/20 to-green-500/10 rounded-md p-1 text-green-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:s(t.wards[e]?.[l]),onChange:t=>a("staff",e,{[l]:t.target.value}),className:`w-16 text-center text-sm font-bold ${i?"bg-gray-100 cursor-not-allowed":"bg-white"} border-b border-green-500 focus:outline-none focus:border-green-500 text-black placeholder-green-300 font-THSarabun`,placeholder:"0",min:"0",readOnly:i,disabled:i})})},e)),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:s(t.totals[l]),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},l)),Object.entries({"New Admit":"newAdmit","Transfer In":"transferIn","Refer In":"referIn","Transfer Out":"transferOut","Refer Out":"referOut",Discharge:"discharge",Dead:"dead"}).map(([n,l])=>(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:n})}),e.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-yellow-400/20 to-yellow-500/10 rounded-md p-1 text-yellow-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:s(t.wards[e]?.[l]),onChange:t=>a("movement",e,{[l]:t.target.value}),className:`w-16 text-center text-sm font-bold ${i?"bg-gray-100 cursor-not-allowed":"bg-white"} border-b border-yellow-500 focus:outline-none focus:border-yellow-500 text-black placeholder-yellow-300 font-THSarabun`,placeholder:"0",min:"0",readOnly:i,disabled:i})})},e)),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:s(t.totals[l]),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},l)),Object.entries({Available:"availableBeds",Unavailable:"unavailable","Planned Discharge":"plannedDischarge"}).map(([n,l])=>(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:n})}),e.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-pink-400/20 to-pink-500/10 rounded-md p-1 text-pink-600 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:s(t.wards[e]?.[l]),onChange:t=>a("info",e,{[l]:t.target.value}),className:`w-16 text-center text-sm font-bold ${i?"bg-gray-100 cursor-not-allowed":"bg-white"} border-b border-pink-500 focus:outline-none focus:border-pink-500 text-black placeholder-pink-300 font-THSarabun`,placeholder:"0",min:"0",readOnly:i,disabled:i})})},e)),(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-400 to-purple-500 rounded-md p-1 text-white shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"number",value:s(t.totals[l]),readOnly:!0,className:"w-16 text-center text-sm font-bold bg-transparent border-b border-white focus:outline-none text-white font-THSarabun",placeholder:"0"})})})]},l)),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Comment"})}),e.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-gray-100 to-gray-200 rounded-md p-1 shadow h-8",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("input",{type:"text",value:t.wards[e]?.comment||"",onChange:t=>a("comment",e,{comment:t.target.value}),className:`w-24 text-center text-xs ${i?"bg-gray-100 cursor-not-allowed":"bg-white"} border-b border-gray-400 focus:outline-none focus:border-gray-600 text-black placeholder-gray-300 font-THSarabun`,placeholder:"Add comment...",readOnly:i,disabled:i})})},e)),(0,r.jsx)("div",{className:"h-8"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"h-12 flex items-center justify-center",children:(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 font-THSarabun",children:"Approval Status"})}),e.map(e=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-100 to-blue-200 rounded-md p-1 shadow h-8",children:(0,r.jsx)("div",{className:"text-center flex justify-center items-center",children:n[e]?(0,r.jsx)(f,{wardId:e,date:l,status:n[e]}):(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"No data"})})},e)),(0,r.jsx)("div",{className:"h-8"})]})]})}),b=({label:e,oldValue:t,newValue:a})=>(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 py-1",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600",children:e}),(0,r.jsx)("div",{className:"text-sm text-purple-600",children:t||"-"}),(0,r.jsx)("div",{className:"text-sm text-pink-600",children:a||"-"})]}),h=({showDataComparison:e,existingData:t,formData:a,summaryData:s,setShowDataComparison:n,saveData:l,WARD_ORDER:i})=>e&&t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-xl font-medium mb-4",children:"Data Comparison"}),(0,r.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-lg mb-2",children:e}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-2",children:[(0,r.jsx)("div",{className:"font-medium",children:"Field"}),(0,r.jsx)("div",{className:"font-medium",children:"Current"}),(0,r.jsx)("div",{className:"font-medium",children:"New"})]}),(0,r.jsx)("div",{className:"space-y-1",children:(0,r.jsx)(b,{label:"Patient Census",oldValue:t?.wards?.[e]?.numberOfPatients,newValue:a?.wards?.[e]?.numberOfPatients})})]},e))}),(0,r.jsxs)("div",{className:"mt-6 flex justify-end gap-4",children:[(0,r.jsx)("button",{onClick:()=>n(!1),className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"}),(0,r.jsx)("button",{onClick:l,className:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600",children:"Save Changes"})]})]})}):null;var g=a(9245);let v=({summaryData:e,setSummaryData:t})=>(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6",children:(0,r.jsx)("div",{className:"grid grid-cols-1 gap-8",children:(0,r.jsxs)("div",{className:"bg-green-50/80 rounded-xl p-5 shadow-sm",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-green-800 mb-4 bg-white/50 py-2 px-4 rounded-lg text-center shadow-sm",children:"Supervisor Signature"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-green-700",children:"First Name"}),(0,r.jsx)("input",{type:"text",value:e.supervisorFirstName,onChange:e=>t(t=>({...t,supervisorFirstName:e.target.value})),className:"w-full text-black px-3 py-2 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-300 focus:border-green-300 bg-white/70",placeholder:"ชื่อ"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-green-700",children:"Last Name"}),(0,r.jsx)("input",{type:"text",value:e.supervisorLastName,onChange:e=>t(t=>({...t,supervisorLastName:e.target.value})),className:"w-full text-black px-3 py-2 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-300 focus:border-green-300 bg-white/70",placeholder:"นามสกุล"})]})]})]})})}),w=({summaryData:e,setSummaryData:t})=>(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-center mb-6 text-indigo-800 bg-white/50 py-2 rounded-lg shadow-sm",children:"ข้อมูลสรุป 24 ชั่วโมง"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"bg-pink-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-pink-700 mb-2",children:"OPD 24hr"}),(0,r.jsx)("input",{type:"number",value:e.opdTotal24hr,onChange:e=>t(t=>({...t,opdTotal24hr:e.target.value})),className:"w-full text-black px-3 py-2 border border-pink-200 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-pink-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-purple-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-purple-700 mb-2",children:"Old Patient"}),(0,r.jsx)("input",{type:"number",value:e.existingPatients,onChange:e=>t(t=>({...t,existingPatients:e.target.value})),className:"w-full text-black px-3 py-2 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-300 focus:border-purple-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"New Patient"}),(0,r.jsx)("input",{type:"number",value:e.newPatients,onChange:e=>t(t=>({...t,newPatients:e.target.value})),className:"w-full text-black px-3 py-2 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-300 focus:border-blue-300 bg-white/70",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"bg-teal-50 rounded-xl p-4 shadow-sm transition-all hover:shadow-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-teal-700 mb-2",children:"Admit 24hr"}),(0,r.jsx)("input",{type:"number",value:e.admissions24hr,onChange:e=>t(t=>({...t,admissions24hr:e.target.value})),className:"w-full text-black px-3 py-2 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-300 focus:border-teal-300 bg-white/70",placeholder:"0"})]})]})]});var N=a(5550);let j=({showCalendar:e,setShowCalendar:t,selectedDate:a,setSelectedDate:s,formData:n,setFormData:l,thaiDate:i,setThaiDate:o,fetchPreviousShiftData:d,handleShiftChange:c,datesWithData:m,checkExistingData:x,setSummaryData:f})=>(0,r.jsxs)("div",{className:"bg-gradient-to-br from-[#0ab4ab]/5 via-blue-50 to-purple-50 rounded-2xl p-4 mb-3 shadow-lg",children:[(0,r.jsxs)("div",{className:"text-center mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Logo",className:"w-8 h-8 object-contain"}),(0,r.jsx)("h1",{className:"text-xl font-bold bg-gradient-to-r from-[#0ab4ab] to-blue-600 text-transparent bg-clip-text mb-1",children:"Daily Patient Census and Staffing"})]}),(0,r.jsx)("div",{className:"h-0.5 w-24 mx-auto bg-gradient-to-r from-[#0ab4ab] to-blue-600 rounded-full"})]}),(0,r.jsx)("div",{className:"space-y-3",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsx)("div",{className:"bg-white/60 backdrop-blur-sm rounded-xl p-3 shadow-sm hover:shadow-md transition-all",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>t(!e),className:"w-full md:w-auto px-4 py-2 bg-gradient-to-r from-[#0ab4ab] to-blue-500 text-white rounded-lg hover:from-[#0ab4ab]/90 hover:to-blue-600 transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[#0ab4ab] focus:ring-opacity-50 shadow-md text-sm",children:e?"ซ่อนปฏิทิน":"เลือกวันที่"}),(0,r.jsxs)("div",{className:"text-gray-700 space-y-0.5 text-center md:text-left text-sm",children:[(0,r.jsxs)("div",{className:"font-medium text-[#0ab4ab]",children:["วันที่ปัจจุบัน : ",(0,g.mI)(new Date)]}),(0,r.jsxs)("div",{className:"text-blue-600",children:["อัพเดทข้อมูลล่าสุด : ",i]})]})]})}),(0,r.jsx)("div",{className:"bg-white/60 backdrop-blur-sm rounded-xl p-3 shadow-sm hover:shadow-md transition-all",children:(0,r.jsx)("div",{className:"flex flex-col md:flex-row justify-center gap-4",children:["07:00-19:00","19:00-07:00"].map(e=>(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsxs)("label",{className:"relative flex items-center gap-2 cursor-pointer group",children:[(0,r.jsx)("input",{type:"radio",name:"shift",value:e,checked:n.shift===e,onChange:e=>c(e.target.value),className:"hidden"}),(0,r.jsx)("div",{className:`w-4 h-4 rounded-full border-2 transition-all ${n.shift===e?"border-[#0ab4ab] bg-[#0ab4ab]":"border-gray-300 group-hover:border-[#0ab4ab]/50"}`,children:n.shift===e&&(0,r.jsx)("div",{className:"w-1.5 h-1.5 bg-white rounded-full m-auto mt-0.5"})}),(0,r.jsxs)("span",{className:`text-sm transition-colors ${n.shift===e?"text-[#0ab4ab] font-medium":"text-gray-600"}`,children:["07:00-19:00"===e?"เช้า":"ดึก"," (",e,")",e===n.shift&&(0,r.jsx)("span",{className:"ml-1 text-xs px-1.5 py-0.5 bg-[#0ab4ab]/10 text-[#0ab4ab] rounded-full",children:"กะที่เลือกก่อนหน้านั้น"})]})]})},e))})})]})}),e&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:(0,r.jsx)("div",{className:"relative bg-white rounded-2xl shadow-2xl transform transition-all",children:(0,r.jsx)(N.A,{selectedDate:a,datesWithData:m,onDateSelect:async e=>{let a=new Date(e);a.setHours(0,0,0,0);let r=a.getTimezoneOffset();a.setMinutes(a.getMinutes()-r);let i=a.toISOString().split("T")[0];!await x(i,n.shift)&&(await u.YU.fire({title:"ยืนยันการเปลี่ยนวันที่",html:`
                                            <div class="text-left">
                                                <p class="font-semibold mb-2">ข้อมูลต่อไปนี้จะถูกล้าง:</p>
                                                <ul class="list-disc pl-5 space-y-1 text-sm">
                                                    <li>ข้อมูลเจ้าหน้าที่ (Nurse Manager, RN, PN, WC)</li>
                                                    <li>ข้อมูลการเคลื่อนย้ายผู้ป่วย</li>
                                                    <li>ข้อมูลเตียง</li>
                                                    <li>Comments</li>
                                                    <li>ข้อมูลสรุป 24 ชั่วโมง</li>
                                                    <li>ลายเซ็นผู้ตรวจการและผู้บันทึก</li>
                                                </ul>
                                                <p class="mt-4 text-sm text-gray-600">*Patient Census และ Overall Data จะถูกคำนวณใหม่</p>
                                            </div>
                                        `,icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33",reverseButtons:!0})).isConfirmed&&(await d(i,n.shift),l(e=>{let t={};return Object.entries(e.wards).forEach(([e,a])=>{t[e]={numberOfPatients:a.numberOfPatients,overallData:a.overallData,nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",availableBeds:"0",unavailable:"0",plannedDischarge:"0",comment:""}}),{...e,date:i,wards:t}}),f({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:"",recorderFirstName:"",recorderLastName:""}),s(a),o((0,g.mI)(a)),t(!1),await u.YU.fire({title:"ล้างข้อมูลสำเร็จ",text:"ระบบได้ล้างข้อมูลและคงค่า Patient Census และ Overall Data ไว้",icon:"success",confirmButtonColor:"#0ab4ab"}))},onClickOutside:()=>t(!1),variant:"form"})})})]}),y=({isApprovalMode:e=!1})=>{let t=(0,n.useRouter)(),{user:a}=(0,x.A)(),[o,m]=(0,s.useState)(0),[f,b]=(0,s.useState)(!0),[N,y]=(0,s.useState)(!1),[C,D]=(0,s.useState)(!1),[S,O]=(0,s.useState)(new Date),[P,B]=(0,s.useState)([]),[R,k]=(0,s.useState)(""),[_,I]=(0,s.useState)(!1),[T,W]=(0,s.useState)({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:""}),[M,A]=(0,s.useState)({date:"",shift:"",wards:{Ward6:{...c},Ward7:{...c},Ward8:{...c},Ward9:{...c},WardGI:{...c},Ward10B:{...c},Ward11:{...c},Ward12:{...c},ICU:{...c},CCU:{...c},LR:{...c},NSY:{...c}},totals:{...c}}),[E,L]=(0,s.useState)(!1),[U,$]=(0,s.useState)(null),[H,Y]=(0,s.useState)({initialLoading:!0,savingData:!1,checkingDuplicates:!1,fetchingDates:!1}),[q,F]=(0,s.useState)(""),[G,z]=(0,s.useState)(!1),[V,K]=(0,s.useState)(!1),[J,Z]=(0,s.useState)({});(0,s.useEffect)(()=>{let e=()=>window.innerWidth<768,t=()=>{K(e())};return K(e()),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),(0,s.useEffect)(()=>{setTimeout(()=>{b(!1)},1e3)},[]);let X=async e=>{try{if(!e)return;let t=(0,g.Ol)(new Date(e)),a=(0,i.rJ)(l.db,"wardDailyRecords"),r={};for(let e of d){let s=(0,i.P)(a,(0,i._M)("date","==",t),(0,i._M)("wardId","==",e)),n=await (0,i.GG)(s);if(n.empty)r[e]=null;else{let t=n.docs[0].data();r[e]=t.approvalStatus||"pending"}}Z(r),console.log("Fetched approval statuses:",r)}catch(e){console.error("Error fetching approval statuses:",e)}};(0,s.useEffect)(()=>{console.log(`ShiftForm running in ${e?"approval":"normal"} mode`),e&&I(!0)},[e]);let[Q,ee]=(0,s.useState)(!1),[et,ea]=(0,s.useState)(!1),er=async e=>{try{let t=(0,i.rJ)(l.db,"staffRecords"),a=(0,i.P)(t,(0,i._M)("date","==",e)),r=await (0,i.GG)(a),s=new Set(r.docs.map(e=>e.data().shift));return{hasMorningShift:s.has("07:00-19:00"),hasNightShift:s.has("19:00-07:00")}}catch(e){return console.error("Error checking date shifts:",e),{hasMorningShift:!1,hasNightShift:!1}}},es=(0,s.useMemo)(()=>Object.values(M.wards).reduce((e,t)=>({numberOfPatients:e.numberOfPatients+(Number(t.numberOfPatients)||0),nurseManager:e.nurseManager+(Number(t.nurseManager)||0),RN:e.RN+(Number(t.RN)||0),PN:e.PN+(Number(t.PN)||0),WC:e.WC+(Number(t.WC)||0),newAdmit:e.newAdmit+(Number(t.newAdmit)||0),transferIn:e.transferIn+(Number(t.transferIn)||0),referIn:e.referIn+(Number(t.referIn)||0),transferOut:e.transferOut+(Number(t.transferOut)||0),referOut:e.referOut+(Number(t.referOut)||0),discharge:e.discharge+(Number(t.discharge)||0),dead:e.dead+(Number(t.dead)||0),overallData:e.overallData+(Number(t.overallData)||0),availableBeds:e.availableBeds+(Number(t.availableBeds)||0),unavailable:e.unavailable+(Number(t.unavailable)||0),plannedDischarge:e.plannedDischarge+(Number(t.plannedDischarge)||0)}),{numberOfPatients:0,nurseManager:0,RN:0,PN:0,WC:0,newAdmit:0,transferIn:0,referIn:0,transferOut:0,referOut:0,discharge:0,dead:0,overallData:0,availableBeds:0,unavailable:0,plannedDischarge:0}),[M.wards]);(0,s.useEffect)(()=>{A(e=>({...e,totals:es}))},[es]);let en=(0,s.useCallback)(()=>{if(!a||a.role?.toLowerCase()==="admin"||a.role?.toLowerCase()==="approver")return d;let e=a.department;return e&&d.includes(e)?[e]:d},[a]),el=(0,s.useMemo)(()=>en(),[en]),ei=(0,s.useCallback)((e,t,r)=>{if(a?.role?.toLowerCase()==="user"){console.log("View only mode: Changes are disabled");return}},[M,A,a]),eo=async e=>{if(e.preventDefault(),_){u.YU.fire({title:"โหมดดูข้อมูลเท่านั้น",text:"ข้อมูลอยู่ในโหมดดูอย่างเดียว ไม่สามารถบันทึกได้",icon:"info",confirmButtonColor:"#0ab4ab"});return}if(a?.role?.toLowerCase()==="user"){u.YU.fire({title:"โหมดดูข้อมูลเท่านั้น",text:"คุณไม่มีสิทธิ์บันทึกข้อมูล กรุณาติดต่อผู้ดูแลระบบ",icon:"info",confirmButtonColor:"#0ab4ab"});return}};(0,s.useCallback)(()=>{let e=new Date,t=new Date(S);return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},[S]);let ed=()=>{if(!M.date)return!1;let e=new Date(M.date),t=new Date;return t.setDate(t.getDate()+1),e.setHours(0,0,0,0),t.setHours(0,0,0,0),e>t};(0,s.useCallback)(()=>Object.values(M.wards).some(e=>Object.entries(e).some(([e,t])=>"comment"!==e&&""!==t&&"0"!==t)),[M.wards]);let ec=(0,s.useCallback)(()=>{let e={staff:!1,movement:!1,additional:!1};return Object.values(M.wards).forEach(t=>{("0"!==t.nurseManager||"0"!==t.RN||"0"!==t.PN||"0"!==t.WC)&&(e.staff=!0),("0"!==t.newAdmit||"0"!==t.transferIn||"0"!==t.referIn||"0"!==t.transferOut||"0"!==t.referOut||"0"!==t.discharge||"0"!==t.dead)&&(e.movement=!0),("0"!==t.availableBeds||"0"!==t.unavailable||"0"!==t.plannedDischarge||""!==t.comment.trim())&&(e.additional=!0)}),e},[M.wards]),eu=(0,s.useCallback)(()=>{let e=ec(M);return e.staff||e.movement||e.additional},[M]);(0,s.useEffect)(()=>{z(eu())},[M,eu]),(0,s.useEffect)(()=>{let e=e=>{G&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[G]),(0,s.useEffect)(()=>{let e=async()=>{if(G&&!(await u.YU.fire({title:"แจ้งเตือนการออกจากหน้าบันทึกข้อมูล",html:`
                        <div class="text-left">
                            <p class="font-semibold">ท่านกำลังดำเนินการบันทึกข้อมูลอยู่</p>
                            <div class="mt-4 space-y-2">
                                <p class="text-gray-600">การออกจากหน้านี้จะส่งผลให้:</p>
                                <ul class="list-disc pl-5 text-sm text-gray-600">
                                    <li>ข้อมูลที่กำลังบันทึกจะถูกรีเซ็ตทั้งหมด</li>
                                    <li>ท่านจะต้องเริ่มกรอกข้อมูลใหม่เมื่อกลับมาที่หน้านี้</li>
                                </ul>
                            </div>
                            <p class="mt-4 text-sm font-medium text-gray-700">โปรดยืนยันการดำเนินการ</p>
                        </div>
                    `,icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยันการออกจากหน้านี้",cancelButtonText:"ยกเลิกและกลับไปบันทึกข้อมูล",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",reverseButtons:!0})).isConfirmed)throw"Route Cancelled"};return t.events?.on("routeChangeStart",e),()=>{t.events?.off("routeChangeStart",e)}},[G,t]),(0,s.useCallback)(async()=>{console.log("Validating form data...",M);let e=new Date(new Date(M.date));e.setDate(e.getDate()-1);let t=e.toISOString().split("T")[0],r=await er(t);if(!r.hasNightShift&&r.hasMorningShift)return await u.YU.fire({title:"ไม่สามารถบันทึกข้อมูลได้",html:`วันที่ ${(0,g.mI)(e)} ยังไม่ได้บันทึกข้อมูลกะดึก<br>กรุณาบันทึกข้อมูลกะดึกของวันที่ ${(0,g.mI)(e)} ก่อน`,icon:"error",confirmButtonColor:"#0ab4ab"}),!1;for(let e of[{condition:!M.date||""===M.date.trim(),message:"กรุณาเลือกวันที่ก่อนดำเนินการต่อ"},{condition:!M.shift||""===M.shift.trim(),message:"กรุณาเลือกกะการทำงาน"},{condition:ed(),message:"ไม่สามารถบันทึกข้อมูลล่วงหน้าเกิน 1 วันได้"},{condition:"19:00-07:00"===M.shift&&!Q,message:"ไม่สามารถบันทึกข้อมูลกะดึกได้ เนื่องจากยังไม่มีการบันทึกข้อมูลกะเช้าก่อน"},{condition:a?.role?.toLowerCase()==="admin"&&(!T.supervisorFirstName?.trim()||!T.supervisorLastName?.trim()),message:"กรุณากรอกชื่อและนามสกุลผู้ตรวจการ"}])if(e.condition)return console.log("Validation failed:",e.message),e.message&&alert(e.message),!1;return!0},[M,T,ed,Q]);let em=()=>{u.YU.fire({title:"ล้างข้อมูล?",text:"คุณต้องการล้างข้อมูลทั้งหมดใช่หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#0ab4ab",cancelButtonColor:"#d33",confirmButtonText:"ใช่, ล้างข้อมูล",cancelButtonText:"ยกเลิก"}).then(e=>{e.isConfirmed&&(A(e=>{let t={};return Object.entries(e.wards).forEach(([e,a])=>{t[e]={...a,nurseManager:"0",RN:"0",PN:"0",WC:"0",newAdmit:"0",transferIn:"0",referIn:"0",transferOut:"0",referOut:"0",discharge:"0",dead:"0",availableBeds:"0",unavailable:"0",plannedDischarge:"0",comment:""}}),{...e,wards:t}}),W({opdTotal24hr:"",existingPatients:"",newPatients:"",admissions24hr:"",supervisorFirstName:"",supervisorLastName:""}),z(!1),u.YU.fire({title:"ล้างข้อมูลสำเร็จ",text:"กรุณาเลือกวันที่อีกครั้ง หรือตรวจสอบข้อมูลโดยรวมในหน้า Dashboard",icon:"success",confirmButtonColor:"#0ab4ab"}))})},ex=async(e,t)=>{try{let a=(0,i.rJ)(l.db,"staffRecords"),r=(0,i.P)(a,(0,i._M)("date","==",e),(0,i._M)("shift","==",t));if(!(await (0,i.GG)(r)).empty)return await u.YU.fire({title:"แจ้งเตือน",html:`มีข้อมูลของวันที่ ${(0,g.mI)(e)} กะ ${t} ในระบบแล้ว<br><br>หากต้องการแก้ไขข้อมูล กรุณาดำเนินการบันทึกข้อมูลใหม่`,icon:"info",confirmButtonColor:"#0ab4ab"}),!0;return!1}catch(e){return console.error("Error checking existing data:",e),!1}},ef=async(e=!1)=>{Y(e=>({...e,savingData:!0})),F("กำลังบันทึกข้อมูล...");try{let t=new Date().toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":",""),a=M.date.replace(/-/g,""),r=e&&U?U.id:`data_${t}_${a}`;console.log("Saving data with ID:",r);let s={date:M.date,shift:M.shift,wards:Object.fromEntries(Object.entries(M.wards).map(([e,t])=>[e,{numberOfPatients:t.numberOfPatients||"0",nurseManager:t.nurseManager||"0",RN:t.RN||"0",PN:t.PN||"0",WC:t.WC||"0",newAdmit:t.newAdmit||"0",transferIn:t.transferIn||"0",referIn:t.referIn||"0",transferOut:t.transferOut||"0",referOut:t.referOut||"0",discharge:t.discharge||"0",dead:t.dead||"0",overallData:t.overallData||"0",availableBeds:t.availableBeds||"0",plannedDischarge:t.plannedDischarge||"0",unavailable:t.unavailable||"0",comment:t.comment||""}])),summaryData:{opdTotal24hr:T.opdTotal24hr||"",existingPatients:T.existingPatients||"",newPatients:T.newPatients||"",admissions24hr:T.admissions24hr||"",supervisorFirstName:T.supervisorFirstName||"",supervisorLastName:T.supervisorLastName||""},timestamp:(0,i.O5)(),lastModified:(0,i.O5)()};console.log("Saving sanitized data:",s),await (0,i.BN)((0,i.H9)(l.db,"staffRecords",r),s);let n=Object.entries(M.wards).map(async([e,t])=>{if(Object.values(t).some(e=>"0"!==e&&""!==e)){let a=(0,i.H9)(l.db,"wardDailyRecords",`${M.date}_${e}`);try{await (0,i.BN)(a,{wardId:e,date:M.date,patientCensus:t.numberOfPatients||"0",overallData:t.overallData||"0",approvalStatus:"pending",lastUpdated:(0,i.O5)(),shifts:{[M.shift]:{nurseManager:t.nurseManager||"0",RN:t.RN||"0",PN:t.PN||"0",WC:t.WC||"0",newAdmit:t.newAdmit||"0",transferIn:t.transferIn||"0",referIn:t.referIn||"0",transferOut:t.transferOut||"0",referOut:t.referOut||"0",discharge:t.discharge||"0",dead:t.dead||"0",availableBeds:t.availableBeds||"0",unavailable:t.unavailable||"0",plannedDischarge:t.plannedDischarge||"0",comment:t.comment||""}}},{merge:!0})}catch(t){console.error(`Error saving wardDailyRecord for ${e}:`,t)}}});await Promise.all(n),await X(M.date),F("บันทึกข้อมูลสำเร็จ กำลังรีเซ็ตฟอร์ม..."),await new Promise(e=>setTimeout(e,1e3)),console.log("Data saved successfully"),em(),u.YU.fire({title:"บันทึกข้อมูลสำเร็จ",text:"ข้อมูลถูกบันทึกเรียบร้อยแล้ว",icon:"success",confirmButtonColor:"#0ab4ab"}).then(()=>{window.location.reload()})}catch(e){console.error("Error saving data:",e),u.YU.fire({title:"เกิดข้อผิดพลาด",text:e.message,icon:"error",confirmButtonColor:"#0ab4ab"})}finally{Y(e=>({...e,savingData:!1,checkingDuplicates:!1})),F(""),L(!1)}},ep=async()=>{try{let e=(0,i.rJ)(l.db,"staffRecords"),t=new Date(new Date().getFullYear(),0,1),a=new Date(new Date().getFullYear(),11,31),r=(0,i.P)(e,(0,i._M)("date",">=",(0,g.Ol)(t)),(0,i._M)("date","<=",(0,g.Ol)(a))),s=await (0,i.GG)(r),n={};s.docs.forEach(e=>{let t=e.data();n[t.date]||(n[t.date]=new Set),n[t.date].add(t.shift)});let o=Object.entries(n).map(([e,t])=>({date:e,shifts:Array.from(t),isComplete:2===t.size}));B(o)}catch(e){console.error("Error fetching dates with data:",e),B([])}};(0,s.useEffect)(()=>{ep()},[]),(0,s.useEffect)(()=>()=>{b(!1),y(!1),D(!1)},[]);let eb=async(e,t)=>{try{F("กำลังดึงข้อมูลจากระบบ");let a=(0,i.rJ)(l.db,"wardDailyRecords"),r=new Date(e),s="";"19:00-07:00"===t?(s="07:00-19:00",F(`กำลังดึงข้อมูลจากกะเช้า-บ่าย (${s})`)):(r.setDate(r.getDate()-1),s="19:00-07:00",F(`กำลังดึงข้อมูลจากกะดึกของวันก่อนหน้า (${s})`));let n=(0,g.Ol)(r),o=(0,g.mI)(r).replace("เพิ่มข้อมูล วันที่: ","");F(`กำลังดึงข้อมูล Overall Data
จากวันที่ ${o}
กะ ${s}`);let d=(0,i.P)(a,(0,i._M)("date","==",n)),c=await (0,i.GG)(d),u={...M.wards};if(c.empty){F("กำลังค้นหาข้อมูลล่าสุด...");let e=(0,i.P)(a,(0,i._M)("date","<=",n),(0,i.My)("date","desc"),(0,i.AB)(1)),t=await (0,i.GG)(e);if(t.empty)F("ไม่พบข้อมูลก่อนหน้า"),setTimeout(()=>F(""),2e3);else{let e=t.docs[0].data(),a=(0,g.mI)(new Date(e.date)).replace("เพิ่มข้อมูล วันที่: ","");F(`พบข้อมูลล่าสุดจาก
วันที่ ${a}`),Object.keys(M.wards).forEach(e=>{let t=c.docs.find(t=>t.data().wardId===e)?.data();t&&(u[e]={...M.wards[e],numberOfPatients:t.overallData||"0",overallData:t.overallData||"0"})}),A(e=>({...e,wards:u})),setTimeout(()=>F(""),2e3)}}else c.docs.forEach(e=>{let t=e.data(),a=t.wardId;t.shifts&&t.shifts[s]&&(t.shifts[s],u[a]={...M.wards[a],numberOfPatients:t.overallData||"0",overallData:t.overallData||"0"})}),A(e=>({...e,wards:u})),F(`ดึงข้อมูลสำเร็จ
จากวันที่ ${o}
กะ ${s}`),setTimeout(()=>F(""),2e3)}catch(e){console.error("Error fetching previous shift data:",e),F(`เกิดข้อผิดพลาด: ${e.message}`),setTimeout(()=>F(""),3e3)}},eh=(0,s.useCallback)(()=>{let e=Object.values(M.wards).some(e=>"0"!==e.nurseManager||"0"!==e.RN||"0"!==e.PN||"0"!==e.WC||"0"!==e.newAdmit||"0"!==e.transferIn||"0"!==e.referIn||"0"!==e.transferOut||"0"!==e.referOut||"0"!==e.discharge||"0"!==e.dead||"0"!==e.availableBeds||"0"!==e.unavailable||"0"!==e.plannedDischarge||""!==e.comment.trim()),t=""!==T.opdTotal24hr||""!==T.existingPatients||""!==T.newPatients||""!==T.admissions24hr||""!==T.supervisorFirstName||""!==T.supervisorLastName;return e||t},[M.wards,T]);(0,s.useEffect)(()=>{z(eh())},[M,T,eh]);let eg=async()=>{G?(await u.YU.fire({title:"แจ้งเตือนการเปลี่ยนหน้า",html:`
                    <div class="text-left">
                        <p class="font-semibold text-red-600">ข้อควรระวัง: พบข้อมูลที่ยังไม่ได้บันทึก</p>
                        <div class="mt-4 space-y-2">
                            <p class="text-gray-700">การเปลี่ยนไปยังหน้า Dashboard จะส่งผลดังนี้:</p>
                            <ul className="list-disc pl-5 space-y-1">
                                <li class="text-gray-600">ข้อมูลที่ท่านกรอกจะไม่ถูกบันทึก</li>
                                <li class="text-gray-600">ข้อมูลทั้งหมดในแบบฟอร์มจะถูกรีเซ็ต</li>
                                <li class="text-gray-600">ท่านจะต้องเริ่มกรอกข้อมูลใหม่เมื่อกลับมายังหน้านี้</li>
                            </ul>
                            <div className="mt-4 p-2 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <p className="text-sm text-yellow-700">
                                    <span class="font-medium">คำแนะนำ:</span> กรุณาบันทึกข้อมูลให้เรียบร้อยก่อนออกจากหน้านี้
                                </p>
                                        </div>
                                        </div>
                                    </div>
                `,icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยันการเปลี่ยนหน้า",cancelButtonText:"ยกเลิกและกลับไปบันทึกข้อมูล",confirmButtonColor:"#d33",cancelButtonColor:"#0ab4ab",reverseButtons:!0})).isConfirmed&&t.push("/dashboard"):t.push("/dashboard")};return(0,r.jsxs)("div",{className:"w-full px-2 py-2",children:[V&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-[#0ab4ab]/95 to-blue-600/95 backdrop-blur-md flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl text-center space-y-4",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Logo",className:"w-24 h-24 mx-auto mb-4 animate-pulse"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-[#0ab4ab]",children:"แจ้งเตือนการใช้งาน"}),(0,r.jsxs)("div",{className:"space-y-3 text-gray-600",children:[(0,r.jsx)("p",{className:"font-medium",children:"ระบบอยู่ระหว่างการพัฒนาสำหรับอุปกรณ์มือถือ"}),(0,r.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-xl",children:[(0,r.jsx)("p",{className:"text-sm",children:"เพื่อประสิทธิภาพในการใช้งานสูงสุด กรุณาใช้งานผ่าน:"}),(0,r.jsxs)("ul",{className:"text-sm mt-2 space-y-1",children:[(0,r.jsx)("li",{children:"• คอมพิวเตอร์ตั้งโต๊ะ (Desktop)"}),(0,r.jsx)("li",{children:"• คอมพิวเตอร์พกพา (Laptop)"})]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"หากมีข้อสงสัยกรุณาติดต่อผู้ดูแลระบบ"})]})]})}),(0,r.jsxs)("form",{onSubmit:eo,className:"w-full mx-auto",children:[f&&(0,r.jsx)("div",{className:"fixed inset-0 bg-white flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("img",{src:"/images/BPK.jpg",alt:"BPK Loading",className:"w-32 h-32 mx-auto mb-4 animate-pulse"}),(0,r.jsx)("p",{className:"text-gray-600",children:"กำลังโหลด..."})]})}),(0,r.jsx)(h,{showDataComparison:E,existingData:U,formData:M,summaryData:T,setShowDataComparison:L,saveData:ef,WARD_ORDER:d}),(0,r.jsx)(j,{showCalendar:C,setShowCalendar:D,selectedDate:S,setSelectedDate:O,formData:M,setFormData:A,thaiDate:R,setThaiDate:k,fetchPreviousShiftData:eb,handleShiftChange:e=>{A(t=>({...t,shift:e}))},datesWithData:P,checkExistingData:ex,setSummaryData:W}),(0,r.jsx)("div",{className:"hidden md:block w-full",children:(0,r.jsxs)("div",{className:"w-full mx-auto p-4 bg-white rounded-xl shadow-lg border border-gray-200",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-pink-400/20 to-white p-2 rounded-lg",children:(0,r.jsx)("h2",{className:"text-lg font-bold text-pink-600 text-center mb-1",children:"Form"})}),(0,r.jsx)(p,{WARD_ORDER:el,formData:M,handleInputChange:ei,displayValue:e=>null==e||""===e?"0":e,approvalStatuses:J,selectedDate:S,readOnly:a?.role?.toLowerCase()==="user"})]})}),(0,r.jsx)("div",{className:"hidden md:block mt-8",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-[#0ab4ab]/10 to-white rounded-xl shadow-lg p-6",children:a?.role?.toLowerCase()==="admin"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w,{summaryData:T,setSummaryData:W}),(0,r.jsx)(v,{summaryData:T,setSummaryData:W})]})})}),(0,r.jsx)("div",{className:"mt-8 flex justify-center p-6 bg-gradient-to-r from-[#0ab4ab]/10 to-white rounded-xl shadow-lg",children:a?.role?.toLowerCase()==="user"?(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center border border-gray-200",children:[(0,r.jsx)("div",{className:"text-gray-700 font-medium mb-2",children:"โหมดดูข้อมูลเท่านั้น"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"คุณสามารถดูข้อมูลได้ แต่ไม่สามารถแก้ไขหรือบันทึกข้อมูลได้"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"ข้อมูลที่แสดงเฉพาะ ward ของคุณเท่านั้น"})]}):(0,r.jsx)("button",{type:"submit",disabled:N||_,className:"px-12 py-4 bg-gradient-to-r from-[#0ab4ab] to-blue-400 text-white text-lg font-bold rounded-xl shadow-lg hover:from-[#0ab4ab] hover:to-blue-500 transition-all transform hover:scale-105 disabled:from-gray-400 disabled:to-gray-500 font-THSarabun",children:N?"Saving...":_?"View Only Mode":"Save Data"})}),(0,r.jsx)("button",{onClick:eg,className:"px-4 py-2 rounded-lg text-white hover:bg-[#0ab4ab]/80",children:"Dashboard"})]})]})};function C(){let{user:e}=(0,x.A)();(0,n.useRouter)();let[t,a]=(0,s.useState)(!0),l=e?.role?.toLowerCase()==="approver"||e?.role?.toLowerCase()==="admin";return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"bg-yellow-50 p-4 mb-6 rounded-lg border border-yellow-200",children:[(0,r.jsx)("h2",{className:"font-medium text-yellow-700 mb-2",children:l?"หน้าสำหรับการอนุมัติข้อมูล":"หน้าแสดงสถานะการอนุมัติข้อมูล"}),(0,r.jsx)("p",{className:"text-sm text-yellow-600",children:l?"คุณสามารถตรวจสอบและอนุมัติข้อมูลได้ในหน้านี้ ข้อมูลที่อนุมัติแล้วจะไม่สามารถแก้ไขได้อีก":"คุณสามารถดูสถานะการอนุมัติข้อมูลของแผนกคุณได้ในหน้านี้ แต่ไม่สามารถอนุมัติข้อมูลได้"})]}),(0,r.jsx)(y,{isApprovalMode:!0})]})}var D=a(9946);function S(){return(0,r.jsx)(D.A,{title:"อนุมัติข้อมูล",requiredRole:"user",children:(0,r.jsx)(C,{})})}},4631:e=>{"use strict";e.exports=require("tls")},4735:e=>{"use strict";e.exports=require("events")},4985:e=>{"use strict";e.exports=require("dns")},5511:e=>{"use strict";e.exports=require("crypto")},6237:(e,t,a)=>{Promise.resolve().then(a.bind(a,4471))},7317:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\B_SIR\\\\OneDrive\\\\เดสก์ท็อป\\\\Summary_of_Personnel_Ratio\\\\Summary_of_Personnel_Ratio\\\\app\\\\page\\\\approval\\\\page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\B_SIR\\OneDrive\\เดสก์ท็อป\\Summary_of_Personnel_Ratio\\Summary_of_Personnel_Ratio\\app\\page\\approval\\page.js","default")},7677:(e,t,a)=>{Promise.resolve().then(a.bind(a,7317))},7910:e=>{"use strict";e.exports=require("stream")},8354:e=>{"use strict";e.exports=require("util")},9021:e=>{"use strict";e.exports=require("fs")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")},9771:e=>{"use strict";e.exports=require("process")},9863:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[719,200,474,855,732,383],()=>a(1900));module.exports=r})();