(()=>{var e={};e.id=0,e.ids=[0],e.modules={378:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>c,pages:()=>u,routeModule:()=>m,tree:()=>d});var a=t(5239),s=t(8088),n=t(8170),i=t.n(n),o=t(893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(r,l);let d={children:["",{children:["page",{children:["ward-form",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,4283)),"C:\\Users\\B_SIR\\OneDrive\\เดสก์ท็อป\\Summary_of_Personnel_Ratio\\Summary_of_Personnel_Ratio\\app\\page\\ward-form\\page.js"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,2648)),"C:\\Users\\B_SIR\\OneDrive\\เดสก์ท็อป\\Summary_of_Personnel_Ratio\\Summary_of_Personnel_Ratio\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,5284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,u=["C:\\Users\\B_SIR\\OneDrive\\เดสก์ท็อป\\Summary_of_Personnel_Ratio\\Summary_of_Personnel_Ratio\\app\\page\\ward-form\\page.js"],c={require:t,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/page/ward-form/page",pathname:"/page/ward-form",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},1645:e=>{"use strict";e.exports=require("net")},1820:e=>{"use strict";e.exports=require("os")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3496:e=>{"use strict";e.exports=require("http2")},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4188:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var a=t(687),s=t(9245),n=t(5550);let i=({selectedDate:e,onDateSelect:r,datesWithData:t=[],showCalendar:i,setShowCalendar:o,thaiDate:l,variant:d="form"})=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"bg-white/60 backdrop-blur-sm rounded-xl p-3 shadow-sm hover:shadow-md transition-all",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>o(!i),className:"w-full md:w-auto px-4 py-2 bg-gradient-to-r from-[#0ab4ab] to-blue-500 text-white rounded-lg hover:from-[#0ab4ab]/90 hover:to-blue-600 transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[#0ab4ab] focus:ring-opacity-50 shadow-md text-sm",children:i?"ซ่อนปฏิทิน":"เลือกวันที่"}),(0,a.jsxs)("div",{className:"text-gray-700 space-y-0.5 text-center md:text-left text-sm",children:[(0,a.jsxs)("div",{className:"font-medium text-[#0ab4ab]",children:["วันที่ปัจจุบัน : ",(0,s.mI)(new Date)]}),(0,a.jsxs)("div",{className:"text-blue-600",children:["วันที่เลือก : ",l]})]})]})}),i&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:(0,a.jsx)("div",{className:"relative bg-white rounded-2xl shadow-2xl transform transition-all",children:(0,a.jsx)(n.A,{selectedDate:e,onDateSelect:r,onClickOutside:()=>o(!1),datesWithData:t,variant:d})})})]})},4283:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});let a=(0,t(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\B_SIR\\\\OneDrive\\\\เดสก์ท็อป\\\\Summary_of_Personnel_Ratio\\\\Summary_of_Personnel_Ratio\\\\app\\\\page\\\\ward-form\\\\page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\B_SIR\\OneDrive\\เดสก์ท็อป\\Summary_of_Personnel_Ratio\\Summary_of_Personnel_Ratio\\app\\page\\ward-form\\page.js","default")},4448:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>O});var a=t(687),s=t(3210),n=t(9141),i=t(5535),o=t(6006),l=t(8972),d=t(9245);let u=()=>{let e=new Date().getHours();return e>=7&&e<19?"07:00-19:00":"19:00-07:00"};t(5550),t(4188),t(9259);var c=t(4623),m=t(4868);let p=async e=>{try{if(!e)return console.warn("fetchDatesWithData: selectedWard is undefined or null"),[];let r=(0,i.P)((0,i.rJ)(n.db,"wardDailyRecords"),(0,i._M)("wardId","==",e)),t=await (0,i.GG)(r),a=[];return t.forEach(e=>{let r=e.data();if(r.date){let e=new Date(r.date);isNaN(e.getTime())||a.push(e)}}),a}catch(e){return console.error("Error fetching dates with data:",e),[]}},f=async(e,r,t=null)=>{try{let a;if(!r)return console.warn("fetchApprovalData: targetWard is undefined or null"),null;let s=(0,d.Ol)(new Date(e));a=t?(0,i.P)((0,i.rJ)(n.db,"wardDailyRecords"),(0,i._M)("wardId","==",r),(0,i._M)("date","==",s),(0,i._M)("shift","==",t)):(0,i.P)((0,i.rJ)(n.db,"wardDailyRecords"),(0,i._M)("wardId","==",r),(0,i._M)("date","==",s));let o=await (0,i.GG)(a);if(o.empty)return null;if(t){if(!o.empty){let e=o.docs[0],r=e.data();return{id:e.id,recorded:!0,approved:r.isApproved||!1,approvedBy:r.approvedBy,approvedAt:r.approvedAt,isDraft:r.isDraft||!1}}return null}let l={};return o.forEach(e=>{let r=e.data();l[r.shift]={id:e.id,recorded:!0,approved:r.isApproved||!1,approvedBy:r.approvedBy,approvedAt:r.approvedAt,isDraft:r.isDraft||!1}}),l}catch(e){return console.error("Error fetching approval data:",e),null}},g=async(e,r,t=null)=>{try{let a=await f(e,r,t);if(!a)return{status:"not_recorded",message:"ยังไม่มีการบันทึกข้อมูล"};if(t){if(a.isDraft)return{status:"draft",message:"อยู่ในสถานะฉบับร่าง"};if(a.approved)return{status:"approved",message:"ได้รับการอนุมัติแล้ว",approvedBy:a.approvedBy,approvedAt:a.approvedAt};return{status:"pending_approval",message:"รอการอนุมัติ"}}let s={};return["เช้า","ดึก"].forEach(e=>{a[e]?a[e].isDraft?s[e]={status:"draft",message:"อยู่ในสถานะฉบับร่าง"}:a[e].approved?s[e]={status:"approved",message:"ได้รับการอนุมัติแล้ว",approvedBy:a[e].approvedBy,approvedAt:a[e].approvedAt}:s[e]={status:"pending_approval",message:"รอการอนุมัติ"}:s[e]={status:"not_recorded",message:"ยังไม่มีการบันทึกข้อมูล"}}),s}catch(e){return console.error("Error checking approval status:",e),{status:"error",message:"เกิดข้อผิดพลาดในการตรวจสอบสถานะ"}}},h=async(e,r,t)=>{if(!e)return console.error("fetchWardData: date is required but got:",e),null;if(!r||""===r.trim())return console.error("fetchWardData: selectedWard is required but got:",r),null;if(!t||""===t.trim())return console.error("fetchWardData: selectedShift is required but got:",t),null;try{let a=(0,d.Ol)(new Date(e));console.log("Fetching ward data with query params:",{wardId:r,date:a,shift:t});let s=(0,i.P)((0,i.rJ)(n.db,"wardDailyRecords"),(0,i._M)("wardId","==",r),(0,i._M)("date","==",a),(0,i._M)("shift","==",t)),o=await (0,i.GG)(s);if(!o.empty){let e=o.docs[0],r=e.data();return{id:e.id,...r}}return null}catch(e){return console.error("Error fetching ward data:",e),null}},x=e=>{if(""===e||null==e)return"0";let r=parseInt(e,10);return isNaN(r)?"0":r.toString()},b=e=>{if(!e)return"0";let r=0,t=parseInt(e.patientCensus||"0",10),a=parseInt(e.newAdmit||"0",10),s=parseInt(e.transferIn||"0",10),n=parseInt(e.referIn||"0",10),i=parseInt(e.transferOut||"0",10),o=parseInt(e.referOut||"0",10),l=parseInt(e.discharge||"0",10),d=parseInt(e.dead||"0",10);return isNaN(t)||(r+=t),isNaN(a),isNaN(s),isNaN(n),isNaN(i),isNaN(o),isNaN(l),isNaN(d),r.toString()},v=async(e,r,t,a,s,o,l="final")=>{e&&e.preventDefault();try{let e=(0,d.Ol)(new Date(a)),u=b(r);if(!r.firstName||!r.lastName)return{success:!1,error:"กรุณากรอกชื่อและนามสกุลผู้บันทึกข้อมูล"};let c={wardId:t,date:e,shift:s,patientCensus:r.patientCensus||"0",overallData:r.overallData||"0",nurseManager:r.nurseManager||"0",RN:r.RN||"0",PN:r.PN||"0",WC:r.WC||"0",rns:r.rns||"0",pns:r.pns||"0",nas:r.nas||"0",aides:r.aides||"0",studentNurses:r.studentNurses||"0",newAdmit:r.newAdmit||"0",transferIn:r.transferIn||"0",referIn:r.referIn||"0",transferOut:r.transferOut||"0",referOut:r.referOut||"0",discharge:r.discharge||"0",dead:r.dead||"0",admissions:r.admissions||"0",discharges:r.discharges||"0",transfers:r.transfers||"0",deaths:r.deaths||"0",availableBeds:r.availableBeds||"0",unavailable:r.unavailable||"0",plannedDischarge:r.plannedDischarge||"0",notes:r.notes||"",comment:r.comment||"",firstName:r.firstName,lastName:r.lastName,createdBy:o?.displayName||"Unknown",createdById:o?.uid||"Unknown",department:o?.department||"Unknown",timestamp:(0,i.O5)(),total:u,isDraft:"draft"===l,isApproved:!1,approvedBy:null,approvedAt:null,lastUpdatedAt:(0,i.O5)(),lastUpdatedBy:o?.displayName||"Unknown",lastUpdatedById:o?.uid||"Unknown"};if(r.id){let e=(0,i.H9)(n.db,"wardDailyRecords",r.id);if("final"===l){let r=await (0,i.x7)(e);if(r.exists()&&!r.data().isDraft&&r.data().isApproved)return{success:!1,error:"ไม่สามารถแก้ไขข้อมูลได้เนื่องจากมีการอนุมัติข้อมูลแล้ว"}}return await (0,i.mZ)(e,c),{success:!0,operation:"update",id:r.id}}{let e=await (0,i.gS)((0,i.rJ)(n.db,"wardDailyRecords"),c);return{success:!0,operation:"create",id:e.id}}}catch(e){return console.error("Error saving data:",e),{success:!1,error:e.message}}},y=(e,r,t,a)=>{let{name:s,value:n}=e.target,i="notes"!==s?x(n):n;t(e=>({...e,[s]:i})),a(!0)},w=({formData:e,setFormData:r,setHasUnsavedChanges:t})=>(0,a.jsxs)("div",{className:"mb-6 p-4 bg-primary-pastel rounded-lg shadow-md",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-primary",children:"จำนวนผู้ป่วย"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"จำนวนผู้ป่วยทั้งหมด"}),(0,a.jsx)("input",{type:"number",name:"patientCensus",value:e.patientCensus,onChange:a=>y(a,e,r,t),className:"w-full p-2 bg-white border border-primary-light rounded focus:ring-2 focus:ring-primary focus:border-transparent"})]})})]}),N=({formData:e,setFormData:r,setHasUnsavedChanges:t})=>(0,a.jsxs)("div",{className:"mb-6 p-4 bg-info-pastel rounded-lg shadow-md",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-primary",children:"การเคลื่อนไหวของผู้ป่วย"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"รับใหม่"}),(0,a.jsx)("input",{type:"number",name:"admissions",value:e.admissions,onChange:a=>y(a,e,r,t),className:"w-full p-2 bg-white border border-info-light rounded focus:ring-2 focus:ring-info focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"จำหน่าย"}),(0,a.jsx)("input",{type:"number",name:"discharges",value:e.discharges,onChange:a=>y(a,e,r,t),className:"w-full p-2 bg-white border border-info-light rounded focus:ring-2 focus:ring-info focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ย้ายแผนก"}),(0,a.jsx)("input",{type:"number",name:"transfers",value:e.transfers,onChange:a=>y(a,e,r,t),className:"w-full p-2 bg-white border border-info-light rounded focus:ring-2 focus:ring-info focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"เสียชีวิต"}),(0,a.jsx)("input",{type:"number",name:"deaths",value:e.deaths,onChange:a=>y(a,e,r,t),className:"w-full p-2 bg-white border border-info-light rounded focus:ring-2 focus:ring-info focus:border-transparent"})]})]})]}),j=({formData:e,setFormData:r,setHasUnsavedChanges:t})=>(0,a.jsxs)("div",{className:"mb-6 p-4 bg-white rounded-lg shadow",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-primary",children:"จำนวนบุคลากร"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RN"}),(0,a.jsx)("input",{type:"number",name:"rns",value:e.rns,onChange:a=>y(a,e,r,t),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PN"}),(0,a.jsx)("input",{type:"number",name:"pns",value:e.pns,onChange:a=>y(a,e,r,t),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NA"}),(0,a.jsx)("input",{type:"number",name:"nas",value:e.nas,onChange:a=>y(a,e,r,t),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ผู้ช่วย"}),(0,a.jsx)("input",{type:"number",name:"aides",value:e.aides,onChange:a=>y(a,e,r,t),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"นักศึกษาพยาบาล"}),(0,a.jsx)("input",{type:"number",name:"studentNurses",value:e.studentNurses,onChange:a=>y(a,e,r,t),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent"})]})]})]}),D=({formData:e,setFormData:r,setHasUnsavedChanges:t})=>(0,a.jsxs)("div",{className:"mb-6 p-4 bg-white rounded-lg shadow",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-primary",children:"บันทึกเพิ่มเติม"}),(0,a.jsx)("div",{children:(0,a.jsx)("textarea",{name:"notes",value:e.notes,onChange:a=>y(a,e,r,t),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent",rows:"3",placeholder:"บันทึกเพิ่มเติม..."})})]}),I=async(e,r,t)=>{if(!e||!r||"string"!=typeof r||""===r.trim()||!t)return console.error("safeFetchWardData: Invalid parameters",{date:e,ward:r,shift:t}),null;try{return await h(e,r,t)}catch(e){return console.error("Error in safeFetchWardData:",e),null}},C=({shift:e})=>"เช้า"===e?(0,a.jsxs)("div",{className:"text-sm text-gray-600 mt-1 mb-2 bg-gray-100 p-2 rounded",children:[(0,a.jsx)("p",{children:"สูตรคำนวณกะเช้า: ข้อมูล Overall Data จากวันก่อนหน้า (จากกะดึก) เป็นค่า Patient Census"}),(0,a.jsx)("p",{children:"หมายเหตุ: หากไม่มีข้อมูลวันก่อนหน้า ให้กรอกข้อมูลด้วยตนเอง"})]}):"ดึก"===e?(0,a.jsxs)("div",{className:"text-sm text-gray-600 mt-1 mb-2 bg-gray-100 p-2 rounded",children:[(0,a.jsx)("p",{children:"สูตรคำนวณกะดึก: newAdmit + transferIn + referIn - transferOut + referOut + discharge + dead = Overall Data"}),(0,a.jsx)("p",{children:"หมายเหตุ: Overall Data จะถูกใช้เป็น Patient Census ในวันถัดไป (กะเช้า)"})]}):null,_=e=>{let r=parseInt(e.newAdmit)||0,t=parseInt(e.transferIn)||0,a=parseInt(e.referIn)||0,s=parseInt(e.transferOut)||0,n=parseInt(e.referOut)||0;return r+t+a-s+n+(parseInt(e.discharge)||0)+(parseInt(e.dead)||0)},S=({wardId:e})=>{let{user:r}=(0,c.A)(),{theme:t}=(0,m.D)(),[n,i]=(0,s.useState)(!0),o=(0,s.useMemo)(()=>e&&""!==e.trim()?e:r?.department&&""!==r.department.trim()?r.department:"",[e,r]),[f,h]=(0,s.useState)(o),[x,b]=(0,s.useState)(new Date),[S,A]=(0,s.useState)(u()),[O,P]=(0,s.useState)((0,d.Lg)()),[k,R]=(0,s.useState)(!1),[B,q]=(0,s.useState)([]),[U,E]=(0,s.useState)(null),[M,W]=(0,s.useState)(!1),[G,Y]=(0,s.useState)(null),[z,J]=(0,s.useState)(null),[F,Z]=(0,s.useState)(!1),[H,T]=(0,s.useState)({patientCensus:"",overallData:"",newAdmit:"",transferIn:"",referIn:"",transferOut:"",referOut:"",discharge:"",dead:"",rns:"",pns:"",nas:"",aides:"",studentNurses:"",notes:"",firstName:r?.firstName||"",lastName:r?.lastName||"",isDraft:!1}),[V,K]=(0,s.useState)(null),[L,X]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{if(f)try{let e=await checkPast30DaysRecords(f);X(e),e.noRecentRecords&&l.YU.fire({title:"เริ่มบันทึกใหม่",text:e.message,icon:"info",confirmButtonColor:"#0ab4ab"})}catch(e){console.error("Error checking past 30 days records:",e)}})()},[f]);let $=async()=>{try{if(!x||!f)return null;let e=new Date(x);e.setDate(e.getDate()-1);let r=(0,d.Ol)(e),t=await g(r,f,"ดึก");if("approved"===t.status){let e=await I(r,f,"ดึก");if(e)return K(e),e.overallData||"0"}else if(L?.noRecentRecords)return"0";return"ยังไม่มีข้อมูลจากวันที่ผ่านมา"}catch(e){return console.error("Error fetching previous day data:",e),"เกิดข้อผิดพลาดในการดึงข้อมูล"}};(0,s.useEffect)(()=>{let e=!1;(async()=>{if(!e){e=!0;try{let e=""!==H.newAdmit||""!==H.transferIn||""!==H.referIn||""!==H.transferOut||""!==H.referOut||""!==H.discharge||""!==H.dead;if("เช้า"===S){if(!H.patientCensus||"ยังไม่มีข้อมูลจากวันที่ผ่านมา"===H.patientCensus){let e=await $();T(r=>({...r,patientCensus:e}))}if(e){let e=_(H);T(r=>({...r,overallData:e.toString()}))}else T(e=>({...e,overallData:"รอผลข้อมูลวันนี้"}))}else if("ดึก"===S){if(e){let e=_(H);T(r=>({...r,overallData:e.toString()}))}else T(e=>({...e,overallData:"รอผลข้อมูลวันนี้"}))}}finally{e=!1}}})()},[H.newAdmit,H.transferIn,H.referIn,H.transferOut,H.referOut,H.discharge,H.dead,S,x,f]);let Q=e=>{let r=e.target,t=r.value;/^[ก-๙a-zA-Z\s]*$/.test(t)?r.setCustomValidity(""):r.setCustomValidity("กรุณากรอกเฉพาะตัวอักษรเท่านั้น")},ee=e=>{y(e,H,T,W)},er=async e=>{if(e&&e.preventDefault(),!x||!S){l.YU.fire({title:"ไม่สามารถบันทึกได้",text:"กรุณาเลือกวันที่และกะก่อนบันทึกข้อมูล",icon:"warning",confirmButtonColor:"#0ab4ab"});return}if(!H.firstName||!H.lastName){l.YU.fire({title:"ไม่สามารถบันทึกได้",text:"กรุณากรอกชื่อ-นามสกุลผู้บันทึกข้อมูล",icon:"warning",confirmButtonColor:"#0ab4ab"});return}try{setIsSubmitting(!0);let e={...H};"เช้า"===S?(e.patientCensus&&"ยังไม่มีข้อมูลจากวันที่ผ่านมา"!==e.patientCensus||(e.patientCensus=await $()),(e.newAdmit||e.transferIn||e.referIn||e.transferOut||e.referOut||e.discharge||e.dead)&&(e.overallData=_(e).toString())):"ดึก"===S&&(e.newAdmit||e.transferIn||e.referIn||e.transferOut||e.referOut||e.discharge||e.dead)&&(e.overallData=_(e).toString()),e.isDraft=!0,await v(x,f,S,e,r,!0)&&(T(e),Z(!0),W(!1),l.YU.fire({title:"บันทึกสำเร็จ",text:"บันทึกข้อมูลเป็นฉบับร่างเรียบร้อยแล้ว",icon:"success",confirmButtonColor:"#0ab4ab"}))}catch(e){console.error("Error saving draft:",e),l.YU.fire({title:"Error",text:"เกิดข้อผิดพลาดในการบันทึกข้อมูล",icon:"error",confirmButtonColor:"#0ab4ab"})}finally{setIsSubmitting(!1)}},et=async e=>{if(e&&e.preventDefault(),!x||!S){l.YU.fire({title:"ไม่สามารถบันทึกได้",text:"กรุณาเลือกวันที่และกะก่อนบันทึกข้อมูล",icon:"warning",confirmButtonColor:"#0ab4ab"});return}if(!H.firstName||!H.lastName){l.YU.fire({title:"ไม่สามารถบันทึกได้",text:"กรุณากรอกชื่อ-นามสกุลผู้บันทึกข้อมูล",icon:"warning",confirmButtonColor:"#0ab4ab"});return}if(!(H.patientCensus||H.overallData||H.newAdmit||H.transferIn||H.referIn||H.transferOut||H.referOut||H.discharge||H.dead||H.rns||H.pns||H.nas||H.aides||H.studentNurses)){l.YU.fire({title:"ไม่สามารถบันทึกได้",text:"กรุณากรอกข้อมูลอย่างน้อย 1 ฟิลด์",icon:"warning",confirmButtonColor:"#0ab4ab"});return}try{setIsSubmitting(!0);let e={...H};"เช้า"===S?(e.patientCensus&&"ยังไม่มีข้อมูลจากวันที่ผ่านมา"!==e.patientCensus||(e.patientCensus=await $()),(e.newAdmit||e.transferIn||e.referIn||e.transferOut||e.referOut||e.discharge||e.dead)&&(e.overallData=_(e).toString())):"ดึก"===S&&(e.newAdmit||e.transferIn||e.referIn||e.transferOut||e.referOut||e.discharge||e.dead)&&(e.overallData=_(e).toString()),e.isDraft=!1,await v(x,f,S,e,r,!1)&&(T(e),Z(!1),W(!1),l.YU.fire({title:"บันทึกสำเร็จ",text:"บันทึกข้อมูลเรียบร้อยแล้ว ข้อมูลจะถูกส่งไปยังหน้าอนุมัติ",icon:"success",confirmButtonColor:"#0ab4ab"}).then(()=>{p(f),g(x,f).then(e=>{Y(e)})}))}catch(e){console.error("Error submitting form:",e),l.YU.fire({title:"Error",text:"เกิดข้อผิดพลาดในการบันทึกข้อมูล",icon:"error",confirmButtonColor:"#0ab4ab"})}finally{setIsSubmitting(!1)}};return(0,a.jsxs)("div",{className:"p-4 max-w-6xl mx-auto",children:[L?.noRecentRecords&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-green-100 text-green-800 rounded-md",children:[(0,a.jsx)("p",{className:"font-semibold",children:"ข้อมูลย้อนหลัง 30 วัน:"}),(0,a.jsx)("p",{children:L.message})]}),(0,a.jsx)(C,{shift:S}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)(w,{formData:H,onInputChange:ee}),(0,a.jsx)(N,{formData:H,onInputChange:ee}),(0,a.jsx)(j,{formData:H,onInputChange:ee}),(0,a.jsx)(D,{formData:H,setFormData:T,setHasUnsavedChanges:W}),(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-4 mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ผู้บันทึกข้อมูล"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsxs)("label",{className:"block text-gray-700 mb-1",children:["ชื่อ ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",name:"firstName",value:H.firstName,onChange:ee,onInput:Q,className:"border rounded p-2 w-full",pattern:"[ก-๙a-zA-Z\\s]*",title:"กรุณากรอกเฉพาะตัวอักษรเท่านั้น",required:!0})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsxs)("label",{className:"block text-gray-700 mb-1",children:["นามสกุล ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",name:"lastName",value:H.lastName,onChange:ee,onInput:Q,className:"border rounded p-2 w-full",pattern:"[ก-๙a-zA-Z\\s]*",title:"กรุณากรอกเฉพาะตัวอักษรเท่านั้น",required:!0})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,a.jsx)("button",{onClick:er,disabled:isSubmitting,className:"bg-gray-500 text-white py-2 px-4 rounded hover:bg-gray-600 transition-colors",children:isSubmitting?"กำลังบันทึก...":"บันทึกฉบับร่าง"}),(0,a.jsx)("button",{onClick:et,disabled:isSubmitting,className:"bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors",children:isSubmitting?"กำลังบันทึก...":"บันทึกข้อมูล"})]})]})]})};var A=t(9946);function O(){let{user:e,loading:r}=(0,c.A)(),[t,n]=(0,s.useState)(null),[i,l]=(0,s.useState)(!1);return(0,a.jsx)(A.A,{title:"แบบฟอร์มบันทึกข้อมูล Ward",children:i?(0,a.jsx)(S,{wardId:t}):(0,a.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,a.jsx)(o.A,{})})})}},4631:e=>{"use strict";e.exports=require("tls")},4735:e=>{"use strict";e.exports=require("events")},4985:e=>{"use strict";e.exports=require("dns")},5511:e=>{"use strict";e.exports=require("crypto")},6011:(e,r,t)=>{Promise.resolve().then(t.bind(t,4283))},6627:(e,r,t)=>{Promise.resolve().then(t.bind(t,4448))},7910:e=>{"use strict";e.exports=require("stream")},8354:e=>{"use strict";e.exports=require("util")},9021:e=>{"use strict";e.exports=require("fs")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9259:(e,r,t)=>{"use strict";t(687)},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")},9771:e=>{"use strict";e.exports=require("process")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[719,200,474,855,732,383],()=>t(378));module.exports=a})();