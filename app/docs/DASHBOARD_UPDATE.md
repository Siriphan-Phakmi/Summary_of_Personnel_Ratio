# การปรับปรุงหน้า Dashboard เพิ่มเติม (วันที่ 16 พฤษภาคม 2567)

## ประเด็นที่ปรับปรุง

1. **ปรับปรุงการแสดงผล Dark Mode และ Light Mode**:
   - การแสดงผลบางส่วนในหน้า Dashboard ไม่ปรับเปลี่ยนสีตาม Dark/Light Mode
   - มีปุ่มเปลี่ยน Dark Mode/Light Mode ซ้ำซ้อนกันปรากฏทั้งในหน้า Dashboard และในส่วนล่างของหน้าจอ

2. **ข้อมูลกราฟแท่งและกราฟวงกลม**:
   - บางแผนก/Ward ไม่แสดงในกราฟ (จากทั้งหมด 12 หน่วย: CCU, ICU, LR, NSY, Ward10B, Ward11, Ward12, Ward6, Ward7, Ward8, Ward9, WardGI)
   - กราฟวงกลมแสดงเลขทศนิยมที่มีความยาวเกินไปและไม่จำเป็น
   - บางกรณีกราฟวงกลมไม่แสดงข้อมูลแม้มีจำนวนเตียงว่าง
   - ตัวอักษรในกราฟวงกลมไม่ชัดเจนในโหมดมืด

3. **การแสดงผลตาม Role ของผู้ใช้**:
   - Dashboard ควรแสดงเฉพาะข้อมูลของแผนกที่ผู้ใช้มีสิทธิ์เข้าถึง ยกเว้นผู้ดูแลระบบที่ควรเห็นข้อมูลทั้งหมด

## การแก้ไข

1. **แก้ไขการแสดงผล Dark Mode**:
   - ปรับปรุง CSS ใน `DashboardOverview.tsx` ให้รองรับ Dark Mode ได้อย่างสมบูรณ์
   - ลบปุ่มสลับโหมดสีธีมที่ซ้ำซ้อนในไฟล์ `DashboardPage.tsx` และใช้เฉพาะปุ่มที่อยู่ในไฟล์ `app/layout.tsx` ซึ่งใช้คอมโพเนนต์ `<ThemeToggle />`

2. **ปรับปรุงกราฟแท่งและกราฟวงกลม**:
   - แก้ไขการแสดงตัวเลขในกราฟวงกลมให้เป็นจำนวนเต็ม (ไม่มีทศนิยม) โดยใช้ `Math.round()` 
   - ปรับปรุงการแสดงผลของ `EnhancedPieChart.tsx` ให้แสดงข้อมูลแม้ว่าค่าจะเป็น 0
   - เพิ่มความคมชัดของข้อความในกราฟวงกลมโดยเพิ่มค่า text-shadow ใน CustomLabel
   - ปรับสีข้อความในส่วน Legend ให้มองเห็นชัดเจนในโหมดมืดด้วยการเพิ่ม class `dark:text-gray-200`

3. **การแสดงผลตาม Role ของ User**:
   - ปรับปรุงโค้ดใน `DashboardPage.tsx` โดยเพิ่มตัวแปร `hasAdminAccess` เพื่อตรวจสอบสิทธิ์ของผู้ใช้
   - ปรับปรุงการกรองข้อมูลสำหรับกราฟและตาราง "ข้อมูลรวมทุกแผนก" โดยใช้เงื่อนไข:
     ```javascript
     hasAdminAccess ? summaryDataList : summaryDataList.filter(ward => 
       wards.some(userWard => userWard.id?.toUpperCase() === ward.id.toUpperCase())
     )
     ```
   - Admin, Super Admin และ Developer เห็นข้อมูลของทุก Ward
   - ผู้ใช้ทั่วไปเห็นเฉพาะข้อมูลของ Ward ที่ตนมีสิทธิ์เข้าถึง

## ไฟล์ที่แก้ไข

1. **app/features/dashboard/components/DashboardPage.tsx**:
   - ลบปุ่มสลับโหมดสีธีมที่ซ้ำซ้อน
   - เพิ่มตัวแปร `hasAdminAccess` และใช้กรองข้อมูลตาม role ของผู้ใช้
   - ปรับปรุงการส่งข้อมูลไปยัง `WardSummaryTable`

2. **app/features/dashboard/components/EnhancedBarChart.tsx**:
   - ปรับปรุงการแสดงผลตัวเลขใน tooltip ให้เป็นจำนวนเต็มโดยใช้ `Math.round()`

3. **app/features/dashboard/components/EnhancedPieChart.tsx**:
   - ปรับปรุงการแสดงผลตัวเลขให้เป็นจำนวนเต็มโดยใช้ `Math.round()` แทนการใช้ `.toFixed(1)`
   - ปรับปรุงการแสดงผลข้อความบนกราฟวงกลมด้วยการเพิ่มค่า text-shadow
   - แก้ไขสีข้อความใน Legend ให้มองเห็นชัดเจนในโหมดมืด

4. **app/features/dashboard/components/DashboardOverview.tsx**:
   - ปรับปรุงการแสดงผล Dark mode ให้มีความคมชัด

## ประโยชน์ที่ได้รับ

1. **การแสดงผลที่ดีขึ้น**:
   - การแสดงผลในโหมดมืดมีความคมชัดมากขึ้น
   - ไม่มีปุ่มที่ซ้ำซ้อนทำให้ UI สะอาดขึ้น
   - ตัวเลขแสดงในรูปแบบที่อ่านง่าย ไม่มีทศนิยมที่ไม่จำเป็น

2. **การเข้าถึงข้อมูลตามสิทธิ์**:
   - ผู้ใช้งานจะเห็นเฉพาะข้อมูลที่ตนมีสิทธิ์เข้าถึง
   - ผู้ดูแลระบบสามารถเห็นข้อมูลทั้งหมดได้

3. **ความสวยงามและความเป็นมืออาชีพ**:
   - กราฟมีการแสดงผลที่สม่ำเสมอแม้ข้อมูลจะเป็นศูนย์
   - การแสดงผลส่วนต่างๆ มีความเป็นมืออาชีพมากขึ้น

## สิ่งที่ต้องติดตาม

1. **ความถูกต้องของการกรองข้อมูล**:
   - ตรวจสอบว่าการกรองข้อมูลตาม role ของผู้ใช้ทำงานถูกต้องในทุกสถานการณ์
   - ตรวจสอบว่าผู้มีสิทธิ์ admin สามารถเข้าถึงข้อมูลของทุก ward ได้จริง

2. **ประสิทธิภาพของกราฟ**:
   - ตรวจสอบว่ากราฟแสดงข้อมูลได้อย่างถูกต้องแม้ว่าข้อมูลจะเป็นศูนย์หรือมีจำนวนน้อย
   - ตรวจสอบว่าการแสดงผลตัวเลขเป็นจำนวนเต็มไม่ส่งผลกระทบต่อความถูกต้องของข้อมูล 