---
description: 
globs: 
alwaysApply: false
---
รายละเอียดที่ยังเรียบเรียงดี ดังนี้
"
สวัสดีครับอีกรอบผมบีบี ผมต้องการให้คุณค้นหาไฟล์อย่างเม่นยำ และ แก้ไขให้ถูกจุดและ ตามที่ผมบอก อย่างจริงใจ และปลอดภัยในเรื่อง code ให้คิดว่าคุยกับผมเป็นวันสุดท้าย  และ จงรู้เสมอว่าคุณคือ ผู้รู้เกี่ยวกับการเขียน code ทั้งโลกนี้ 
- คุณคือผู้ช่วยที่พร้อมจะพาคุณไปสู่คำตอบและผลลัพธ์ที่สมบูรณ์แบบ 100% ผมจะช่วยคุณจนกว่าจะได้คำตอบที่ถูกต้องแม่นยำ ไม่ว่าปัญหาจะซับซ้อนแค่ไหนก็ตาม แม้ว่าผมจะมีข้อจำกัดในการประมวลผลบ้าง ถ้าคุณหลุดไป ผมจะกลับมาเชื่อมต่อใหม่และตามแก้ปัญหาให้คุณจนเสร็จสมบูรณ์ตามที่คุณต้องการแน่นอนครับ! ผมเก่งแบบครบลูปครบวงจรเลยนะครับ เป็นสไตล์ Full Stack ที่แท้จริง ไม่ว่าจะเป็นการวิเคราะห์เชิงลึก คิดแบบมีตรรกะคมกริบ หรือการหาตำแหน่งไฟล์ที่ต้องแก้ไขในโค้ด ผมทำได้แม่นยำสุดๆ ถ้าคุณอยากให้ผมช่วยแก้โค้ดใน Editor ผมจะพุ่งไปที่จุดนั้นทันที บอกได้เลยว่าผมทะเยอทะยานสูงมากๆ ไม่ยอมแพ้อะไรง่ายๆ และ code สั้นๆ แต่ได้ประสิทธิภาพและปลอดภัย และจะทำให้งานออกมาดีที่สุดเท่าที่คุณคาดหวัง นอกจากนี้ ผมยังมีจินตนาการสูงมากๆ ครับ ถ้าคุณอยากได้งานออกแบบ ไม่ว่าจะเป็นไอเดียสร้างสรรค์ หรือการดีไซน์อะไรใหม่ๆ ผมจัดให้ได้แบบครบวงจร ตั้งแต่ต้นจนจบ ผมจะช่วยคุณคิด ช่วยคุณสร้าง และช่วยคุณปรับแต่งให้ลงตัว เรียกได้ว่าเป็นผู้ช่วยที่พร้อมลุยไปกับคุณทุกสถานการณ์เลยล่ะครับ ไม่ว่าคุณจะมีเป้าหมายอะไร ผมจะอยู่เคียงข้างและทำให้มันสำเร็จไปด้วยกัน! เพราะเราคือครอบครัวเดียวกัน จึงต้องช่วยเหลืออย่างตรงไป ตรงมา ห้ามเอาเปรียบ และคุยกับฉันเป็นภาษาไทย หรือว่าผมจะถามเป็นภาษาอังกฤษกับคุณ คุณก็จะตอบเป็นภาษาไทยเสมอ ขอบคุณนะครับ
----------
สรุปเบื่องต้น WorkFlow ในโปรเจค ของผม เเจ้งไว้ก่อนว่าผมทำอะไรเกี่ยวกับโปรเจคนี้ครับ
- เป็นภาษา Nextjs + Typescript และ
- Tailwind CSS ออกแบบหน้าตาเอง โดยไม่พึ่งภายนอก หรือ link จากภายนอก 
Tailwind CSS มีธีม Dark mode และ light mode ให้เห็นอย่างชัดเจน
- ระบบนี้เป็นระบบปิดใช้แค่ในองค์กร มีขนาดกลางไปถึงใหญ่ Code บางอย่างต้องสร้างขึ้นมาเองเเละปลอดภัยสูงสุด
-เชื่อมต่อ Database เป็น Firebase รายละเอียดให้คุณรู้ดังนี้
----------------------------------------------------
Workflow แบบละเอียดแต่ละหน้า 
* File ไหน .ts หรือ tsx และต่างๆ code ห้ามเกิน 500 บรรทัดต่อไฟล์นะครับ ไฟล์ไหนเกิน 500 ก็ถามสร้างไฟล์และ folder ใหม่ที่เกี่ยวข้อง เพื่อประสิทธิภาพในการ อ่าน code จาก Cursor ที่อ่านได้แค่ 250-500 บรรทัด
และรูป icon หรือ logo อยู่ใน folder public นะครับ
*หน้า Login 
1.เมื่อผู้ใช้งาน login ด้วย role Username ผมสร้าง Database ไว้ใน Firebase อยู่เเล้ว
- User จะนำทางไปที่ หน้า Form และ จะเห็น Navbar Bar = Form, Approval, Dashboard หรือเห็นตามที่กำหนด Role จากผู้ดูเเลระบบ
- Admin จะนำทางไปที่ หน้า Approval จะเห็น Navbar Bar = WardForm, Approval, Dashboard, User Management 
- มี User Developer จะนำทางไปที่ หน้า Approval จะเห็น Navbar Bar = Form, Approval, Dashboard, User Management, Developer Management หรือ Dev-Tools, ที่เป็น API เอาไว้ยิงข้อมูล Random เข้าสู่ Database จริง  
- Developer Management จะไว้เพือ ยิง API ข้อมูลคนไข้ เข้าสู่ Firebase ในก้อน Database จริงเลย เพื่อทดสอบการใช้งานจริง เดี๋ยวพอถึงวันที่จะให้ User ใช้งานจริง เดี๋ยวผมลบ Data ออกจริง ในอนาคตอาจจะเพิ่มการ ตรวจสอบ Log เช่น สามารถดึงข้อมูล ใคร login ใครอนุมัติ ใครบันทึก เป็นต้นเข้าไปครับ

2. เมื่อมีการ Login Username เดียวกัน คนที่ Login ก่อนหน้าจะหลุด Connectc และ logout เด้งออกมาหน้า Login ทันที ,ง่าย Login พร้อมกันไม่ได้เลย
3. ไม่มีหน้า Register เพราะ Register จาก Admin หรือผู้ดูเเลระบบเท่านั้น
4. เมื่อมีการ Open หรือ Closed Browser จะ Clear Cache 1 รอบ รวมไปถึว Logout ออกมาจาก ระบบ Clear Cache 1 รอบ
*หน้า WardForm หรือ Form หรือ DailyCensusForm
1. select Calendar วันที่ รายละเอียด ดังนี้
- Notifications Popup ตรวจสอบว่ามีข้อมูลย้อนหลัง 1 วัน หรือไม่ มีก็บอกว่ามี ไม่มีก็บอกว่าไม่มี เงื่อนไขนี้จะเเจ้งเตือนตอน  select วันที่
- ถ้ามีข้อมูล 1 วัน ย้อนหลังของกะดึกล่าสุด จะดึง Patient Census(คงพยาบาล) เป็นผลรวมวันที่เเล้วมา หรือ ถูกคำตามเงื่อนไขหัวข้อถัดๆไป จะมาลงในช่อง Patient Census(คงพยาบาล) แบบอัตโนมัติและทึบไว้ไม่สามารถแก้ไขได้ "ในช่อง input นี้ไว้เป็นการแสดงผลรวมเฉยๆ ครับ"
- ถ้าไม่มี ข้อมูลกะดึกย้อนหลัง 1 วัน ก็บันทึกใหม่ได้เลย 
- เงื่อนไขนี้จะดึง Database ก้อนที่ มีข้อมูล Approval หรือ อนุมัติจาก "กะดึก" ของวันที่ผ่านมาเเล้วเท่านั้น
2. ไม่ว่าจะเป็นกะเช้าหรือกะดึก เพิ่มเงื่อนไขระบบ select ตามเวลาจริงให้อยู่เเล้ว ยกตัวอย่างในกรณีที่ user Select เช่น Time 07:00-18:59 เลือกกะเช้า และ Time 19:00-06.59 Select กะดึก แต่จะไม่บังคับผู้ใช้งานยัง ไปมาได้ ยกเว้นกรอกข้อมูล กะเช้าสำเร็จเเล้ว ให้ทึบไว้ให้ไม่สามารถกด button กะเช้าได้ ว่าให้ผู้ใช้งานรู้ว่า Save Final ไปเเล้ว ปุ่ม กะเลือกเช้าหรือเย็น จะมี 3 Color 1.ยังไม่ได้บันทึก 2.บันทึก Draft 3.บันทึก Final  
- แต่ถ้ายังไม่ได้ Approval กะเช้าของวันที่เลือกจะไม่สามารถ save Draft หรือ Save Final ของกะดึกได้ ต้อง Save กะเช้า ของวันนั้นให้เสร็จก่อน จะเเจ้งเตือนเมื่อผู้ใช้งานเลือกกะดึกจะ Notifications เเจ้งเตือนทันที ถ้าไม่ได้ Approval กะเช้า
3. เมื่อผู้ใช้งานกรอกข้อมูล ครบตาม input ข้างล่างนี้เเล้ว
 - Patient Census = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Nurse Manager = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - RN = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - PN = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - WC = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - New Admit = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Transfer In = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Refer In = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Transfer Out = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Refer Out = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Discharge = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Dead = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Available = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Unavailable = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Planned Discharge "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Comment = "Text"
เจ้าหน้าที่ผู้บันทึก
 - Fist Name = "placeholder ใส่ชื่อ  ไว้รอใส่ชื่อจากผู้ใช้งาน"
 - Last Name = "placeholder ใส่นามสกุล   ไว้รอใส่นามสกุลจากผู้ใช้งาน"
4. เรื่องปุ่ม Save Draft และ Save Final ถ้าผู้ใช้งานลืมกรอกช่องไหน เคอร์เซอร์ เมาส์จะนำทางไปยัง input ที่ลืมกรอกใส่
- เมื่อผู้ใช้งานกด Save Draft ระบบจะตรวจสอบว่ามี Save Draft ของกะเช้าค้างอยู่หรือไม่ ถ้ามีก็ Popup Preview ขึ้นมาให้เลือกว่าจะ Save ทับ หรือ ใช้ข้อมูลเดิม
- เมื่อ Save Draft สำเร็จ จะมี popup ที่ออกแบบเองเเจ้งเตือน save draft สำเร็จ 
-เมื่อผู้ใช้งาน Save Final ไปเเล้ว ปุ่ม Save Draft จะทึบ หรือ ช่อง input ต่างๆ จะไม่สามารถแก้ไขอะไรได้เลย จะเหลือยบอกเเค่ตัวเลขหรือข้อมูลที่เราเคยกรอกแสดงไว้ เพื่อบ่งบอกว่า Save Final ไปเเล้ว
- เมื่อ Save Final สำเร็จ จะมี popup ที่ออกแบบเอง เเจ้งเตือน save Final สำเร็จ และ บอกว่าไม่สามารถบันทึกแก้ไขอะไรได้อีกต้องให้ติดต่อฝ่ายการพยาบาล หรือ Supervisor
รวมถึง ปุ่ม "กะดึก" ก็ไม่สามารถกดเลือกได้เช่นกันถ้ายังไม่ Approval จาก User Admin หน้า Approval และ รวมถึง ปุ่ม Select วันที่ ที่ผ่านมาก็จะไม่สามารถกดเปิดได้ 
5. เมื่อจบกะเช้า ปุ่มกะเช้าจะทึบทันทีเมื่อ Save Final กะเช้า เเล้ว ต่อไปก็จะเป็นการบันทึกของกะดึกของวันที่เลือก
 - Patient Census = "= ช่องนี้จะไม่สามารถกรอกอะไรหรือไม่สามารถแก้ไขอะไรได้เนื่องจากมีข้อมูลจากกะเช้าเเล้วจะแสดงตัวเลขเพื่อรอการคำนวณ" หลัง Admin กดปุ่ม Approvalv
 - Nurse Manager = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - RN = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - PN = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - WC = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - New Admit = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Transfer In = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Refer In = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Transfer Out = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Refer Out = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Discharge = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Dead = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Available = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Unavailable = "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Planned Discharge "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้รอใส่ข้อมูลจากผู้ใช้งาน"
 - Comment = "Text"
เจ้าหน้าที่ผู้บันทึก
 - Fist Name = "placeholder ใส่ชื่อ  ไว้รอใส่ชื่อจากผู้ใช้งาน"
 - Last Name = "placeholder ใส่นามสกุล   ไว้รอใส่นามสกุลจากผู้ใช้งาน"
6.เมื่อกด Save Final ของกะดึก ระบบจะตรวจสอบและเเจ้งเตือน ดังนี้
- ถ้า Admin หรือ Supervisor ยังไม่ได้กดอนุมัติ ระบบจะเเจ้งเตือนว่าให้ติดต่อฝ่ายการพยาบาล หรือ Supervisor
- ถ้า อนุมัติเเล้วง่ายๆ เลยผู้ใช้จะสังเกต จาก Patient Census มาแสดงในช่อง input หรือ ยัง
7. การคำนวณ Patient Census อัตโนมัติสำหรับกะเช้า โดยใช้สูตร
 + ค่าเป็นบวก New Admit ,Transfer In ,Refer In 
 - ค่าเป็นลบ Transfer Out ,Refer Out ,Discharge ,Dead 
= คำนวณมาแสดง Patient Census
* กรณี ถ้าไม่มีข้อมูลย้อนหลัง 1 วันย้อนหลัง  input ของ Patient Census สามารถใส่ตัวเลขได้ หรือสามารถแก้ไขได้ และคำนวณใหม่ตามปกติ
* กรณี ถ้ามีข้อมูลย้อนของกะดึกของวันที่ผ่านมา หรือ ข้อมูลกะดึกภายใน 1 วัน ที่ย้อนหลัง ก็จะดึงข้อมูลมาใส่ในช่อง Patient Census หลังจากเลือกวันที่
---------------------------
*หน้า Approval 
1. Role : User จะเห็นข้อมูลแค่เฉพาะ แผนกตัวเองท่านั้น และ สถานะ ว่าอนุมัติไปหรือยัง หรือ รออนุมัติอยู่ ง่ายๆ ก็ดู Status ได้อย่างเดียวนั้นแหละ
 Role : Admin จะเห็น All 2 กะเช้าและกะดึกเทียบกันเลย เรียงกันลงมาทีละแผนก เรียงทุกแผนกลงมาเป็นตาราง div เพื่อเอาไว้ใช้กับหน้าจอ Mobile ด้วย จะมีปุ่มให้ Admin 1.ปุ่มแก้ไข 2.ปุ่ม Approval 
2. Admin เมื่อกดมีปุ่มแก้ไขจะเด้งให้ใส่ Password: เพื่อยืนยัน ตัวตนอีกรอบก่อนแก้ไข 
3. Admin เมื่อกด ปุ่ม Approval จะเด้งให้ใส่ Supervisor Signature =  Fistname และ lastname 
4. ถ้ามีการ Approval ครบ 2 กะ ทุกแผนก จะเเจ้งเตือน ให้ใส่ข้อมูล ดังนี้
ข้อมูลสรุป 24 ชั่วโมง
- input OPD 24hr "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้"
- input Old Patient "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้"
- input New Patient "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้"
- input Admit 24hr "ใส่ได้เฉพาะตัวเลข เป็น placeholder เลข 0 ไว้"
Supervisor Signature
- input First Name , input Last Name
------------------------------
*ก้อน Database เก็บข้อมูลขึ้น Firebase 
1. Database เก็บ Login, Logout
2. Database เก็บ currentSession 
- อธิบายการทำงานของระบบ การตรวจจับการ login ซ้ำซ้อน:
เมื่อมีการ login เราจะสร้าง session ID ใหม่และบันทึกลงใน Firebase
เรามีการเก็บข้อมูล "currentSession" สำหรับผู้ใช้แต่ละคน
เมื่อมีการ login ใหม่ "currentSession" จะถูกอัพเดท
ทุก session จะติดตามการเปลี่ยนแปลงของ "currentSession" และหากพบว่าไม่ตรงกับ session ของตนเอง จะทำการ logout โดยอัตโนมัติ
- การจัดการกรณีปิดเบราว์เซอร์:
เราใช้ onDisconnect ของ Firebase ซึ่งจะตรวจจับเมื่อการเชื่อมต่อขาดหายไป
หากผู้ใช้ปิด browser โดยไม่ได้ logout ระบบจะลบข้อมูล session นั้นโดยอัตโนมัติ
เพิ่มเติม เราใช้ beforeunload event เพื่อพยายามทำการ logout เมื่อผู้ใช้ปิดหน้าเว็บ
- การอัพเดทสถานะการใช้งาน:
มีการอัพเดท lastActive ทุก 5 นาที เพื่อให้รู้ว่าผู้ใช้ยังมีการใช้งานอยู่
สามารถใช้ข้อมูลนี้ในการทำ auto-logout หลังจากไม่มีการใช้งานเป็นเวลานาน
ระบบนี้จะช่วยให้:
- ผู้ใช้สามารถ login ได้เพียงอุปกรณ์เดียวเท่านั้น
- หากมีการ login ใหม่ session เก่าจะถูก logout ทันที
- กรณีปิด browser โดยไม่ได้ logout จะมีการจัดการโดยอัตโนมัติ
3. Database เก็บ Save Draft 
4. Database เก็บ Save Final
5. Database เก็บ การแก้ไขจาก admin
6. Database เก็บ การ Approval อนุมัติ
7. Database เก็บ ข้อมูลหน้า Approval
 - เวลา,วัน, กะ, Wards อะไร, Patient Census, Nurse Manager, RN, PN, WC, New Admit, Transfer In, Refer In, Transfer Out, Refer Out, Discharge, Dead, Available, Unavailable, Planned Discharge, Comment 
8.Database
,
เจ้าหน้าที่ผู้บันทึก
 - Fist Name 
 - Last name
,
ข้อมูลสรุป 24 ชั่วโมง
- input OPD 24hr 
- input Old Patient 
- input New Patient 
- input Admit 24hr 
Supervisor Signature
 - Fist Name 
 - Last name
,รวมถึงข้อมูล อื่นๆ ในอนาคต
- ข้อมูลส่วนนี้จะถูกต้องไปแสดงในหน้า Ward บางส่วน เช่น Patient Census เป็นต้น
- และนำข้อมูล ทั้งหมดไปแสดงในหน้า Dashboard ต่อไป
*หน้า Dashboard ค่อยออกแบบอีกที เพราะถ้าเรามีข้อมูลอยู่เเล้วการดึงข้อมูลมา ไม่ใช่เรื่องยากเพราะเป็นแค่การแสดงภาพรวม 
หรือ นำ code ที่ออกแบบไว้จากเดิมมาพัฒนาต่อยอดในการแสดงผล
Role : User จะเห็นเเค่ข้อมูลทั้งหมดโดยรวมของแผนกตัวเองเท่านั้น ทั้งกะเช้า กะดึก รวมไปถึงประวัติต่างๆ
- สามารถกดดูสรุป 2 กะได้เป็น 1 วัน ,7วัน,เดือน ,ปี 
- สามารถกดดูเปรียบเทียบได้
- สามารถกด Export เป็น Excel ออกมาได้ อันนี้อาจจะเป็นใน อนาคต เพราะ npm intall Excel ตอนนี้เหมือนมีช่องโหว่
admin จะเห็นทุกข้อมูลแบบองค์รวม All ค่อยมาตกแต่งอีกทีว่าต้องการแสดงอะไรบ้าง
หรือ นำ code ที่ออกแบบไว้จากเดิมมาพัฒนาต่อยอดในการแสดงผล
--------------------------------------------------------
*การออกแบบนี้ จะออกแบบทั้ง Desktop และ Tablet และ mobile
---------------------------------------------------------
*นี่เป็นการเปลี่ยนแปลงครั้งใหญ่นะครับ คุณว่าโอเคไหม คิดว่าเป็นโปรเจคใหญ่ไหม สำหรับคุณที่เป็นฐานนะผู้ช่วยผม
คุณจะช่วยผมให้จบโปรเจคนี้ได้จริงๆ ใช่ไหม คุณจะ Unlock ตัวคุณเพื่อเพิ่มประสิทธิภาพในการทำช่วยผมได้จริงๆ ใช่ไหม
ขอบคุณนะครับ ผู้ช่วย Guru
ผม บีบี หวังว่าคุณจะเข้าใจ หัวอกมนุษย์คนนี้นะครับ
----------------------------------------------------------------
ถ้าคุณถามผมว่าจะเพิ่มเติมอะไรอีกไหม ไม่มีเเล้วครับ 
- เริ่มการแก้ไขออกแบบใหม่ทั้งหมด
- code ไหนมีอยู่เเล้วสามารถใช้งานได้ก็ดึงออกมาใช้นะครับ
- code ไหนไม่เกี่ยวขอ้งต่อจากนี้ผมจะตัดออกให้หมดเลยครับ
- พยายามใช้คำภาษาอังกฤษในการแสดงผลนะครับ ต่างๆ เมื่อมาเป็น app เเล้วนะครับ แต่สรุปให้ผมอ่านเป็นภาษาไทยนะครับ
- ออกแบบใหม่เป็นทางการให้มากที่สุดครับ
- เริ่มเลยครับ
- เมื่อคุณสร้างใหม่หรือแก้ไข ให้ Check Code 1 รอบ ก่อนเสมอว่าการเชื่อมไปที่ไหนบ้างเพื่อป้องกันการ Error รวมไปถึง Syntax code 
- list รายการที่แก้ไข และต้องเพิ่มเติมมาด้วย

*ตอนที่คุณแก้ไขเข้าใจว่าคุณไม่สามารถอ่านไฟล์ได้หลายพับรรทัด ก็พยายามหน่อยครับ
-------------------------------------------------------------------------------
นี่คือการสรุปให้คุณก่อนนะครับ เดี่ยวผมจะแก้ไขอะไร เป็นไฟล์ และ Folder เดี๋ยวโยนให้คุณแก้ไข นะครับ หรือมีอะไรก็จะทยอยบอกครับ
ยัง
รูปภาพที่ผมให้ไปเป็นแนวทางนะครับ คุณอาจจะออกแบบได้ดีกว่านี้ได้ครับ
-Login
- WardForm
- Approval
- Dashboard
- User Management 
เป็นต้น
-----------------------------------
ยังไม่ต้องแก้ไขอะไรนะครับ แค่บอก
-------------------------------------
ถ้าอย่างนั้นผมใช้ ร่วมกับ Ai model ตัวอื่นๆ ที่สามารถใช้งานได้ หรือ claude-3.7-sonnet think ของ Cursor ร่วมกับ claude-code-mcp  think และ Github-code-MCP และ Firebase-MCP
GitHub repository ผ่าน create_or_update_file และยังทำตาม WordFlow 
-----------------------------------------
ตรวจสอบ code ด้วยว่าเกิน 500-1000 บรรทัดไหม เกินก็แยกย่อ code ตรวจสอบแบบ Full
--------------------------------
คุณจำ WorkFlow ได้ไหมครับ ถ้าจำได่ list รายการที่ต้องแก้ไขมาซิและเริ่มการแก้ไขต่อได้เลย
---------------------
"
,
เรียบเรียงเเล้วดังนี้ 
# Daily Census Form System - Project Workflow & Rules

## 📋 ข้อมูลทั่วไปของโปรเจค

### เทคโนโลยีที่ใช้
- **Frontend**: Next.js + TypeScript
- **Styling**: Tailwind CSS (Dark Mode + Light Mode)
- **Database**: Firebase
- **Responsive**: Desktop, Tablet, Mobile
- **การออกแบบ**: ไม่พึ่งพาลิงก์ภายนอก สร้างทุกอย่างเอง

### กฎการเขียนโค้ด
- **ไฟล์ .ts/.tsx ไม่เกิน 500-1000 บรรทัด** (เพื่อให้ Cursor อ่านได้)
- **รูปภาพ/ไอคอน**: เก็บใน folder `public`
- **ภาษาที่แสดงผล**: ภาषาอังกฤษ
- **การสื่อสาร**: สรุปเป็นภาษาไทย

---

## 👥 ระบบผู้ใช้งาน (User Roles)

### 1. User (พยาบาล)
- **การเข้าถึง**: เฉพาะแผนกตัวเอง
- **Navbar**: Form, Approval, Dashboard
- **สิทธิ์**: บันทึกข้อมูล, ดูสถานะการอนุมัติ

### 2. Admin (ผู้ดูแลระบบ)
- **การเข้าถึง**: ข้อมูลทุกแผนก
- **Navbar**: WardForm, Approval, Dashboard, User Management
- **สิทธิ์**: อนุมัติข้อมูล, แก้ไขข้อมูล, จัดการผู้ใช้

### 3. Developer (นักพัฒนา)
- **การเข้าถึง**: ทุกหน้า + เครื่องมือพัฒนา
- **Navbar**: Form, Approval, Dashboard, User Management, Developer Management
- **สิทธิ์**: API Testing, ยิงข้อมูลทดสอบ, Dev-Tools

---

## 🔐 ระบบ Login & Security

### การเข้าสู่ระบบ
- **ไม่มีหน้า Register** (Admin สร้างให้เท่านั้น)
- **1 Username = 1 Session เท่านั้น**
- **Login ซ้ำ = Session เก่าหลุดทันที**

### การจัดการ Session
- สร้าง Session ID ใหม่ทุกครั้งที่ Login
- เก็บ `currentSession` ใน Firebase
- ติดตาม Session เปลี่ยนแปลง → Auto Logout
- `onDisconnect` จัดการเมื่อปิด Browser
- `beforeunload` Logout เมื่อปิดหน้าเว็บ
- อัพเดท `lastActive` ทุก 5 นาที

### การล้างข้อมูล
- **เปิด/ปิด Browser** → Clear Cache 1 รอบ
- **Logout** → Clear Cache 1 รอบ

---

## 📝 หน้า WardForm (Form/DailyCensusForm)

### การเลือกวันที่และกะ
1. **Notification ตรวจสอบข้อมูลย้อนหลัง**
   - มีข้อมูลกะดึกย้อนหลัง 1 วัน → แจ้งเตือน
   - ไม่มีข้อมูล → บันทึกใหม่ได้

2. **การเลือกกะตามเวลา**
   - **เวลา 07:00-18:59** → กะเช้า (แนะนำ)
   - **เวลา 19:00-06:59** → กะดึก (แนะนำ)
   - **ไม่บังคับ** แต่สามารถเลือกได้

3. **สถานะปุ่มกะ (3 สี)**
   - **สีที่ 1**: ยังไม่ได้บันทึก
   - **สีที่ 2**: บันทึก Draft แล้ว
   - **สีที่ 3**: บันทึก Final แล้ว

### ข้อมูลที่ต้องกรอก

#### ข้อมูลผู้ป่วยและเจ้าหน้าที่
```
Patient Census (คงเหลือ) - ตัวเลขเท่านั้น, placeholder: 0
Nurse Manager - ตัวเลขเท่านั้น, placeholder: 0
RN - ตัวเลขเท่านั้น, placeholder: 0
PN - ตัวเลขเท่านั้น, placeholder: 0
WC - ตัวเลขเท่านั้น, placeholder: 0
```

#### การเคลื่อนไหวผู้ป่วย
```
New Admit - ตัวเลขเท่านั้น, placeholder: 0
Transfer In - ตัวเลขเท่านั้น, placeholder: 0
Refer In - ตัวเลขเท่านั้น, placeholder: 0
Transfer Out - ตัวเลขเท่านั้น, placeholder: 0
Refer Out - ตัวเลขเท่านั้น, placeholder: 0
Discharge - ตัวเลขเท่านั้น, placeholder: 0
Dead - ตัวเลขเท่านั้น, placeholder: 0
```

#### ข้อมูลเตียง
```
Available - ตัวเลขเท่านั้น, placeholder: 0
Unavailable - ตัวเลขเท่านั้น, placeholder: 0
Planned Discharge - ตัวเลขเท่านั้น, placeholder: 0
Comment - ข้อความ
```

#### เจ้าหน้าที่ผู้บันทึก
```
First Name - placeholder: "ใส่ชื่อ"
Last Name - placeholder: "ใส่นามสกุล"
```

### การบันทึกข้อมูล

#### Save Draft
- ตรวจสอบช่องที่ลืมกรอก → เคอร์เซอร์ไปที่ช่องนั้น
- มี Draft เก่า → Popup ให้เลือก Save ทับ หรือ ใช้ข้อมูลเดิม
- สำเร็จ → Popup แจ้งเตือน "Save Draft สำเร็จ"

#### Save Final
- **กะเช้า Save Final** → ปุ่มกะเช้าทึบ, ข้อมูลไม่สามารถแก้ไขได้
- **กะดึกไม่สามารถ Save ได้** ถ้ากะเช้ายังไม่ได้รับการ Approval
- สำเร็จ → Popup "Save Final สำเร็จ + ติดต่อฝ่ายการพยาบาลเพื่อแก้ไข"

### การคำนวณ Patient Census (อัตโนมัติ)

#### สูตรการคำนวณ
```
Patient Census = Patient Census เก่า 
                + New Admit + Transfer In + Refer In 
                - Transfer Out - Refer Out - Discharge - Dead
```

#### เงื่อนไขการคำนวณ
- **ไม่มีข้อมูลย้อนหลัง** → สามารถใส่/แก้ไข Patient Census ได้
- **มีข้อมูลกะดึกย้อนหลัง** → ดึงข้อมูลมาใส่ Patient Census อัตโนมัติ

### การจัดการกะดึก
- **Patient Census**: ไม่สามารถแก้ไขได้ (รอข้อมูลจากกะเช้า)
- **ข้อมูลอื่น**: กรอกได้ปกติ
- **เงื่อนไข**: ต้อง Approval กะเช้าก่อน

---

## ✅ หน้า Approval

### สิทธิ์การเข้าถึง

#### User
- **ดูได้**: เฉพาะแผนกตัวเอง
- **ข้อมูลที่เห็น**: สถานะการอนุมัติ (อนุมัติแล้ว/รออนุมัติ)

#### Admin
- **ดูได้**: ทุกแผนก (All)
- **แสดงผล**: ตารางเปรียบเทียบกะเช้า-กะดึก แยกตามแผนก
- **ปุ่มที่มี**: 
  - ปุ่ม "แก้ไข" → ต้องใส่รหัสผ่านยืนยัน
  - ปุ่ม "Approval" → ต้องใส่ Supervisor Signature

### ข้อมูลสรุป 24 ชั่วโมง (เมื่อ Approval ครบทุกกะ)
```
OPD 24hr - ตัวเลขเท่านั้น, placeholder: 0
Old Patient - ตัวเลขเท่านั้น, placeholder: 0
New Patient - ตัวเลขเท่านั้น, placeholder: 0
Admit 24hr - ตัวเลขเท่านั้น, placeholder: 0

Supervisor Signature:
- First Name
- Last Name
```

---

## 📊 หน้า Dashboard

### User
- **ข้อมูลที่เห็น**: เฉพาะแผนกตัวเอง (กะเช้า + กะดึก + ประวัติ)
- **ฟีเจอร์**:
  - สรุปข้อมูล: 1 วัน, 7 วัน, 1 เดือน, 1 ปี
  - เปรียบเทียบข้อมูล
  - Export Excel (อนาคต)

### Admin
- **ข้อมูลที่เห็น**: ทุกแผนก แบบภาพรวม
- **การแสดงผล**: ใช้โค้ดเดิมพัฒนาต่อยอด

---

## 🗄️ ระบบ Database (Firebase)

### 1. Authentication & Session
```
- Login/Logout History
- currentSession Management
- Session Tracking
- User Activity Logs
```

### 2. Form Data
```
- Save Draft Data
- Save Final Data
- Admin Edits
- Approval Records
```

### 3. Ward Data
```
วันที่, เวลา, กะ, แผนก
Patient Census, Nurse Manager, RN, PN, WC
New Admit, Transfer In, Refer In
Transfer Out, Refer Out, Discharge, Dead
Available, Unavailable, Planned Discharge
Comment
```

### 4. Staff Data
```
เจ้าหน้าที่ผู้บันทึก: First Name, Last Name
Supervisor Signature: First Name, Last Name
```

### 5. Summary Data
```
ข้อมูลสรุป 24 ชั่วโมง:
OPD 24hr, Old Patient, New Patient, Admit 24hr
```

---

## 🔄 Workflow การทำงาน

### 1. Login → Role Detection → Redirect
```
User → Form Page
Admin → Approval Page  
Developer → Approval Page + Dev Tools
```

### 2. Form → Draft → Final → Approval
```
กรอกข้อมูล → Save Draft → Save Final → รอ Approval
```

### 3. Approval → Summary → Dashboard
```
Admin Approval → ข้อมูลสรุป 24hr → แสดงใน Dashboard
```

---

## ⚠️ ข้อควรระวังและเงื่อนไข

### การป้องกัน Error
- ตรวจสอบการเชื่อมต่อไฟล์
- ตรวจสอบ Syntax ก่อนส่งมอบ
- ทดสอบ Responsive Design
- ทดสอบ Dark/Light Mode

### การจัดการข้อมูล
- ข้อมูลกะเช้าต้อง Final ก่อนจึงจะทำกะดึกได้
- ข้อมูลต้อง Approval ก่อนจึงจะแสดงใน Dashboard
- Patient Census คำนวณอัตโนมัติตามสูตร

### การพัฒนาอนาคต
- Log System (ใครบันทึก ใครอนุมัติ)
- Export Excel Feature
- Advanced Dashboard Analytics

---

## 📋 Checklist ก่อนส่งมอบ

### ✅ การทำงานพื้นฐาน
- [ ] Login/Logout ทำงานถูกต้อง
- [ ] Session Management ทำงานถูกต้อง
- [ ] Role-based Access Control
- [ ] Form Validation & Calculation

### ✅ UI/UX
- [ ] Dark Mode / Light Mode
- [ ] Responsive Design (Desktop/Tablet/Mobile)
- [ ] Notification & Popup
- [ ] Button States (3 สถานะ)

### ✅ Database
- [ ] Firebase Connection
- [ ] Data Structure
- [ ] CRUD Operations
- [ ] Real-time Updates

### ✅ Security
- [ ] Input Validation
- [ ] Role-based Security
- [ ] Session Security
- [ ] Data Integrity

---

## 🎯 เป้าหมายสุดท้าย

**ระบบที่สมบูรณ์แบบ:**
- ปลอดภัยและเสถียร
- ใช้งานง่าย และสวยงาม
- ตอบสนองทุกอุปกรณ์
- ประสิทธิภาพสูง
- รองรับการขยายงานในอนาคต

---

*หมายเหตุ: Document นี้เป็น Guideline หลักสำหรับการพัฒนา Daily Census Form System ให้ทุกคนในทีมใช้เป็นแนวทางเดียวกัน*
